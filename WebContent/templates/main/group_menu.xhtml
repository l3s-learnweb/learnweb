<html xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
      xmlns:h="http://xmlns.jcp.org/jsf/html"
      xmlns:f="http://xmlns.jcp.org/jsf/core"
      xmlns:p="http://primefaces.org/ui">

<ui:composition>
    <div class="group-menu">
        <h3 class="group_link">
            <h:outputLink value="myhome/groups.jsf" style="font-weight:normal;">
                <h:outputText value="#{msg.groupOverview}"/>
                <h:outputText value="(#{userBean.newGroupsCount})" rendered="#{userBean.newGroupsCount gt 0}"
                              id="new_group_count" styleClass="bold_red" style="padding-left:3px;"/>
            </h:outputLink>
        </h3>
        <p:tooltip for="new_group_count" showEffect="fade" hideEffect="fade">
            <h:outputFormat value="#{msg.new_groups_message}">
                <f:param value="#{userBean.newGroupsCount}"/>
            </h:outputFormat>
        </p:tooltip>
    </div>

    <ui:fragment rendered="#{!userBean.groupResourcesPage}">
        <h:panelGroup layout="block" id="group_menu" styleClass="group-menu">
            <ui:repeat value="#{userBean.groupMenu}" var="group">
                <div class="panelmenu">
                    <h3 class="group_link">
                        <h:link value="#{group.label}" outcome="/lw/group/resources.jsf?group_id=#{group.id}"/>
                    </h3>
                </div>
            </ui:repeat>
        </h:panelGroup>
    </ui:fragment>

    <ui:fragment rendered="#{userBean.groupResourcesPage}">
        <h:panelGroup layout="block" id="group_menu_tree" styleClass="group-menu">
            <ui:repeat value="#{userBean.groupMenu}" var="group">
                <h:panelGroup rendered="#{groupResourcesBean.groupId != group.id}">
                    <div class="panelmenu">
                        <h3 class="group_link">
                            <h:link value="#{group.label}" outcome="/lw/group/resources.jsf?group_id=#{group.id}"/>
                        </h3>
                    </div>
                </h:panelGroup>
                <h:panelGroup rendered="#{groupResourcesBean.groupId == group.id}">
                    <div class="panelmenu active folder-tree">
                        <div id="folders_tree_wrap">
                            <h:form id="folders_tree_form">
                                <p:tree id="folders_tree" value="#{groupResourcesBean.getFoldersTree(group.id)}" var="node" animate="true" dynamic="true" selectionMode="single" selection="#{groupResourcesBean.selectedNode}" datakey="#{node.folderId}">
                                    <p:ajax event="select" update=":breadcrumbs :resourcesView :paginator :right_pane_wrapper" listener="#{groupResourcesBean.onGroupMenuNodeSelect}" oncomplete="updateCarousel();scroller();update_url(0,$('#folders_tree_wrap .ui-treenode-label.ui-state-highlight').parents('.ui-treenode')[0].getAttribute('data-datakey'));resourceDND();update_header();"/>
                                    <p:ajax event="expand" oncomplete="resourceDND();"/>
                                    <p:ajax event="collapse" oncomplete="resourceDND();"/>

                                    <p:treeNode type="root">
                                        <h:outputText id="root" value="#{node.name}"/>
                                    </p:treeNode>

                                    <p:treeNode type="folder" expandedIcon="ui-icon-folder-open" collapsedIcon="ui-icon-folder-collapsed">
                                        <h:outputText value="#{node.name}"/>
                                    </p:treeNode>
                                </p:tree>
                            </h:form>
                        </div>
                    </div>
                </h:panelGroup>
            </ui:repeat>
        </h:panelGroup>
    </ui:fragment>
</ui:composition>
</html>