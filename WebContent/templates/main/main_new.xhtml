<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
      xmlns:h="http://xmlns.jcp.org/jsf/html"
      xmlns:f="http://xmlns.jcp.org/jsf/core"
      xmlns:p="http://primefaces.org/ui"
      xmlns:pp="http://primefaces.org/california"
      lang="#{userBean.localeCode}">

<!--@elvariable id="pageTitle" type="java.lang.String"-->
<!--@elvariable id="helpText" type="java.lang.String"-->
<!--@elvariable id="disableGrowl" type="java.lang.Boolean"-->
<!--@elvariable id="smallPage" type="java.lang.Boolean"-->
<!--@elvariable id="loginRequired" type="java.lang.Boolean"-->

<f:view locale="#{userBean.locale}" contentType="text/html">
    <ui:insert name="metadata"/>

    <h:head>
        <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>
        <title>#{pageTitle} - #{msg['application.name']}</title>
        <link rel="shortcut icon" href="#{request.contextPath}/resources/icon/favicon.ico"/>

        <h:outputStylesheet library="main-template" name="main_new.css"/>
        <h:outputStylesheet library="primeflex-master" name="primeflex.css"/>
        <h:outputStylesheet library="california-layout" name="css/layout-green.css"/>
        <h:outputStylesheet library="california-layout" name="css/nanoscroller.css"/>

        <h:outputScript library="primefaces" name="jquery/jquery.js" target="head"/>
        <h:outputScript library="california-layout" name="js/layout.js" target="head"/>
        <h:outputScript library="california-layout" name="js/nanoscroller.js" target="head"/>
        <h:outputScript library="main-template" name="default2.js"/>

        <ui:decorate template="/templates/main/tooltips.xhtml"/>

        <base href="#{request.contextPath}/lw/"/>
    </h:head>

    <h:body>
        <p:growl id="growl" rendered="#{not disableGrowl}"/>

        <ui:decorate template="/templates/main/header_new.xhtml"/>

        <section id="content">
            <ui:fragment rendered="#{not learnwebBean.maintenanceMode}">
                <p:messages id="message" showDetail="false" showSummary="true" escape="false"/>

                <h:panelGroup layout="block" styleClass="small_page" rendered="#{loginRequired and !userBean.loggedIn}">
                    <ui:include src="/templates/user/login.xhtml"/>
                </h:panelGroup>

                <h:panelGroup rendered="#{!loginRequired || userBean.loggedIn}">
                    <ui:insert name="center_layout"></ui:insert>
                </h:panelGroup>
            </ui:fragment>
            <ui:fragment rendered="#{learnwebBean.maintenanceMode}">
                <div class="error" style="font-size:1.4rem">#{msg.service_unavailable}</div>
            </ui:fragment>
        </section>

<!-- 
        <h:panelGroup layout="block" id="footer" rendered="#{not empty helpText}"
                      styleClass="#{userBean.getPreference('helptext_hide')? 'display-none':''}">
            <h:outputText value="?" id="footer_question_mark"/>
            <h:outputText value="#{helpText}" escape="false" id="footer_text"/>
            <a href="#" onclick="return footerClose();" id="footer_close" title="#{msg.close}"></a>
        </h:panelGroup>
 -->

        <h:form styleClass="display-none">
            <p:remoteCommand actionListener="#{userBean.setPreferenceRemote()}" name="setPreferenceRemote" async="true" process="@this"/>
			<p:remoteCommand actionListener="${searchBean.logQuerySuggestion()}" name="logQuerySuggestion" async="true" process="@this" partialSubmit="true" global="false"/>
        </h:form>
        
		<h:form>
			<p:ajaxExceptionHandler type="javax.faces.application.ViewExpiredException" onexception="PF('expiredExceptionDialog').show();" />
	
			<p:ajaxExceptionHandler type="java.lang.Exception" update="exceptionDialog" onexception="PF('exceptionDialog').show();" />
	
			<p:dialog id="exceptionDialog" header="Exception '#{pfExceptionHandler.type}' occured!" widgetVar="exceptionDialog" height="500px">
		        #{msg.message}: #{pfExceptionHandler.message}
		        <br />
		        StackTrace:
		        <h:outputText value="#{pfExceptionHandler.formattedStackTrace}" escape="false" />
				<br />
			</p:dialog>
	
			<p:dialog header="#{msg.session_expired}" widgetVar="expiredExceptionDialog" modal="true">
				<div class="error" style="font-size:1.4rem">
					#{msg.reload_page}
				</div>
		        <br/>
		        <br/>
		        <p:button onclick="document.location.reload(); return false;" value="#{msg.reload}" />
			</p:dialog>
		</h:form>
		
		<p:confirmDialog global="true" showEffect="fade" hideEffect="fade" header="#{msg.confirmation}" icon="ui-icon-alert">
			<p:commandButton value="#{msg.yes}" type="button" styleClass="ui-confirmdialog-yes" icon="ui-icon-check" />
			<p:commandButton value="#{msg.no}" type="button" styleClass="ui-confirmdialog-no" icon="ui-icon-close" />
		</p:confirmDialog>
		
		<ui:fragment rendered="#{userBean.trackingEnabled}">
			<script src="//learnweb.l3s.uni-hannover.de/tracker/js/client.min.js"></script>
			<script type="text/javascript">
                if (!window.tracker)
                {
                    window.tracker = new L3STracker({
                        apiKey: '#{learnwebBean.trackerApiKey}',
                        apiHost: '//learnweb.l3s.uni-hannover.de/tracker',
                        externalUserId: '#{userBean.getUser().getId()}'
                    });
                }
			</script>
		</ui:fragment>
    </h:body>
</f:view>

</html>