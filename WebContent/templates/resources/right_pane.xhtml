<ui:composition xmlns="http://www.w3.org/1999/xhtml"
                xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
                xmlns:h="http://xmlns.jcp.org/jsf/html"
                xmlns:f="http://xmlns.jcp.org/jsf/core"
                xmlns:c="http://xmlns.jcp.org/jsp/jstl/core"
                xmlns:p="http://primefaces.org/ui">

    <p:layoutUnit rendered="#{userBean.loggedIn}" header="#{rightPaneBean.panelTitle}" position="east" size="38%" resizable="false" closable="false" collapsible="false" id="right_pane">

        <h:outputScript library="resource-pane-template" name="resource-pane4.js" target="head"/>
        <h:outputStylesheet library="resource-pane-template" name="resource-pane.css"/>

        <h:panelGroup layout="block" id="right_pane_wrapper" styleClass="right-panel">
            <h:inputHidden id="panel_header_title" value="#{rightPaneBean.panelTitle}" readonly="true"/>

            <ui:fragment rendered="#{rightPaneBean.paneAction == 'newFile'}">
                <h:panelGroup styleClass="create-block new-resource" style="padding-bottom:2rem" layout="block">
                    <h:form id="create_file_form">
                        <p:fieldset id="create_file_fieldset" style="margin-bottom:20px">
                            <p:panelGrid styleClass="full-width">
                                <p:row>
                                    <p:column>
                                        <h:outputText value="#{msg.location}:"/>
                                    </p:column>
                                    <p:column>
                                        <p:commandLink onstart="selectNewResourceLocation();">
                                            <h:outputText value="#{addResourceBean.currentPath}"/>
                                        </p:commandLink>
                                    </p:column>
                                </p:row>
                                <p:row>
                                    <p:column>
                                        <h:outputText value="#{msg.file_name}*:"/>
                                    </p:column>
                                    <p:column>
                                        <p:inputText validator="#{addResourceBean.validateNewDocName}" value="#{addResourceBean.resource.fileName}" styleClass="add_field"/>
                                    </p:column>
                                </p:row>
                            </p:panelGrid>
                        </p:fieldset>
                        * #{msg.mandatory_field}

                        <p:commandButton id="create_file_button" widgetVar="create-button" value="#{msg.create}" styleClass="greenbutton float-right"
                                         update=":growl :right_pane_wrapper :datagrid" actionListener="#{addResourceBean.createFile}" ajax="true"
                                         onstart="PF('create-button').disable()" oncomplete="update_header();resourceDND(); load_lightbox_editor();load_editor();">
                            <f:setPropertyActionListener target="#{addResourceBean.formStep}" value="0"/>
                            <f:setPropertyActionListener target="#{rightPaneBean.viewResource}" value="#{addResourceBean.resource}"/>
                        </p:commandButton>

                        <p:commandButton value="#{msg.cancel}" styleClass="graybutton float-right" style="margin-right:0.5em;"
                                         update=":right_pane_wrapper" actionListener="#{addResourceBean.cancelUpload}" ajax="true" immediate="true"
                                         oncomplete="update_header(); PF('block1').hide();load_editor();">
                            <f:setPropertyActionListener target="#{rightPaneBean.paneAction}" value="none"/>
                        </p:commandButton>
                        <br class="clear"/>
                        <p:blockUI block="create_file_fieldset" trigger="create_file_button" widgetVar="block1">
                            <div class="float-left" style="height: 25px; line-height: 25px;">#{msg.please_wait}</div>
                            <div class="loading-animation small float-left">
                                <div></div>
                                <div></div>
                                <div></div>
                            </div>
                        </p:blockUI>
                    </h:form>
                </h:panelGroup>
            </ui:fragment>


            <!-- Create resource block -->
            <h:panelGroup id="add_resource_section" rendered="#{rightPaneBean.paneAction == 'newResource'}"
                          styleClass="create-block new-resource" style="padding-bottom:2rem" layout="block">

                <h:form id="add_resource_upload_form" rendered="#{addResourceBean.formStep > 0}">

                    <p:fieldset legend="#{msg.step} 1" style="margin-bottom:20px" id="step1_field">
                        <p:panelGrid styleClass="full-width">
                            <p:row>
                                <p:column>
                                    <h:outputText value="#{msg.type}:"/>
                                </p:column>
                                <p:column>
                                    <h:outputText value="#{addResourceBean.resource.getStringStorageType()}"/>
                                </p:column>
                            </p:row>
                            <p:row>
                                <p:column>
                                    <h:outputText value="#{msg.location}:"/>
                                </p:column>
                                <p:column rendered="#{addResourceBean.formStep == 1}">
                                    <p:commandLink onstart="selectNewResourceLocation();">
                                        <h:outputText value="#{addResourceBean.currentPath}"/>
                                    </p:commandLink>
                                </p:column>
                                <p:column rendered="#{addResourceBean.formStep > 1}">
                                    <h:outputText value="#{addResourceBean.currentPath}"/>
                                </p:column>
                            </p:row>
                            <p:row rendered="#{addResourceBean.resource.storageType == 1 and not (addResourceBean.resource.type eq 'glossary' or addResourceBean.resource.type eq 'survey') }">
                                <p:column>
                                    <h:outputText value="#{msg.file}:"/>
                                </p:column>
                                <p:column
                                        rendered="#{addResourceBean.formStep == 1 and not (addResourceBean.resource.type eq 'glossary' or addResourceBean.resource.type eq 'survey') }">
                                    <p:fileUpload fileUploadListener="#{addResourceBean.handleFileUpload}"
                                                  mode="advanced" auto="true" sizeLimit="10000000000" fileLimit="1"
                                                  label="#{msg.choose_file}" update=":growl :add_resource_section"/>
                                </p:column>
                                <p:column rendered="#{addResourceBean.formStep > 1}">
                                    <h:outputText value="#{addResourceBean.resource.url}"/>
                                </p:column>
                            </p:row>
                            <p:row rendered="#{addResourceBean.resource.storageType == 2 }">
                                <p:column>
                                    <h:outputText value="URL:"/>
                                </p:column>
                                <p:column rendered="#{addResourceBean.formStep == 1}">
                                    <p:inputText value="#{addResourceBean.resource.url}" styleClass="add_field"
                                                 required="true" requiredmessage="#{msg.mandatory_field}"
                                                 id="url_input" validator="#{addResourceBean.validateUrl}"
                                                 label="URL"/>
                                </p:column>
                                <p:column rendered="#{addResourceBean.formStep > 1 }">
                                    <h:outputText value="#{addResourceBean.resource.url}"/>
                                </p:column>
                            </p:row>
                            <p:row rendered="#{addResourceBean.resource.storageType == 1 and addResourceBean.resource.type eq 'glossary'}">
                                <p:column>
                                    <h:outputText value="#{msg.title}:"/>
                                </p:column>
                                <p:column rendered="#{addResourceBean.formStep == 1}">
                                    <p:inputText value="#{addResourceBean.resource.title}" styleClass="add_field"
                                                 required="true" requiredmessage="#{msg.mandatory_field}"
                                                 id="title_input"/>
                                </p:column>
                            </p:row>
                            <p:row rendered="#{addResourceBean.resource.type eq 'glossary'}">
                                <p:column>
                                    <h:outputText value="Language One: "/>
                                </p:column>
                                <p:column rendered="#{addResourceBean.formStep == 1}">
                                    <p:selectOneMenu id="langOne" value="#{addResourceBean.resource.languageOne}" required="true" requiredMessage="#{msg.mandatory_field}">
                                        <f:selectItem itemLabel="-Select-" itemDisabled="true"/>
                                        <!--@elvariable id="lang" type="de.l3s.glossary.LanguageItem.LANGUAGE"-->
                                        <f:selectItems value="#{addResourceBean.glossaryLaguage}" var="lang" itemValue="#{lang.toString()}" itemLabel="#{lang.toString()}"></f:selectItems>
                                    </p:selectOneMenu>
                                </p:column>
                            </p:row>
                            <p:row rendered="#{addResourceBean.resource.type eq 'glossary'}">
                                <p:column>
                                    <h:outputText value="Language Two: "/>
                                </p:column>
                                <p:column rendered="#{addResourceBean.formStep == 1}">
                                    <p:selectOneMenu id="langTwo" value="#{addResourceBean.resource.languageTwo}" required="true" requiredMessage="#{msg.mandatory_field}">
                                        <f:selectItem itemLabel="-Select-" itemDisabled="true"/>
                                        <f:selectItems value="#{addResourceBean.glossaryLaguage}" var="lang" itemValue="#{lang.toString()}" itemLabel="#{lang.toString()}"></f:selectItems>
                                    </p:selectOneMenu>
                                </p:column>
                            </p:row>
                            <p:row rendered="#{addResourceBean.resource.storageType == 1 and addResourceBean.resource.type eq 'survey'}">
                                <p:column>
                                    <h:outputText value="#{msg.title}:"/>
                                </p:column>
                                <p:column rendered="#{addResourceBean.formStep == 1}">
                                    <p:inputText value="#{addResourceBean.resource.title}" styleClass="add_field"
                                                 required="true" requiredmessage="#{msg.mandatory_field}"
                                                 id="survey_title"/>
                                </p:column>
                            </p:row>
                            <p:row rendered="#{addResourceBean.resource.storageType == 1 and addResourceBean.resource.type eq 'survey'}">
                                <p:column>
                                    <h:outputText value="#{msg.description}:"/>
                                </p:column>
                                <p:column rendered="#{addResourceBean.formStep == 1}">
                                    <p:inputText value="#{addResourceBean.resource.description}"
                                                 styleClass="add_field" id="survey_desc"/>
                                </p:column>
                            </p:row>
                            <p:row rendered="#{addResourceBean.resource.storageType == 1 and addResourceBean.resource.type eq 'survey'}">
                                <p:column>
                                    <h:outputText value="survey Open Date: "/>
                                </p:column>
                                <p:column>
                                    <p:calendar id="open" value="#{addResourceBean.surveyOpenDate}" showOn="button"></p:calendar>
                                </p:column>
                            </p:row>
                            <p:row rendered="#{addResourceBean.resource.storageType == 1 and addResourceBean.resource.type eq 'survey'}">
                                <p:column>
                                    <h:outputText value="survey Close Date: "/>
                                </p:column>
                                <p:column>
                                    <p:calendar id="close" value="#{addResourceBean.surveyCloseDate}" showOn="button"></p:calendar>
                                </p:column>
                            </p:row>
                            <p:row rendered="#{false and addResourceBean.formStep > 1 and addResourceBean.resource.thumbnail3 != null}">
                                <p:column>

                                    <h:outputText value="#{msg.preview}:"/>
                                </p:column>
                                <p:column styleClass="form-preview">
                                    <h:outputText id="preview" escape="false" value="#{addResourceBean.resource.thumbnail1.html}"/>
                                </p:column>
                            </p:row>
                        </p:panelGrid>
                    </p:fieldset>

                    <p:commandButton id="next_button" widgetVar="next-button" value="#{msg.nextStep}"
                                     styleClass="greenbutton float-right" update=":growl :add_resource_section"
                                     action="#{addResourceBean.handleUrlInput}" ajax="true"
                                     rendered="#{addResourceBean.formStep == 1 and addResourceBean.resource.storageType == 2}"
                                     onstart="PF('next-button').disable();">
                    </p:commandButton>

                    <p:blockUI block="step1_field" trigger="next_button" widgetVar="block-step1">
                        <div class="float-left" style="height: 25px; line-height: 25px;">#{msg.please_wait}</div>
                        <div class="loading-animation small float-left">
                            <div></div>
                            <div></div>
                            <div></div>
                        </div>
                    </p:blockUI>

                    <p:commandButton id="create_glossary_button" value="Create Glossary"
                                     styleClass="greenbutton float-right"
                                     update=":growl :right_pane_wrapper :datagrid"
                                     action="#{addResourceBean.addGlossary}" ajax="true"
                                     oncomplete="update_header();resourceDND();"
                                     rendered="#{addResourceBean.formStep == 1 and addResourceBean.resource.type eq 'glossary'}">
                        <f:setPropertyActionListener target="#{activityResourceBean.reloadLogs}" value="true"/>
                        <f:setPropertyActionListener target="#{rightPaneBean.clickedAbstractResource}" value="#{addResourceBean.resource}"/>
                    </p:commandButton>
                    <p:commandButton id="create_survey_button" value="Create survey"
                                     styleClass="greenbutton float-right"
                                     update=":growl :right_pane_wrapper :datagrid"
                                     action="#{addResourceBean.addSurvey}" ajax="true"
                                     oncomplete="update_header();resourceDND();"
                                     rendered="#{addResourceBean.formStep == 1 and addResourceBean.resource.type eq 'survey'}">
                        <f:setPropertyActionListener target="#{activityResourceBean.reloadLogs}" value="true"/>
                        <f:setPropertyActionListener target="#{rightPaneBean.clickedAbstractResource}" value="#{addResourceBean.resource}"/>
                    </p:commandButton>

                    <p:commandButton value="#{msg.cancel}" styleClass="graybutton float-right" immediate="true"
                                     actionListener="#{addResourceBean.cancelUpload}" ajax="true"
                                     update=":right_pane_wrapper"
                                     oncomplete="update_header(); PF('block-step1').hide(); PF('next-button').enable();"
                                     style="margin-right:0.5em;" rendered="#{addResourceBean.formStep == 1}">
                        <f:setPropertyActionListener target="#{rightPaneBean.paneAction}" value="none"/>
                    </p:commandButton>

                    <br class="clear"/>
                </h:form>

                <h:form id="add_resource_meta_form" rendered="#{addResourceBean.formStep > 1}">

                    <p:fieldset legend="#{msg.step} 2" style="margin-bottom:20px">

                        <table id="add_attributes_table" class="full-width">
                            <colgroup>
                                <col span="1" style="width: 10%; min-width: 10rem;"/>
                                <col span="1"/>
                            </colgroup>
                            <ui:decorate template="/templates/resources/edit.xhtml">
                                <ui:param name="res" value="#{addResourceBean.resource}"/>
                            </ui:decorate>
                        </table>
                    </p:fieldset>

                    <p:commandButton value="#{msg.addResource}" styleClass="greenbutton float-right"
                                     update=":growl :right_pane_wrapper :datagrid"
                                     action="#{addResourceBean.addResource}" ajax="true"
                                     oncomplete="update_header();resourceDND(); load_editor();"
                                     rendered="#{addResourceBean.formStep > 1}">
                        <f:setPropertyActionListener target="#{activityResourceBean.reloadLogs}" value="true"/>
                        <f:setPropertyActionListener target="#{rightPaneBean.clickedAbstractResource}" value="#{addResourceBean.resource}"/>
                    </p:commandButton>

                    <p:commandButton value="#{msg.cancel}" styleClass="graybutton float-right" immediate="true"
                                     actionListener="#{addResourceBean.clearForm()}" ajax="true"
                                     update=":right_pane_wrapper" oncomplete="update_header()"
                                     style="margin-right:0.5em;">
                        <f:setPropertyActionListener target="#{rightPaneBean.paneAction}" value="none"/>
                    </p:commandButton>

                    <br class="clear"/>
                </h:form>
            </h:panelGroup>


            <!-- View resource block -->
            <h:panelGroup rendered="#{rightPaneBean.paneAction == 'viewResource' or rightPaneBean.paneAction =='viewUpdatedResource'}" layout="block">

                <h:outputText value="This resource has been removed" rendered="${(not rightPaneBean.clickedResource.canViewResource(userBean.user)) and (rightPaneBean.clickedResource.deleted or rightPaneBean.clickedResource.groupId eq 0)}"/>

                <h:outputText value="#{msg.group_resources_access_denied}" rendered="${not rightPaneBean.clickedResource.canViewResource(userBean.user) and not (rightPaneBean.clickedResource.deleted or rightPaneBean.clickedResource.groupId eq 0)}"/>

                <ui:fragment rendered="#{rightPaneBean.clickedAbstractResource.canViewResource(userBean.user)}">

                    <ui:fragment rendered="#{rightPaneBean.clickedResource.type eq 'spreadsheet' or rightPaneBean.clickedResource.type eq 'presentation' or rightPaneBean.clickedResource.type eq 'document' or rightPaneBean.clickedResource.type eq 'text' or rightPaneBean.clickedResource.type eq 'website' or rightPaneBean.clickedResource.type eq 'pdf' or rightPaneBean.clickedResource.type eq 'video' or rightPaneBean.clickedResource.type eq 'image' or rightPaneBean.clickedResource.type eq 'glossary' or rightPaneBean.clickedResource.type eq 'survey'}">
                        <div class="align-center" style="margin-top: 5px;">
                            <ui:decorate template="/templates/resources/parts/lightbox.xhtml">
                                <ui:param name="resource" value="#{rightPaneBean.clickedResource}"/>
                            </ui:decorate>

                            <ui:decorate template="/templates/resources/parts/preview_box.xhtml">
                                <ui:param name="resource" value="#{rightPaneBean.clickedResource}"/>
                            </ui:decorate>
                        </div>

                        <div class="align-center" style="padding-top: 10px">
                            <a class="hyperlink" href="#{rightPaneBean.clickedResource.urlProxied}"
                               target="_blank">
                                <h:outputText styleClass="hyperlink"
                                              rendered="#{rightPaneBean.clickedResource.type eq 'text' or rightPaneBean.clickedResource.type eq 'website' or rightPaneBean.clickedResource.type eq 'pdf'}"
                                              value="#{rightPaneBean.clickedResource.url}"/>
                            </a>
                            <a class="hyperlink" onclick="lightbox_open(); change_lightbox_content(true);"
                               style="float:right;" title="#{msg['Archive.change_thumbnail']}?">
                                <h:graphicImage style="cursor:pointer;" value="/resources/icon/silk/pencil.png"
                                                width="16" height="16" alt="#{msg['Archive.change_thumbnail']}?"
                                                rendered="#{not empty rightPaneBean.clickedResource.archiveUrls}"/>
                            </a>
                            <h:outputLink value="showGlossary.jsf"
                                          styleClass="ui-button ui-widget ui-state-default ui-corner-all ui-button-text-only greenbutton clearfix"
                                          rendered="#{rightPaneBean.clickedResource.type eq 'glossary'}">
                                <f:param name="resource_id" value="#{rightPaneBean.clickedResource.id}"/>
                                #{msg["Glossary.open"]}
                            </h:outputLink>
                            <h:outputLink value="../lw/survey/survey.jsf"
                                          styleClass="ui-button ui-widget ui-state-default ui-corner-all ui-button-text-only greenbutton clearfix"
                                          rendered="#{rightPaneBean.clickedResource.type eq 'survey'}">
                                <f:param name="resource_id" value="#{rightPaneBean.clickedResource.id}"/>
                                Open survey
                            </h:outputLink>

                            <h:outputLink id="survey_esult" value="../lw/survey/surveyResult.jsf"
                                          style="margin-left:5px"
                                          styleClass="ui-button ui-widget ui-state-default ui-corner-all ui-button-text-only greenbutton clearfix"
                                          rendered="#{rightPaneBean.clickedResource.type eq 'survey' and userBean.user.moderator eq true }">
                                <f:param name="resource_id" value="#{rightPaneBean.clickedResource.id}"/>
                                Result
                            </h:outputLink>
                        </div>
                    </ui:fragment>

                    <c:if test="${userBean.user.organisation.id eq 480}">
                        <ui:fragment rendered="#{not empty rightPaneBean.clickedResource}">
                            <div id="eMetaDetail">
                                <hr/>
                                <div id="detailList">
                                    <ui:fragment rendered="#{not empty rightPaneBean.clickedResource.extendedMetadata.categories}">
                                        <label class="rdlabel"><b>Category: </b></label>#{rightPaneBean.clickedResource.extendedMetadata.categories[0]}
                                        <br/>
                                    </ui:fragment>
                                    <ui:fragment rendered="#{empty rightPaneBean.clickedResource.extendedMetadata.categories}">
                                        <label class="rdlabel"><b>Category: </b></label><i>(Not available. Click the button below to add)</i>
                                        <br/>
                                    </ui:fragment>
                                    <ui:fragment rendered="#{not empty rightPaneBean.clickedResource.extendedMetadata.lCount}">
                                        <label class="rdlabel"><b>Level (stats): </b></label>#{rightPaneBean.clickedResource.extendedMetadata.lCount}
                                        <br/>
                                    </ui:fragment>
                                    <ui:fragment rendered="#{empty rightPaneBean.clickedResource.extendedMetadata.lCount}">
                                        <label class="rdlabel"><b>Level (stats): </b></label><i>(Not available. Click the button below to add)</i>
                                        <br/>
                                    </ui:fragment>
                                    <ui:fragment rendered="#{not empty rightPaneBean.clickedResource.extendedMetadata.targetCount}">
                                        <label class="rdlabel"><b>Target learner (stats): </b></label>
                                        <ui:repeat value="#{rightPaneBean.clickedResource.extendedMetadata.targetCount.entrySet().toArray()}" var="t">
                                            <h:graphicImage class="circle" value="/resources/resources-chloe/images/green_circle.png" width="2%"
                                                            rendered="#{t.key == 'very young learners (pre-school)'}"/>
                                            <h:graphicImage class="circle" value="/resources/resources-chloe/images/blue_circle.png" width="2%"
                                                            rendered="#{t.key == 'young learners (elementary)'}"/>
                                            <h:graphicImage class="bluecircle" value="/resources/resources-chloe/images/yellow_circle.png" width="2%"
                                                            rendered="#{t.key == 'teenage learners'}"/>
                                            <h:graphicImage class="circle" value="/resources/resources-chloe/images/red_circle.png" width="2%"
                                                            rendered="#{t.key == 'teachers'}"/>
                                            <h:graphicImage class="circle" value="/resources/resources-chloe/images/red_circle.png" width="2%"
                                                            rendered="#{t.key == 'adult learners'}"/>

                                            <h:outputText value="Pre-school" rendered="#{t.key == 'very young learners (pre-school)'}"/>
                                            <h:outputText value="Young learners" rendered="#{t.key == 'young learners (elementary)'}"/>
                                            <h:outputText value="Teens" rendered="#{t.key == 'teenage learners'}"/>
                                            <h:outputText value="Adult learners" rendered="#{t.key == 'adult learners'}"/>
                                            <h:outputText value="Teachers" rendered="#{t.key == 'teachers'}"/>
                                            <h:outputText value="[#{t.value}] "/>
                                        </ui:repeat>
                                        <br/>
                                    </ui:fragment>

                                    <ui:fragment rendered="#{empty rightPaneBean.clickedResource.extendedMetadata.targetCount}">
                                        <label class="rdlabel"><b>Target Learner (stats): </b></label><i>(Not available. Click the button below to add)</i>
                                        <br/>
                                    </ui:fragment>
                                    <ui:fragment rendered="#{empty rightPaneBean.clickedResource.extendedMetadata.purposeCount}">
                                        <label class="rdlabel"><b>Purpose of use (stats): </b></label><i>(Not available. Click the button below to add)</i>
                                        <br/>
                                    </ui:fragment>
                                    <ui:fragment rendered="#{not empty rightPaneBean.clickedResource.extendedMetadata.purposeCount}">
                                        <label class="rdlabel"><b>Purpose of use (stats): </b></label>
                                        <ui:repeat value="#{rightPaneBean.clickedResource.extendedMetadata.purposeCount.entrySet().toArray()}" var="p">
                                            <h:graphicImage class="bluecircle" value="/resources/resources-chloe/images/speaking.png"
                                                            width="2%" rendered="#{p.key == 'speaking skills'}"/>
                                            <h:graphicImage class="bluecircle" value="/resources/resources-chloe/images/listening.png"
                                                            width="2%" rendered="#{p.key == 'listening skills'}"/>
                                            <h:graphicImage class="bluecircle" value="/resources/resources-chloe/images/writing.png"
                                                            width="2%" rendered="#{p.key == 'writing skills'}"/>
                                            <h:graphicImage class="bluecircle" value="/resources/resources-chloe/images/reading.png"
                                                            width="2%" rendered="#{p.key == 'reading skills'}"/>

                                            <h:outputText value="Speaking" rendered="#{p.key == 'speaking skills'}"/>
                                            <h:outputText value="Listening" rendered="#{p.key == 'listening skills'}"/>
                                            <h:outputText value="Writing" rendered="#{p.key == 'writing skills'}"/>
                                            <h:outputText value="Reading" rendered="#{p.key == 'reading skills'}"/>
                                            <h:outputText value="[#{p.value}] "
                                                          rendered="#{p.key == 'speaking skills' or p.key == 'listening skills' or p.key =='writing skills' or p.key =='reading skills'}"/>
                                        </ui:repeat>
                                        <br/>

                                        <ui:repeat value="#{rightPaneBean.clickedResource.extendedMetadata.purposeCount.entrySet().toArray()}" var="p">
                                            <ui:fragment rendered="#{p.key != 'speaking skills' and p.key != 'listening skills' and p.key !='writing skills' and p.key !='reading skills'}">
                                                <span class="tag tag-grey">#{p.key}</span>
                                            </ui:fragment>
                                        </ui:repeat>
                                    </ui:fragment>

                                </div> <!-- detailList -->
                                <br/>

                                <div id="detailAdd">
                                    <!-- add the button to show div detailBox -->
                                    <h:form>
                                        <p:commandButton id="detailAdd_button" styleClass="greenbutton centered"
                                                         value="Add your own" update=":add_metadata_form"
                                                         onsuccess="PF('adlg').show();" ajax="true" process="@form"
                                                         partialSubmit="true"
                                                         actionListener="{rightPaneBean.onOpenExtendedMetadataDialog}"/>
                                    </h:form>
                                </div>

                                <hr/>
                            </div>
                        </ui:fragment>

                        <p:dialog id="addDetailDlg" header="Add Your Own Categorization" widgetVar="adlg" minWidth="440" maxWidth="500" appendTo="@(body)" modal="true" closable="true">
                            <h:outputText value="Please, add your own categorization: this will help you and other users find resources easily and efficiently."/>
                            <br/>
                            <h:outputText value="Select the most appropriate tags or type them; then, click on the &quot;SAVE&quot; button."/>
                            <br/>
                            <br/>
                            <b><h:outputText value="Resource Title: #{rightPaneBean.clickedResource.title}"/></b>
                            <br/>
                            <br/>
                            <h:form id="add_metadata_form">

                                <b><p:outputLabel for="toplist" value="Category:"/></b>
                                <h:panelGrid columns="6" cellpadding="10" id="catlist">
                                    <h:outputLabel for="toplist" value="Level 1:"/>
                                    <p:selectOneMenu id="toplist" value="#{resourceDetailBean.selectedTopcat}"
                                                     panelStyle="width:150px"
                                                     valueChangeListener="#{searchFilterBean.topCatChanged}">
                                        <f:selectItem itemLabel="Select Category Level 1" itemValue="-1"/>
                                        <f:selectItems value="#{searchFilterBean.cattops}"/>
                                        <p:ajax update="middlelist" process="@this"/>
                                    </p:selectOneMenu>

                                    <p:outputLabel for="middlelist" value="Level 2:"/>
                                    <p:selectOneMenu id="middlelist" value="#{resourceDetailBean.selectedMidcat}"
                                                     panelStyle="width:150px"
                                                     valueChangeListener="#{searchFilterBean.midCatChanged}">
                                        <f:selectItem itemLabel="Select Category Level 2" itemValue="-1"/>
                                        <f:selectItems value="#{searchFilterBean.catmids}"/>
                                        <p:ajax update="bottomlist" process="@this"/>
                                    </p:selectOneMenu>

                                    <p:outputLabel for="bottomlist" value="Level 3: (Choose or type a new one)"/>
                                    <p:autoComplete id="bottomlist" panelStyle="width:150px" dropdown="true"
                                                    value="#{resourceDetailBean.selectedBotcat}"
                                                    completeMethod="#{searchFilterBean.showCatbots}"/>

                                </h:panelGrid>

                                <h:panelGrid columns="4" cellpadding="10">
                                    <p:outputLabel for="levlist" value="Language Level: "/>
                                    <p:selectCheckboxMenu id="levlist" value="#{resourceDetailBean.selectedLevels}"
                                                          label="Levels" multiple="true" filter="false"
                                                          filterMatchMode="startsWith" panelStyle="width:250px">
                                        <f:selectItems value="#{searchFilterBean.levels}"/>
                                    </p:selectCheckboxMenu>
                                    <p:outputLabel for="aglist" value="Target Learner:"/>
                                    <p:selectCheckboxMenu id="aglist" value="#{resourceDetailBean.selectedTargets}"
                                                          label="Target Learners" multiple="true" filter="false"
                                                          filterMatchMode="startsWith" panelStyle="width:250px">
                                        <f:selectItems value="#{searchFilterBean.targets}"/>
                                    </p:selectCheckboxMenu>
                                </h:panelGrid>

                                <h:panelGrid columns="2" cellpadding="10">
                                    <p:outputLabel for="aclist" value="Purpose of Use:"/>
                                    <p:selectCheckboxMenu id="aclist" value="#{resourceDetailBean.selectedPurposes}"
                                                          label="Purposes of Use" multiple="true" filter="false"
                                                          filterMatchMode="startsWith" panelStyle="width:250px">
                                        <f:selectItems value="#{searchFilterBean.purposes}"/>
                                    </p:selectCheckboxMenu>
                                </h:panelGrid>

                                <br/>
                                <br/>
                                <p:commandButton value="Save" actionListener="#{resourceDetailBean.addNewMetadata}"
                                                 update=":right_pane_wrapper :growl"
                                                 onsuccess="adlg.hide();"/> <!--TODO: need to update resources somehow-->
                                <p:commandButton value="Cancel" onclick="adlg.hide(); return false;"/>
                            </h:form>
                        </p:dialog>
                    </c:if>
					<c:choose>
						<c:when test="#{rightPaneBean.paneAction =='viewUpdatedResource'}">
							<ui:decorate template="/templates/group/summary_right_pane.xhtml" />
						</c:when>
						<c:otherwise>
							<ui:decorate template="/templates/resources/parts/right_pane_under_previewbox_content.xhtml" />
						</c:otherwise>
					</c:choose>
				</ui:fragment>
            </h:panelGroup>


            <!-- Edit resource block -->
            <h:form rendered="#{rightPaneBean.paneAction == 'editResource' and rightPaneBean.clickedResource.id != -1}"
                    id="edit_form">
                <ui:fragment
                        rendered="#{rightPaneBean.clickedResource.type eq 'text' or rightPaneBean.clickedResource.type eq 'website' or rightPaneBean.clickedResource.type eq 'pdf' or rightPaneBean.clickedResource.type eq 'video' or rightPaneBean.clickedResource.type eq 'image'}">
                    <div class="align-center" style="margin-top: 5px;">
                        <ui:decorate template="/templates/resources/parts/lightbox.xhtml">
                            <ui:param name="resource" value="#{rightPaneBean.clickedResource}"/>
                        </ui:decorate>

                        <ui:decorate template="/templates/resources/parts/preview_box.xhtml">
                            <ui:param name="resource" value="#{rightPaneBean.clickedResource}"/>
                        </ui:decorate>
                    </div>
                    <div class="align-center" style="padding-top: 10px">
                        <a class="hyperlink" href="#{rightPaneBean.clickedResource.urlProxied}"
                           target="_blank">
                            <h:outputText styleClass="hyperlink"
                                          rendered="#{rightPaneBean.clickedResource.type eq 'text' or rightPaneBean.clickedResource.type eq 'website' or rightPaneBean.clickedResource.type eq 'pdf'}"
                                          value="#{rightPaneBean.clickedResource.url}"/>
                        </a>
                        <a class="hyperlink" onclick="lightbox_open(); change_lightbox_content(true);"
                           style="float:right;" title="#{msg['Archive.change_thumbnail']}?">
                            <h:graphicImage style="cursor:pointer;" value="/resources/icon/silk/pencil.png"
                                            width="16" height="16" alt="#{msg['Archive.change_thumbnail']}?"
                                            rendered="#{not empty rightPaneBean.clickedResource.archiveUrls}"/>
                        </a>
                        <h:outputLink value="showGlossary.jsf"
                                      styleClass="ui-button ui-widget ui-state-default ui-corner-all ui-button-text-only greenbutton clearfix"
                                      rendered="#{rightPaneBean.clickedResource.source eq 'Glossary'}">
                            <f:param name="resource_id" value="#{rightPaneBean.clickedResource.id}"/>
                            #{msg["Glossary.open"]}
                        </h:outputLink>
                    </div>
                </ui:fragment>

                <table id="edit_table" class="full-width">
                    <colgroup>
                        <col span="1" style="width: 10%; min-width: 10rem;"/>
                        <col span="1"/>
                    </colgroup>
                    <ui:decorate template="/templates/resources/edit.xhtml">
                        <ui:param name="res" value="#{rightPaneBean.clickedAbstractResource}"/>
                    </ui:decorate>

                    <tr>
                        <td colspan="2">
                            <p:commandButton styleClass="greenbutton float-right" value="#{msg.save}"
                                             actionListener="#{rightPaneBean.editClickedResource}"
                                             update=":resourcesView :right_pane_wrapper"
                                             oncomplete="update_header();resourceDND();" style="margin-right:0;">
                                <f:setPropertyActionListener target="#{rightPaneBean.paneAction}"
                                                             value="viewResource"/>
                            </p:commandButton>
                            <p:commandButton styleClass="greenbutton float-right" value="#{msg.cancel}"
                                             update=":right_pane_wrapper" style="margin-right:0.5em"
                                             immediate="true">
                                <f:setPropertyActionListener target="#{rightPaneBean.paneAction}"
                                                             value="viewResource"/>
                            </p:commandButton>
                        </td>
                    </tr>
                </table>

                <p:commandButton styleClass="graybutton" value="Recreate thumbnail"
                                 actionListener="#{resourceDetailBean.onUpdateThumbnail}"
                                 update=":right_pane_wrapper" immediate="true" rendered="#{userBean.admin}">
                    <f:setPropertyActionListener target="#{rightPaneBean.paneAction}" value="viewResource"/>
                    <f:setPropertyActionListener target="#{rightPaneBean.clickedResource}"
                                                 value="#{rightPaneBean.clickedAbstractResource}"/>
                </p:commandButton>
            </h:form>


            <!-- Create folder block -->
            <h:panelGroup rendered="#{rightPaneBean.paneAction == 'newFolder'}" styleClass="create-block new-folder" layout="block">
                <h:form id="add_folder_form">
                    <p:fieldset style="margin-bottom:20px">
                        <p:panelGrid id="add_folder_table" styleClass="full-width">
                            <p:row rendered="#{addFolderBean.targetGroup != null}">
                                <p:column>
                                    <h:outputText value="#{msg.group}:"/>
                                </p:column>
                                <p:column>
                                    <h:outputText value="#{addFolderBean.targetGroup.title}"/>
                                </p:column>
                            </p:row>
                            <p:row rendered="#{addFolderBean.targetFolder != null}">
                                <p:column>
                                    <h:outputText value="#{msg.path}:"/>
                                </p:column>
                                <p:column>
                                    <h:outputText value="#{addFolderBean.targetFolder.prettyPath}"/>
                                </p:column>
                            </p:row>
                            <p:row>
                                <p:column>
                                    <h:outputText value="#{msg.title}*:"/>
                                </p:column>
                                <p:column>
                                    <p:inputText value="#{addFolderBean.folder.name}" styleClass="add_field" required="true" requiredmessage="#{msg.mandatory_field}" id="folder_title_input"/>
                                </p:column>
                            </p:row>
                            <p:row>
                                <p:column>
                                    <h:outputText value="#{msg.description}*:"/>
                                </p:column>
                                <p:column>
                                    <p:inputTextarea id="folderDescription" value="#{addFolderBean.folder.description}" autoResize="true" styleClass="add_field" style="min-height:100px;"/>
                                </p:column>
                            </p:row>
                        </p:panelGrid>
                        * #{msg.mandatory_field}
                    </p:fieldset>

                    <p:commandButton value="#{msg.cancel}" styleClass="graybutton float-right" style="margin-right:0.5em;"
                                     update=":right_pane_wrapper" immediate="true" oncomplete="update_header()">
                        <f:setPropertyActionListener target="#{rightPaneBean.paneAction}" value="none"/>
                    </p:commandButton>
                    <p:commandButton value="#{msg.create_folder}" styleClass="greenbutton float-right"
                                     update=":group_menu_tree :folderGrid :growl :right_pane_wrapper"
                                     action="#{addFolderBean.addFolder}" ajax="true" oncomplete="update_header();resourceDND();">
                        <f:setPropertyActionListener target="#{rightPaneBean.paneAction}" value="none"/>
                    </p:commandButton>
                </h:form>
            </h:panelGroup>


            <!-- View folder block -->
            <h:panelGroup rendered="#{rightPaneBean.paneAction == 'viewFolder' and rightPaneBean.clickedFolder != null}" layout="block">
                <table id="view_folder_table" class="full-width">
                    <tr>
                        <td>
                            #{msg.group}:
                        </td>
                        <td>
                            <h:outputText style="width: 96%" value="#{rightPaneBean.clickedFolder.group.title}"/>
                        </td>
                    </tr>
                    <ui:fragment rendered="#{rightPaneBean.clickedFolder.parentFolder != null}">
                        <tr>
                            <td>
                                #{msg.path}:
                            </td>
                            <td>
                                <h:outputText style="width: 96%" value="#{rightPaneBean.clickedFolder.parentFolder.prettyPath}"/>
                            </td>
                        </tr>
                    </ui:fragment>
                    <tr>
                        <td>
                            #{msg.title}:
                        </td>
                        <td>
                            <h:outputText style="width: 96%" value="#{rightPaneBean.clickedFolder.name}"/>
                        </td>
                    </tr>
                    <ui:fragment rendered="#{not empty rightPaneBean.clickedFolder.description}">
                        <tr>
                            <td>
                                #{msg.description}:
                            </td>
                            <td>
                                <h:outputText style="width: 96%" value="#{rightPaneBean.clickedFolder.description}" escape="false"/>
                            </td>
                        </tr>
                    </ui:fragment>
                </table>
            </h:panelGroup>


            <!-- Edit folder block -->
            <h:panelGroup rendered="#{rightPaneBean.paneAction == 'editFolder' and rightPaneBean.clickedFolder != null}" layout="block">
                <h:form id="edit_folder_form">
                    <table id="edit_folder_table" class="full-width">
                        <tr>
                            <td>
                                #{msg.group}:
                            </td>
                            <td>
                                <h:outputText style="width: 96%" value="#{rightPaneBean.clickedFolder.group.title}"/>
                            </td>
                        </tr>
                        <ui:fragment rendered="#{rightPaneBean.clickedFolder.parentFolder != null}">
                            <tr>
                                <td>
                                    #{msg.path}:
                                </td>
                                <td>
                                    <h:outputText style="width: 96%" value="#{rightPaneBean.clickedFolder.parentFolder.prettyPath}"/>
                                </td>
                            </tr>
                        </ui:fragment>
                        <tr>
                            <td>
                                #{msg.title}:
                            </td>
                            <td>
                                <p:inputText style="width: 96%" value="#{rightPaneBean.clickedFolder.name}"/>
                            </td>
                        </tr>
                        <tr>
                            <td>
                                #{msg.description}:
                            </td>
                            <td>
                                <p:inputTextarea style="width: 96%" value="#{rightPaneBean.clickedFolder.description}" autoResize="true"/>
                            </td>
                        </tr>
                        <tr>
                            <td colspan="2" class="align-right">
                                <p:commandButton styleClass="graybutton" style="margin-right:0.5em;" oncomplete="update_header();"
                                                 value="#{msg.cancel}" update=":right_pane_wrapper" immediate="true">
                                    <f:setPropertyActionListener target="#{rightPaneBean.paneAction}" value="viewFolder"/>
                                </p:commandButton>
                                <p:commandButton styleClass="greenbutton" style="margin-right:0.5em;" oncomplete="update_header();resourceDND();"
                                                 value="#{msg.save}" update=":group_menu_tree :folderGrid :right_pane_wrapper :growl"
                                                 actionListener="#{rightPaneBean.editClickedResource}">
                                    <f:setPropertyActionListener target="#{rightPaneBean.paneAction}" value="viewFolder"/>
                                </p:commandButton>
                            </td>
                        </tr>
                    </table>
                </h:form>
            </h:panelGroup>

            <script type="text/javascript">
                $("#right_pane_wrapper img").bind('load', function ()
                {
                    scroller();
                });

                function firstStepStart()
                {
                    console.log('start');
                    PF('next_button').disable();
                    $('#first_step_loading_screen').show();
                }

                function firstStepComplete()
                {
                    console.log('complet');
                    $('#first_step_loading_screen').hide();
                }

                function update_header()
                {
                    var title = $("#panel_header_title");
                    $(".ui-layout-unit-header", "#right_pane").text(title.val());

                    $('#right_pane .content').scrollTop(0);

                    scroller();
                    lightbox_load();
                }

                function validateBottomCat(selectedValue)
                {
                    if (selectedValue === "add a new category")
                    {
                        $('#bottomlist').toggle(); //hide list
                    }
                }
            </script>
        </h:panelGroup>
    </p:layoutUnit>
</ui:composition>
