<ui:composition xmlns="http://www.w3.org/1999/xhtml"
	xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
	xmlns:h="http://xmlns.jcp.org/jsf/html"
	xmlns:f="http://xmlns.jcp.org/jsf/core"
	xmlns:c="http://xmlns.jcp.org/jsp/jstl/core"
	xmlns:p="http://primefaces.org/ui">

	<table id="resources_informations_table" class="full-width">

		<ui:fragment
			rendered="${not empty rightPaneBean.clickedResource.fileName and not rightPaneBean.clickedResource.source.equals('LORO')}">
			<tr>
				<td><span class="resource_field">#{msg.file}:</span></td>
				<td><a href="#{rightPaneBean.clickedResource.fileUrl}"> <span
						style="text-decoration: underline;" class="float-left">#{rightPaneBean.clickedResource.fileName}</span>
						<span class="ui-icon ui-icon-arrowthickstop-1-s float-left "></span>
				</a> <ui:fragment
						rendered="${not empty rightPaneBean.clickedResource.originalFile}">
						<div style="clear: both;"></div>
						<a href="#{rightPaneBean.clickedResource.originalFile.url}"> <span
							style="float: left; text-decoration: underline;">#{rightPaneBean.clickedResource.originalFile.name}</span>
							<span class="ui-icon ui-icon-arrowthickstop-1-s"
							style="float: left;"></span>
						</a>
                                        (Backup
                                        <h:outputText
							value="#{rightPaneBean.clickedResource.originalFile.lastModified}">
							<f:convertDateTime type="date" timeStyle="short" dateStyle="long"
								timeZone="#{userBean.timeZone}" />
						</h:outputText>)
                                    </ui:fragment></td>
			</tr>
		</ui:fragment>


		<ui:fragment
			rendered="${empty rightPaneBean.clickedResource.fileName
                         and rightPaneBean.clickedResource.type != 'text'
                         and rightPaneBean.clickedResource.type != 'website'
                          and rightPaneBean.clickedResource.type != 'pdf'
                           and rightPaneBean.clickedResource.type != 'glossary'
                           and rightPaneBean.clickedResource.type != 'survey'
                           and rightPaneBean.clickedResource.type != 'video'
                            and rightPaneBean.clickedResource.type != 'image' }">
			<tr>
				<td><span class="resource_field">#{msg.resource}:</span></td>
				<td><a style="color: #22e"
					href="#{rightPaneBean.clickedResource.urlProxied}">#{rightPaneBean.clickedResource.url}</a>
				</td>
			</tr>
		</ui:fragment>

		<ui:fragment rendered="#{userBean.starRatingEnabled}">
			<tr>
				<td><span class="resource_field">#{msg.relevance}:</span></td>
				<td><h:form id="rate_form">
						<p:rating
							value="#{resourceDetailBean.clickedResource.starRatingRounded}"
							disabled="${resourceDetailBean.starRatedByUser or not resourceDetailBean.clickedResource.canAnnotateResource(userBean.user)}"
							cancel="false"
							style="vertical-align: bottom; margin-right:10px; display:inline-block;">
							<p:ajax event="rate" listener="#{resourceDetailBean.handleRate}"
								update="rate_form :growl" />
						</p:rating>

						<h:outputText value="#{rightPaneBean.clickedResource.starRating}">
							<f:convertNumber maxFractionDigits="1" minFractionDigits="1" />
						</h:outputText>
                                        (<h:outputFormat
							value="#{msg.votes}">
							<f:param value="#{rightPaneBean.clickedResource.rateNumber}" />
						</h:outputFormat>)
                                    </h:form></td>
			</tr>
		</ui:fragment>

		<ui:fragment
			rendered="#{userBean.optionContentAnnotationFieldEnabled and rightPaneBean.clickedResource.type eq 'website'}">
			<tr>
				<td><span class="resource_field"> #{msg.content}: </span></td>
				<td><h:outputLink value="resource_transcript.jsf"
						style="text-decoration:underline;">
						<f:param name="resource_id"
							value="#{rightPaneBean.clickedResource.id}" />
                                        #{msg.link_to_content}
                                    </h:outputLink></td>
			</tr>
			<ui:fragment
				rendered="#{not empty rightPaneBean.clickedResource.group and not empty rightPaneBean.clickedResource.group.hypothesisLink}">
				<tr>
					<td><span class="resource_field"> #{msg.discuss}: </span></td>
					<td><h:outputLink value="#{resourceDetailBean.hypothesisLink}"
							style="text-decoration:underline;">
                                            #{msg.link_to_discuss}
                                        </h:outputLink> <h:outputLink
							value="#{rightPaneBean.clickedResource.group.hypothesisLink}"
							style="text-decoration:underline;">
                                            (#{msg.discuss_group_invite})
                                        </h:outputLink> <h:outputLink
							value="discussion_help.jsf" target="_blank"
							style="text-decoration:underline;">
							<f:param name="type" value="user" />
                                            [?]
                                        </h:outputLink></td>
				</tr>
			</ui:fragment>
		</ui:fragment>

		<ui:fragment rendered="#{userBean.thumbRatingEnabled}">
			<tr>
				<td><span class="resource_field">#{msg.reliability}:</span></td>
				<td><h:form id="thumbrating">
						<h:panelGrid columns="4">
							<h:outputText value="+#{rightPaneBean.clickedResource.thumbUp}" />
							<p:commandLink actionListener="#{resourceDetailBean.onThumbUp}"
								update="thumbrating :growl">
								<f:param name="resource_id"
									value="#{rightPaneBean.clickedResource.id}" />
								<h:graphicImage value="/resources/icon/thumb_up.png" width="16"
									height="16" alt="Rate thump up" />
							</p:commandLink>

							<p:commandLink actionListener="#{resourceDetailBean.onThumbDown}"
								update="thumbrating :growl">
								<f:param name="resource_id"
									value="#{rightPaneBean.clickedResource.id}" />
								<h:graphicImage value="/resources/icon/thumb_dw.png" width="16"
									height="16" alt="Rate thump down" />
							</p:commandLink>
							<h:outputText value="-#{rightPaneBean.clickedResource.thumbDown}" />
						</h:panelGrid>
					</h:form></td>
			</tr>
		</ui:fragment>

		<ui:fragment
			rendered="#{not empty rightPaneBean.clickedResource.author}">
			<tr>
				<td><span class="resource_field">#{msg.author}:</span></td>
				<td><h:outputText
						value="#{rightPaneBean.clickedResource.author}" /></td>
			</tr>
		</ui:fragment>

		<ui:fragment
			rendered="#{not empty rightPaneBean.clickedResource.msource}">
			<tr>
				<td><span class="resource_field"> Media Source: </span></td>
				<td><h:outputText
						value="#{rightPaneBean.clickedResource.msource}" /></td>
			</tr>
		</ui:fragment>
		<ui:fragment
			rendered="#{not empty rightPaneBean.clickedResource.mtype}">
			<tr>
				<td><span class="resource_field"> Contains: </span></td>
				<td><h:outputText
						value="#{rightPaneBean.clickedResource.mtype}" /></td>
			</tr>
		</ui:fragment>

		<ui:fragment
			rendered="#{not empty rightPaneBean.clickedResource.language}">
			<tr>
				<td><span class="resource_field">#{msg.language}:</span></td>
				<td><ui:repeat var="language"
						value="#{rightPaneBean.clickedResource.metadataMultiValue['language']}"
						varStatus="status">
						<h:outputText value="#{msg['language_' += language]}" />
						<h:outputText value=", " rendered="#{!status.last}" escape="false" />
					</ui:repeat></td>
			</tr>
		</ui:fragment>

		<tr>
			<td><span class="resource_field"> #{msg.source}: </span></td>
			<td style="overflow: hidden;"><a
				href="#{rightPaneBean.clickedResource.urlProxied}"><h:outputText
						value="#{rightPaneBean.clickedResource.source}" /></a> <span
				style="display: inline-block; width: 300px;"> </span></td>
		</tr>

		<ui:repeat var="entry"
			value="#{rightPaneBean.clickedResource.metadataEntries}">
			<ui:fragment rendered="#{not empty entry.value}">
				<tr>
					<td><span class="resource_field"> <h:outputText
								value="${utilBean.getLocaleMessage(entry.key, null)}" />:
					</span></td>
					<td><h:outputText value="#{entry.value}" /></td>
				</tr>
			</ui:fragment>
		</ui:repeat>

		<ui:fragment
			rendered="${not empty rightPaneBean.clickedResource.group}">
			<tr>
				<td><span class="resource_field"> #{msg.group}: </span></td>
				<td><h:outputLink value="group/overview.jsf"
						style="display:inline-block; margin-right:1rem;">
						<f:param name="group_id"
							value="#{rightPaneBean.clickedResource.group.id}" />
						<h:outputText value="#{rightPaneBean.clickedResource.group.title}" />
					</h:outputLink></td>
			</tr>
		</ui:fragment>
		<ui:fragment
			rendered="${not empty rightPaneBean.clickedResource.originalGroup}">
			<tr>
				<td><span class="resource_field"> #{msg.copied_from}: </span></td>
				<td><h:outputLink value="group/overview.jsf"
						style="display:inline-block; margin-right:1rem;">
						<f:param name="group_id"
							value="#{rightPaneBean.clickedResource.originalGroup.id}" />
						<h:outputText
							value="#{rightPaneBean.clickedResource.originalGroup.title}" />
					</h:outputLink></td>
			</tr>
		</ui:fragment>
		<ui:fragment
			rendered="${rightPaneBean.clickedResource.source == 'TED' or rightPaneBean.clickedResource.source == 'TEDx'}">
			<tr>
				<td><span class="resource_field"> #{msg.transcript}: </span></td>
				<td><h:outputLink value="ted_transcript.jsf"
						style="text-decoration:underline;">
						<f:param name="resource_id"
							value="#{rightPaneBean.clickedResource.id}" />
                                        #{msg.link_to_transcript}
                                    </h:outputLink></td>
			</tr>
		</ui:fragment>
		<ui:fragment
			rendered="${not empty rightPaneBean.clickedResource.creationDate}">
			<tr>
				<td><span class="resource_field"> #{msg.date}: </span></td>
				<td><h:outputText
						value="#{rightPaneBean.clickedResource.creationDate}">
						<f:convertDateTime type="date" dateStyle="long"
							timeZone="#{userBean.timeZone}" />
					</h:outputText></td>
			</tr>
		</ui:fragment>
		<ui:fragment rendered="#{rightPaneBean.clickedResource.folderId != 0}">
			<tr>
				<td><span class="resource_field"> #{msg.path}: </span></td>
				<td><a
					href="group/resources.jsf?group_id=#{rightPaneBean.clickedResource.groupId}&amp;folder_id=#{rightPaneBean.clickedResource.folderId}&amp;resource_id=#{rightPaneBean.clickedResource.id}">
						<h:outputText value="#{rightPaneBean.clickedResource.prettyPath}" />
				</a></td>
			</tr>
		</ui:fragment>
	</table>

	<h:panelGroup
		rendered="#{not empty rightPaneBean.clickedResource.description}">
		<div class="resource_field" style="padding-top: 10px">
			#{msg.description}</div>
		<h:outputText id="resource_description"
			value="#{rightPaneBean.clickedResource.descriptionHTML}"
			escape="false" />
	</h:panelGroup>

	<h:form id="archive_current_form"
		rendered="${rightPaneBean.clickedResource.storageType == 2 and rightPaneBean.clickedResource.canEditResource(userBean.user)}">
		<span class="resource_field"> #{msg.current_version}: </span>
		<p:commandButton action="#{resourceDetailBean.archiveCurrentVersion}"
			styleClass="greenbutton" value="#{msg['Archive.now']}"
			update=":growl :archive_view :archive_view_options"
			style="margin-top:10px" />
	</h:form>

	<h:panelGroup id="archive_view_options" layout="block">
		<h:panelGroup layout="block" style="padding-top: 15px;"
			rendered="#{not empty rightPaneBean.clickedResource.archiveUrls}">
			<span class="resource_field" style="position: relative;">
				#{msg['Archive.versions']} ( <span id="no_of_archive_versions"
				style="color: red">
					#{rightPaneBean.clickedResource.archiveUrls.size()} </span> ):
			</span>

			<p:commandButton id="list_button" styleClass="greenbutton"
				value="#{msg.list_view}" onclick="open_list_view(); return false;" />
			<p:commandButton id="timeline_button" styleClass="greenbutton"
				value="#{msg.timeline_view}"
				onclick="open_timeline_view(); return false;" />
			<!-- Insert thumbnail link visualization -->
		</h:panelGroup>
	</h:panelGroup>

	<h:panelGroup id="archive_view"
		rendered="#{not empty rightPaneBean.clickedResource.archiveUrls}"
		layout="block">
		<h:panelGroup id="archive_list_view" layout="block">
			<ul>
				<ui:repeat var="entry"
					value="#{rightPaneBean.clickedResource.archiveUrls}">
					<!--@elvariable id="entry" type="de.l3s.learnweb.ArchiveUrl"-->
					<li><a href="#{entry.archiveUrl}" target="_blank"> <h:outputText
								value="${userBean.formatDate(entry.timestamp)}" />
					</a></li>
				</ui:repeat>
			</ul>
		</h:panelGroup>
		<h:panelGroup id="timeline_view" layout="block">
			<ui:decorate template="/lw/templates/archive_timeline_template.xhtml" />
		</h:panelGroup>
		<br class="clear" />
	</h:panelGroup>

	<h:form id="tag_form"
		rendered="${not empty rightPaneBean.clickedResource.tags or rightPaneBean.clickedResource.canEditResource(userBean.user)}">
		<div class="resource_field"
			style="padding-top: 10px; padding-bottom: 10px">#{msg.tags}</div>

		<ul style="margin: 0; padding: 0;">
			<ui:repeat var="tag" value="#{rightPaneBean.clickedResource.tags}">
				<li class="tag_list"><h:outputLink
						styleClass="tag_name ui-button ui-widget ui-state-default ui-corner-all ui-button-text-only"
						value="search.jsf">
						<span class="ui-button-text"> #{tag.name} </span>
						<f:param name="action" value="image" />
						<f:param name="query" value="#{tag.name}" />
					</h:outputLink> <p:commandButton styleClass="tag_x float-right"
						action="#{resourceDetailBean.onDeleteTag}" value="x"
						update=":right_pane_wrapper :growl" process="@form"
						rendered="#{rightPaneBean.clickedResource.canEditResource(userBean.user)}">
						<f:setPropertyActionListener
							target="#{resourceDetailBean.selectedTag}" value="#{tag}" />
					</p:commandButton></li>
			</ui:repeat>
		</ul>
	</h:form>

	<h:form id="tag_input_form"
		rendered="#{rightPaneBean.clickedResource.canAnnotateResource(userBean.user)}">

		<p:inputText styleClass="tag_field"
			value="#{resourceDetailBean.tagName}" id="tag_name" />
		<p:commandButton actionListener="#{resourceDetailBean.addTag}"
			styleClass="greenbutton clearfix" value="#{msg.addTag}"
			update=":resourcesView :tag_form :growl :tag_input_form:tag_name"
			process="@form" style="margin-right:0;margin-top:4px;float:right"
			partialSubmit="true">

			<f:setPropertyActionListener
				target="#{activityResourceBean.reloadLogs}" value="true" />
		</p:commandButton>

	</h:form>

	<h:form id="comment_input_form" styleClass="clear" prependId="false">

		<h:panelGroup layout="block" class="resource_field"
			style="padding-top: 10px"
			rendered="${not empty rightPaneBean.clickedResource.comments or rightPaneBean.clickedResource.canAnnotateResource(userBean.user)}">
                            #{msg.comments}
                        </h:panelGroup>

		<ui:fragment
			rendered="#{rightPaneBean.clickedResource.canAnnotateResource(userBean.user)}">
			<br />
			<div style="position: relative; padding-left: 60px;">
				<img id="userpic"
					src="${learnwebBean.getProfileImage(userBean.user)}" width="50"
					height="50" style="position: absolute; left: 0"
					alt="Profile picture" />

				<p:inputTextarea id="commentfield"
					style="width:100%;min-height:50px;box-sizing:border-box;" rows="2"
					value="#{resourceDetailBean.newComment}"
					placeholder="#{msg.addComment}" required="true" />
				<br />
			</div>
			<p:commandButton id="comment_button"
				styleClass="greenbutton float-right" value="#{msg.addComment}"
				actionListener="#{resourceDetailBean.addComment()}"
				update=":resourcesView :comment_input_form :comment_form :growl">
				<f:setPropertyActionListener
					target="#{activityResourceBean.reloadLogs}" value="true" />
			</p:commandButton>
		</ui:fragment>
	</h:form>
	<br class="clear" />
	<h:form id="comment_form" styleClass="clear" prependId="false"
		style="margin-bottom:40px;">
		<h:panelGroup layout="block"
			rendered="#{not empty rightPaneBean.clickedResource.comments}"
			styleClass="comments">

			<ui:repeat var="comment"
				value="#{rightPaneBean.clickedResource.comments}">
				<div class="comment">
					<img class="userpic" src="#{comment.getUser().image}" width="30"
						height="30" alt="Profile picture" />
					<div class="username_div">
						<span class="username"> <a
							href="user/detail.jsf?user_id=#{comment.user.id}"
							class="username_link"> #{comment.user.username} </a>
						</span> <span title="#{comment.date}" class="comment_date">
							#{userBean.getPrettyDate(comment.date)} </span>
						<div style="margin-top: 5px;">#{comment.text}</div>

					</div>
					<div class="clear"></div>
					<div style="padding-left: 40px;">
						<p:commandLink
							rendered="#{resourceDetailBean.canEditComment(comment)}"
							style="margin-right: 5px; font-size: 10px !important; color: green"
							value="#{msg.edit}" onsuccess="PF('comment_dialog').show();"
							ajax="true" update=":comment_dialog_form">
							<f:setPropertyActionListener
								target="#{resourceDetailBean.clickedComment}" value="#{comment}" />
						</p:commandLink>
						<p:commandLink
							rendered="#{resourceDetailBean.canEditComment(comment)}"
							action="#{resourceDetailBean.onDeleteComment}"
							style="margin-right: 5px; font-size: 10px !important; color: red"
							value="#{msg.delete}"
							onstart="return confirm('#{msg.delete_message_comments}');"
							ajax="true" update=":right_pane_wrapper :growl">
							<f:setPropertyActionListener
								target="#{resourceDetailBean.clickedComment}" value="#{comment}" />
						</p:commandLink>
					</div>

				</div>
			</ui:repeat>
		</h:panelGroup>
	</h:form>

	<script type="text/javascript">
		prepareCommentButton();
	</script>

	<p:dialog header="#{msg.edit}" modal="true" minWidth="440" width="540"
		appendTo="@(body)" widgetVar="comment_dialog">
		<h:form id="comment_dialog_form" style="padding-right:8px;">
			<p:inputTextarea autoResize="1" maxHeight="20"
				value="#{resourceDetailBean.clickedComment.text}"
				style="width:100%;" />

			<p:commandButton actionListener="#{resourceDetailBean.onEditComment}"
				update=":right_pane_wrapper :growl" title="#{msg.save}"
				value="#{msg.save}" onsuccess="PF('comment_dialog').hide();"
				style="display:block; margin-top:5px;" />
		</h:form>
	</p:dialog>
</ui:composition>