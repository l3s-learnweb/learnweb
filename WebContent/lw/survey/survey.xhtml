<ui:composition template="/templates/main/main_old.xhtml"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:p="http://primefaces.org/ui"
	xmlns:pt="http://xmlns.jcp.org/jsf/passthrough"
	xmlns:c="http://java.sun.com/jsp/jstl/core"
	xmlns:fn="http://java.sun.com/jsp/jstl/functions"
	lang="#{userBean.localeCode}">

	<ui:define name="metadata">
		<f:metadata>
			<f:viewParam name="resource_id" value="#{surveyBean.surveyResourceId}" required="true" requiredMessage="Missing resource parameter" />
			<f:viewParam name="user_id" value="#{surveyBean.surveyUserId}" />
			<f:viewParam name="go_back" value="#{surveyBean.goBackPage}" />
			<f:viewAction action="#{surveyBean.onLoad}" />
			<f:viewAction action="#{surveyBean.onLoadEdit}" />
		</f:metadata>
	</ui:define>
	
	<ui:param name="pageTitle" value="Survey" />
	<ui:param name="loginRequired" value="true" />
	<ui:param name="disableGrowl" value="true" />

	<ui:define name="center_layout">
		<h:outputStylesheet library="survey" name="survey.css" />

		<h:form id="form" rendered="#{surveyBean.resource != null}">
		
			<p:panel header="#{surveyBean.resource.title}" style="margin-bottom:10px;">
				
				<h:panelGroup rendered="#{surveyBean.formEnabled}">
					<h:panelGrid columns="1" cellpadding="5">
						<c:forEach var="question" items="#{surveyBean.resource.questions}">

							<c:if test="#{fn:startsWith(question.type,'FULLWIDTH_')}">
								<c:if test="#{question.type eq 'FULLWIDTH_HEADER'}">
									<h:panelGroup>
										<h3>
											<h:outputText value="${question.label}" style="font-style: italic; font-weight: bold;" />
										</h3>
									</h:panelGroup>
								</c:if>
								<c:if test="#{question.type eq 'FULLWIDTH_DESCRIPTION'}">
									<h:outputText value="${question.label}" />
								</c:if>
							</c:if>
							
							<c:if test="#{question.type eq 'INPUT_TEXT'}">
								<p:outputLabel for="input_#{question.id}" value="#{question.label}"></p:outputLabel>
								<p:inputText id="input_#{question.id}" required="#{question.required and empty param[save.clientId]}" value="#{surveyBean.userAnswers.answers[question.id]}"
									title="#{question.info}" style="width:70%;'">

									<f:validateLength disabled="#{empty question.options}" minimum="#{question.options[0]}" maximum="#{question.options[1]}" />									
								</p:inputText>
								<p:tooltip for="input_#{question.id}" showEvent="focus"
									hideEvent="blur" position="left"
									rendered="#{not empty question.info}" />
							</c:if>

							<c:if test="#{question.type eq 'INPUT_TEXTAREA'}">
								<p:outputLabel for="input_area_#{question.id}" value="#{question.label}"></p:outputLabel>
								<p:inputTextarea id="input_area_#{question.id}" required="#{question.required and empty param[save.clientId]}" value="#{surveyBean.userAnswers.answers[question.id]}"
									title="#{question.info}" rows="4" style="overflow-y: scroll; width:100%; box-sizing: border-box;" class="border-box-100">									
									
									<f:validateLength disabled="#{empty question.options}" minimum="#{question.options[0]}" maximum="#{question.options[1]}" />									
								</p:inputTextarea>
								<p:tooltip for="input_area_#{question.id}" showEvent="focus"
									hideEvent="blur" position="left"
									rendered="#{not empty question.info}" />
							</c:if>

							<c:if test="#{question.type eq 'AUTOCOMPLETE'}">
								<p:outputLabel for="input_complete_#{question.id}"
									value="#{question.label}"></p:outputLabel>
								<p:autoComplete id="input_complete_#{question.id}"
									required="#{question.required and empty param[save.clientId]}"
									value="#{surveyBean.userAnswers.answers[question.id]}"
									completeMethod="#{question.completeText}" class="border-box-100" />
								<p:tooltip for="input_complete_#{question.id}" showEvent="hover"
									position="left" rendered="#{true}"
									value="#{question.info}" />
							</c:if>

							<c:if
								test="#{question.type eq 'ONE_MENU' or question.type eq 'ONE_MENU_EDITABLE'}">
								<p:outputLabel for="input_selectone_#{question.id}" value="#{question.label}"></p:outputLabel>
								<p:selectOneMenu id="input_selectone_#{question.id}"
									value="#{surveyBean.userAnswers.answers[question.id]}"
									editable="#{question.type eq 'ONE_MENU_EDITABLE'}"
									required="#{question.required and empty param[save.clientId]}"
									class="border-box-100" title="#{question.info}">
									<f:selectItems value="#{question.answers}" var="option"
										itemLabel="#{option}" itemValue="#{option}" />
								</p:selectOneMenu>
								<p:tooltip for="input_selectone_#{question.id}" position="left" rendered="#{not empty question.info}" />
							</c:if>

							<c:if test="#{question.type eq 'MULTIPLE_MENU'}">
								<p:outputLabel for="input_selectmultiple_#{question.id}" value="#{question.label}"></p:outputLabel>
								<p:selectCheckboxMenu id="input_selectmultiple_#{question.id}"
									value="#{surveyBean.userAnswers.multipleAnswers[question.id]}"
									label="" multiple="true" title="#{question.info}"
									required="#{question.required and empty param[save.clientId]}"
									filter="#{question.answers.size() gt 8}"
									filterMatchMode="startsWith" panelStyle="width:250px">
									<f:selectItems value="#{question.answers}" var="option"
										itemLabel="#{option.label}" itemValue="#{option.value}" />
								</p:selectCheckboxMenu>
								<p:tooltip for="input_selectmultiple_#{question.id}" position="left" rendered="#{not empty question.info}" />
							</c:if>
							
							<c:if test="#{question.type eq 'ONE_RADIO'}">
								<p:outputLabel for="input_oneradio_#{question.id}"
									value="#{question.label}"></p:outputLabel>
								<p:selectOneRadio id="input_oneradio_#{question.id}"
									value="#{surveyBean.userAnswers.answers[question.id]}"
									label="" multiple="true" title="#{question.info}"
									required="#{question.required and empty param[save.clientId]}"
									filter="#{question.answers.size() gt 8}"
									filterMatchMode="startsWith" panelStyle="width:250px">
									<f:selectItems value="#{question.answers}" var="option"
										itemLabel="#{option}" itemValue="#{option}" />
								</p:selectOneRadio>
								<p:tooltip for="input_oneradio_#{question.id}" position="left" rendered="#{not empty question.info}" />
							</c:if>
							
							<c:if test="#{question.type eq 'MANY_CHECKBOX'}">
								<p:outputLabel for="input_manycheckbox_#{question.id}" value="#{question.label}"></p:outputLabel>
								<p:selectManyCheckbox id="input_manycheckbox_#{question.id}"
									value="#{surveyBean.userAnswers.multipleAnswers[question.id]}"
									label="" multiple="true" title="#{question.info}"
									required="#{question.required and empty param[save.clientId]}"
									filter="#{question.answers.size() gt 8}"
									filterMatchMode="startsWith" panelStyle="width:250px"
									layout="grid" columns="1">
									<f:selectItems value="#{question.answers}" var="option"
										itemLabel="#{option}" itemValue="#{option}" />
								</p:selectManyCheckbox>
								<p:tooltip for="input_manycheckbox_#{question.id}" position="left" rendered="#{not empty question.info}" />
							</c:if>
							
						</c:forEach>
					</h:panelGrid>
					
					<div style="margin:2rem 0 1.5rem;">
						<p:commandButton value="#{msg.submit}"
							styleClass="float-left greenbutton resource_button" 
							action="#{surveyBean.onSubmit()}" update=":message @form"
							oncomplete="$('.nano').nanoScroller({scrollTop: 0});"
							ajax="true">
							<p:confirm message="Do you want to submit this form finally? You will not be able to change your answers." disabled="#{not surveyBean.resource.saveable}" />
						</p:commandButton>
	
						<p:commandButton binding="#{save}" id="save" value="#{msg.save}" 
							rendered="#{surveyBean.resource.saveable}" 
							actionListener="#{surveyBean.onSave()}" 
							style="float:left; margin-left:5px"
							styleClass="graybutton resource_button"
							ajax="true" oncomplete="$('.nano').nanoScroller({scrollTop: 0});"				
	                     	process="@form" 
	                     	update="@form :message">
						</p:commandButton>
						<br class="clear" />
					</div>
				</h:panelGroup>	
				
				<ui:fragment rendered="#{not surveyBean.formEnabled}">
					<h:outputText value="You can't edit this survey." />
					<br />
					<br />
					
					<h:outputLink value="survey/answer.jsf" rendered="#{surveyBean.userAnswers.saved}" styleClass="float-left greenbutton">
						<f:param name="resource_id" value="#{surveyBean.surveyResourceId}" />
						<f:param name="user_id" value="#{surveyBean.surveyUserId}" />		
						<h:outputText value="View answers" />
					</h:outputLink>

					<h:outputLink value="#{surveyBean.goBackPageLink}" rendered="#{surveyBean.goBackPageLink ne null}"  
							style="margin-left:5px" styleClass="float-left greenbutton">
						<h:outputText value="#{surveyBean.goBackPageTitle}" />
					</h:outputLink>
					<br class="clear" />
				</ui:fragment>	
					
			</p:panel>

		

		
		</h:form>
	</ui:define>
</ui:composition>