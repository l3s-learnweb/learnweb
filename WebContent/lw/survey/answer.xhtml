<ui:composition template="/WEB-INF/templates/layout/template.xhtml"
				xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
				xmlns:h="http://xmlns.jcp.org/jsf/html"
				xmlns:f="http://xmlns.jcp.org/jsf/core"
				xmlns:p="http://primefaces.org/ui"
				xmlns:c="http://xmlns.jcp.org/jsp/jstl/core"
				xmlns:fn="http://xmlns.jcp.org/jsp/jstl/functions">

	<ui:define name="metadata">
		<f:metadata>
			<f:viewParam name="resource_id" value="#{surveyBean.surveyResourceId}" required="true" requiredMessage="Missing resource parameter"/>
			<f:viewParam name="user_id" value="#{surveyBean.surveyUserId}"/>
			<f:viewAction action="#{surveyBean.onLoad}"/>
		</f:metadata>
	</ui:define>

	<ui:param name="pageTitle" value="Survey"/>
	<ui:param name="loginRequired" value="true"/>

	<ui:define name="breadcrumb_ext">
		<p:menuitem value="#{msg['Submission.overview_title']}" url="myhome/submission_overview.jsf#"/>
		<p:menuitem value="#{surveyBean.resource.title}" url="myhome/submission_overview.jsf#"/>
	</ui:define>

	<ui:define name="center_layout">
		<p:panel header="Survey answer" rendered="#{surveyBean.resource != null}">
			<h:form id="survey_data">
				<div class="form-group font-weight-bold">
					<h:outputText value="Student ID: #{surveyBean.userAnswers.user.studentId}"
								  rendered="#{userBean.moderator or userBean.user.id eq surveyBean.surveyUserId}"/>
				</div>

				<c:forEach var="field" items="#{surveyBean.resource.questions}">
					<c:if test="#{fn:startsWith(field.type,'FULLWIDTH_')}">
						<c:if test="#{field.type eq 'FULLWIDTH_HEADER'}">
							<h3 class="mb-3">
								<h:outputText value="${field.label}"/>
							</h3>
						</c:if>

						<c:if test="#{field.type eq 'FULLWIDTH_DESCRIPTION'}">
							<h:outputText value="${field.label}" styleClass="d-block"/>
						</c:if>
					</c:if>

					<div class="form-group">
						<c:if test="#{field.type eq 'INPUT_TEXT' or field.type eq 'INPUT_TEXTAREA' or field.type eq 'AUTOCOMPLETE'}">
							<!-- eumade4all special rule remove later   field.label.startsWith('QUALITATIVE FEEDBACK ON ') and  -->
							<c:if test="#{not (field.label.startsWith('QUALITATIVE FEEDBACK ON ') and empty surveyBean.userAnswers.answers[field.id].trim())}">
								<p:outputLabel value="#{field.label}"/>
								<p:outputLabel value="#{surveyBean.userAnswers.answers[field.id]}"/>
							</c:if>
						</c:if>

						<c:if test="#{field.type eq 'ONE_MENU' or field.type eq 'ONE_MENU_EDITABLE'}">
							<p:outputLabel value="#{field.label}"/>
							<p:selectOneMenu id="input_selectone_#{field.id}" value="#{surveyBean.userAnswers.answers[field.id]}"
											 editable="#{field.type eq 'ONE_MENU_EDITABLE'}" required="#{field.required}" class="border-box-100" title="#{field.info}">
								<f:selectItems value="#{field.answers}" var="option" itemLabel="#{option}" itemValue="#{option}"/>
							</p:selectOneMenu>
						</c:if>

						<c:if test="#{field.type eq 'MULTIPLE_MENU'}">
							<p:outputLabel value="#{field.label}"/>
							<p:selectCheckboxMenu id="input_selectmultiple_#{field.id}" value="#{surveyBean.userAnswers.multipleAnswers[field.id]}"
												  label="" multiple="true" title="#{field.info}" required="#{field.required}"
												  filter="#{field.optionsList.size() gt 8}" filterMatchMode="startsWith">
								<f:selectItems value="#{field.optionsList}" var="selectItemOption" itemLabel="#{selectItemOption.label}" itemValue="#{selectItemOption.value}"/>
							</p:selectCheckboxMenu>
						</c:if>

						<c:if test="#{field.type eq 'ONE_RADIO'}">
							<c:if test="#{not field.label.startsWith('OVERALL MARK') or not empty surveyBean.userAnswers.answers[field.id] and surveyBean.userAnswers.answers[field.id] ne 'Don\'t show'}">
								<!-- eumade4all special rule remove later  -->
								<p:outputLabel value="#{field.label}"/>
								<p:selectOneRadio id="input_oneradio_#{field.id}" value="#{surveyBean.userAnswers.answers[field.id]}" label=""
												  multiple="true" title="#{field.info}" required="#{field.required}" filter="#{field.optionsList.size() gt 8}"
												  layout="responsive" columns="10" filterMatchMode="startsWith" panelStyle="">
									<!--
									<f:selectItems value="#{field.answers}" var="option" itemLabel="#{option}" itemValue="#{option}"/>
										special rule for eumade4all remove after the project:
										-->
									<f:selectItems value="#{field.getEUMadeAnswersWithout()}" var="option" itemLabel="#{option}" itemValue="#{option}"/>
								</p:selectOneRadio>
							</c:if>
						</c:if>

						<c:if test="#{field.type eq 'MANY_CHECKBOX'}">
							<p:outputLabel value="#{field.label}"/>
							<p:selectManyCheckbox id="input_manycheckbox_#{field.id}" value="#{surveyBean.userAnswers.multipleAnswers[field.id]}"
								label="" multiple="true" title="#{field.info}" required="#{field.required}" filter="#{field.optionsList.size() gt 8}"
                                                  filterMatchMode="startsWith" panelStyle="width:250px" layout="pageDirection" columns="1">
								<f:selectItems value="#{field.answers}" var="option" itemLabel="#{option}" itemValue="#{option}"/>
							</p:selectManyCheckbox>
						</c:if>
					</div>
				</c:forEach>
			</h:form>

            <div class="d-flex mt-3">
                <div class="mr-auto">
                    <h:outputLink value="survey/survey.jsf" rendered="#{!not surveyBean.submitted}">
                        <f:param name="resource_id" value="#{surveyBean.surveyResourceId}"/>
                        <f:param name="user_id" value="#{surveyBean.surveyUserId}"/>

                        <i class="fa fa-fw fa-pencil" aria-hidden="true"></i>
                        <h:outputText value="#{msg.edit}"/>
                    </h:outputLink>
                </div>
                <div>
                    <p:commandButton value="#{msg.Print}" styleClass="alt-btn d-print-none">
                        <p:printer target="survey_data"/>
                    </p:commandButton>
                </div>
            </div>
		</p:panel>

		<ui:fragment rendered="#{surveyBean.resource == null}">
			<div class="h4 text-center">
				<h:outputText value="Please select valid survey resource."></h:outputText>
			</div>
		</ui:fragment>
	</ui:define>
</ui:composition>
