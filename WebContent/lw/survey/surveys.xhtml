<ui:composition template="/WEB-INF/templates/layout/template.xhtml"
				xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
				xmlns:h="http://xmlns.jcp.org/jsf/html"
				xmlns:f="http://xmlns.jcp.org/jsf/core"
				xmlns:p="http://primefaces.org/ui"
				xmlns:lw="http://l3s.de/learnweb">

<ui:param name="pageTitle" value="#{msg['surveys']}"/>
<ui:param name="hasAccessPermission" value="#{userBean.moderator}"/>

<ui:define name="breadcrumb">
	<lw:breadcrumb-item link="moderator.jsf" title="#{msg.moderator}">
		<ui:decorate template="/WEB-INF/templates/blocks/breadcrumb/nav_list_first.xhtml"/>
	</lw:breadcrumb-item>

	<lw:breadcrumb-item link="survey/templates.jsf" title="#{msg['survey.survey_overview']}">
		<ui:decorate template="/WEB-INF/templates/blocks/breadcrumb/nav_list_admin.xhtml"/>
	</lw:breadcrumb-item>
</ui:define>

<ui:define name="center_layout">
	<h:form>
		<p:dataTable var="survey" styleClass="mb-3" value="#{surveyTemplatesBean.surveys}" emptyMessage="#{msg['no_survey_found']}">
			<f:facet name="header">
				<div class="d-flex">
					<div class="me-auto">#{msg['templates']}</div>
					<div class="d-md-block d-flex flex-column">
						<p:commandButton value="#{msg['survey.create_new_survey']}" action="#{surveyTemplatesBean.onCreateSurvey}" onsuccess="PF('createSurvey').show();" update="createSurvey" styleClass="ui-button-warning mt-2 mt-md-0"/>
					</div>
				</div>
			</f:facet>

			<p:column headerText="#{msg['title']}" styleClass="dd-xs-none">
				<h:outputLink value="#{request.contextPath}/lw/survey/template_readonly.jsf">
					<f:param name="survey_id" value="#{survey.id}"/>
					<h:outputText value="#{survey.title}" escape="false"/>
				</h:outputLink>
			</p:column>

			<p:column headerText="#{msg['description']}" styleClass="dd-sm-none">
				<h:outputText value="#{survey.description}" escape="false"/>
			</p:column>

			<p:column headerText="#{msg['options']}" styleClass="td-text-end">
				<div class="d-flex justify-content-end">
					<p:commandLink styleClass="icon-link me-2" onsuccess="PF('createSurvey').show();" action="#{surveyTemplatesBean.onCopySurvey(survey.id)}" update="createSurvey" process="@this">
						<i class="fas fa-fw fa-copy text-warning" aria-hidden="true"></i>
						<h:outputText value="#{msg['copy']}"/>
					</p:commandLink>
					<p:tooltip for="@next" rendered="#{survey.associated}" value="#{msg['survey.template_already_associated']}." position="left"/>
					<h:panelGroup id="edit" layout="block" styleClass="me-2">
						<p:commandLink styleClass="icon-link" action="#{surveyTemplatesBean.onEditSurvey(survey.id)}" disabled="#{survey.associated}">
							<i class="fas fa-fw fa-pencil-alt text-warning" aria-hidden="true"></i>
							<h:outputText value="#{msg['edit']}"/>
						</p:commandLink>
					</h:panelGroup>
					<p:tooltip for="@next" rendered="#{survey.associated}" value="#{msg['survey.template_already_associated']}." position="left"/>
					<h:panelGroup id="delete" layout="block">
						<p:commandLink styleClass="icon-link" disabled="#{survey.associated}" action="#{surveyTemplatesBean.onDeleteSurvey(survey)}" update="@form" process="@this">
							<p:confirm header="#{msg['delete']}" message="#{msg['survey.delete_template']}" icon="fas fa-triangle-exclamation"/>
							<i class="fas fa-fw fa-trash-alt text-warning" aria-hidden="true"></i>
							<h:outputText value="#{msg['delete']}"/>
						</p:commandLink>
					</h:panelGroup>
				</div>
			</p:column>
		</p:dataTable>
	</h:form>

	<p:dialog header="#{msg['survey.create_new_survey']}" styleClass="overflow-hidden" widgetVar="createSurvey" modal="true">
		<h:form id="createSurvey">
			<div class="d-flex flex-column mb-3">
				<div class="field">
					<p:outputLabel for="@next" value="#{msg['title']}:" styleClass="fw-bold"/>
					<p:inputText value="#{surveyTemplatesBean.selectedSurvey.title}" label="#{msg['title']}" />
					<p:message for="@previous"/>
				</div>
				<div class="field">
					<p:outputLabel for="@next" value="#{msg['description']}:" styleClass="fw-bold"/>
					<p:textEditor value="#{surveyTemplatesBean.selectedSurvey.description}" height="100">
						<f:facet name="toolbar">
						<span class="ql-formats">
							<button class="ql-bold"></button>
							<button class="ql-italic"></button>
							<button class="ql-underline"></button>
						</span>
							<span class="ql-formats">
							<button class="ql-header" value="1"/>
							<button class="ql-header" value="2"/>
						</span>
						</f:facet>
					</p:textEditor>
					<p:message for="@previous"/>
				</div>
				<p:outputPanel layout="block" styleClass="d-flex flex-column">
					<p:outputLabel for="@next" value="#{msg['public']}:" styleClass="fw-bold" />
					<p:tooltip for="@next" value="#{msg['survey.public_explanation']}." position="right"/>
					<p:toggleSwitch value="#{surveyTemplatesBean.selectedSurvey.publicTemplate}"/>
				</p:outputPanel>
			</div>
			<p:commandButton value="#{msg['save']}" action="#{surveyTemplatesBean.onSave}" styleClass="float-end" update="@form" process="@form"/>
		</h:form>
	</p:dialog>
</ui:define>

</ui:composition>
