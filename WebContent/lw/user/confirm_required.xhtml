<ui:composition template="/WEB-INF/templates/layout/template.xhtml"
                xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
                xmlns:h="http://xmlns.jcp.org/jsf/html"
                xmlns:f="http://xmlns.jcp.org/jsf/core"
                xmlns:p="http://primefaces.org/ui">

<ui:param name="pageTitle" value="#{msg.email_validation}"/>
<ui:param name="extraPageClass" value="container"/>
<ui:param name="hasAccessPermission" value="#{!confirmRequiredBean.confirmed}"/>

<ui:param name="hideBreadcrumbs" value="true"/>

<ui:define name="center_layout">
    <p:panel header="#{msg.email_validation}" rendered="#{confirmRequiredBean.confirmed}">
        <a href="#{userBean.bannerLink}">
            <h:outputText value="#{msg.return_to_welcome_page}"/>
        </a>
    </p:panel>

    <p:panel header="#{msg.email_validation}" rendered="#{!confirmRequiredBean.confirmed and confirmRequiredBean.user != null}">
        <h:outputFormat value="#{msg['email_confirm_required_text']}" escape="false">
            <f:param value="#{confirmRequiredBean.user.realUsername}"/>
            <f:param value="#{confirmRequiredBean.user.email}"/>
        </h:outputFormat>

        <h:form styleClass="mt-2">
            <p:commandButton action="#{confirmRequiredBean.onSubmitNewEmail}" value="#{msg.send_again}" ajax="false"/>
            <p:linkButton value="#{msg.change_email}" onclick="PF('changeMailDialog').show();return false;"/>
        </h:form>
    </p:panel>

    <p:dialog widgetVar="changeMailDialog" header="#{msg.change_email}"
              modal="true" resizable="false" draggable="false" responsive="true" closeOnEscape="true">
        <h:form>
            <div class="fg-grid mb-3">
                <p:outputLabel for="@next" value="#{msg.email_address}:"/>
                <div class="fg-col">
                    <p:inputText type="email" value="#{confirmRequiredBean.email}" label="#{msg.email_address}" required="true" validator="emailValidator"/>
                    <p:message for="@previous"/>
                </div>
            </div>

            <div class="d-flex">
                <div class="mr-auto">
                    <h:outputText value="* #{msg.mandatory_field}"/>
                </div>
                <div class="d-flex flex-row-reverse">
                    <p:commandButton action="#{confirmRequiredBean.onSubmitNewEmail}" value="#{msg.send_email}" ajax="false"/>
                </div>
            </div>
        </h:form>
    </p:dialog>
</ui:define>

</ui:composition>
