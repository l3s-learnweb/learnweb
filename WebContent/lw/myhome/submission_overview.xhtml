<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:p="http://primefaces.org/ui">

	<ui:composition template="/templates/main/main_old.xhtml">
	
		<ui:define name="metadata">
			<f:metadata>
				<f:viewParam name="user_id" value="#{submitResourcesBean.userId}" />
				<f:viewParam name="course_id" value="#{submitResourcesBean.courseId}" />
				<f:event type="javax.faces.event.PreRenderViewEvent" listener="#{submitResourcesBean.preRenderView}"/>
			</f:metadata>
		</ui:define>
		
		<ui:param name="loginRequired" value="true" />
		<ui:param name="pageTitle" value="#{msg['Submission.overview_title']}" />
		<ui:param name="helpText" value=""/>	
	
		<ui:define name="center_layout">
			<script type="text/javascript">
			function addSubmissionHeaderClickHandler(){
				$('.submission_header').on('click', function(){
			    	$(this).toggleClass('active');
			    	$(this).siblings().slideToggle();
			    });
			}
			
			$(document).ready(function(){
				addSubmissionHeaderClickHandler();
			});
			</script>
			<h:outputStylesheet library="resource-submission" name="submit.css" />
			
			<p:dialog header="#{msg['Submission.edit_submission']}" id="edit_submission_dialog1" modal="true" minWidth="440" appendTo="@(body)" widgetVar="submission_edit_dialog">
				<h:form id="submission_dialog_form" prependId="false">
					<h:panelGrid columns="2">
					
						<h:outputText value="#{msg.title}" title="#{msg.title}"/> <p:inputText value="#{submitResourcesBean.selectedSubmission.title}"/>
						<h:outputText value="#{msg.description}" title="#{msg.description}"/> <p:inputTextarea autoResize="1" maxHeight="20" value="#{submitResourcesBean.selectedSubmission.description}"
							styleClass="resource_dialog_field"/>
						<h:outputText value="#{msg['Submission.open_date']}"/> <p:calendar value="#{submitResourcesBean.selectedSubmission.openDatetime}"  locale="#{userBean.locale}" navigator="true" showOn="button"/>
						<h:outputText value="#{msg['Submission.close_date']}"/> <p:calendar value="#{submitResourcesBean.selectedSubmission.closeDatetime}"  locale="#{userBean.locale}" navigator="true" showOn="button"/>
						<h:outputText value="Max no. of resources"/> <p:inputNumber value="#{submitResourcesBean.selectedSubmission.noOfResources}"/>
						
						<p:commandButton value="#{msg.save}" styleClass="greenbutton" onclick="PF('submission_edit_dialog').hide();" update=":submissions" actionListener="#{submitResourcesBean.updateSubmissionDetails()}" oncomplete="addSubmissionHeaderClickHandler();"/> <h:outputText value=""/> 
					</h:panelGrid>	
				</h:form>
			</p:dialog>
		
			<p:dialog header="#{msg['Submission.create_new_submission']}" id="create_submission_dialog1" modal="true" minWidth="440" appendTo="@(body)" widgetVar="create_submission_dialog">
				<h:form id="create_submission_dialog_form" prependId="false">
				<h:panelGrid columns="2">
				
					<h:outputText value="#{msg.title}" title="#{msg.title}"/> <p:inputText value="#{submitResourcesBean.newSubmission.title}"/>
					<h:outputText value="#{msg.description}" title="#{msg.description}"/> <p:inputTextarea autoResize="1" maxHeight="20" value="#{submitResourcesBean.newSubmission.description}"
						styleClass="resource_dialog_field"/>
					<h:outputText value="#{msg['Submission.open_date']}"/> <p:calendar value="#{submitResourcesBean.newSubmission.openDatetime}"  locale="#{userBean.locale}" navigator="true" showOn="button"/>
					<h:outputText value="#{msg['Submission.close_date']}"/> <p:calendar value="#{submitResourcesBean.newSubmission.closeDatetime}"  locale="#{userBean.locale}" navigator="true" showOn="button"/>
					<h:outputText value="Max no. of resources"/> <p:inputNumber value="#{submitResourcesBean.newSubmission.noOfResources}"/>
					
					<p:commandButton value="#{msg.save}" styleClass="greenbutton" onclick="PF('create_submission_dialog').hide();" update=":submissions :create_submission_dialog1" actionListener="#{submitResourcesBean.createNewSubmission()}" oncomplete="addSubmissionHeaderClickHandler();"/> <h:outputText value=""/> 
				</h:panelGrid>	
				</h:form>
			</p:dialog>
			
			<div class="page_header">
				<span>
					#{msg['Submission.overview']}
				</span>
			</div>
			<h:panelGroup id="submissions" layout="block">
				<h:outputText id="no_submissions" rendered="${submitResourcesBean.pastSubmissions.size() == 0 and submitResourcesBean.currentSubmissions.size() == 0 and submitResourcesBean.futureSubmissions.size() == 0}">There are no submissions for this course at the moment</h:outputText>
				<h:panelGroup id="past_submissions" layout="block" rendered="${submitResourcesBean.pastSubmissions.size() > 0}">
					<div class="submission_header">
						<div style="margin-top:10px;"><h1>#{msg['Submission.past_submissions']} (${submitResourcesBean.pastSubmissions.size()})</h1></div>
					</div>
					<div class="submission_cards">
						<ui:decorate  template="/lw/templates/submission_cards_template.xhtml">
							<ui:param name="submissions" value="#{submitResourcesBean.pastSubmissions}" />
						</ui:decorate>
					</div>
				</h:panelGroup>
				<h:panelGroup id="current_submissions" layout="block" rendered="${submitResourcesBean.currentSubmissions.size() > 0}">
					<div class="submission_header">
						<div style="margin-top:10px;"><h1>#{msg['Submission.current_submissions']} (${submitResourcesBean.currentSubmissions.size()})</h1></div>
					</div>
					<div class="submission_cards">
						<ui:decorate  template="/lw/templates/submission_cards_template.xhtml">
							<ui:param name="submissions" value="#{submitResourcesBean.currentSubmissions}" />
						</ui:decorate>
					</div>
				</h:panelGroup>
				<h:panelGroup id="future_submissions" layout="block" rendered="${submitResourcesBean.futureSubmissions.size() > 0}">
					<div class="submission_header">
						<div style="margin-top:10px;"><h1>#{msg['Submission.future_submissions']} (${submitResourcesBean.futureSubmissions.size()})</h1></div>
					</div>
					<div class="submission_cards">
						<ui:decorate  template="/lw/templates/submission_cards_template.xhtml">
							<ui:param name="submissions" value="#{submitResourcesBean.futureSubmissions}" />
						</ui:decorate>
					</div>
				</h:panelGroup>
				<br/>
				<h:form>
				<p:commandLink styleClass="greenbutton" style="margin-top:20px;text-decoration:none;" title="#{msg['Submission.create_new_submission']}" rendered="#{userBean.admin || userBean.moderator}"
							process="@this" oncomplete="PF('create_submission_dialog').show();" update=":create_submission_dialog1">
							#{msg['Submission.create_new_submission']}
				</p:commandLink>
				</h:form>
			</h:panelGroup>			
		</ui:define>
	</ui:composition>
</html>