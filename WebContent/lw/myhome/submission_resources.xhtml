<ui:composition template="/templates/main/main_old.xhtml"
				xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
				xmlns:h="http://xmlns.jcp.org/jsf/html"
				xmlns:f="http://xmlns.jcp.org/jsf/core"
				xmlns:p="http://primefaces.org/ui"
				xmlns:pt="http://xmlns.jcp.org/jsf/passthrough">
	
	<ui:define name="metadata">
		<f:metadata>
			<f:viewParam name="submission_id" value="#{submissionBean.submissionId}"/>
			<f:viewParam name="user_id" value="#{submissionBean.userId}" />
			<f:viewParam name="resource_id" value="#{rightPaneBean.resourceId}" />
			<f:viewAction action="#{rightPaneBean.onLoad}"/>
			<f:viewAction action="#{submissionBean.onLoad}"/> 
		</f:metadata>
	</ui:define>
	
	<ui:param name="pageTitle" value="#{msg['Submission.title']}" />
	<ui:param name="loginRequired" value="true" />

	<ui:define name="center_layout">
	
		<script>
			var max_resources = #{submissionBean.selectedSubmission.noOfResources};
			var resources_to_select = max_resources;
		</script>
		<h:form>
			<p:remoteCommand name="selectGroupItemCommand" actionListener="#{submissionBean.actionSelectGroupItem}" update=":right_pane_wrapper :growl" oncomplete="update_header();selectResourceDND(); load_editor(); "/>
			<p:remoteCommand name="updateSelectedItemsCommand" actionListener="#{submissionBean.actionUpdateSelectedItems}" update=":right_pane_wrapper :resourceGrid2" oncomplete="update_header(); selectResourceDND(); updateMaxResources();"/>
		</h:form>
		
		<!-- only for eumade4all -->
		<p:panel rendered="#{not submissionBean.submitted and not submissionBean.submissionOverviewReadOnly}"><h1 class="red">Remove your name and the university name from inside the uploaded files. Only the study number can be displayed inside the files.</h1></p:panel>

		<ui:fragment rendered="#{not submissionBean.submitted and not submissionBean.submissionOverviewReadOnly}"><h3 class="title-header">#{msg['Submission.select_resources_header']}</h3></ui:fragment>
		<ui:fragment rendered="#{submissionBean.submitted}"><h3 class="title-header">The submitted resources</h3></ui:fragment>
		<hr class="title-divider"/>
		
		<h:outputStylesheet library="lightbox" name="lightbox.css" />
		<h:outputStylesheet library="resource-submission" name="submit.css" />
		<h:outputScript library="resource-submission" name="submit.js" />

		<h:panelGroup id="resourcesView" layout="block">
			<!-- dummy for right pane -->
		</h:panelGroup>

		<h:panelGroup layout="block" id="datagrid" styleClass="datagrid" pt:data-isEnabledMoving="false">
		<h:panelGroup id="resourceGrid2" styleClass="resource-grid" layout="block">
				<p:repeat var="res" value="#{submissionBean.selectedResources}" >

					<h:panelGroup styleClass="resource-item group-resources-item" pt:data-itemType="resource" pt:data-itemId="#{res.id}" layout="block">
						<div class="resource-block">

							<div class="resource-preview">
								<div class="resource-preview-wrapper">
									<div class="resource-preview-wrapper2">
										<div class="resource-preview-block"></div>
										<img class="resource-preview-image" src="#{res.thumbnail1.url}" alt="#{res.title}" />
									</div>
								</div>
								<h:form class="resource-controls" rendered="#{not submissionBean.submitted}">
									<h:outputLink value="#" title="#{msg.delete}" styleClass="action-remove">
										<h:graphicImage alt="Delete" value="../resources/icon/Remove.png"/>
									</h:outputLink>
								</h:form>
							</div>

							<div class="resource-title">
								<div class="resource-title-wrapper">
									<!--<div class="resource-title-icon">
											<div class="resource-title-icon-wrapper">
												<img src="img.png" alt="Title" />
											</div>
										</div>-->
									<div class="resource-title-text">
										<h:outputText value="#{res.title}" escape="false" styleClass="resource-title-name" title="#{res.title}" />
										<span class="resource-title-summary"><span>#{utilBean.getLocaleMessage(res.type)}</span> #{msg.added_by} <span>#{res.getOwnerUser().username}</span></span>
									</div>
								</div>
							</div>

						</div>
					</h:panelGroup>
				</p:repeat>

				<h:outputText value="No resources were submitted" rendered="#{empty submissionBean.selectedResources and submissionBean.submitted}" class="nothing_found"/>
				<h:panelGroup id="add_resource_sign" class="resource-item" layout="block" rendered="#{not submissionBean.submitted and not submissionBean.submissionOverviewReadOnly}">
						<div class="resource-block" style="box-shadow:none;">
							<div class="resource-preview">
								<div class="resource-preview-wrapper">
									<div class="resource-preview-wrapper2">
										<h:graphicImage value="/resources/image/add_sign.png" styleClass="resource-preview-image add-resource-image" alt="select a resource" />
									</div>
								</div>
							</div>	
						</div>
				</h:panelGroup>
				<div class="clear"></div>
				<h:form id="submit_resources_form" prependId="false">
					<p:commandButton id="submit_resources_button" value="#{msg.submit}" class="greenbutton" style="display:none;" action="#{submissionBean.actionSubmitItems}" update=":right_pane_wrapper :resourceGrid2 :growl" onclick="return confirmSubmitMessage();" rendered="#{not submissionBean.submitted}"/>
				</h:form>
		</h:panelGroup>
		</h:panelGroup>
		<h:panelGroup layout="block" id="context-menu" class="context-menu resource-context-menu" role="menu" rendered="#{not submissionBean.submitted}">
			<ui:fragment>
				<div class="context-menu-item action-remove" role="menuitem" data-action="remove" data-per="canDeleteResource">
					<div class="context-menu-item-wrapper">
						<span class="context-menu-item-icon" />
						<span class="context-menu-item-content">Remove</span>
					</div>
				</div>
			</ui:fragment>
		</h:panelGroup>
		<div id="lightbox" class="submit-resources">
			<div id="lightbox_background" onclick="select_res_lightbox.close();"></div>

			<div id="lightbox_container">
				<div id="lightbox_title">
					<h:outputFormat value="#{msg['Submission.lightbox_header']}">
						<f:param value="#{submissionBean.selectedSubmission.noOfResources}"/>
					</h:outputFormat>
					<a href="#" onclick="select_res_lightbox.close(); return false;" id="lightbox_close" title="close"></a>
				</div>
				<div id="lightbox_content" style="overflow-y:auto;overflow-x:hidden;background: white;">
				<h:panelGroup id="resourceGrid" styleClass="resource-grid" layout="block" style="padding-left:5px;padding-top:5px;background-color:white;">
				<p:repeat var="res" value="#{submissionBean.resources}" >

					<h:panelGroup styleClass="resource-item2 group-resources-item2" pt:data-itemType="resource" pt:data-itemId="#{res.id}" layout="block">
						<div class="resource-block">

							<div class="resource-preview">
								<div class="resource-preview-wrapper">
									<div class="resource-preview-wrapper2">
										<div class="resource-preview-block"></div>
										<img class="resource-preview-image" src="#{res.thumbnail1.url}" alt="#{res.title}" />
									</div>
								</div>
							</div>

							<div class="resource-title">
								<div class="resource-title-wrapper">
									<div class="resource-title-text">
										<h:outputText value="#{res.title}" escape="false" styleClass="resource-title-name" title="#{res.title}" />
										<span class="resource-title-summary"><span>#{utilBean.getLocaleMessage(res.type)}</span> #{msg.added_by} <span>#{res.getOwnerUser().username}</span></span>
									</div>
								</div>
							</div>

						</div>
						
					</h:panelGroup>
				</p:repeat>
				<h:panelGroup style="background-color:white;height:100%;" rendered="#{empty submissionBean.resources}" layout="block">
					<h:outputText value="#{msg.no_resources_found}" class="nothing_found" style="color:black;"/>
					<span style="color:black;" class="nothing_found">
						First add resources to  
						<h:outputLink value="myhome/resources.jsf" style="text-decoration:underline;color:black;">
						#{msg.myResourcesTitle}.
						</h:outputLink>
					</span>
				</h:panelGroup>
				</h:panelGroup>
				
				</div>
				<div id="lightbox_footer" style="background: rgba(0, 0, 0, .80);">
					<span class="archive_timestamp_overlay_text">
						<button class="greenbutton" style="padding:8px 14px; font-size:16px !important;" onclick="selectResources();">#{msg.add}</button>
					</span>
				</div>
			</div>
			
		</div>
	</ui:define>
	
	<ui:define name="right_layout">
		<ui:decorate  template="/templates/resources/right_pane.xhtml">
			<ui:param name="bean" value="#{submissionBean}" />
		</ui:decorate>
	</ui:define>
</ui:composition>	