<ui:composition template="/WEB-INF/templates/layout/template.xhtml"
                xmlns="http://www.w3.org/1999/xhtml"
                xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
                xmlns:h="http://xmlns.jcp.org/jsf/html"
                xmlns:f="http://xmlns.jcp.org/jsf/core"
                xmlns:pt="http://xmlns.jcp.org/jsf/passthrough"
                xmlns:p="http://primefaces.org/ui">

<ui:param name="loginRequired" value="true"/>
<ui:param name="pageTitle" value="#{msg.myResourcesTitle}"/>
<ui:param name="helpText" value="#{msg.myhomeResourcesHelp}"/>
<ui:param name="rightPane" value="true"/>

<ui:define name="metadata">
    <f:metadata>
        <f:viewParam name="group_id" value="#{myResourcesBean.groupId}"/>
        <f:viewParam name="folder_id" value="#{myResourcesBean.selectedFolderId}"/>
        <f:viewParam name="save_url" value="#{myResourcesBean.urlToSave}"/>
        <f:viewParam name="resource_id" value="#{rightPaneBean.resourceId}"/>
        <f:viewAction action="#{myResourcesBean.onLoad}"/>
        <f:viewAction action="#{rightPaneBean.onLoad}"/>
    </f:metadata>
</ui:define>

<ui:define name="sub_breadcrumb">
    <p:menuitem value="#{msg.myResourcesTitle}" url="myhome/resources.jsf#"/>
</ui:define>

<ui:define name="center_layout">
    <p:panel styleClass="m-0 panel-content no-padding-panel-content section-resources" >
        <h:form>
            <p:remoteCommand name="resourceAddedHook" update=":resourcesView"/>
            <p:remoteCommand name="resourceUpdatedHook" update=":resourcesView"/>

            <p:remoteCommand name="openFolderCommand" actionListener="#{myResourcesBean.actionOpenFolder}"
                             update=":folder_layout_options :breadcrumb :context-menu :resourcesView :right_pane_wrapper :right_pane :growl"
                             oncomplete="resourceDND();"/>
            <p:remoteCommand name="selectGroupItemCommand" actionListener="#{myResourcesBean.actionSelectGroupItem}"
                             update=":right_pane_wrapper :right_pane :growl" oncomplete="resourceDND(); "/>
            <p:remoteCommand name="updateGroupItemsCommand" actionListener="#{myResourcesBean.actionUpdateGroupItems}"
                             update=":breadcrumb :resourcesView :right_pane_wrapper :right_pane :growl " oncomplete="resourceDND();"/>
            <p:remoteCommand name="editGroupItemCommand" actionListener="#{myResourcesBean.actionEditGroupItem}"
                             update=":right_pane_wrapper :right_pane :growl" />
            <p:remoteCommand name="updateAddResourcePaneCommand" actionListener="#{myResourcesBean.updateTargetForAddResourceBean}"
                             update=":right_pane_wrapper :right_pane :growl" />
            <p:remoteCommand name="updateThumbnailCommand" actionListener="#{resourceDetailBean.setResourceThumbnail}"
                             update=":right_pane_wrapper :right_pane :resourcesView :growl" oncomplete="resourceDND();"/>
        </h:form>

        <div class="center-header" id="group_header">
            <div class="d-flex justify-content-between align-items-center">
                <div class="d-flex flex-row justify-content-between align-items-center">
                    <span class="green-tittle mr-2 mb-2">My Resources</span>
                    <h:form  id="folder_layout_options" prependId="false">
                        <p:commandButton value="#{msg.list_view}" icon="ui-icon-mylist" style="background-color: rgb(221, 221, 221);"
                                         update=":resourcesView :folder_layout_options"
                                         rendered="#{myResourcesBean.rootFolder and myResourcesBean.resourcesView == 'grid'}">
                            <f:setPropertyActionListener target="#{myResourcesBean.resourcesView}" value="list"/>
                        </p:commandButton>
                        <p:commandButton value="#{msg.grid_view}" icon="ui-icon-mygrid" style="background-color: rgb(221, 221, 221); "
                                         update=":resourcesView :folder_layout_options"
                                         rendered="#{myResourcesBean.rootFolder and myResourcesBean.resourcesView == 'list'}">
                            <f:setPropertyActionListener target="#{myResourcesBean.resourcesView}" value="grid"/>
                        </p:commandButton>
                    </h:form>
                </div>
                <h:form id="center_header_form">
                    <p:commandButton id="add_resource_button" value="#{msg.upload_resource}" menuStyleClass="test" iconPos="right"
                                     styleClass="resource_button greenbutton resourcetoolbutton" type="button"/>
                    <p:tieredMenu overlay="true" trigger="add_resource_button" my="left top" at="left bottom" style="width:200px">
                        <p:submenu label="#{msg.create}" icon="fa fa-plus-square">
                            <p:menuitem value="#{msg.office_document}" icon="fa fa-file-word-o"
                                        update=":right_pane_wrapper"  process="@form" styleClass="bg-primary"
                                        actionListener="#{addResourceBean.clearForm()}">
                                <f:setPropertyActionListener
                                        target="#{addResourceBean.resource.storageType}" value="1"/>
                                <f:setPropertyActionListener
                                        target="#{addResourceBean.resource.type}" value="document"/>
                                <f:setPropertyActionListener
                                        target="#{rightPaneBean.paneAction}" value="newFile"/>
                            </p:menuitem>
                            <p:menuitem value="#{msg.office_spreadsheet}" icon="fa fa-file-excel-o"
                                        update=":right_pane_wrapper" styleClass="bg-primary"
                                        actionListener="#{addResourceBean.clearForm()}">
                                <f:setPropertyActionListener
                                        target="#{addResourceBean.resource.storageType}" value="1"/>
                                <f:setPropertyActionListener
                                        target="#{addResourceBean.resource.type}" value="spreadsheet"/>
                                <f:setPropertyActionListener
                                        target="#{rightPaneBean.paneAction}" value="newFile"/>
                            </p:menuitem>
                            <p:menuitem value="#{msg.office_presentation}" icon="fa fa-file-powerpoint-o"
                                        update=":right_pane_wrapper" styleClass="bg-primary"
                                        actionListener="#{addResourceBean.clearForm()}">
                                <f:setPropertyActionListener
                                        target="#{addResourceBean.resource.storageType}" value="1"/>
                                <f:setPropertyActionListener
                                        target="#{addResourceBean.resource.type}" value="presentation"/>
                                <f:setPropertyActionListener
                                        target="#{rightPaneBean.paneAction}" value="newFile"/>
                            </p:menuitem>
                        </p:submenu>

                        <p:menuitem value="#{msg.upload_file}" icon="ui-icon-disk" update=":right_pane_wrapper"
                                    actionListener="#{addResourceBean.clearForm()}">
                            <f:setPropertyActionListener target="#{addResourceBean.resource.storageType}" value="1"/>
                            <f:setPropertyActionListener target="#{rightPaneBean.paneAction}" value="newResource"/>
                        </p:menuitem>
                        <p:menuitem value="#{msg.upload_url}" icon="ui-icon-link" update=":right_pane_wrapper"
                                    actionListener="#{addResourceBean.clearForm()}">
                            <f:setPropertyActionListener target="#{addResourceBean.resource.storageType}" value="2"/>
                            <f:setPropertyActionListener target="#{rightPaneBean.paneAction}" value="newResource"/>
                        </p:menuitem>
                        <p:menuitem value="#{msg['Glossary.add_glossary']}" icon="ui-icon-link" update=":right_pane_wrapper"
                                    actionListener="#{addResourceBean.clearForm()}">
                            <f:setPropertyActionListener target="#{addResourceBean.resource.storageType}" value="1"/>
                            <f:setPropertyActionListener target="#{addResourceBean.resource.type}" value="glossary2"></f:setPropertyActionListener>
                            <f:setPropertyActionListener target="#{rightPaneBean.paneAction}" value="newResource"/>
                            <f:actionListener binding="#{addResourceBean.setResourceAsGlossary()}"/>
                        </p:menuitem>
                    </p:tieredMenu>

                </h:form>

            </div>
            <h:panelGroup id="breadcrumb" styleClass="breadcrumbs" layout="block">
                <h:form rendered="#{not empty myResourcesBean.breadcrumb}">
                    <ul>
                        <li>
                            <h:link value="#{msg.myResourcesTitle}" styleClass="m-1" outcome="/lw/myhome/resources.jsf"/>
                        </li>

                        <p:repeat var="folder" value="#{myResourcesBean.breadcrumb}" varStatus="status">
                            <li>
                                <p:commandLink rendered="#{not status.last}" update=":breadcrumb :resourcesView :right_pane_wrapper"
                                               oncomplete="update_url(0,0,#{folder.groupId});resourceDND();">
                                    <f:setPropertyActionListener target="#{myResourcesBean.selectedFolder}" value="#{folder}"/>
                                    <h:outputText value="#{folder.name}" escape="false"/>
                                </p:commandLink>

                                <h:outputText rendered="#{status.last}" value="#{folder.name}" escape="false" styleClass="bold"/>
                            </li>
                        </p:repeat>
                    </ul>
                </h:form>
            </h:panelGroup>
        </div>

        <p:dialog id="deleteConfirmDialog" header="#{msg.delete_resource_title}" widgetVar="deleteConfirm" appendTo="@(body)" closable="false"
                  minWidth="540" modal="true">
            <p>
                <h:outputText value="#{msg.delete_confirm_dialog_content_folder}" styleClass="single-folder"/>
                <h:outputText value="#{msg.delete_confirm_dialog_content}" styleClass="single-resource"/>
                <h:outputText value="#{msg.delete_confirm_dialog_content_plural}" styleClass="plural"/>
            </p>

            <h:panelGroup colspan="2" styleClass="float-right" style="margin: 10px 0;">
                <p:button value="#{msg.cancel}" styleClass="graybutton" onclick="PF('deleteConfirm').hide(); return false;"/>
                <p:button value="#{msg.delete}" styleClass="confirm greenbutton" onclick="return false"/>
            </h:panelGroup>
        </p:dialog>

        <p:dialog id="selectDestinationDialog" header="#{msg.selectDestination}" widgetVar="selectDestination" appendTo="@(body)" closable="false"
                  minWidth="540" modal="true">
            <h:panelGrid columns="2">
                <h:outputText value="#{msg.add_to}:"/>

                <h:form>
                    <p:tree id="folders_tree" value="#{userBean.writeAbleGroupsTree}" var="node" animate="true" dynamic="true" selectionMode="single"
                            selection="#{myResourcesBean.selectedTargetNode}" style="max-height:28rem; overflow:auto;">
                        <p:ajax event="select" listener="#{myResourcesBean.onTargetNodeSelect}"/>

                        <p:treeNode type="group">
                            <h:outputText id="group" value="#{node.title}"/>
                        </p:treeNode>

                        <p:treeNode type="folder" expandedIcon="ui-icon-folder-open" collapsedIcon="ui-icon-folder-collapsed">
                            <h:outputText value="#{node.name}"/>
                        </p:treeNode>
                    </p:tree>
                </h:form>
            </h:panelGrid>

            <h:panelGroup colspan="2" styleClass="float-right" style="margin: 10px 0;">
                <p:button value="#{msg.cancel}" styleClass="graybutton" onclick="PF('selectDestination').hide(); return false;"/>
                <p:button value="#{msg.save}" styleClass="confirm greenbutton" onclick="return false"/>
            </h:panelGroup>
        </p:dialog>

        <p:dialog id="addTagDialog" header="#{msg.addTag}" widgetVar="addTag" appendTo="@(body)" closable="false" minWidth="540" modal="true">
            <h:panelGrid columns="1">
                <p:inputText id="modal_tag_name"/>
            </h:panelGrid>

            <h:panelGroup colspan="2" styleClass="float-right" style="margin: 10px 0;">
                <p:button value="#{msg.cancel}" styleClass="graybutton" onclick="PF('addTag').hide(); return false;"/>
                <p:button value="#{msg.save}" styleClass="confirm greenbutton" onclick="return false"/>
            </h:panelGroup>
        </p:dialog>

        <h:panelGroup id="resourcesView" layout="block"
                      pt:data-canAddResources="true"
                      pt:data-canMoveResources="false" style="height: 100%; width: 100%; padding-top: 3px;">
            <h:panelGroup layout="block" id="datagrid" styleClass="datagrid">
                <h:panelGroup id="folderGrid" layout="block" styleClass="folder-grid">

                    <h:panelGroup rendered="#{myResourcesBean.resourcesView == 'grid' or !myResourcesBean.rootFolder}">
                        <ui:repeat var="folder" value="#{myResourcesBean.folders}">
                            <h:panelGroup layout="block" rendered="#{myResourcesBean.rootFolder and folder.groupId == 0}">
                                <h:panelGroup styleClass="folder-item group-resources-item" style="margin: 0.5em;" layout="block"
                                              pt:data-itemType="#{myResourcesBean.rootFolder ? 'group': 'folder'}"
                                              pt:data-itemId="#{myResourcesBean.rootFolder ? folder.groupId : folder.id}"
                                              pt:data-canViewResource="true"
                                              pt:data-canEditResource="true"
                                              pt:data-canDeleteResource="true">
                                    <div class="folder-block" >

                                        <div class="folder-icon">
                                            <div class="folder-icon-wrapper">
                                                <span class="icon icon-folder"/>
                                            </div>
                                        </div>


                                            <div class="folder-title-wrapper">
                                                <h:outputText value="#{folder.name}" escape="false" styleClass="folder-title-name"
                                                              title="#{folder.name}"/>
                                            </div>


                                    </div>
                                </h:panelGroup>
                                <hr style="margin-top:10px;width:97%"/>
                                <h5 style="margin: 0.5em;">#{msg.myhomeVirtualFolders}</h5>
                            </h:panelGroup>
                            <h:panelGroup layout="block" rendered="#{folder.groupId != 0}">
                                <h:panelGroup styleClass="folder-item group-resources-item" layout="block"
                                              pt:data-itemType="#{myResourcesBean.rootFolder ? 'group': 'folder'}"
                                              pt:data-itemId="#{myResourcesBean.rootFolder ? folder.groupId : folder.id}"
                                              pt:data-canViewResource="true"
                                              pt:data-canEditResource="true"
                                              pt:data-canDeleteResource="true">
                                    <div class="folder-block">

                                        <div class="folder-icon">
                                            <div class="folder-icon-wrapper">
                                                <span class="icon icon-folder"/>
                                            </div>
                                        </div>


                                            <div class="folder-title-wrapper">
                                                <h:outputText value="#{folder.name}" escape="false" styleClass="folder-title-name"
                                                              title="#{folder.name}"/>
                                            </div>


                                    </div>
                                </h:panelGroup>
                            </h:panelGroup>
                        </ui:repeat>
                    </h:panelGroup>

                    <h:panelGroup rendered="#{myResourcesBean.rootFolder and myResourcesBean.resourcesView == 'list'}"
                                  styleClass="myresource-listview">
                        <ui:repeat var="folder" value="#{myResourcesBean.folders}">
                            <hr/>
                            <h:form>
                                <p:commandLink styleClass="resource_command_link"
                                               update=":breadcrumb :resourcesView :right_pane_wrapper :folder_layout_options"
                                               oncomplete="update_url(0, #{folder.folderId}, #{folder.groupId});resourceDND();">
                                    <f:setPropertyActionListener target="#{myResourcesBean.selectedFolder}" value="#{folder}"/>
                                    <h:outputText value="#{folder.name}" escape="false" styleClass="resource_short_title"/>
                                </p:commandLink>
                            </h:form>
                            <br/>
                            <div>
                                <ui:repeat var="res" value="#{folder.resourcesSubset}">
                                    <h:panelGroup styleClass="resource-item group-resources-item" layout="block"
                                                  pt:data-itemType="resource"
                                                  pt:data-itemId="#{res.id}"
                                                  pt:data-canViewResource="true"
                                                  pt:data-canEditResource="true"
                                                  pt:data-canDeleteResource="true"
                                                  pt:data-canAnnotateResource="true">
                                        <div class="resource-block">
                                            <div class="resource-preview">
                                                <div class="resource-preview-wrapper">
                                                    <div class="resource-preview-wrapper2">
                                                        <div class="resource-preview-block"></div>
                                                        <img class="resource-preview-image" src="#{res.thumbnail1.url}" alt="#{res.title}"/>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="resource-title">
                                                <div class="resource-title-wrapper">
                                                    <div class="resource-title-text">
                                                        <h:outputText value="#{res.title}" escape="false" styleClass="resource-title-name"
                                                                      title="#{res.title}"/>

                                                        <span class="resource-title-summary"><span>#{utilBean.getLocaleMessage(res.type)}</span> #{msg.added_by}
                                                            <span>#{res.getOwnerUser().username}</span></span>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </h:panelGroup>
                                </ui:repeat>
                            </div>
                            <h:form>
                                <p:commandButton styleClass="float-right " value="#{msg.show_all_my_resources_in_this_group}"
                                                 update=":breadcrumb :resourcesView :right_pane_wrapper :folder_layout_options"
                                                 oncomplete="update_url(0, #{folder.folderId});resourceDND();">
                                    <f:setPropertyActionListener target="#{myResourcesBean.selectedFolder}" value="#{folder}"/>
                                </p:commandButton>
                                <br/>
                            </h:form>
                        </ui:repeat>
                    </h:panelGroup>
                </h:panelGroup>

                <h:panelGroup id="resourceGrid" styleClass="resource-grid" layout="block">
                    <ui:repeat var="res" value="#{myResourcesBean.resources}">

                        <h:panelGroup styleClass="resource-item group-resources-item" layout="block"
                                      pt:data-itemType="resource"
                                      pt:data-itemId="#{res.id}"
                                      pt:data-canViewResource="true"
                                      pt:data-canEditResource="true"
                                      pt:data-canDeleteResource="true"
                                      pt:data-canAnnotateResource="true">
                            <div class="resource-block">

                                <div class="resource-preview">
                                    <div class="resource-preview-wrapper">
                                        <div class="resource-preview-wrapper2">
                                            <div class="resource-preview-block"></div>
                                            <img class="resource-preview-image" src="#{res.thumbnail1.url}" alt="#{res.title}"/>
                                        </div>
                                    </div>

                                    <h:form class="resource-controls">
                                        <h:outputLink value="#" title="#{msg.copy}" styleClass="action-copy">
                                            <h:graphicImage alt="Copy" value="/resources/icon/Add.png"/>
                                        </h:outputLink>

                                        <ui:fragment rendered="${res.canDeleteResource(userBean.user)}">
                                            <h:outputLink value="#" title="#{msg.edit}" styleClass="action-edit">
                                                <h:graphicImage alt="Edit" value="../resources/icon/Edit.png"/>
                                            </h:outputLink>

                                            <h:outputLink value="#" title="#{msg.delete}" styleClass="action-delete">
                                                <h:graphicImage alt="Delete" value="../resources/icon/Remove.png"/>
                                            </h:outputLink>
                                        </ui:fragment>
                                    </h:form>
                                </div>

                                <div class="resource-title">
                                    <div class="resource-title-wrapper">
                                        <!--<div class="resource-title-icon">
                                                <div class="resource-title-icon-wrapper">
                                                    <img src="img.png" alt="Title" />
                                                </div>
                                            </div>-->
                                        <div class="resource-title-text">
                                            <h:outputText value="#{res.title}" escape="false" styleClass="resource-title-name" title="#{res.title}"/>
                                            <span class="resource-title-summary"><span>#{utilBean.getLocaleMessage(res.type)}</span> #{msg.added_by}
                                                <span>#{res.getOwnerUser().username}</span></span>
                                        </div>
                                    </div>
                                </div>

                            </div>
                        </h:panelGroup>
                    </ui:repeat>

                    <h:outputText value="#{msg.no_resources_found}" rendered="#{empty myResourcesBean.resources and !myResourcesBean.rootFolder}"
                                  class="nothing_found"/>
                </h:panelGroup>
            </h:panelGroup>
        </h:panelGroup>

        <h:panelGroup style="height: 100%;" id="context-menu" class="context-menu resource-context-menu" role="menu">
            <div class="context-menu-item action-add-tag" role="menuitem" data-action="add-tag" data-per="canAnnotateResource">
                <div class="context-menu-item-wrapper">
                    <span class="context-menu-item-icon"/>
                    <span>#{msg.addTag}</span>
                </div>
            </div>
            <div class="context-menu-item action-edit" role="menuitem" data-action="edit" data-per="canEditResource">
                <div class="context-menu-item-wrapper">
                    <span class="context-menu-item-icon"/>
                    <span>#{msg.edit}</span>
                </div>
            </div>
            <div class="context-menu-item action-copy" role="menuitem" data-action="copy" data-per="canViewResource">
                <div class="context-menu-item-wrapper">
                    <span class="context-menu-item-icon"/>
                    <span>#{msg.copy}</span>
                </div>
            </div>
            <div class="context-menu-item action-open-folder" role="menuitem" data-action="open-folder" data-per="canViewResource">
                <div class="context-menu-item-wrapper">
                    <span class="context-menu-item-icon"/>
                    <span>#{msg.open}</span>
                </div>
            </div>
            <div class="context-menu-item action-delete" role="menuitem" data-action="delete" data-per="canDeleteResource">
                <div class="context-menu-item-wrapper">
                    <span class="context-menu-item-icon"/>
                    <span>#{msg.delete}</span>
                </div>
            </div>
        </h:panelGroup>


        <script type="text/javascript">
           // $("#center_pane").prepend($("#group_header"));
            update_header();
        </script>
    </p:panel>
</ui:define>

<ui:define name="right_layout">
    <ui:decorate template="/templates/resources/right_pane.xhtml">
        <ui:param name="bean" value="#{myResourcesBean}"/>
    </ui:decorate>
</ui:define>
</ui:composition>