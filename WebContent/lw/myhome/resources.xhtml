<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" 
	xmlns:ui="http://java.sun.com/jsf/facelets" 
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:f="http://java.sun.com/jsf/core" 
	xmlns:c="http://java.sun.com/jsp/jstl/core" 
	xmlns:p="http://primefaces.org/ui">

<ui:composition template="/lw/templates/new_main.xhtml">

	<ui:param name="loginRequired" value="true" />
	<ui:param name="pageTitle" value="My Resources" />
	<ui:param name="helpText" value="#{msg.myhomeResourcesHelp}"/>
	  
		<ui:define name="center_layout">
			<div class="ui-layout-unit-header ui-widget-header ui-corner-all">
			My Resources
			</div>
			<br></br>
			<h:form style="display:inline;">
				<p:commandButton id="add_resource" styleClass="resource_button greenbutton" value="Upload Resource" widgetVar="add_resource" update=":add_resource_panel" oncomplete="update_header()">
					<f:setPropertyActionListener target="#{myResourcesBean.newResourceClicked}" value="true"></f:setPropertyActionListener>
				</p:commandButton>
			</h:form>
			<script type="text/javascript">
			/*
				var div = document.createElement("div");
				var group_header = document.createElement("span");
				$(group_header).addClass("group_header");
				$(group_header).html("My Resources");
				var cl = $("#add_resource").clone();
	            $(cl).appendTo(div);
	            $("#add_resource").remove()
				$(div).append(group_header);
				$(div).addClass("ui-layout-unit-header ui-widget-header ui-corner-all");
				$("#center_pane").prepend(div);
				*/
			</script>
			<h:form prependId="false">
				<p:confirmDialog id="confirmDialog" message="Are you sure about deleting the resource?" header="Delete Resource" severity="alert" widgetVar="confirmation" appendToBody="true" >
			        <p:commandButton id="confirm" value="Yes" update=":datagrid :growl :add_resource_panel" oncomplete="confirmation.hide(); update_header()"  
			                   actionListener="#{myResourcesBean.deleteResource}" process=":datagrid"/>  
			        <p:commandButton id="decline" value="No" onclick="confirmation.hide()" type="button" />
			    </p:confirmDialog>
			</h:form>
			<p:dialog header="Upload File" widgetVar="file_dialog" modal="true" appendToBody="true" width="600" height="150">
				<h:form>
					<p:fileUpload  rendered="true" fileUploadListener="#{addResourceBean.handleFileUpload}"  
		            mode="advanced"  
		            auto="true"
		            sizeLimit="10000000"   
		            widgetVar="fileUpload"
		            oncomplete="file_dialog.hide()"
		            update=":add_resource_form:preview"
		            /> 
				</h:form>
			</p:dialog>
			<p:dialog header="#{msg.options}" closable="false" widgetVar="resource_dialog" appendToBody="true" modal="true" minWidth="540">
				<h:form id="resource_form">
					<h:panelGrid columns="2">
						<h:outputLabel value="Add to:" />
						<h:selectOneMenu value="#{myResourcesBean.selectedResourceTargetGroupId}">
							<f:selectItem itemLabel="My resources" itemValue="0" />
							<f:selectItem itemLabel="------------" itemValue="-1" itemDisabled="true" />
							<f:selectItems var="group" value="#{userBean.user.writeAbleGroups}" itemLabel="#{group.title}" itemValue="#{group.id}" />
						</h:selectOneMenu>
	
						<h:outputLabel value="#{msg.title}:" />
						<p:inputText value="#{myResourcesBean.clickedResource.title}" styleClass="resource_dialog_field" />
	
	
						<h:outputLabel value="#{msg.description}:" />
						<p:inputTextarea value="#{myResourcesBean.clickedResource.description}" autoResize="true" styleClass="resource_dialog_field" />
	
						<h:outputLabel value="Url:" />
						<p:inputText value="#{myResourcesBean.clickedResource.url}" disabled="true" styleClass="resource_dialog_field" />
	
						<h:outputLabel value="#{msg.type}:" />
						<p:inputText value="#{myResourcesBean.clickedResource.type}" disabled="true" styleClass="resource_dialog_field" />
	
						<h:outputLabel value="#{msg.author}:" />
						<p:inputText value="#{myResourcesBean.clickedResource.author}" styleClass="resource_dialog_field" />
						
							<h:outputText value=""></h:outputText>
							<p:column styleClass="myresources_pcolumn">
								<div class="myresources_pcolumn_div"><p:commandButton value="Cancel" onclick="resource_dialog.hide()" />
								<p:commandButton value="#{msg.save}" action="#{myResourcesBean.addSelectedResource}" update=":datagrid :growl" process="@form :datagrid" oncomplete="resource_dialog.hide()" /></div>
							</p:column>
					</h:panelGrid>
				</h:form>
			</p:dialog>
			<p:dialog header="#{msg.edit}" id="comment_dialog1" modal="true" minWidth="440" appendToBody="true" widgetVar="comment_dialog">
				<h:form id="comment_dialog_form">	
					<p:inputTextarea autoResize="1" maxHeight="20" value="#{myResourcesBean.clickedComment.text}" styleClass="resource_dialog_field"></p:inputTextarea>
					<p:commandButton actionListener="#{myResourcesBean.onEditComment}" update=":add_resource_panel" 
										title="#{msg.save}" value="#{msg.save}"								
										onsuccess="comment_dialog.hide();">
					</p:commandButton>
				</h:form>
			</p:dialog>
			<script type="text/javascript">
				function select(panel)
				{
					$(".resource_panel").css("border","1px solid #ccc");
					$(panel).css("border","1px solid #666");
				}
				
			</script>
           <h:panelGroup id="resource_disp"> 
			<p:dataGrid id="datagrid" var="result" value="#{myResourcesBean.resources}" columns="3" paginator="false" widgetVar="datagrid">  
		       <h:form>
		        <p:commandLink styleClass="resource_command_link" update=":add_resource_panel :resource_form" oncomplete="update_header()">
		        	<f:setPropertyActionListener target="#{myResourcesBean.clickedResource}" value="#{result}"></f:setPropertyActionListener>
			        <p:panel styleClass="resource_panel">  
			            <h:panelGrid columns="1" styleClass="resource_panelgrid"> 
			            	<div class="resource_short_title">#{result.shortTitle}</div>
			            	<p:row>
			            		<span class="groupid">#{result.id}</span>
			            		<h:outputText styleClass="resource_thumbnail" value='#{result.embeddedSize1.replaceAll("width=\".*\"","").replaceAll("height=\".*\"","").replaceAll("/>","").replaceAll(">","").concat(" width=\"140\" height=\"140\" />")}' escape="false"></h:outputText>
			            		<div class="buttons">
				            		
				            			<p:commandLink onclick="resource_dialog.show()" title="#{msg.addToMyResources}"
											styleClass="buttons_link myresources_commandlink" update=":datagrid">
											<h:graphicImage alt="Add" value="/resources/icon/Add.png" width="16" height="16" />
												<f:setPropertyActionListener value="#{result}" target="#{myResourcesBean.clickedResource}" />
										</p:commandLink>
				            			
				            			<p:commandLink onclick="confirmation.show()" title="#{msg.removeFromGroup}" rendered="true" styleClass="buttons_link">
											<h:graphicImage alt="Remove" value="../resources/icon/Remove.png" width="16" height="16" />
												<f:setPropertyActionListener value="#{result}" target="#{myResourcesBean.clickedResource}" />
										</p:commandLink>
										
										<p:commandLink title="#{msg.edit}" update=":add_resource_panel" styleClass="buttons_link">
											<h:graphicImage alt="Edit" value="../resources/icon/Edit.png" width="16" height="16" />
												<f:setPropertyActionListener value="#{result}" target="#{myResourcesBean.clickedResource}" />
												<f:setPropertyActionListener target="#{myResourcesBean.editResourceClicked}" value="true"></f:setPropertyActionListener>
											<f:param name="group_id" value="#{groupDetailBean.groupId}" />
										</p:commandLink>
									
			            		</div>
			            	</p:row>
			            	<ui:fragment rendered="#{result.type.length() le 12}">
				            	<div class="resource_summary">
									<span>${learnwebBean.getLocaleMessage(result.type)}</span> #{msg.added_by} <span>#{result.getOwnerUser().username}</span>
					            </div>
				            </ui:fragment>
				            <ui:fragment rendered="#{result.type.length() gt 12}">
				            	<div class="resource_summary">
									<span>${learnwebBean.getLocaleMessage(result.type).substring(0,12).concat("...")}</span> #{msg.added_by} <span>#{result.getOwnerUser().username}</span>
					            </div>
				            </ui:fragment>
			            </h:panelGrid>  
			            
			        </p:panel>
			    </p:commandLink>
			    </h:form>
		    </p:dataGrid>
		  </h:panelGroup> 
		    <script type="text/javascript">
			    $(".ui-panel").live("click",function(){
		    		select(this);
		    	});
		    </script>
		</ui:define>
		<ui:define name="right_layout">
			<ui:decorate  template="/lw/templates/right_pane.xhtml">
				<ui:param name="bean" value="#{myResourcesBean}" />
			</ui:decorate >
		</ui:define>
</ui:composition>
</html>