<ui:composition template="/templates/main/main_old.xhtml"
				xmlns="http://www.w3.org/1999/xhtml"
				xmlns:ui="http://java.sun.com/jsf/facelets"
				xmlns:h="http://java.sun.com/jsf/html"
				xmlns:f="http://java.sun.com/jsf/core"
				xmlns:p="http://primefaces.org/ui"
				xmlns:pt="http://xmlns.jcp.org/jsf/passthrough">

	<ui:param name="loginRequired" value="true" />
	<ui:param name="pageTitle" value="#{msg.myResourcesTitle}" />
	<ui:param name="helpText" value="#{msg.myhomeResourcesHelp}"/>

	<ui:define name="metadata">
		<f:metadata>
			<f:viewParam name="group_id" value="#{myResourcesBean.groupId}" />
			<f:viewParam name="folder_id" value="#{myResourcesBean.selectedFolderId}" />
			<f:viewParam name="resource_id" value="#{resourceDetailBean.resourceId}" />
			<f:viewParam name="save_url" value="#{myResourcesBean.urlToSave}" />
			<f:event type="javax.faces.event.PreRenderViewEvent" listener="#{resourceDetailBean.preRenderView}" />
			<f:event type="javax.faces.event.PreRenderViewEvent" listener="#{myResourcesBean.preRenderView}"/>
		</f:metadata>
	</ui:define>

	<ui:define name="center_layout">

		<h:form>
			<p:remoteCommand name="openFolderCommand" actionListener="#{myResourcesBean.actionOpenFolder}" update=":folder_layout_options :breadcrumb :context-menu :datagrid :add_resource_panel :growl" oncomplete="resourceDND();update_header();scroller();"/>
			<p:remoteCommand name="selectGroupItemCommand" actionListener="#{myResourcesBean.actionSelectGroupItem}" update=":add_resource_panel :growl" oncomplete="update_header();resourceDND(); "/>
			<p:remoteCommand name="updateGroupItemsCommand" actionListener="#{myResourcesBean.actionUpdateGroupItems}" update=":breadcrumb :datagrid :add_resource_panel :growl " oncomplete="resourceDND();update_header();"/>
			<p:remoteCommand name="editGroupItemCommand" actionListener="#{myResourcesBean.actionEditGroupItem}" update=":add_resource_panel :growl" oncomplete="update_header()"/>
			<p:remoteCommand name="updateAddResourcePaneCommand" actionListener="#{myResourcesBean.updateTargetForAddResourceBean}" update=":add_resource_panel :growl" oncomplete="update_header()"/>
			<p:remoteCommand name="updateThumbnailCommand" actionListener="#{resourceDetailBean.setResourceThumbnail}" update=":add_resource_panel :datagrid :growl" oncomplete="update_header();resourceDND();"/>
		</h:form>

		<div class="center-header" id="group_header">
			<h2>#{msg.myResourcesTitle}</h2>
			<h:form id="center_header_form">
				<p:commandButton id="add_resource_button" value="#{msg.upload_resource}" menuStyleClass="test" iconPos="right" styleClass="resource_button greenbutton resourcetoolbutton" type="button" />
			    <p:tieredMenu overlay="true" trigger="add_resource_button" my="left top" at="left bottom" style="width:200px">
					<p:submenu label="#{msg.create}" icon="fa fa-plus-square">
						<p:menuitem value="#{msg.office_document}" icon="fa fa-file-word-o"
							update=":add_resource_panel" oncomplete="update_header()"
							actionListener="#{addResourceBean.clearForm()}">
							<f:setPropertyActionListener
								target="#{addResourceBean.resource.storageType}" value="1" />
							<f:setPropertyActionListener
								target="#{addResourceBean.resource.type}" value="document" />
							<f:setPropertyActionListener
								target="#{myResourcesBean.rightPanelAction}" value="newFile" />
						</p:menuitem>
						<p:menuitem value="#{msg.office_spreadsheet}" icon="fa fa-file-excel-o"
							update=":add_resource_panel" oncomplete="update_header()"
							actionListener="#{addResourceBean.clearForm()}">
							<f:setPropertyActionListener
								target="#{addResourceBean.resource.storageType}" value="1" />
							<f:setPropertyActionListener
								target="#{addResourceBean.resource.type}" value="spreadsheet" />
							<f:setPropertyActionListener
								target="#{myResourcesBean.rightPanelAction}" value="newFile" />
						</p:menuitem>
						<p:menuitem value="#{msg.office_presentation}" icon="fa fa-file-powerpoint-o"
							update=":add_resource_panel" oncomplete="update_header()"
							actionListener="#{addResourceBean.clearForm()}">
							<f:setPropertyActionListener
								target="#{addResourceBean.resource.storageType}" value="1" />
							<f:setPropertyActionListener
								target="#{addResourceBean.resource.type}" value="presentation" />
							<f:setPropertyActionListener
								target="#{myResourcesBean.rightPanelAction}" value="newFile" />
						</p:menuitem>
					</p:submenu>

					<p:menuitem value="#{msg.upload_file}" icon="ui-icon-disk" update=":add_resource_panel" oncomplete="update_header()" actionListener="#{addResourceBean.clearForm()}">
						<f:setPropertyActionListener target="#{addResourceBean.resource.storageType}" value="1"/>
						<f:setPropertyActionListener target="#{myResourcesBean.rightPanelAction}" value="newResource"/>
					</p:menuitem>
					<p:menuitem value="#{msg.upload_url}" icon="ui-icon-link" update=":add_resource_panel" oncomplete="update_header()" actionListener="#{addResourceBean.clearForm()}">
						<f:setPropertyActionListener target="#{addResourceBean.resource.storageType}" value="2"/>
						<f:setPropertyActionListener target="#{myResourcesBean.rightPanelAction}" value="newResource"/>
					</p:menuitem>
					<p:menuitem value="Add Glossary" icon="ui-icon-link" update=":add_resource_panel" oncomplete="update_header()" actionListener="#{addResourceBean.clearForm()}">
						<f:setPropertyActionListener target="#{addResourceBean.resource.storageType}" value="1"/>
						<f:setPropertyActionListener target="#{addResourceBean.resource.type}" value="glossary"></f:setPropertyActionListener>
						<f:setPropertyActionListener target="#{myResourcesBean.rightPanelAction}" value="newResource"/>
					</p:menuitem>			        
			    </p:tieredMenu>
			
			</h:form>
			<h:form styleClass="layout_button" id="folder_layout_options" prependId="false">
				<p:commandButton value="#{msg.list_view}" icon="ui-icon-mylist" update=":datagrid :folder_layout_options" rendered="#{myResourcesBean.rootFolder and myResourcesBean.folderView}">
					<f:setPropertyActionListener target="#{myResourcesBean.folderView}" value="false"/>
				</p:commandButton>
				<p:commandButton value="#{msg.grid_view}" icon="ui-icon-mygrid" update=":datagrid :folder_layout_options" rendered="#{myResourcesBean.rootFolder and !myResourcesBean.folderView}">
					<f:setPropertyActionListener target="#{myResourcesBean.folderView}" value="true"/>
				</p:commandButton>
			</h:form>

			<h:panelGroup id="breadcrumb" styleClass="breadcrumbs" layout="block">
				<h:form rendered="#{not empty myResourcesBean.breadcrumb}">
					<ul>
						<li>
							<a href="myhome/resources.jsf">#{msg.myResourcesTitle}</a>
						</li>

						<ui:repeat var="folder" value="#{myResourcesBean.breadcrumb}" varStatus="status">
							<li>
								<p:commandLink update=":breadcrumb :datagrid :add_resource_panel" oncomplete="update_header();update_url(0,0,#{folder.groupId});scroller();resourceDND();">
									<f:setPropertyActionListener target="#{myResourcesBean.clickedFolder}" value="#{folder}" />
									<h:outputText value="#{folder.name}" escape="false"/>
								</p:commandLink>
							</li>
						</ui:repeat>
					</ul>
				</h:form>
			</h:panelGroup>
		</div>

		<p:dialog id="deleteConfirmDialog" header="#{msg.delete_resource_title}"  widgetVar="deleteConfirm" appendTo="@(body)" closable="false" minWidth="540" modal="true">
			<p>
				<h:outputText value="#{msg.delete_confirm_dialog_content_folder}" styleClass="single-folder"/>
				<h:outputText value="#{msg.delete_confirm_dialog_content}" styleClass="single-resource"/>
				<h:outputText value="#{msg.delete_confirm_dialog_content_plural}" styleClass="plural"/>
			</p>

			<h:panelGroup colspan="2" styleClass="float-right" style="margin: 10px 0;">
				<p:button value="#{msg.cancel}" styleClass="graybutton" onclick="PF('deleteConfirm').hide(); return false;" />
				<p:button value="#{msg.delete}" styleClass="confirm greenbutton" onclick="return false"/>
			</h:panelGroup>
		</p:dialog>

		<p:dialog id="selectDestinationDialog" header="#{msg.selectDestination}" widgetVar="selectDestination" appendTo="@(body)" closable="false" minWidth="540" modal="true">
			<h:panelGrid columns="2">
				<h:outputText value="#{msg.add_to}:" />

				<h:form>
					<p:tree id="folders_tree" value="#{userBean.writeAbleGroupsTree}" var="node" animate="true" dynamic="true" selectionMode="single" selection="#{myResourcesBean.selectedTargetNode}" style="max-height:28rem; overflow:auto;">
						<p:ajax event="select" listener="#{myResourcesBean.onTargetNodeSelect}"/>

						<p:treeNode type="group">
							<h:outputText id="group" value="#{node.title}"/>
						</p:treeNode>

						<p:treeNode type="folder" expandedIcon="ui-icon-folder-open" collapsedIcon="ui-icon-folder-collapsed">
							<h:outputText value="#{node.name}" />
						</p:treeNode>
					</p:tree>
				</h:form>
			</h:panelGrid>

			<h:panelGroup colspan="2" styleClass="float-right" style="margin: 10px 0;">
				<p:button value="#{msg.cancel}" styleClass="graybutton" onclick="PF('selectDestination').hide(); return false;" />
				<p:button value="#{msg.save}" styleClass="confirm greenbutton" onclick="return false"/>
			</h:panelGroup>
		</p:dialog>

		<p:dialog id="addTagDialog" header="#{msg.addTag}" widgetVar="addTag" appendTo="@(body)" closable="false" minWidth="540" modal="true">
			<h:panelGrid columns="1">
				<p:inputText id="modal_tag_name" value="#{resourceDetailBean.clickedComment.text}" />
			</h:panelGrid>

			<h:panelGroup colspan="2" styleClass="float-right" style="margin: 10px 0;">
				<p:button value="#{msg.cancel}" styleClass="graybutton" onclick="PF('addTag').hide(); return false;" />
				<p:button value="#{msg.save}" styleClass="confirm greenbutton" onclick="return false"/>
			</h:panelGroup>
		</p:dialog>
		<h:panelGroup id="resourcesView" layout="block"
					  pt:data-canAddResources="true"
					  pt:data-canMoveResources="false">
			<h:panelGroup layout="block" id="datagrid" styleClass="datagrid">
				<h:panelGroup id="folderGrid" layout="block" styleClass="folder-grid">
					<h:panelGroup rendered="#{!myResourcesBean.folderView or !myResourcesBean.rootFolder}">
						<ui:repeat var="folder" value="#{myResourcesBean.folders}">
							<h:panelGroup layout="block" rendered="#{myResourcesBean.rootFolder and folder.groupId == 0}">
								<h:panelGroup styleClass="folder-item group-resources-item" layout="block"
											  pt:data-itemType="#{myResourcesBean.rootFolder ? 'group': 'folder'}"
											  pt:data-itemId="#{myResourcesBean.rootFolder ? folder.groupId : folder.id}"
											  pt:data-canViewResource="true"
											  pt:data-canEditResource="true"
											  pt:data-canDeleteResource="true">
									<div class="folder-block">

										<div class="folder-icon">
											<div class="folder-icon-wrapper">
												<span class="icon icon-folder" />
											</div>
										</div>

										<div class="folder-title">
											<div class="folder-title-wrapper">
												<h:outputText value="#{folder.name}" escape="false" styleClass="folder-title-name" title="#{folder.name}" />
											</div>
										</div>

									</div>
								</h:panelGroup>
								<hr style="margin-top:10px;width:97%"/>
								<h3>#{msg.myhomeVirtualFolders}</h3>
								<br/>
							</h:panelGroup>
							<h:panelGroup layout="block" rendered="#{folder.groupId != 0}">
								<h:panelGroup styleClass="folder-item group-resources-item" layout="block"
											  pt:data-itemType="#{myResourcesBean.rootFolder ? 'group': 'folder'}"
											  pt:data-itemId="#{myResourcesBean.rootFolder ? folder.groupId : folder.id}"
											  pt:data-canViewResource="true"
											  pt:data-canEditResource="true"
											  pt:data-canDeleteResource="true">
									<div class="folder-block">

										<div class="folder-icon">
											<div class="folder-icon-wrapper">
												<span class="icon icon-folder" />
											</div>
										</div>

										<div class="folder-title">
											<div class="folder-title-wrapper">
												<h:outputText value="#{folder.name}" escape="false" styleClass="folder-title-name" title="#{folder.name}" />
											</div>
										</div>

									</div>
								</h:panelGroup>
							</h:panelGroup>
						</ui:repeat>
					</h:panelGroup>
					<h:panelGroup rendered="#{myResourcesBean.rootFolder and myResourcesBean.folderView}" styleClass="myresource-listview">
						<ui:repeat var="folder" value="#{myResourcesBean.folders}">
							<hr/>
							<h:form>
								<p:commandLink styleClass="resource_command_link" update=":breadcrumb :datagrid :add_resource_panel :folder_layout_options" oncomplete="update_header();update_url(0, #{folder.folderId}, #{folder.groupId});resourceDND();">
									<f:setPropertyActionListener target="#{myResourcesBean.clickedFolder}" value="#{folder}" />
									<h:outputText value="#{folder.name}" escape="false" styleClass="resource_short_title"/>
								</p:commandLink>
							</h:form>
							<br/>
							<div>
							<ui:repeat var="res" value="#{folder.resourcesSubset}" >
							   <h:panelGroup styleClass="resource-item group-resources-item" layout="block"
											 pt:data-itemType="resource"
											 pt:data-itemId="#{res.id}"
											 pt:data-canViewResource="true"
											 pt:data-canEditResource="true"
											 pt:data-canDeleteResource="true"
											 pt:data-canAnnotateResource="true">
								<div class="resource-block">
									<div class="resource-preview">
										<div class="resource-preview-wrapper">
											<div class="resource-preview-wrapper2">
												<div class="resource-preview-block"></div>
												<img class="resource-preview-image" src="#{res.thumbnail1.url}" alt="#{res.title}" />
											</div>
										</div>
									</div>
									<div class="resource-title">
										<div class="resource-title-wrapper">
											<div class="resource-title-text">
												<h:outputText value="#{res.title}" escape="false" styleClass="resource-title-name" title="#{res.title}" />

												<span class="resource-title-summary"><span>${learnwebBean.getLocaleMessage(res.type)}</span> #{msg.added_by} <span>#{res.getOwnerUser().username}</span></span>
											</div>
										</div>
									</div>
								</div>
							  </h:panelGroup>
							</ui:repeat>
							</div>
							<br/>
							<h:form>
								<p:commandLink styleClass="more_resources_link" update=":breadcrumb :datagrid :add_resource_panel :folder_layout_options" oncomplete="update_header();update_url(0, #{folder.folderId});resourceDND();">
										<f:setPropertyActionListener target="#{myResourcesBean.clickedFolder}" value="#{folder}" />
										<h:outputText value="#{msg.show_all_my_resources_in_this_group}" />
								</p:commandLink>
							</h:form>
							<div class="clear"></div>
						</ui:repeat>
					</h:panelGroup>
				</h:panelGroup>
				<h:panelGroup id="resourceGrid" styleClass="resource-grid" layout="block">
					<ui:repeat var="res" value="#{myResourcesBean.resources}" >

						<h:panelGroup styleClass="resource-item group-resources-item" layout="block"
									  pt:data-itemType="resource"
									  pt:data-itemId="#{res.id}"
									  pt:data-canViewResource="true"
									  pt:data-canEditResource="true"
									  pt:data-canDeleteResource="true"
									  pt:data-canAnnotateResource="true">
							<div class="resource-block">

								<div class="resource-preview">
									<div class="resource-preview-wrapper">
										<div class="resource-preview-wrapper2">
											<div class="resource-preview-block"></div>
											<img class="resource-preview-image" src="#{res.thumbnail1.url}" alt="#{res.title}" />
										</div>
									</div>

									<h:form class="resource-controls">
										<h:outputLink value="#" title="#{msg.copy}" styleClass="action-copy">
											<h:graphicImage alt="Copy" value="/resources/icon/Add.png"/>
										</h:outputLink>

										<ui:fragment rendered="${res.canDeleteResource(userBean.user)}">
											<h:outputLink value="#" title="#{msg.edit}" styleClass="action-edit" >
												<h:graphicImage alt="Edit" value="../resources/icon/Edit.png"/>
											</h:outputLink>

											<h:outputLink value="#" title="#{msg.delete}" styleClass="action-delete">
												<h:graphicImage alt="Delete" value="../resources/icon/Remove.png"/>
											</h:outputLink>
										</ui:fragment>
									</h:form>
								</div>

								<div class="resource-title">
									<div class="resource-title-wrapper">
										<!--<div class="resource-title-icon">
												<div class="resource-title-icon-wrapper">
													<img src="img.png" alt="Title" />
												</div>
											</div>-->
										<div class="resource-title-text">
											<h:outputText value="#{res.title}" escape="false" styleClass="resource-title-name" title="#{res.title}" />
											<span class="resource-title-summary"><span>${learnwebBean.getLocaleMessage(res.type)}</span> #{msg.added_by} <span>#{res.getOwnerUser().username}</span></span>
										</div>
									</div>
								</div>

							</div>
						</h:panelGroup>
					</ui:repeat>

					<h:outputText value="#{msg.no_resources_found}" rendered="#{empty myResourcesBean.resources and !myResourcesBean.rootFolder}" class="nothing_found"/>
				</h:panelGroup>
			</h:panelGroup>
		</h:panelGroup>
		<h:panelGroup layout="block" id="context-menu" class="context-menu resource-context-menu" role="menu">
			<ui:fragment rendered="${myResourcesBean.clickedResource.canAnnotateResource(userBean.user)}">
				<div class="context-menu-item action-add-tag" role="menuitem" data-action="add-tag" data-per="canAnnotateResource">
					<div class="context-menu-item-wrapper">
						<span class="context-menu-item-icon" />
						<span class="context-menu-item-content">#{msg.addTag}</span>
					</div>
				</div>
			</ui:fragment>
			<ui:fragment rendered="${myResourcesBean.clickedResource.canEditResource(userBean.user)}">
				<div class="context-menu-item action-edit" role="menuitem" data-action="add-tag" data-per="canEditResource">
					<div class="context-menu-item-wrapper">
						<span class="context-menu-item-icon" />
						<span class="context-menu-item-content">#{msg.edit}</span>
					</div>
				</div>
			</ui:fragment>
			<div class="context-menu-item action-copy" role="menuitem" data-action="copy" data-per="canViewResource">
				<div class="context-menu-item-wrapper">
					<span class="context-menu-item-icon" />
					<span class="context-menu-item-content">#{msg.copy}</span>
				</div>
			</div>
			<div class="context-menu-item action-open-folder" role="menuitem" data-action="open-folder" data-per="canViewResource">
					<div class="context-menu-item-wrapper">
						<span class="context-menu-item-icon" />
						<span class="context-menu-item-content">#{msg.open}</span>
					</div>
			</div>
			<ui:fragment rendered="${myResourcesBean.clickedResource.canDeleteResource(userBean.user)}">
				<div class="context-menu-item action-delete" role="menuitem" data-action="delete" data-per="canDeleteResource">
					<div class="context-menu-item-wrapper">
						<span class="context-menu-item-icon" />
						<span class="context-menu-item-content">#{msg.delete}</span>
					</div>
				</div>
			</ui:fragment>
		</h:panelGroup>

		<script type="text/javascript">
            $("#center_pane").prepend($("#group_header"));
            update_header();
		</script>

	</ui:define>
	<ui:define name="right_layout">
		<ui:decorate  template="/templates/resources/right_pane.xhtml">
			<ui:param name="bean" value="#{myResourcesBean}" />
		</ui:decorate >
	</ui:define>
</ui:composition>