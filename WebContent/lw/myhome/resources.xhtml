<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" 
	xmlns:ui="http://java.sun.com/jsf/facelets" 
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:f="http://java.sun.com/jsf/core" 
	xmlns:c="http://java.sun.com/jsp/jstl/core" 
	xmlns:p="http://primefaces.org/ui"
	xmlns:pt="http://xmlns.jcp.org/jsf/passthrough">

<ui:composition template="/lw/templates/new_main_t.xhtml">

	<ui:param name="loginRequired" value="true" />
	<ui:param name="pageTitle" value="#{msg.myResourcesTitle}" />
	<ui:param name="helpText" value="#{msg.myhomeResourcesHelp}"/>
	  
		<ui:define name="center_layout">
			<link rel="stylesheet" type="text/css" href="#{request.contextPath}/resources/myresources/myresources.css" />
			
		    <div class="center-header" id="group_header">
		    	<h:outputText value="#{msg.myResourcesTitle} " styleClass="green_header"/>
				<h:form style="display:inline" id="folder_layout_options" prependId="false">
					<p:commandButton value="#{msg.list_view}" icon="ui-icon-mylist" styleClass="layout_button" update=":datagrid :folder_layout_options" rendered="#{myResourcesBean.rootFolder and myResourcesBean.folderView}">
						<f:setPropertyActionListener target="#{myResourcesBean.folderView}" value="false"/>
					</p:commandButton>
					<p:commandButton value="Grid View" icon="ui-icon-mygrid" styleClass="layout_button" update=":datagrid :folder_layout_options" rendered="#{myResourcesBean.rootFolder and !myResourcesBean.folderView}">
						<f:setPropertyActionListener target="#{myResourcesBean.folderView}" value="true"/>
					</p:commandButton>
				</h:form>
				<h:form  id="center_header_form">
					<p:menuButton value="#{msg.upload_resource}" menuStyleClass="test" iconPos="right" styleClass="resource_button greenbutton resourcetoolbutton">
				        <p:menuitem value="#{msg.upload_file}" icon="ui-icon-disk" update=":add_resource_panel" oncomplete="update_header()" actionListener="#{addResourceBean.clearForm()}">
							<f:setPropertyActionListener target="#{addResourceBean.resource.storageType}" value="1"/>
							<f:setPropertyActionListener target="#{myResourcesBean.rightPanelAction}" value="newResource"/>
				        </p:menuitem>
				        <p:menuitem value="#{msg.upload_url}" icon="ui-icon-link" update=":add_resource_panel" oncomplete="update_header()" actionListener="#{addResourceBean.clearForm()}">
							<f:setPropertyActionListener target="#{addResourceBean.resource.storageType}" value="2"/>
							<f:setPropertyActionListener target="#{myResourcesBean.rightPanelAction}" value="newResource"/>
				        </p:menuitem>
				    </p:menuButton>
				</h:form>
		    </div>
			<br></br>

			<script type="text/javascript">
				//var div = $(".center-header");
				//var div = document.createElement("div");
				//var group_header = document.createElement("span");
				//$(group_header).addClass("group_header");
				//$(group_header).html("#{msg.myResourcesTitle}");
				//var cl = $("#center_header_form").clone();
	            //$(cl).appendTo(div);
	            //$("#center_header_form").remove();
				//$(div).append(group_header);
				//$(div).addClass("center-header");
				$("#center_pane").prepend($(".center-header"));
			</script>
			
			
			<p:confirmDialog id="confirmDialog" message="#{msg.delete_message_resource}" header="#{msg.delete_resource_title}" severity="alert" 
				widgetVar="confirmation" appendTo="@(body)" >
		        <h:form>
			        <p:commandButton id="confirm" value="#{msg.yes}" update=":datagrid :growl :add_resource_panel" process="@form"
			        	oncomplete="PF('confirmation').hide(); update_header()" actionListener="#{myResourcesBean.deleteResource}" />  
			        <p:commandButton id="decline" value="#{msg.no}" onclick="PF('confirmation').hide()" type="button" />
			    </h:form>
		    </p:confirmDialog>
			
			<p:dialog header="#{msg.add_to}" widgetVar="resource_add_dialog" modal="false" minWidth="540" styleClass="zindex10000">			
				<h:form id="resource_add_form">
					<h:panelGrid columns="2">
						<h:outputText value="#{msg.add_to}:"/>
						<h:selectOneMenu value="#{myResourcesBean.selectedResourceTargetGroupId}">
							<f:selectItems var="group" value="#{userBean.user.writeAbleGroups}" itemLabel="#{group.title}" itemValue="#{group.id}"/>
						</h:selectOneMenu>
						
						<h:outputText value="" />
						<p:commandButton value="#{msg.save}" action="#{myResourcesBean.addSelectedResourceToGroup}" process="@form" update=":growl" 
							oncomplete="PF('resource_link_dialog').hide()"/>
					</h:panelGrid>
				
				</h:form>			
			</p:dialog>
			
			<p:dialog header="#{msg.edit}" id="comment_dialog1" modal="true" minWidth="440" appendTo="@(body)" widgetVar="comment_dialog">
				<h:form id="comment_dialog_form">	
					<p:inputTextarea autoResize="1" maxHeight="20" value="#{resourceDetailBean.clickedComment.text}" 
						styleClass="resource_dialog_field"/>
					<p:commandButton actionListener="#{resourceDetailBean.onEditComment}" update=":add_resource_panel" title="#{msg.save}" 
						value="#{msg.save}" onsuccess="PF('comment_dialog').hide();"/>
				</h:form>
			</p:dialog>
	
       
			<h:panelGroup layout="block" id="datagrid" styleClass="datagrid"> 
				<script type="text/javascript">
					$(".center-header .breadcrumb").remove();
					$(".center-header").append($(".breadcrumb"));
				</script> 
				<h:panelGroup styleClass="breadcrumb" layout="block" rendered="#{not empty myResourcesBean.breadcrumb}">
					<ul style="padding:5px;">
						<li>
							<a href="myhome/resources.jsf">My Resources</a>
							<span class="arrow"></span>
						</li>
						
						<h:form>
						<ui:repeat var="folder" value="#{myResourcesBean.breadcrumb}">
							<li>
								<p:commandLink update=":datagrid :add_resource_panel" oncomplete="update_header();">
				       				<f:setPropertyActionListener target="#{myResourcesBean.clickedFolder}" value="#{folder}" />
						        	<h:outputText value="#{folder.name}" escape="false"/> 
								</p:commandLink>
								<span class="arrow"></span>
							</li>
						</ui:repeat>
						</h:form>
					</ul>
				</h:panelGroup>
				<h:panelGroup id="folderGrid" layout="block" pt:data-selectedFolderId="#{myResourcesBean.selectedFolderId}">
					<h:panelGroup rendered="#{!myResourcesBean.folderView or !myResourcesBean.rootFolder}">
						<ui:repeat var="folder" value="#{myResourcesBean.folders}"> 			     
					  		<h:form styleClass="resource_panel resource_folder grey_border" pt:data-folderId="#{folder.folderId}">
					  			<p:commandLink styleClass="resource_command_link" update=":datagrid :add_resource_panel :folder_layout_options" oncomplete="update_header();">
		       						<f:setPropertyActionListener target="#{myResourcesBean.clickedFolder}" value="#{folder}" />
						        	<h:outputText value="#{folder.name}" escape="false" styleClass="resource_short_title" /> 
								</p:commandLink>
					  		</h:form>
						</ui:repeat>
					</h:panelGroup>
					<h:panelGroup rendered="#{myResourcesBean.rootFolder and myResourcesBean.folderView}">
						<ui:repeat var="folder" value="#{myResourcesBean.folders}"> 			     
							<hr/>
					  		<h:form>
					  			<p:commandLink styleClass="resource_command_link" update=":datagrid :add_resource_panel :folder_layout_options" oncomplete="update_header();">
		       						<f:setPropertyActionListener target="#{myResourcesBean.clickedFolder}" value="#{folder}" />
						        	<h:outputText value="#{folder.name}" escape="false" styleClass="resource_short_title"/> 
								</p:commandLink>
					  		</h:form>
							<br/>
					  		<ui:repeat var="result" value="#{folder.resourcesSubset}" >
						       <h:form styleClass="resource_panel grey_border">
								<p:commandLink styleClass="resource_command_link" update=":add_resource_panel" oncomplete="update_header();">
			        				<f:setPropertyActionListener target="#{myResourcesBean.clickedResource}" value="#{result}"/>
			        				<f:setPropertyActionListener target="#{resourceDetailBean.clickedResource}" value="#{result}"/>
									<h:outputText value="#{result.title}" escape="false" styleClass="resource_short_title" /> 			

				            		<h:panelGrid columns="1" styleClass="resource_panelgrid"> 
				            			<p:row>	
											<h:graphicImage styleClass="resource_thumbnail" width="150" height="150" value="#{result.thumbnail1.url}" 
												rendered="#{not empty result.thumbnail1}" alt="#{result.title}" />
							    			<h:outputText styleClass="resource_thumbnail" escape="false" rendered="#{empty result.thumbnail1}"
							    				value='#{result.embeddedSize1.replaceAll("width=\".*\"","").replaceAll("height=\".*\"","").replaceAll("/>","").replaceAll(">","").concat(" width=\"150\" height=\"150\" />")}'/>
				         			    </p:row>
				            	
				            			<div class="resource_summary">
											<span>
												${learnwebBean.getLocaleMessage(result.type)}
											</span> 
											#{msg.added_by} 
											<span>
												#{result.getOwnerUser().username}
											</span>
						        		</div>
				            		</h:panelGrid>  
							    </p:commandLink>
			    			   </h:form>
				    		</ui:repeat>
				    		<h:form>
					    		<p:commandLink styleClass="more_resources_link" update=":datagrid :add_resource_panel :folder_layout_options" oncomplete="update_header();">
			       						<f:setPropertyActionListener target="#{myResourcesBean.clickedFolder}" value="#{folder}" />
							        	<h:outputText value="More Resources..." escape="false" style="text-decoration:underline"/> 
								</p:commandLink>
							</h:form>
							<div class="clear"></div>
						</ui:repeat>
					</h:panelGroup>
				</h:panelGroup>
				<h:panelGroup id="resourceGrid" layout="block">
					<ui:repeat var="result" value="#{myResourcesBean.resources}" >
				       <h:form styleClass="resource_panel grey_border">
							<p:commandLink styleClass="resource_command_link" update=":add_resource_panel" oncomplete="update_header();">
		        				<f:setPropertyActionListener target="#{myResourcesBean.clickedResource}" value="#{result}"/>
		        				<f:setPropertyActionListener target="#{resourceDetailBean.clickedResource}" value="#{result}"/>
								<h:outputText value="#{result.title}" escape="false" styleClass="resource_short_title" /> 			
			           
			            		<h:panelGrid columns="1" styleClass="resource_panelgrid"> 
			            
			            			<p:row>	
										<h:graphicImage styleClass="resource_thumbnail" width="150" height="150" value="#{result.thumbnail1.url}" 
											rendered="#{not empty result.thumbnail1}" alt="#{result.title}" />
						    			<h:outputText styleClass="resource_thumbnail" escape="false" rendered="#{empty result.thumbnail1}"
						    				value='#{result.embeddedSize1.replaceAll("width=\".*\"","").replaceAll("height=\".*\"","").replaceAll("/>","").replaceAll(">","").concat(" width=\"150\" height=\"150\" />")}'/>
			            				<div class="buttons">
			            					<p:commandLink oncomplete="PF('resource_add_dialog').show();" title="#{msg.add_to}" 
				            					rendered="#{userBean.isModerator() or true}" styleClass="buttons_link resource_commandlink">
												<h:graphicImage alt="Add" value="/resources/icon/Add_blue.png" title="#{msg.add_to}" id="add"/> 
												<f:setPropertyActionListener value="#{result}" target="#{myResourcesBean.clickedResource}" />
											</p:commandLink>

			            					<p:commandLink onclick="PF('confirmation').show()" title="#{msg.delete_resource_title}" rendered="true" 
			            						styleClass="buttons_link">
												<h:graphicImage alt="Remove" value="../resources/icon/Remove.png" width="16" height="16" />
												<f:setPropertyActionListener value="#{result}" target="#{myResourcesBean.clickedResource}" />
											</p:commandLink>
									
											<p:commandLink title="#{msg.edit}" update=":add_resource_panel" styleClass="buttons_link">
												<h:graphicImage alt="Edit" value="../resources/icon/Edit.png" width="16" height="16" />
												<f:setPropertyActionListener value="#{result}" target="#{myResourcesBean.clickedResource}" />
												<f:setPropertyActionListener target="#{myResourcesBean.rightPanelAction}" value="editResource"/>
											</p:commandLink>
			            				</div>
			            			</p:row>
			            	
			            			<div class="resource_summary">
										<span>
											${learnwebBean.getLocaleMessage(result.type)}
										</span> 
										#{msg.added_by} 
										<span>
											#{result.getOwnerUser().username}
										</span>
					        		</div>
			            		</h:panelGrid>  
						    </p:commandLink>
			    		</h:form>
				    </ui:repeat>
				    <!-- <h:outputText value="#{msg.no_resources_found}" rendered="#{empty myResourcesBean.resources}" class="nothing_found"/> -->
				</h:panelGroup>
				
		    </h:panelGroup>
		  
	
		</ui:define>
		<ui:define name="right_layout">
			<ui:decorate  template="/lw/templates/right_pane.xhtml">
				<ui:param name="bean" value="#{myResourcesBean}" />
			</ui:decorate >
		</ui:define>
</ui:composition>
</html>