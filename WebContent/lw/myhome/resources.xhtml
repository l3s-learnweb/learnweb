<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" 
	xmlns:ui="http://java.sun.com/jsf/facelets" 
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:f="http://java.sun.com/jsf/core" 
	xmlns:c="http://java.sun.com/jsp/jstl/core" 
	xmlns:p="http://primefaces.org/ui">

<ui:composition template="/lw/templates/new_main_t.xhtml">

	<ui:param name="loginRequired" value="true" />
	<ui:param name="pageTitle" value="#{msg.myResourcesTitle}" />
	<ui:param name="helpText" value="#{msg.myhomeResourcesHelp}"/>
	  
		<ui:define name="center_layout">
			<br></br>
			
			<h:form>
			 	<p:remoteCommand name="updateColumns" update=":resource_disp" actionListener="#{myResourcesBean.updateColumns}"></p:remoteCommand>
	         </h:form>
			<h:form  id="add_resource">
				<p:commandButton styleClass="resource_button greenbutton" value="#{msg.upload_resource}" widgetVar="add_resource" update=":add_resource_panel" oncomplete="update_header()">
					<f:setPropertyActionListener target="#{myResourcesBean.newResourceClicked}" value="true"></f:setPropertyActionListener>
				</p:commandButton>
			</h:form>
			<script type="text/javascript">
			
				var div = document.createElement("div");
				var group_header = document.createElement("span");
				$(group_header).addClass("group_header");
				$(group_header).html("#{msg.myResourcesTitle}");
				var cl = $("#add_resource").clone();
	            $(cl).appendTo(div);
	            $("#add_resource").remove()
				$(div).append(group_header);
				$(div).addClass("ui-layout-unit-header ui-widget-header ui-corner-all");
				$("#center_pane").prepend(div);
				
				
				
				var columns = 3;
				function nCol(){
					var w = $(window).width();
					var c = 3;
					
					if(w &lt; 1360)
						c = 2;
					if(w &gt; 1610)
						c = 4;
					
					if(columns != c) {
						columns = c;
						updateColumns([{name:'cols',value: columns}]);
					}					
				}
				
				$(document).ready(nCol);
				window.onresize = nCol;
				
			</script>
			
			
			<p:confirmDialog id="confirmDialog" message="Are you sure about deleting the resource?" header="Delete Resource" severity="alert" widgetVar="confirmation" appendTo="@(body)" >
		        <h:form>
			        <p:commandButton id="confirm" value="Yes" update=":datagrid :growl :add_resource_panel" oncomplete="PF('confirmation').hide(); update_header()"  
			                   actionListener="#{myResourcesBean.deleteResource}" process="@form"/>  
			        <p:commandButton id="decline" value="No" onclick="PF('confirmation').hide()" type="button" />
			        </h:form>
		    </p:confirmDialog>
			
			<p:dialog header="Upload File" widgetVar="file_dialog" modal="true" appendTo="@(body)" width="600" height="150">
				<h:form>
					<p:fileUpload  rendered="true" fileUploadListener="#{addResourceBean.handleFileUpload}"  
		            mode="advanced"  
		            auto="true"
		            sizeLimit="10000000"   
		            widgetVar="fileUpload"
		            oncomplete="PF('file_dialog').hide()"
		            update=":add_resource_form:preview"
		            /> 
				</h:form>
			</p:dialog>
			<p:dialog header="#{msg.options}" closable="false" widgetVar="resource_dialog" appendTo="@(body)" modal="true" minWidth="540">
				<h:form id="resource_form">
					<h:panelGrid columns="2">
						<h:outputLabel value="#{msg.add_to}:" />
						<h:selectOneMenu value="#{myResourcesBean.selectedResourceTargetGroupId}">
							<f:selectItem itemLabel="#{msg.myResourcesTitle}" itemValue="0" />
							<f:selectItem itemLabel="------------" itemValue="-1" itemDisabled="true" />
							<f:selectItems var="group" value="#{userBean.user.writeAbleGroups}" itemLabel="#{group.title}" itemValue="#{group.id}" />
						</h:selectOneMenu>
	
						<h:outputLabel value="#{msg.title}:" />
						<p:inputText value="#{myResourcesBean.clickedResource.title}" styleClass="resource_dialog_field" />
	
	
						<h:outputLabel value="#{msg.description}:" />
						<p:inputTextarea value="#{myResourcesBean.clickedResource.description}" autoResize="true" styleClass="resource_dialog_field" />
	
						<h:outputLabel value="Url:" />
						<p:inputText value="#{myResourcesBean.clickedResource.url}" disabled="true" styleClass="resource_dialog_field" />
	
						<h:outputLabel value="#{msg.type}:" />
						<p:inputText value="#{myResourcesBean.clickedResource.type}" disabled="true" styleClass="resource_dialog_field" />
	
						<h:outputLabel value="#{msg.author}:" />
						<p:inputText value="#{myResourcesBean.clickedResource.author}" styleClass="resource_dialog_field" />
						
							<h:outputText value=""></h:outputText>
							<p:column styleClass="myresources_pcolumn">
								<div class="myresources_pcolumn_div"><p:commandButton value="#{msg.cancel}" onclick="PF('resource_dialog').hide()" />
								<p:commandButton value="#{msg.save}" action="#{myResourcesBean.addSelectedResource}" update=":datagrid :growl" process="@form :datagrid" oncomplete="PF('resource_dialog').hide()" /></div>
							</p:column>
					</h:panelGrid>
				</h:form>
			</p:dialog>
			<p:dialog header="#{msg.edit}" id="comment_dialog1" modal="true" minWidth="440" appendTo="@(body)" widgetVar="comment_dialog">
				<h:form id="comment_dialog_form">	
					<p:inputTextarea autoResize="1" maxHeight="20" value="#{myResourcesBean.clickedComment.text}" styleClass="resource_dialog_field"></p:inputTextarea>
					<p:commandButton actionListener="#{myResourcesBean.onEditComment}" update=":add_resource_panel" 
										title="#{msg.save}" value="#{msg.save}"								
										onsuccess="PF('comment_dialog').hide();">
					</p:commandButton>
				</h:form>
			</p:dialog>
	
           <h:panelGroup id="resource_disp"> 
			<p:dataGrid id="datagrid" var="result" value="#{myResourcesBean.resources}" columns="#{myResourcesBean.numberOfColumns}" paginator="false" widgetVar="datagrid">  
		       <h:form>
		        <p:commandLink styleClass="resource_command_link" update=":add_resource_panel :resource_form" oncomplete="update_header()">
		        	<f:setPropertyActionListener target="#{myResourcesBean.clickedResource}" value="#{result}"></f:setPropertyActionListener>
			        <p:panel styleClass="resource_panel">  
			            <h:panelGrid columns="1" styleClass="resource_panelgrid"> 
			            	<h:outputText value="#{result.title}" escape="false" styleClass="resource_short_title" style="white-space: nowrap; overflow:hidden; text-overflow: ellipsis; max-width:185px; width:185px; display:block;" /> 
				        
			            	<p:row>
			            		<span class="groupid">#{result.id}</span>
			            		<h:outputText styleClass="resource_thumbnail" value='#{result.embeddedSize1.replaceAll("width=\".*\"","").replaceAll("height=\".*\"","").replaceAll("/>","").replaceAll(">","").concat(" width=\"140\" height=\"140\" />")}' escape="false"></h:outputText>
			            		<div class="buttons">
				            		
				            			<p:commandLink onclick="PF('resource_dialog').show()" title="#{msg.addToMyResources}"
											styleClass="buttons_link myresources_commandlink" update=":datagrid">
											<h:graphicImage alt="Add" value="/resources/icon/Add.png" width="16" height="16" />
												<f:setPropertyActionListener value="#{result}" target="#{myResourcesBean.clickedResource}" />
										</p:commandLink>
				            			
				            			<p:commandLink onclick="PF('confirmation').show()" title="#{msg.removeFromGroup}" rendered="true" styleClass="buttons_link">
											<h:graphicImage alt="Remove" value="../resources/icon/Remove.png" width="16" height="16" />
												<f:setPropertyActionListener value="#{result}" target="#{myResourcesBean.clickedResource}" />
										</p:commandLink>
										
										<p:commandLink title="#{msg.edit}" update=":add_resource_panel" styleClass="buttons_link">
											<h:graphicImage alt="Edit" value="../resources/icon/Edit.png" width="16" height="16" />
												<f:setPropertyActionListener value="#{result}" target="#{myResourcesBean.clickedResource}" />
												<f:setPropertyActionListener target="#{myResourcesBean.editResourceClicked}" value="true"></f:setPropertyActionListener>
											<f:param name="group_id" value="#{groupDetailBean.groupId}" />
										</p:commandLink>
									
			            		</div>
			            	</p:row>
			            	<ui:fragment rendered="#{result.type.length() le 12}">
				            	<div class="resource_summary">
									<span>${learnwebBean.getLocaleMessage(result.type)}</span> #{msg.added_by} <span>#{result.getOwnerUser().username}</span>
					            </div>
				            </ui:fragment>
				            <ui:fragment rendered="#{result.type.length() gt 12}">
				            	<div class="resource_summary">
									<span>${learnwebBean.getLocaleMessage(result.type).substring(0,12).concat("...")}</span> #{msg.added_by} <span>#{result.getOwnerUser().username}</span>
					            </div>
				            </ui:fragment>
			            </h:panelGrid>  
			            
			        </p:panel>
			    </p:commandLink>
			    </h:form>
		    </p:dataGrid>
		  </h:panelGroup> 
	
		</ui:define>
		<ui:define name="right_layout">
			<ui:decorate  template="/lw/templates/right_pane.xhtml">
				<ui:param name="bean" value="#{myResourcesBean}" />
			</ui:decorate >
		</ui:define>
</ui:composition>
</html>