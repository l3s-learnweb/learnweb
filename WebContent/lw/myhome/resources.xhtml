<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" 
	xmlns:ui="http://java.sun.com/jsf/facelets" 
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:f="http://java.sun.com/jsf/core" 
	xmlns:c="http://java.sun.com/jsp/jstl/core" 
	xmlns:p="http://primefaces.org/ui">

<ui:composition template="/lw/templates/new_main_t.xhtml">

	<ui:param name="loginRequired" value="true" />
	<ui:param name="pageTitle" value="#{msg.myResourcesTitle}" />
	<ui:param name="helpText" value="#{msg.myhomeResourcesHelp}"/>
	  
		<ui:define name="center_layout">
			<br></br>

			<h:form  id="add_resource">
				<p:commandButton styleClass="resource_button greenbutton" value="#{msg.upload_resource}" widgetVar="add_resource" update=":add_resource_panel" oncomplete="update_header()">
					<f:setPropertyActionListener target="#{myResourcesBean.newResourceClicked}" value="true"></f:setPropertyActionListener>
				</p:commandButton>
			</h:form>
			<script type="text/javascript">			
				var div = document.createElement("div");
				var group_header = document.createElement("span");
				$(group_header).addClass("group_header");
				$(group_header).html("#{msg.myResourcesTitle}");
				var cl = $("#add_resource").clone();
	            $(cl).appendTo(div);
	            $("#add_resource").remove()
				$(div).append(group_header);
				$(div).addClass("ui-layout-unit-header ui-widget-header ui-corner-all");
				$("#center_pane").prepend(div);				
			</script> 
			
			
			<p:confirmDialog id="confirmDialog" message="#{msg.delete_message_resource}" header="#{msg.delete_resource_title}" severity="alert" widgetVar="confirmation" appendTo="@(body)" >
		        <h:form>
			        <p:commandButton id="confirm" value="#{msg.yes}" update=":datagrid :growl :add_resource_panel" oncomplete="PF('confirmation').hide(); update_header()" actionListener="#{myResourcesBean.deleteResource}" process="@form"/>  
			        <p:commandButton id="decline" value="#{msg.no}" onclick="PF('confirmation').hide()" type="button" />
			        </h:form>
		    </p:confirmDialog>
			
			<p:dialog header="#{msg.upload_file}" widgetVar="file_dialog" modal="true" appendTo="@(body)" width="600" height="150">
				<h:form>
					<p:fileUpload rendered="true" fileUploadListener="#{addResourceBean.handleFileUpload}" mode="advanced" auto="true" sizeLimit="10000000" widgetVar="fileUpload" oncomplete="PF('file_dialog').hide()" update=":add_resource_form:preview" label="#{msg.choose_file}" cancelLabel="abb"/> 
				</h:form>
			</p:dialog>
			
			 <p:dialog header="#{msg.link_to}" widgetVar="resource_link_dialog" modal="false" minWidth="540" styleClass="zindex10000">			
				<h:form id="resource_link_form">
					<h:panelGrid columns="2">
						<h:outputText value="#{msg.link_to}:"/>
						<h:selectOneMenu value="#{myResourcesBean.selectedResourceTargetGroupId}">
							<f:selectItems var="group" value="#{userBean.user.writeAbleGroups}" itemLabel="#{group.title}" itemValue="#{group.id}"/>
						</h:selectOneMenu>					
						
						<h:outputText value="" />
						<p:commandButton value="#{msg.save}" action="#{myResourcesBean.addSelectedResourceLink}" process="@form" update=":growl" oncomplete="PF('resource_link_dialog').hide()"/>
					</h:panelGrid>
				
				</h:form>			
			</p:dialog>	
			<p:dialog header="#{msg.edit}" id="comment_dialog1" modal="true" minWidth="440" appendTo="@(body)" widgetVar="comment_dialog">
				<h:form id="comment_dialog_form">	
					<p:inputTextarea autoResize="1" maxHeight="20" value="#{resourceDetailBean.clickedComment.text}" styleClass="resource_dialog_field"></p:inputTextarea>
					<p:commandButton actionListener="#{resourceDetailBean.onEditComment}" update=":add_resource_panel" title="#{msg.save}" value="#{msg.save}" onsuccess="PF('comment_dialog').hide();"></p:commandButton>
				</h:form>
			</p:dialog>
	
       
			<h:panelGroup layout="block" id="datagrid">  
		       <ui:repeat var="result" value="#{myResourcesBean.resources}" >
		       
		       <h:form styleClass="resource_panel grey_border">
		        
		        <p:commandLink styleClass="resource_command_link" update=":add_resource_panel" oncomplete="update_header()">
		        	<f:setPropertyActionListener target="#{myResourcesBean.clickedResource}" value="#{result}"></f:setPropertyActionListener>
		        	<f:setPropertyActionListener target="#{resourceDetailBean.clickedResource}" value="#{result}"></f:setPropertyActionListener>
									
			            <h:panelGrid columns="1" styleClass="resource_panelgrid"> 
			            	<h:outputText value="#{result.title}" escape="false" styleClass="resource_short_title" /> 
				        
			            	<p:row>
			            		<span class="groupid">#{result.id}</span>
			            		<h:graphicImage styleClass="resource_thumbnail" width="150" height="150" value="#{result.thumbnail1.url}" rendered="#{not empty result.thumbnail1}" alt="#{result.title}"></h:graphicImage>
				            	<h:outputText styleClass="resource_thumbnail" value='#{result.embeddedSize1.replaceAll("width=\".*\"","").replaceAll("height=\".*\"","").replaceAll("/>","").replaceAll(">","").concat(" width=\"150\" height=\"150\" />")}' escape="false" rendered="#{empty result.thumbnail1 and empty result.thumbnail0}"></h:outputText>

			            		<div class="buttons">
				            		
				            		<!-- 
				            			<p:commandLink onclick="PF('resource_dialog').show()" title="#{msg.addToMyResources}"
											styleClass="buttons_link myresources_commandlink" update=":datagrid">
											<h:graphicImage alt="Add" value="/resources/icon/Add.png" width="16" height="16" />
												<f:setPropertyActionListener value="#{result}" target="#{myResourcesBean.clickedResource}" />
										</p:commandLink>
				            			 -->
				            			<p:commandLink oncomplete="PF('resource_link_dialog').show();" title="#{msg.link_to}" rendered="#{userBean.isModerator() or true}" styleClass="buttons_link resource_commandlink">
											<h:graphicImage alt="Add" value="/resources/icon/Add_blue.png" title="#{msg.link_to}" /> 
											<f:setPropertyActionListener value="#{result}" target="#{myResourcesBean.clickedResource}" />
										</p:commandLink>
										 
				            			<p:commandLink onclick="PF('confirmation').show()" title="#{msg.delete_resource_title}" rendered="true" styleClass="buttons_link">
											<h:graphicImage alt="Remove" value="../resources/icon/Remove.png" width="16" height="16" />
												<f:setPropertyActionListener value="#{result}" target="#{myResourcesBean.clickedResource}" />
										</p:commandLink>
										
										<p:commandLink title="#{msg.edit}" update=":add_resource_panel" styleClass="buttons_link">
											<h:graphicImage alt="Edit" value="../resources/icon/Edit.png" width="16" height="16" />
												<f:setPropertyActionListener value="#{result}" target="#{myResourcesBean.clickedResource}" />
												<f:setPropertyActionListener target="#{myResourcesBean.editResourceClicked}" value="true"></f:setPropertyActionListener>
	
										</p:commandLink>
									
			            		</div>
			            	</p:row>
			            	
			            	<div class="resource_summary">
								<span>${learnwebBean.getLocaleMessage(result.type)}</span> #{msg.added_by} <span>#{result.getOwnerUser().username}</span>
					        </div>
			            </h:panelGrid>  
			            

			    </p:commandLink>
			    
			    </h:form>

			    </ui:repeat>
		    </h:panelGroup>
		  
	
		</ui:define>
		<ui:define name="right_layout">
			<ui:decorate  template="/lw/templates/right_pane.xhtml">
				<ui:param name="bean" value="#{myResourcesBean}" />
			</ui:decorate >
		</ui:define>
</ui:composition>
</html>