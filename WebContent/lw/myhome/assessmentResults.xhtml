<ui:composition template="/WEB-INF/templates/layout/template.xhtml"
				xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
				xmlns:h="http://xmlns.jcp.org/jsf/html"
				xmlns:f="http://xmlns.jcp.org/jsf/core"
				xmlns:p="http://primefaces.org/ui">

	<ui:param name="loginRequired" value="true"/>
	<ui:param name="pageTitle" value="Assessment results"/>

	<ui:define name="breadcrumb_ext">
		<p:menuitem value="Assessment results" url="myhome/assessmentResults.jsf"/>
	</ui:define>

	<ui:define name="center_layout">

		<p:panel header="Assessment results">

			<h:outputText rendered="#{assessmentResultBean.mandatorySurveySubmitted}"/>

			<h:outputText rendered="#{empty assessmentResultBean.peerAssessmentPairs}" value="You did not participate in any assessment."/>
				
			<p:repeat var="pair" value="#{assessmentResultBean.peerAssessmentPairs}">

				<ui:fragment rendered="#{not assessmentResultBean.mandatorySurveySubmitted}">
					Please answer the
					<h:outputLink value="survey/survey.jsf">
						<f:param name="resource_id" value="#{assessmentResultBean.mandatorySurvey.id}"/>
						<f:param name="go_back" value="assessmentResults"/>
						<h:outputText value="#{assessmentResultBean.mandatorySurvey.title}"/>
					</h:outputLink>
					to view the assessment results.			
				</ui:fragment>

				<h:panelGrid columns="2" columnClasses="nowrap bold," rendered="#{assessmentResultBean.mandatorySurveySubmitted}" cellspacing="8">

					<h:outputText value="Peer assessment:" style="font-weight:bold;"/>
					<h:outputLink value="survey/answer.jsf" rendered="#{pair.peerAssessmentUserAnswers.saved}">
						<f:param name="resource_id" value="#{pair.peerAssessmentSurveyResourceId}"/>
						<f:param name="user_id" value="#{pair.assessorUserId}"/>
						<h:outputText value="#{pair.peerAssessment.title}"/>
					</h:outputLink>
					<h:outputText rendered="#{not pair.peerAssessmentUserAnswers.saved}" value="Your partner didn't submit the peer assessment :("/>

					<h:outputText value="Assessment:" class="bold"/>
					<h:panelGroup rendered="#{not empty pair.assessment.submittedAnswersOfAllUsers and pair.assessment.submittedAnswersOfAllUsers.size() == 1}">
						<p:repeat var="answer" value="#{pair.assessment.submittedAnswersOfAllUsers}">
							<h:outputLink value="survey/answer.jsf">
								<f:param name="resource_id" value="#{pair.assessmentSurveyResourceId}"/>
								<f:param name="user_id" value="#{answer.userId}"/>
								<h:outputText value="#{pair.peerAssessment.title} (#{answer.user.realUsername})"/>
							</h:outputLink>
						</p:repeat>
					</h:panelGroup>
					<h:outputText rendered="#{empty pair.assessment.submittedAnswersOfAllUsers}"
						value="The teacher's assessment wasn't submitted (yet). Maybe you will retrieve it directly from your teacher."/>

				</h:panelGrid>

			</p:repeat>
		</p:panel>
	</ui:define>
</ui:composition>