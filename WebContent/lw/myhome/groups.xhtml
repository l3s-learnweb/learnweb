<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xmlns:ui="http://java.sun.com/jsf/facelets" xmlns:h="http://java.sun.com/jsf/html" xmlns:f="http://java.sun.com/jsf/core"
	xmlns:p="http://primefaces.org/ui">

<ui:composition template="/lw/templates/new_main_t.xhtml">

	<ui:param name="loginRequired" value="true" />
	<ui:param name="pageTitle" value="#{msg.groupsTitle}" />
	<ui:param name="helpText" value="#{msg.myhomeGroupsHelp}"/>
	
	<ui:define name="right_layout">
	<p:layoutUnit rendered="#{userBean.loggedIn}" position="east" size="38%" resizable="false" closable="false" collapsible="false" style="border: none;" id="right_pane">
		<h:panelGroup style= "left: 5%; position:relative;">
			<h:form id="addgroupform" style="width: 90%;" prependId="false">
				
				<div class="page_header">
					<span>
						#{msg.createGroup}
					</span>
				</div>
			
				<div class="grey_border">
					<h:panelGrid columns="3" columnClasses="medium-width">						
					
						<h:outputText value="#{msg.title}*:" />
						<p:inputText id="new_title" value="#{groupsBean.newGroup.title}" validator="#{groupsBean.validateGroupTitle}" style="width:20rem"/>
						<p:message for="new_title" showSummary="true" showDetail="false" id="message_new_title"/>
						
											 
						<h:outputText value="#{msg.course}*:" />
						<h:selectOneMenu value="#{groupsBean.newGroup.courseId}" id="course_id" style="width:21rem;">	
							<f:selectItems var="course" value="#{userBean.user.courses}" itemLabel="#{course.title}" itemValue="#{course.id}"/>
						</h:selectOneMenu>
						<h:outputText value="" />				
						
						<h:outputText value="#{msg.category}*:" rendered="#{not empty userBean.activeCourse.groupCategories}" />
						<h:selectOneMenu value="#{groupsBean.newGroup.categoryId}" rendered="#{not empty userBean.activeCourse.groupCategories}" >	
							<f:selectItems value="#{userBean.activeCourse.groupCategories}" var="cat" itemValue="#{cat.id}" itemLabel="#{cat.title} [#{cat.abbreviation}]" />
						</h:selectOneMenu>
						<h:outputText value="" rendered="#{not empty userBean.activeCourse.groupCategories}" />						
							
						<h:outputText value="#{msg.description}:" />					
						<p:inputTextarea id="new_description" value="#{groupsBean.newGroup.description}" style="width:20rem"/>
						<p:message for="new_description" showSummary="true" showDetail="false"/>	

						<h:outputText value="#{msg.language}:" />
						<p:inputText id="new_language" value="#{groupsBean.newGroup.language}" style="width:20rem"/>
						<p:message for="new_language" showSummary="true" showDetail="false"/>
						
					</h:panelGrid>	
						<br/>
						
					<span>* #{msg.mandatory_field}</span> 
				</div> 
			
				<p:fieldset legend="Group protection" rendered="false">
					<h:panelGrid columns="3" columnClasses="medium-width">	
					
						<h:outputText value="" />
						<h:selectBooleanCheckbox value="#{groupsBean.newGroup.restrictionOnlyLeaderCanAddResources}" />
						<h:outputText value="#{msg.add_resource_group_leader}" />
				
					</h:panelGrid>
				 </p:fieldset>
				<br/>
				<p:commandButton  id="create_group_button" ajax="true" value="#{msg.createGroup}" action="#{groupsBean.onCreateGroup}" styleClass="greenbutton" process="@form" update="@form :my_groups :growl :group_menu" />
				
			</h:form>
		</h:panelGroup>
</p:layoutUnit>
</ui:define>
	<ui:define name="center_layout">
	
		<div class="page_header">
			<span>
				#{msg.myGroups}
			</span>
		</div>
		<h:form id="my_groups">
					
			<p:dataTable var="group" value="#{groupsBean.myGroups}" emptyMessage="#{msg.no_groups_found}" dynamic="false">
				
				<p:column headerText="#{msg.title}" sortBy="#{group.title}" width="17%">
					<h:outputLink value="group/overview.jsf">
						<f:param name="group_id" value="#{group.id}" />
						<h:outputText value="#{group.longTitle}" />
					</h:outputLink>
					
					<h:outputText value=" (#{msg.new_word})" styleClass="bold_red" rendered="${userBean.newGroups.contains(group)}"/>
				</p:column>

				<p:column headerText="#{msg.description}" sortBy="#{group.description}">
					<h:outputText value="#{group.description}" />
				</p:column>

				<p:column headerText="#{msg.leader}" sortBy="#{group.leader.username}" width="9%">
					<h:outputText value="#{group.leader.username}" />
				</p:column>
				
				<p:column headerText="#{msg.course}" sortBy="#{group.course.title}" width="8%" >
					<h:outputText value="#{group.course.title}" />						
				</p:column>		
				
				<p:column headerText="#{msg.options}" styleClass="nowrap align-center" width="70">					
					<p:commandLink action="#{groupsBean.leaveGroup}" styleClass="optionIcon" process="@this" update=":other_groups :growl :group_menu :my_groups"  title="#{msg.leave}">
						<f:setPropertyActionListener target="#{groupsBean.selectedGroup}" value="#{group}" />
						<h:graphicImage value="/resources/icon/silk/group_delete.png" width="16" height="16" alt="#{msg.leave}" />
					</p:commandLink>					
					
					<p:commandLink process="@this" update=":group_moderator_form" styleClass="optionIcon" title="#{msg.edit}" rendered="#{groupsBean.canDeleteGroup(group)}" oncomplete="PF('group_moderator_dialog').show()">
						<f:setPropertyActionListener target="#{groupsBean.selectedGroup}" value="#{group}" />
						<h:graphicImage value="/resources/icon/silk/pencil.png" width="16" height="16" alt="#{msg.edit}" /> 								
					</p:commandLink>
					
					<p:commandLink action="#{groupsBean.deleteGroup}" update=":growl :group_menu :my_groups" styleClass="optionIcon" title="#{msg.delete}" process="@this" onstart="return confirm('${groupsBean.getLocaleMessage('group_delete_question', group.title)}');" rendered="#{groupsBean.canDeleteGroup(group)}">
						<f:setPropertyActionListener target="#{groupsBean.selectedGroup}" value="#{group}" />
						<h:graphicImage value="/resources/icon/silk/delete.png" width="16" height="16" alt="#{msg.delete}"/> 							
					</p:commandLink>						
				</p:column>
			</p:dataTable>
			<br/><br/>
		</h:form>
		<br/>
		<br/>
		
			<div class="page_header">
				<span>
					#{msg.otherGroups}
				</span>
			</div>
			<h:form id="other_groups">
				<p:dataTable var="group" value="#{groupsBean.otherGroups}" emptyMessage="#{msg.no_groups_found}"  paginator="false" >
					
					<p:column headerText="#{msg.title}" sortBy="#{group.title}" width="17%">
						<h:outputLink value="group/overview.jsf">
							<f:param name="group_id" value="#{group.id}" />
							<h:outputText value="#{group.longTitle}" />
						</h:outputLink>
						
						<h:outputText value=" (#{msg.new_word})" styleClass="bold_red" rendered="${userBean.newGroups.contains(group)}"/>
					</p:column>

					<p:column  headerText="#{msg.description}" >
						<h:outputText value="#{group.description}" />
					</p:column>					
					
					<p:column headerText="#{msg.language}" width="7%">
						<h:outputText value="#{group.language}" />			
					</p:column>
					
					<p:column headerText="#{msg.course}" width="8%">
						<h:outputText value="#{group.course.title}" />						
					</p:column>
					
					<p:column styleClass="nowrap align-center" width="70">	
						<f:facet name="header">
								<span id="option_join_group">
									#{msg.options}
								</span>
						</f:facet>	
						<p:commandLink action="#{groupsBean.joinGroup}" update=":other_groups :growl :group_menu :my_groups"  process="@this" styleClass="optionIcon" title="#{msg.join}">
							<f:setPropertyActionListener target="#{groupsBean.selectedGroup}" value="#{group}" />
							<h:graphicImage value="/resources/icon/silk/group_add.png" width="16" height="16" alt="#{msg.join}" />
						</p:commandLink>
						
						
						<p:commandLink process="@this" update=":group_moderator_form" styleClass="optionIcon" title="#{msg.edit}" rendered="#{userBean.admin || userBean.moderator}" onsuccess="PF('group_moderator_dialog').show()" onerror="alert('error');">
							<f:setPropertyActionListener target="#{groupsBean.selectedGroup}" value="#{group}" />
							<h:graphicImage value="/resources/icon/silk/pencil.png" width="16" height="16" alt="#{msg.edit}" /> 								
						</p:commandLink>	
						
						
						<p:commandLink action="#{groupsBean.deleteGroup}" update=":other_groups :growl" styleClass="optionIcon" title="#{msg.delete}" process="@this" onstart="return confirm('${groupsBean.getLocaleMessage('group_delete_question', group.title)}');" rendered="#{userBean.admin || userBean.moderator}">
							<f:setPropertyActionListener target="#{groupsBean.selectedGroup}" value="#{group}" />
							<h:graphicImage value="/resources/icon/silk/delete.png" width="16" height="16" alt="#{msg.delete}"/> 								
						</p:commandLink>				 	
					
						 
					</p:column>

				</p:dataTable>
			</h:form>

		<p:dialog header="#{msg.edit_group}" widgetVar="group_moderator_dialog" modal="true" minWidth="440" appendTo="@(body)">
			<h:form id="group_moderator_form">
				
				<h:panelGrid columns="2">
					<h:outputLabel value="#{msg.leader}:" for="edit_group_leader"/>		
					
					<h:selectOneMenu value="#{groupsBean.selectedGroupLeaderId}" immediate="true" id="edit_group_leader">
						<f:selectItems value="#{groupsBean.membersOfSelectedGroup}" />
					</h:selectOneMenu>

					<h:outputLabel value="#{msg.title}:" for="edit_group_title"/>
					<p:inputText value="#{groupsBean.selectedGroupTitle}" id="edit_group_title" style="width:300px;"/>
					
					<h:outputLabel value="#{msg.description}:" for="edit_group_description"/>
					<p:inputTextarea value="#{groupsBean.selectedGroupDescription}" id="edit_group_description" autoResize="true"  style="width:300px;"/>
					
					<h:outputText value="" />
					<p:commandButton disabled="false" value="#{msg.save}" ajax="false" action="#{groupsBean.onGroupEdit}" update=":other_groups :growl :group_menu :my_groups" oncomplete="PF('group_moderator_dialog').hide()" style="border-radius:0px;">
						<f:setPropertyActionListener target="#{groupsBean.editGroup}" value="#{groupsBean.selectedGroup}" />
					</p:commandButton>
				</h:panelGrid>
			
			</h:form>
		
		</p:dialog>
	</ui:define>
</ui:composition>
</html>