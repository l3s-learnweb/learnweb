<ui:composition template="/templates/main/main_old.xhtml"
    xmlns="http://www.w3.org/1999/xhtml"
    xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
    xmlns:h="http://xmlns.jcp.org/jsf/html"
    xmlns:f="http://xmlns.jcp.org/jsf/core"
    xmlns:p="http://primefaces.org/ui">

	<ui:param name="loginRequired" value="true" />
	<ui:param name="pageTitle" value="#{msg.groupsTitle}" />
	<ui:param name="helpText" value="#{msg.myhomeGroupsHelp}"/>
	
	<ui:define name="right_layout">
	
		<p:layoutUnit rendered="#{userBean.loggedIn}" position="east" size="38%" resizable="false" closable="false" 
			collapsible="false" style="border: none;" id="right_pane">
			<h:panelGroup style= "left: 5%; position:relative;">
				<h:form id="addgroupform" style="width: 90%;" prependId="false">
					
					<div class="page_header">
						<span>
							#{msg.createGroup}
						</span>
					</div>
			
					<style type="text/css">
						.ui-state-hover, .ui-state-focus, .ui-state-active{
							box-shadow:0 0 0px 0px #fff !important;
							background-color:#d1d1d1 !important;
							background-image:none !important;
							border:1px solid #a8a8a8 !important;
						}
						.other_groups_course_title > input { max-width:100%; box-sizing: border-box; }
						
					</style>
					<div class="grey_border">
						
						<h:panelGrid columns="3" columnClasses="medium-width">						
						
							<h:outputText value="#{msg.title}*:" />
							<p:inputText id="new_title" value="#{groupsBean.newGroup.title}" validator="#{groupsBean.validateGroupTitle}" 
								style="width:21rem" label="#{msg.title}"/>
							<p:message for="new_title" showSummary="true" showDetail="false" id="message_new_title"/>
												 
							<h:outputText value="#{msg.course}*:" />
							<h:selectOneMenu value="#{groupsBean.newGroup.courseId}" id="course_id" style="width:22rem;">	
								<f:selectItems var="course" value="#{userBean.user.courses}" itemLabel="#{course.title}" itemValue="#{course.id}"/>
							</h:selectOneMenu>
							<h:outputText value="" />
															
							<h:outputText value="#{msg.description}:" />					
							<p:textEditor  id="new_description" widgetVar="editorWidget" value="#{groupsBean.newGroup.description}" style="width:22rem;">
								<f:facet name="toolbar">
									<span class="ql-formats">
										<button class="ql-bold"></button>
										<button class="ql-italic"></button>
										<button class="ql-underline"></button>
										<button class="ql-strike"></button>
									</span>
								</f:facet>
							</p:textEditor >
							<p:message for="new_description" showSummary="true" showDetail="false"/>

							<ui:fragment rendered="false">
								<h:outputText value="#{msg.language}:" />
								<p:inputText id="new_language" value="#{groupsBean.newGroup.language}" style="width:21rem" />
								<p:message for="new_language" showSummary="true" showDetail="false" />
							</ui:fragment>
						</h:panelGrid>	
							<br/>
							
						<span>
							* #{msg.mandatory_field}
						</span> 
					</div> 
					<br/>
						
					<p:commandButton id="create_group_button" ajax="true" value="#{msg.createGroup}" action="#{groupsBean.onCreateGroup}" oncomplete="applyTooltip()"
						styleClass="greenbutton" process="@form" update="@form :my_groups :growl :group_menu" />	
					
				</h:form>
			</h:panelGroup>
		</p:layoutUnit>
	</ui:define>
	
	<ui:define name="center_layout">
		<h:outputStylesheet name="vendor/tooltipster-v3.3.0/tooltipster.min.css"/>
		<h:outputScript name="vendor/tooltipster-v3.3.0/jquery.tooltipster.min.js" target="head"/>
	    
	    <script type="text/javascript">
	    	function applyTooltip()
	    	{
	    		$('.tooltip').tooltipster({
	            	 
	                contentAsHTML:true,
	                //maxWidth: 400,
	                position:'top',
	                //hideOnClick: true;,
	                interactive:true,
	                interactiveTolerance:150 // increase to debug
	                //theme:'tooltipster-custom-theme'	
	                //theme:'tooltipster-custom-b'
	            });
	    	}
	        $(document).ready(function() {
	        	applyTooltip();
	        	
	        });
	    </script>	

		<div class="page_header">
			<span>
				#{msg.myGroups}
			</span>
		</div>
		
		<h:form id="my_groups">
					
			<p:dataTable var="group" value="#{groupsBean.myGroups}" emptyMessage="#{msg.no_groups_found}" dynamic="false">
				<p:ajax event="sort" oncomplete="applyTooltip()" />				
				
				<p:column headerText="#{msg.title}" sortBy="#{group.title}" width="17%">
					
					<h:outputLink value="group/resources.jsf" styleClass="tooltip" title="#{group.tooltip}">
					
						<f:param name="group_id" value="#{group.id}" />
						<h:outputText value="#{group.longTitle}" />
					</h:outputLink>								
										
					<h:outputText value=" (#{msg.new_word})" styleClass="bold_red" rendered="${userBean.newGroups.contains(group)}"/>
					
				</p:column>

				<p:column headerText="#{msg.description}" sortBy="#{group.description}" styleClass="group_description" >
					<h:outputText value="#{group.description}" escape="false"/>
				</p:column>

				<p:column headerText="#{msg.leader}" sortBy="#{group.leader.username}" width="11%">
					<h:outputText value="#{group.leader.username}" />
				</p:column>
				
				<p:column headerText="#{msg.course}" sortBy="#{group.course.title}" width="11%" >
					<h:outputText value="#{group.course.title}" />						
				</p:column>	
				
				<p:column headerText="#{msg.members}" sortBy="#{group.memberCount}"  width="60" styleClass="align-center">
					<h:outputText value=" #{group.memberCount} #{msg.of} #{group.maxMemberCount}"  rendered="#{group.memberCountLimited}"/>
					<h:outputText value=" #{group.memberCount}"  rendered="#{not group.memberCountLimited}"/>					
				</p:column>		
				
				<p:column headerText="#{msg.options}" styleClass="nowrap align-center" width="60">					
					<p:commandLink action="#{groupsBean.leaveGroup}" styleClass="optionIcon" process="@this" 
						update=":other_groups :growl :group_menu :my_groups"  title="#{msg.leave}" oncomplete="applyTooltip()">
						<f:setPropertyActionListener target="#{groupsBean.selectedGroup}" value="#{group}" />
						<h:graphicImage value="/resources/icon/silk/group_delete.png" width="16" height="16" alt="#{msg.leave}" />
						<p:confirm message="#{utilBean.getLocaleMessage('leave_group_question', group.title)}" />
				    </p:commandLink>			 
			    
					<h:outputLink value="group/options.jsf" rendered="#{groupsBean.canDeleteGroup(group)}">
							<f:param name="group_id" value="#{group.id}" />
							<h:graphicImage value="/resources/icon/silk/pencil.png" width="16" height="16" alt="#{msg.edit}" />
					</h:outputLink>					
				</p:column>
				
				
			</p:dataTable>
			<br/><br/>
			
				
			    
		</h:form>
		<br/>
		<br/>
		<h:form id="other_groups">
			<ui:fragment rendered="#{not empty groupsBean.otherGroups}">
				<div class="page_header">
					<span>
						#{msg.otherGroups}
					</span>
				</div>
			
				<p:dataTable var="group" value="#{groupsBean.otherGroups}" emptyMessage="#{msg.no_groups_found}"  paginator="false" >
					<p:ajax event="filter" oncomplete="applyTooltip()"/>
					<p:ajax event="sort" oncomplete="applyTooltip()"/>
					
					<p:column headerText="#{msg.title}" sortBy="#{group.title}" style="min-width:17%" filterBy="#{group.longTitle}" filterMatchMode="contains">
						
						<h:outputLink value="group/resources.jsf" styleClass="tooltip" title="#{group.tooltip}">
							<f:param name="group_id" value="#{group.id}" />
							<h:outputText value="#{group.longTitle}" />
						</h:outputLink>
						
						<h:outputText value=" (#{msg.new_word})" styleClass="bold_red" rendered="${userBean.newGroups.contains(group)}"/>
					</p:column>

					<p:column headerText="#{msg.description}" styleClass="group_description" filterBy="#{group.description}" filterMatchMode="contains">
						<h:outputText value="#{group.description}" escape="false"/>
					</p:column>					
					
					<p:column headerText="#{msg.language}" width="7%" rendered="#{groupsBean.otherGroupsShowLanguage}">
						<h:outputText value="#{group.language}" />			
					</p:column>
					
					<p:column headerText="#{msg.course}" width="8%" filterBy="#{group.course.title}" filterMatchMode="contains" styleClass="other_groups_course_title">
						<h:outputText value="#{group.course.title}" />						
					</p:column>
				
					<p:column headerText="#{msg.members}" sortBy="#{group.memberCount}"  width="60" styleClass="align-center">
						<h:outputText value=" #{group.memberCount} #{msg.of} #{group.maxMemberCount}"  rendered="#{group.memberCountLimited}"/>
						<h:outputText value=" #{group.memberCount}"  rendered="#{not group.memberCountLimited}"/>					
					</p:column>	
					
					<p:column styleClass="nowrap align-center" width="60">	
						<f:facet name="header">
								<span id="option_join_group">
									#{msg.options}
								</span>
						</f:facet>	
						<p:commandLink action="#{groupsBean.joinGroup}" update=":other_groups :growl :group_menu :my_groups"  
							process="@this" styleClass="optionIcon" title="#{msg.join}" oncomplete="applyTooltip()">
							<f:setPropertyActionListener target="#{groupsBean.selectedGroup}" value="#{group}" />
							<h:graphicImage value="/resources/icon/silk/group_add.png" width="16" height="16" alt="#{msg.join}" />
						</p:commandLink>
						
						<h:outputLink value="group/options.jsf" rendered="#{userBean.admin || userBean.moderator}">
							<f:param name="group_id" value="#{group.id}" />
							<h:graphicImage value="/resources/icon/silk/pencil.png" width="16" height="16" alt="#{msg.edit}" />
						</h:outputLink>				
						 
					</p:column>

				</p:dataTable>			
			</ui:fragment>
		</h:form>
	</ui:define>
</ui:composition>