<ui:composition template="/WEB-INF/templates/layout/template.xhtml"
                xmlns="http://www.w3.org/1999/xhtml"
                xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
                xmlns:h="http://xmlns.jcp.org/jsf/html"
                xmlns:f="http://xmlns.jcp.org/jsf/core"
                xmlns:c="http://xmlns.jcp.org/jsp/jstl/core"
                xmlns:p="http://primefaces.org/ui">

<ui:param name="loginRequired" value="true"/>
<ui:param name="pageTitle" value="#{msg.myProfileTitle}"/>
<ui:param name="helpText" value="#{msg.myhomeProfileHelp}"/>

<ui:define name="sub_breadcrumb">
    <p:menuitem value="#{msg.myProfileTitle}" url="myhome/profile.jsf#"/>
</ui:define>

<ui:define name="center_layout">
    <div class="row s-gutters flex-column-reverse flex-lg-row">
        <div class="col-12 col-lg-6">
            <p:panel header="#{msg.last_activities}" id="profile_news">
                <ui:decorate template="/WEB-INF/templates/blocks/user/activity-logs.xhtml"/>
            </p:panel>
        </div>
        <div class="col-12 col-lg-6">
            <p:panel header="#{msg.edit_profile}" styleClass="mb-3">
                <h:form enctype="multipart/form-data">
                    <f:param name="user_id" value="#{profileBean.selectedUser.id}"/>

                    <h:panelGroup id="profile_image">
                        <div class="row flex-column-reverse flex-md-row">
                            <div class="col-md-8">
                                <div class="form-group">
                                    <p:outputLabel for="@next" value="#{msg.username}:"/>
                                    <p:inputText id="username" value="#{profileBean.username}" validator="#{profileBean.validateUsername}" label="#{msg.username}"/>
                                    <p:message for="@previous"/>
                                </div>

                                <div class="form-group">
                                    <p:outputLabel for="@next" value="#{msg.full_name}:"/>
                                    <p:inputText id="userfullname" value="#{profileBean.fullName}" label="#{msg.full_name}:"/>
                                    <p:message for="@previous"/>
                                </div>

                                <div class="form-group">
                                    <p:outputLabel for="@next" value="#{msg.email_address}:"/>
                                    <p:inputText id="useremail" value="#{profileBean.email}" label="#{msg.email_address}:" required="#{profileBean.mailRequired}"/>
                                    <p:message for="@previous"/>
                                </div>
                            </div>
                            <div class="col-md-4">
                                <img class="d-block w-100 h-auto m-auto profile-picture" src="${learnwebBean.getProfileImage(profileBean.selectedUser)}"
                                     alt="Profile image" style="max-width:10rem;"/>

                                <div class="form-group text-center">
                                    <p:outputLabel for="@next" value="#{msg.photo}"/>
                                    <p:fileUpload id="profilephoto" fileUploadListener="${profileBean.handleFileUpload}" styleClass="fileupload-minimal"
                                                  mode="advanced" skinSimple="true" allowTypes="/(\.|\/)(gif|jpe?g|png)$/" sizeLimit="10485760"
                                                  update=":growl profile_image" auto="true" label="#{msg.choose_file}" cancelLabel="abb"
                                                  disabled="#{profileBean.anonymizeUsername}"/>
                                    <p:message for="@previous"/>
                                </div>
                            </div>
                        </div>
                        <div>
                            <div class="form-group">
                                <p:outputLabel for="@next" value="#{msg.gender}:"/>
                                <p:selectOneMenu id="usergender" value="#{profileBean.gender}" >
                                    <f:selectItem id="g0" itemLabel="--" itemValue="0"/>
                                    <f:selectItem id="g1" itemLabel="#{msg.gender_male}" itemValue="1"/>
                                    <f:selectItem id="g2" itemLabel="#{msg.gender_female}" itemValue="2"/>
                                </p:selectOneMenu>
                                <p:message for="@previous"/>
                            </div>

                            <div class="form-group">
                                <p:outputLabel for="@next" value="#{msg.student_id}:"/>
                                <p:inputText id="studentId" value="#{profileBean.studentId}" label="#{msg.student_id}:" required="#{profileBean.studentIdRequired}"/>
                                <p:message for="@previous"/>
                            </div>

                            <h:panelGroup layout="block" styleClass="form-group" rendered="#{profileBean.studentIdRequired}">
                                <p:outputLabel value="#{msg.consent}:"/>
                                <p:selectBooleanCheckbox id="accept_terms" value="#{profileBean.acceptTermsAndConditions}" label="#{msg.consent}"
                                                         itemLabel="I've given consent to use my data for the project" validator="#{profileBean.validateConsent}"/>
                                <p:message for="@previous"/>
                            </h:panelGroup>

                            <div class="form-group">
                                <p:outputLabel for="@next" value="#{msg.affiliation}:"/>
                                <p:inputText id="useraffiliation" value="#{profileBean.affiliation}" required="#{profileBean.affiliationRequired}"/>
                                <p:message for="@previous"/>
                            </div>

                            <div class="form-group">
                                <p:outputLabel for="@next" value="#{msg.address}:"/>
                                <p:inputTextarea id="useraddress" value="#{profileBean.address}"/>
                                <p:message for="@previous"/>
                            </div>

                            <div class="form-group">
                                <p:outputLabel for="@next" value="#{msg.profession}:"/>
                                <p:inputText id="userprofession" value="#{profileBean.profession}"/>
                                <p:message for="@previous"/>
                            </div>

                            <div class="form-group">
                                <p:outputLabel for="@next" value="#{msg.interest}:"/>
                                <p:inputTextarea id="userinterest" value="#{profileBean.interest}"/>
                                <p:message for="@previous"/>
                            </div>

                            <h:panelGroup layout="block" styleClass="form-group" rendered="false">
                                <p:outputLabel for="@next"  value="#{msg.dateofbirth}:"/>
                                <p:calendar id="userdateofbirth" value="#{profileBean.dateOfBirth}" navigator="true" locale="de"
                                            maxdate="#{profileBean.maxBirthday}" inputStyleClass="w-100"/>
                                <p:message for="@previous"/>
                            </h:panelGroup>

                            <h:panelGroup layout="block" styleClass="form-group" rendered="#{profileBean.moderatorAccess}">
                                <p:outputLabel for="@next" value="#{msg.additionalinformation}:"/>
                                <p:inputTextarea id="useradditionalinformation" value="#{profileBean.additionalInformation}"/>
                                <p:message for="@previous"/>
                            </h:panelGroup>

                            <h:panelGroup layout="block" styleClass="form-group" rendered="#{profileBean.moderatorAccess}">
                                <p:outputLabel for="@next" value="#{msg.awards}:"/>
                                <p:editor id="usercredits" value="#{profileBean.credits}" height="80" controls="bold italic underline undo redo"/>
                                <p:message for="@previous"/>
                            </h:panelGroup>

                            <p:commandButton actionListener="#{profileBean.onSaveProfile}" value="#{msg.save}"
                                             process="@form" update=":growl @form :profile_news"/>
                        </div>
                    </h:panelGroup>
                </h:form>
            </p:panel>

            <p:panel header="#{msg.awards}" rendered="#{not empty profileBean.selectedUser.credits}" styleClass="mb-3">
                <h:outputText value="#{profileBean.selectedUser.credits}" escape="false"/>
            </p:panel>

            <p:panel header="#{msg.change_password}" styleClass="mb-3">
                <h:form id="passwordform">
                    <div class="form-group">
                        <p:outputLabel for="@next" value="#{msg.current_password}:"/>
                        <p:password id="current_password" value="#{profileBean.currentPassword}"
                                    validator="#{profileBean.validateCurrentPassword}" autocomplete="off" required="#{!userBean.admin}"/>
                        <p:message for="@previous"/>
                    </div>

                    <div class="form-group">
                        <p:outputLabel for="@next" value="#{msg.new_password}:"/>
                        <p:password id="password" value="#{profileBean.password}" promptLabel="#{msg.passwordStrength_prompt}"
                                    weakLabel="#{msg.passwordStrength_weak}" goodLabel="#{msg.passwordStrength_good}" strongLabel="#{msg.passwordStrength_strong}"
                                    autocomplete="off" required="true"/>
                        <p:message for="@previous"/>
                    </div>

                    <div class="form-group">
                        <p:outputLabel for="@next" value="#{msg.confirm_password}:"/>
                        <p:password id="confirm_password" value="#{profileBean.confirmPassword}" validator="#{profileBean.validatePassword}" promptLabel="#{msg.passwordStrength_prompt}"
                                    strongLabel="#{msg.passwordStrength_strong}" weakLabel="#{msg.passwordStrength_weak}" goodLabel="#{msg.passwordStrength_good}"
                                    autocomplete="off" required="true"/>
                        <p:message for="@previous"/>
                    </div>

                    <p:commandButton actionListener="#{profileBean.onChangePassword}" value="#{msg.save}"
                                     process="@form" update=":growl @form"/>
                </h:form>
            </p:panel>

            <p:panel header="#{msg.miscellaneous}" styleClass="mb-3">
                <h:form id="deleteform">
                    <p:commandButton action="#{profileBean.onDeleteAccountSoft}" value="#{msg['user.account.deleteSoft.button']}">
                        <p:confirm message="#{msg['user.account.deleteSoft.confirmDescription']}" escape="false"/>
                    </p:commandButton>
                </h:form>
            </p:panel>
        </div>
    </div>
</ui:define>

</ui:composition>
