<ui:composition template="/WEB-INF/templates/layout/template-public.xhtml"
                xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
                xmlns:h="http://xmlns.jcp.org/jsf/html"
                xmlns:f="http://xmlns.jcp.org/jsf/core"
                xmlns:p="http://primefaces.org/ui">

<ui:param name="pageTitle" value="Webgazer Calibration"/>
<ui:param name="hasAccessPermission" value="true"/>
<ui:param name="hideBreadcrumbs" value="true"/>

<ui:define name="header_right">
    <li class="nav-item" id="webgazerAccuracy"><a class="nav-link">Not yet Calibrated</a></li>
    <li class="nav-item">
        <a class="nav-link" onclick="calibrate.restart();return false;">Recalibrate</a>
    </li>
    <li class="nav-item">
        <a class="nav-link" onclick="calibrate.toggleKarmaFilter();return false;">Toggle Kalman Filter</a>
    </li>
    <li class="nav-item">
        <a class="nav-link" onclick="PF('helpDialog').show();">Help</a>
    </li>
</ui:define>

<ui:define name="center_layout">
    <h:outputScript library="learnweb" name="js/webgazer.js" target="body"/>
    <script src="https://learnweb.l3s.uni-hannover.de/tracker/js/webgazer.js"/>

    <canvas id="plotting_canvas" width="500" height="500" style="cursor:crosshair;"></canvas>

    <div class="calibration-area collapse">
        <input type="button" class="calibration-point" id="pt1"></input>
        <input type="button" class="calibration-point" id="pt2"></input>
        <input type="button" class="calibration-point" id="pt3"></input>
        <input type="button" class="calibration-point" id="pt4"></input>
        <input type="button" class="calibration-point" id="pt5"></input>
        <input type="button" class="calibration-point" id="pt6"></input>
        <input type="button" class="calibration-point" id="pt7"></input>
        <input type="button" class="calibration-point" id="pt8"></input>
        <input type="button" class="calibration-point" id="pt9"></input>
    </div>

    <p:dialog widgetVar="helpDialog" header="Help" showEffect="fade" visible="true"
              modal="true" resizable="false" draggable="false" responsive="true" closeOnEscape="true">
        <h:graphicImage library="images" name="calibration.png" alt="webgazer demo instructions" width="100%" height="100%"/>
    </p:dialog>

    <p:dialog widgetVar="calibrationDialog" header="Calibration" showEffect="fade"
              modal="true" resizable="false" draggable="false" responsive="true" closeOnEscape="true">
        <p class="mb-0">Please click on each of the 9 points on the screen. You must click on each point 5 times till it goes yellow. This will calibrate your eye movements.</p>
        <f:facet name="footer">
            <p:commandButton type="button" value="Confirm" onclick="PF('calibrationDialog').hide();calibrate.showCalibrationPoint();" />
        </f:facet>
    </p:dialog>

    <p:dialog widgetVar="measurementDialog" header="Calculating measurement" showEffect="fade"
              modal="true" resizable="false" draggable="false" responsive="true" closeOnEscape="false">
        <p class="mb-0">Please don't move your mouse and stare at the middle dot for the next 5 seconds. This will allow us to calculate the accuracy of our predictions.</p>
        <f:facet name="footer">
            <p:commandButton type="button" value="Confirm" onclick="PF('measurementDialog').hide();calibrate.calculateMeasurements();" />
        </f:facet>
    </p:dialog>

    <p:dialog widgetVar="measurementResultsDialog" header="Measurement results" showEffect="fade"
              modal="true" resizable="false" draggable="false" responsive="true" closeOnEscape="false">
        <p class="mb-0">Your accuracy measure is <span id="precision_measurement">(not yet known)</span>%</p>
        <f:facet name="footer">
            <p:commandButton type="button" value="Recalibrate" onclick="PF('measurementResultsDialog').hide();calibrate.recalibrate();" />
            <p:commandButton type="button" value="Confirm" onclick="PF('measurementResultsDialog').hide();calibrate.clearCanvas();" />
        </f:facet>
    </p:dialog>
</ui:define>

</ui:composition>
