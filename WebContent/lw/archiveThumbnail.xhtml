<ui:composition template="/templates/main/main.xhtml" 
xmlns:ui="http://java.sun.com/jsf/facelets" 
	xmlns:h="http://java.sun.com/jsf/html" 
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:p="http://primefaces.org/ui"
	xmlns:pe="http://primefaces.org/ui/extensions"
	lang="#{userBean.localeCode}">

	<ui:define name="metadata">
		<f:metadata>
			<f:viewParam name="resource_id" value ="#{archiveThumbnailBean.resourceId}" />
			<f:event type="preRenderView" listener="#{archiveThumbnailBean.init}"/>
		</f:metadata>
	</ui:define>

	<ui:param name="pageTitle" value="Archive Thumbnail Visualization" />

	<ui:define name="center_layout">
		<script>
			var cf;
			function loadCF(){
				cf = new ContentFlow('contentFlow', {reflectionColor: "#000000", circularFlow: false, startItem: 'visible', reflectionHeight: 0.3, maxItemHeight:450});
				cf._init();
			}
			$(document).ready(function(){
				loadCF();
			});
		</script>	

		<h:outputScript name="archive-thumbnail/contentflow.js" target="head" />
		<link rel="stylesheet" type="text/css" href="#{request.contextPath}/resources/archive-thumbnail/mycontentflow.css" />
		<link rel="stylesheet" type="text/css" href="#{request.contextPath}/resources/archive-thumbnail/styles.css" />
    	
    	<h:panelGroup id="maincontent"  layout="block">
    		
    		<h:panelGroup id="contentFlow" styleClass="ContentFlow" layout="block">
            	<div class="loadIndicator"><div class="indicator"></div></div>
            	<div class="flow">
                	<ui:repeat var="image" value="#{archiveThumbnailBean.listOfUrls}">
                      <div class="item">
                      <h:graphicImage value="#{image.fileUrl}" class="content" alt=""/>
                      <div class="caption">#{msg.date}: <a href="#{image.archiveUrl}" target="_blank">${userBean.formatDate(image.timestamp)}</a></div>
                      </div>
                	</ui:repeat>
            	</div>
            	<div class="globalCaption"></div>
        	</h:panelGroup>
        
        	<pe:timeline id="timeline" styleClass="timeline"
                     value="#{archiveThumbnailBean.model}"  
                     min="#{archiveThumbnailBean.min}"  
                     max="#{archiveThumbnailBean.max}"  
                     zoomMin="#{archiveThumbnailBean.zoomMin}"  
                     zoomMax="#{archiveThumbnailBean.zoomMax}"
                     zoomable="true"
                     movable="true"
                     axisOnTop="true" 
                     height="227px" showNavigation="false" widgetVar="tmlnbar">
        		<pe:javascript event="select" execute="timelinecall()"/> 
        	</pe:timeline>
        	<script>
		        function timelinecall()
		        {
		            //$('#'+PF('tmlnbar').getSelectedEvent().content);
		            cf.moveTo(PF('tmlnbar').getSelectedIndex());
		        }
        	</script>
        </h:panelGroup>      
        
        <div class="timeSlider">
			<h:form prependId="false" styleClass="timeGridSlider">

				<div id="slideA" class="slideA" style="margin-top: 10px;"></div>
				<script>
					$(function() {
						$("#slideA").slider({
							range : "min",
							step : 0.05,
							value : 1,
							min : 0,
							max : 1,
							slide : function(event, ui) {
								$("#input_frame").val(ui.value);
							}
						});
						$("#input_frame").val($("#slideA").slider("value"));
					});
				</script>
				<h:outputLabel styleClass="textInputLabel" for="input_frame" value="Frame Slider(increments of 0.05):" />
				<p:inputText id="input_frame" value="#{archiveThumbnailBean.frameSim}" styleClass="textInput">
					<f:convertNumber minFractionDigits="2" />
				</p:inputText>

				<div id="slideB" class="slideA"></div>
				<script>
		            $(function() {
		                $("#slideB").slider({
		                    range: "min",
		                    step: 0.05,
		                    value: 1,
		                    min: 0,
		                    max: 1,
		                    slide: function(event, ui) {
		                        $("#input_text").val(ui.value);
		                    } 
		                });
		                $("#input_text").val($("#slideB").slider("value"));
		            });
          		</script>

				<h:outputLabel styleClass="textInputLabel" for="input_text" value="Text Slider (increments of 0.05):" />
				<p:inputText id="input_text" value="#{archiveThumbnailBean.textSim}" styleClass="textInput">
					<f:convertNumber minFractionDigits="2" />
				</p:inputText>
				<div class="clear"></div>
				<p:commandButton id="process" styleClass="greenbutton" value="Submit" title="Press to refresh the Coverflow" update=":maincontent :timeline" oncomplete="loadCF()" />
			</h:form>
		</div>
	</ui:define>
</ui:composition>