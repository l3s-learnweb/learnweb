<ui:composition xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
	xmlns:h="http://xmlns.jcp.org/jsf/html"
	xmlns:f="http://xmlns.jcp.org/jsf/core"
	xmlns:p="http://primefaces.org/ui"
	xmlns:pt="http://xmlns.jcp.org/jsf/passthrough">

	<ui:repeat var="submission" value="#{submissions}">
		<h:panelGroup layout="block" class="submission_card">
		<div class="submission_card_details">
			<div class="submission_details">
				<h2>
					<b>#{submission.title} </b>
					<h:form style="display:inline;">
						<p:commandLink style="text-decoration:none;" title="#{msg.edit}" rendered="#{(userBean.admin || userBean.moderator) and not submissionBean.submissionOverviewReadOnly}"
							process="@this" oncomplete="PF('submission_edit_dialog').show();toggleSurveySelectField(editSurveyCheckBox.input.is(':checked'), 'edit');" update=":edit_submission_dialog1">
							<f:setPropertyActionListener target="#{submissionBean.selectedSubmission}" value="#{submission}" />
							<h:graphicImage value="/resources/icon/silk/pencil.png" width="16" height="16" alt="#{msg.edit}" />
						</p:commandLink>
						<p:commandLink style="text-decoration:none;" title="unlock submission" rendered="#{(userBean.admin || userBean.moderator) and submissionBean.submissionOverviewReadOnly and submission.currentSubmission and submission.submitted}"
							process="@this" update=":current_submissions" action="#{submissionBean.unlockSubmission}" oncomplete="addSubmissionHeaderClickHandler();clickCurrentSubmissions();setScrollPos();" onstart="saveScrollPos(event);">
							<f:setPropertyActionListener target="#{submissionBean.selectedSubmission}" value="#{submission}" />
							<h:graphicImage value="/resources/icon/lock.png" width="16" height="16" alt="#{msg.edit}" />
						</p:commandLink>
						<p:commandLink style="text-decoration:none;" title="lock submission" rendered="#{(userBean.admin || userBean.moderator) and submissionBean.submissionOverviewReadOnly and submission.currentSubmission and not submission.submitted and not empty submission.submittedResources}"
							process="@this" update=":current_submissions" action="#{submissionBean.lockSubmission}" oncomplete="addSubmissionHeaderClickHandler();clickCurrentSubmissions();">
							<f:setPropertyActionListener target="#{submissionBean.selectedSubmission}" value="#{submission}" />
							<h:graphicImage value="/resources/icon/unlock.png" width="16" height="16" alt="#{msg.edit}" />
						</p:commandLink>
					</h:form>
				</h2>
				<span class="submission_description">#{submission.description}</span>
			</div>
			<div class="submission_time_block">
				<table style="position: relative; float: right;">
					<tr>
						<td><span style="font-weight: bold;">#{msg['Submission.open_date']}: </span></td>
						<td>
							<h:outputText value="#{submission.openDatetime}">
								<f:convertDateTime dateStyle="long" type="both" timeZone="#{userBean.timeZone}"/>
							</h:outputText>
						</td>
					</tr>
					<tr>
						<td><span style="font-weight: bold;">#{msg['Submission.close_date']}: </span></td>
						<td>
							<h:outputText value="#{submission.closeDatetime}">
								<f:convertDateTime dateStyle="long" type="both" timeZone="#{userBean.timeZone}"/>
							</h:outputText>
						</td>
					</tr>
					<tr>
						<td><span style="font-weight: bold;">Course: </span></td>
						<td>
							<h:outputText value="#{submission.course.title}" />
						</td>
					</tr>
				</table>
			</div>
			<div>
				<h:outputLink styleClass="greenbutton submission_link"
					value="myhome/submission_resources.jsf"
					rendered="#{submission.pastSubmission and (not userBean.moderator || submissionBean.submissionOverviewReadOnly)}">
					<f:param name="submission_id" value="#{submission.id}" />
					<f:param name="user_id" value="#{submissionBean.userId}" />
					#{msg['Submission.view_submission']}
				</h:outputLink>
				<h:outputLink styleClass="greenbutton submission_link"
					value="myhome/submission_resources.jsf"
					rendered="#{submission.currentSubmission and submission.isSurveySubmitted(userBean.user.id) and not submissionBean.submissionOverviewReadOnly}">
					<f:param name="submission_id" value="#{submission.id}" />
					<f:param name="user_id" value="#{submissionBean.userId}" />
					#{msg['Submission.submit_resources']}
				</h:outputLink>
				<h:outputLink  style="text-decoration: underline;" styleClass="submission_link"
					value="../templates/resources/survey.jsf"
					rendered="#{submission.currentSubmission and not submission.isSurveySubmitted(userBean.user.id) and not submissionBean.submissionOverviewReadOnly}">
					<f:param name="resource_id" value="#{submission.surveyResourceId}" />
					<h:outputText class="survey_submit_message" value="Please submit the survey first"/>
				</h:outputLink>
				
				<h:outputLink styleClass="greenbutton submission_link"
					value="myhome/submission_resources.jsf"
					rendered="#{submission.currentSubmission and userBean.moderator and submissionBean.submissionOverviewReadOnly}">
					<f:param name="submission_id" value="#{submission.id}" />
					<f:param name="user_id" value="#{submissionBean.userId}" />
					#{msg['Submission.view_submission']}
				</h:outputLink>
				
				
				<h:outputLink styleClass="greenbutton submission_link"
					value="myhome/submission_moderator.jsf"
					rendered="#{userBean.moderator}">
					<f:param name="submission_id" value="#{submission.id}" />
					#{msg['Submission.view_user_submissions']}
				</h:outputLink>
			</div>
		</div>
		<h:panelGroup class="submission_card_resources" layout="block" rendered="#{not empty submission.submittedResources}">
			<hr/>
			<h:panelGroup layout="block" styleClass="datagrid not-selectable" pt:data-isEnabledMoving="false">
				<h:panelGroup styleClass="resource-grid" layout="block" style="margin-bottom:0px;">
						<ui:repeat var="res" value="#{submission.submittedResources}" >
		
							<h:panelGroup styleClass="resource-item group-resources-item" pt:data-itemType="resource" pt:data-itemId="#{res.id}" layout="block">
								<div class="resource-block">
		
									<div class="resource-preview">
										<div class="resource-preview-wrapper">
											<div class="resource-preview-wrapper2">
												<div class="resource-preview-block"></div>
												<img class="resource-preview-image" src="#{res.thumbnail1.url}" alt="#{res.title}" />
											</div>
										</div>
									</div>
		
									<div class="resource-title">
										<div class="resource-title-wrapper">
											<div class="resource-title-text">
												<h:outputText value="#{res.title}" escape="false" styleClass="resource-title-name" title="#{res.title}" />
												<span class="resource-title-summary"><span>#{utilBean.getLocaleMessage(res.type)}</span> #{msg.added_by} <span>#{res.getOwnerUser().username}</span></span>
											</div>
										</div>
									</div>
		
								</div>
							</h:panelGroup>
						</ui:repeat>
				</h:panelGroup>
			</h:panelGroup>
			
		</h:panelGroup>
		</h:panelGroup>
	</ui:repeat>
</ui:composition>