<ui:composition template="/WEB-INF/templates/layout/template.xhtml"
				xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
				xmlns:h="http://xmlns.jcp.org/jsf/html"
				xmlns:f="http://xmlns.jcp.org/jsf/core"
				xmlns:p="http://primefaces.org/ui">

<ui:define name="metadata">
	<f:metadata>
		<f:viewParam name="resource_id" value ="#{tedTranscriptBean.resourceId}" />
		<f:viewAction action="#{tedTranscriptBean.preRenderView}"/>
	</f:metadata>
</ui:define>

<ui:param name="loginRequired" value="true" />
<ui:param name="pageTitle" value="#{msg.tedTranscriptTitle}" />
<ui:param name="helpText" value="#{msg.tedTranscriptHelp}"/>
<ui:param name="helpTextStyle" value="tedtranscript_help" />
<ui:define name="sub_breadcrumb">
	<p:menuitem value="#{msg.tedTranscriptTitle}" url=""/>
</ui:define>
<ui:define name="center_layout">
	<div class="mt-3 row section-ted-transcript">
			<h:form class="display-none" id="command_form">
				<p:remoteCommand partialSubmit="true" immediate="true" actionListener="${tedTranscriptBean.processActionSetSynonyms()}" name="setSynonymsForWord" process="@this" oncomplete="setSynonyms(xhr,status,args);" async="false"/>
				<p:remoteCommand partialSubmit="true" immediate="true" actionListener="${tedTranscriptBean.processActionSaveResource()}" name="saveTedResource" process="@this" update=":growl" />
				<p:remoteCommand partialSubmit="true" immediate="true" actionListener="${tedTranscriptBean.processActionSubmitResource()}" name="submitTedResource" process="@this" update=":growl :transcript :transcript_options" />
				<p:remoteCommand partialSubmit="true" immediate="true" actionListener="${tedTranscriptBean.processActionSaveLog()}" name="saveTranscriptLog" process="@this" update="@none" />
			</h:form>

			<h:outputStylesheet name="vendor/jquery-ui-v1.12.1/jquery-ui.min.js" />
			<h:outputStylesheet name="vendor/contextMenu-v2.7.0/jquery.contextMenu.min.css" />
			<h:outputScript name="vendor/contextMenu-v2.7.0/jquery.contextMenu.min.js" />

			<h:outputStylesheet name="vendor/spectrum-v1.8.0/spectrum.css" />
			<h:outputScript name="vendor/spectrum-v1.8.0/spectrum.js" />

			<h:outputScript library="ted-transcript" name="ted-transcript.js" target="head"/>

			<script type="text/javascript">
				var noteId = #{tedTranscriptBean.noteId};
				var readOnly = #{tedTranscriptBean.tedResource.readOnlyTranscript};
			</script>

			<div id="ted_content" class="col">
				<div class="embed-responsive embed-responsive-1by1" style="position: fixed; width: 43%;"   id="ted_embedded" >
					<!-- ${tedTranscriptBean.tedResource.embedded} -->
				</div>
			</div>
			<div class="col" style="">
				<h:panelGroup layout="block" id="transcript_column"  class="right_bar">
					<p:outputPanel id="transcript_options">
						<div class="center-header noselect">
							<h:form>
								<p:outputLabel for="select_lang" styleClass="mr-2" value="#{msg.select_transcript_lang}:" />
								<h:selectOneMenu id="select_lang" styleClass="mr-2" value="#{tedTranscriptBean.transcriptLanguage}" >
									<f:selectItem itemValue="----------------------------"/>
									<f:selectItems value="#{tedTranscriptBean.getLanguageList()}"/>
									<p:ajax listener="#{tedTranscriptBean.setTranscript}" update=":transcript" oncomplete="clearTagList();"/>
								</h:selectOneMenu>
								<p:commandButton id="save" styleClass="mr-2" value="#{msg.save}" onclick="saveEditing();" rendered="#{tedTranscriptBean.tedResource.canEditResource(userBean.user)}" disabled="#{tedTranscriptBean.tedResource.readOnlyTranscript}"/>
								<p:tooltip id="toolTipSave" for="save" value="#{msg.save_tooltip}" position="left"/>
								<p:commandButton id="submit"  value="#{msg.submit}" onclick="submitTranscript();" disabled="#{tedTranscriptBean.tedResource.readOnlyTranscript}" rendered="#{tedTranscriptBean.tedResource.canEditResource(userBean.user)}"/>
								<p:tooltip id="toolTipSubmit" for="submit" value="#{msg.submit_tooltip}" position="left"/>
								<!-- <p:commandButton styleClass="button_position greenbutton" value="#{msg.show_tags}" onclick="openTagsDiv();"/> -->

								<p:menuButton value="#{msg.options}" iconPos="right"  rendered="#{tedTranscriptBean.tedResource.canEditResource(userBean.user)}">
									<p:menuitem value="#{msg.show_summary}" icon="ui-icon-circle-triangle-w" onclick="openTagsDiv();selectTab('summary');">
									</p:menuitem>
									<p:menuitem value="#{msg.show_tags}" icon="ui-icon-circle-triangle-w" onclick="openTagsDiv();selectTab('tags');">
									</p:menuitem>
									<p:menuitem value="Disable Editing" icon="ui-icon-pencil" rendered="#{!tedTranscriptBean.tedResource.readOnlyTranscript and userBean.moderator}" update=":transcript :transcript_options">
										<f:setPropertyActionListener value="true" target="#{tedTranscriptBean.tedResource.readOnlyTranscript}"/>
									</p:menuitem>
									<p:menuitem value="Enable Editing" icon="ui-icon-pencil" rendered="#{tedTranscriptBean.tedResource.readOnlyTranscript and userBean.moderator}" update=":transcript :transcript_options">
										<f:setPropertyActionListener value="false" target="#{tedTranscriptBean.tedResource.readOnlyTranscript}"/>
									</p:menuitem>
								</p:menuButton>
							</h:form>
						</div>
						<div class="transcript_note noselect">
							<b>Owner of transcript: </b><h:outputText value="#{tedTranscriptBean.tedResource.ownerUser.username}"/><br/>
							<b>#{msg.note}:</b><h:outputText value = " #{msg.transcript_warning}" rendered="${!tedTranscriptBean.tedResource.canEditResource(userBean.user)}"/>
							<h:outputText value = " #{msg.transcript_submit_message}" rendered="#{tedTranscriptBean.tedResource.readOnlyTranscript}" style="color:red"/>
							<h:outputText value = " #{msg.transcript_note}" rendered="${tedTranscriptBean.tedResource.canEditResource(userBean.user) and !tedTranscriptBean.tedResource.readOnlyTranscript}"/>
						</div>
					</p:outputPanel>
					<h:panelGroup layout="block" id="transcript">
						<h:panelGroup layout="block" onmouseup="noteSelectedText();" id="ted_transcript" class="tedTranscript" rendered="${tedTranscriptBean.tedResource.canEditResource(userBean.user) and !tedTranscriptBean.tedResource.readOnlyTranscript}">
							<h:outputText value="#{tedTranscriptBean.tedResource.transcript}"  escape="false"/>
						</h:panelGroup>
						<h:panelGroup layout="block" class="tedTranscript" rendered="${!tedTranscriptBean.tedResource.canEditResource(userBean.user) or tedTranscriptBean.tedResource.readOnlyTranscript}">
							<h:outputText value="#{tedTranscriptBean.tedResource.transcript}" escape="false"/>
						</h:panelGroup>
					</h:panelGroup>
				</h:panelGroup>

				<!-- User Annotation Div-->
				<div id="myNav" class="overlay">
					<a href="javascript:void(0)" class="closebtn" onclick="closeTagsDiv()"></a>
					<ul class="tab row flex-nowrap mr-2">
						<li class="col"><a href="javascript:void(0)" id="tags_button" class="tablinks" onclick="openTab(event, 'tags')"><h:outputText value="#{msg.tags}"/></a></li>
						<li class="col"><a href="javascript:void(0)" id="summary_button" class="tablinks" onclick="openTab(event, 'summary')"><h:outputText value="#{msg.summary}"/></a></li>
					</ul>
					<div id="tags" class="overlay-content">
						<ol id="selectable">
						</ol>
					</div>
					<div id="summary" class="overlay-content mt-2" style="display:none">
						<h:form prependId="false" styleClass="mb-2">
							<h:outputText value="#{msg.brief_summary}"/>
							<p:inputTextarea id="textarea_s" counter="char_s" maxlength="600" counterTemplate="{0} characters remaining" autoResize="false" value="#{tedTranscriptBean.summaryTextS}" /><br/>
							<h:outputText id="char_s" /><br/>
							<p:commandButton value="#{msg.submit}" action="#{tedTranscriptBean.submitShortSummary()}"/>
						</h:form>
						<h:form prependId="false" styleClass="mb-2">
							<h:outputText value="#{msg.long_summary}"/>
							<p:inputTextarea id="textarea_m" counter="char_m" maxlength="1500" counterTemplate="{0} characters remaining" autoResize="false" value="#{tedTranscriptBean.summaryTextM}"/><br/>
							<h:outputText id="char_m" /><br/>
							<p:commandButton value="#{msg.submit}" action="#{tedTranscriptBean.submitLongSummary()}"/>
						</h:form>
						<h:form prependId="false" styleClass="mb-2">
							<h:outputText value="#{msg.detailed_summary}"/>
							<p:inputTextarea id="textarea_l" counter="char_l" maxlength="2500" counterTemplate="{0} characters remaining" autoResize="false" value="#{tedTranscriptBean.summaryTextL}"/><br/>
							<h:outputText id="char_l" /><br/>
							<p:commandButton value="#{msg.submit}" action="#{tedTranscriptBean.submitDetailedSummary()}"/>
						</h:form>
					</div>
				</div>
			</div>

			<p:dialog widgetVar="userinput_dialog" modal="true" header="#{msg.userAnnotation}" minWidth="600" resizable="false" closable="false" appendTo="@(body)">
				<h:form id="userinput_form" prependId="false">
					<h:outputLabel value="#{msg.justify_selection}:" for="text"/>
					<p:inputText id="text" style="width:97%;"/>
					<p:commandButton id="userinput_ok" value="Ok" onclick="getUserText('ok');return false;"></p:commandButton>
					<p:commandButton id="userinput_cancel" value="#{msg.cancel}" onclick="getUserText('cancel');return false;"></p:commandButton>
				</h:form>
			</p:dialog>

	</div>
</ui:define>

</ui:composition>
