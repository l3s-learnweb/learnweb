<ui:composition
		template="/WEB-INF/templates/layout/template.xhtml"
		xmlns="http://www.w3.org/1999/xhtml"
		xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
		xmlns:h="http://xmlns.jcp.org/jsf/html"
		xmlns:f="http://xmlns.jcp.org/jsf/core"
		xmlns:c="http://xmlns.jcp.org/jsp/jstl/core"
		xmlns:p="http://primefaces.org/ui">

	<ui:define name="metadata">
		<f:metadata>
			<f:viewParam name="course_id" value="#{adminCourseBean.courseId}" />
		</f:metadata>
	</ui:define>
	
	<ui:param name="loginRequired" value="true"/>
	<ui:param name="pageTitle" value="#{adminCourseBean.course.title}" />

	<ui:define name="sub_breadcrumb">
		<p:menuitem value="#{msg.courses}" url="admin/courses.jsf" />
		<p:menuitem value="#{adminCourseBean.course.title}" url="admin/course.jsf?course_id=#{adminCourseBean.course.id}" />
	</ui:define>
		
	<ui:define name="center_layout">
		<h:form id="editwelcomeform"  prependId="false" styleClass="form">
			<div class="row">
				<div class="col-12">
					<p:panel header="#{msg.welcome_message}">
						<!-- a dirty fix. we should check old message and remove tables -->
						<p:textEditor height="400" value="#{adminCourseBean.course.welcomeMessage}" rendered="${!adminCourseBean.course.welcomeMessage.contains('table')}">
							<f:facet name="toolbar">
								<span class="ql-formats">
									<select class="ql-font"></select>
									<select class="ql-size"></select>
								</span>
									<span class="ql-formats">
									<button class="ql-bold"></button>
									<button class="ql-italic"></button>
									<button class="ql-underline"></button>
									<button class="ql-strike"></button>
									<button class="ql-link"></button>
								</span>
							</f:facet>
						</p:textEditor>
					</p:panel>
				</div>

				<div class="col-12 mt-3">
					<div class="row">
						<div class="col">
							<p:panel header="Common settings">
								<div class="form-group">
									<p:outputLabel for="@next" value="#{msg.title}:"/>
									<p:inputText id="c_title" value="#{adminCourseBean.course.title}">
										<p:ajax update="message_c_title"/>
									</p:inputText>
									<p:message for="@previous"/>
								</div>

								<div class="form-group">
									<p:outputLabel for="@next" value="Wizard Parameter:"/>
									<p:inputText id="c_param" value="#{adminCourseBean.course.wizardParam}">
										<p:ajax update="message_c_param"/>
									</p:inputText>
									<p:message for="@previous"/>
								</div>

								<h:panelGroup layout="block" styleClass="form-group" rendered="#{userBean.admin}">
									<p:outputLabel for="@next" value="#{msg.organization}:"/>
									<p:selectOneMenu id="c_organisation" value="#{adminCourseBean.course.organisationId}">
										<f:selectItem itemLabel="No organisation" itemValue="0" />
										<f:selectItem itemLabel="------------" itemValue="-1" itemDisabled="true" />
										<f:selectItems var="org" value="#{adminCourseBean.organisations}" itemLabel="#{org.title}" itemValue="#{org.id}"/>
									</p:selectOneMenu>
									<p:message for="@previous"/>
								</h:panelGroup>

								<h:panelGroup layout="block" styleClass="form-group" rendered="#{userBean.admin}">
									<p:outputLabel for="@next" value="Default group:"/>
									<p:selectOneMenu id="c_group" value="#{adminCourseBean.course.defaultGroupId}">
										<f:selectItem itemLabel="No default group" itemValue="0" />
										<f:selectItem itemLabel="------------" itemValue="-1" itemDisabled="true" />
										<f:selectItems var="group" value="#{adminCourseBean.course.groups}" itemLabel="#{group.title}" itemValue="#{group.id}"/>
									</p:selectOneMenu>
									<p:message for="@previous"/>
								</h:panelGroup>
							</p:panel>
						</div>

						<div class="col">
							<p:panel header="Additional settings">
                                <p:accordionPanel autoHeight="false" id="courseoptions">
                                    <c:forEach items="#{adminCourseBean.optionGroups}" var="group" varStatus="status">
                                        <p:tab title="#{adminCourseBean.optionGroups[status.index].title}">
                                            <p:repeat value="#{adminCourseBean.optionGroups[status.index].options}" var="option">
												<div class="form-group">
                                                    <p:selectBooleanCheckbox value="#{option.value}" itemLabel="#{option.name}" id="checkbox"/>
												</div>
                                            </p:repeat>
                                        </p:tab>
                                    </c:forEach>
                                </p:accordionPanel>

                                <p>#{msg.changes_login_again}</p>
                            </p:panel>
						</div>
					</div>
				</div>

				<div class="col-12 my-4">
					<p:commandButton styleass="my-4" actionListener="#{adminCourseBean.save}" value="#{msg.save}" update=":growl :courseoptions">
						<f:param name="course_id" value="#{adminCourseBean.courseId}" />
					</p:commandButton>
				</div>
			</div>
		</h:form>
	</ui:define>
</ui:composition>