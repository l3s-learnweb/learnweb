<ui:composition 
	template="/templates/main/main.xhtml" 
	xmlns="http://www.w3.org/1999/xhtml" 
	xmlns:ui="http://java.sun.com/jsf/facelets" 
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:f="http://java.sun.com/jsf/core" 
	xmlns:p="http://primefaces.org/ui">

	<ui:param name="loginRequired" value="true" />
	<ui:param name="pageTitle" value="System Tools" />

	<ui:define name="center_layout">
		<h:outputText value="Missing authentication" rendered="#{not (userBean.admin || userBean.moderator)}" />

		<div class="page_header" style="margin:5px;">
			<span>
				#{msg.notification}
			</span>
		</div>			
		
		  <p:panel rendered="#{userBean.admin || userBean.moderator}" style="margin:5px;">

<h:head>
	<title>System Tools</title>
</h:head>

<h:body>
	<div>
		<h:form>
			<h2>Connection Checker</h2>
	
			Open Connection: ... Scanning ... Bibub ... Found ... There are <h:outputText value="#{adminSystemBean.databaseProcessList.size()}" /> Connections open
	
			
			
			<p:dataTable id="processTable" var="process" style="margin: 2rem;text-align: right;" value="#{adminSystemBean.databaseProcessList}" tableStyle="width: 96%;table-layout:auto" emptyMessage="no open connection" >
			
				<p:column headerText="id" sortBy="#{process.id}">
					<h:outputText value="#{process.id}"  />
				</p:column>
			
			
				<p:column headerText="#{msg.username}" sortBy="#{process.user}">
					<h:outputText value="#{process.user}" />
				</p:column>
				
				<p:column headerText="host" sortBy="#{process.host}">
					<h:outputText value="#{process.host}" />
				</p:column>
				
				<p:column headerText="db" sortBy="#{process.db}">
					<h:outputText value="#{process.db}" />
				</p:column>
				
				<p:column headerText="command" sortBy="#{process.command}">
					<h:outputText value="#{process.command}" />
				</p:column>
				
				<p:column headerText="time" sortBy="#{process.time}">
					<h:outputText value="#{process.time}" />
				</p:column>
				
				<p:column headerText="state" sortBy="#{process.state}">
					<h:outputText value="#{process.state}" />
				</p:column>
				
				<p:column headerText="#{msg.info}" sortBy="#{process.info}">
					<h:outputText value="#{process.info}" />
				</p:column>
				
				<p:column headerText="progress" sortBy="#{process.progress}">
					<h:outputText value="#{process.progress}" />
				</p:column>
				
				<p:column headerText="Terminate">
					<p:commandButton value="terminate" actionListener="#{adminSystemBean.onKillDatabaseProcess(process.id)}"/>
				</p:column>
				
				
			</p:dataTable>
		
		
		
		</h:form>
	</div>
</h:body>
</p:panel>

</ui:define>

</ui:composition> 