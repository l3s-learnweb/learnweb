<ui:composition
        template="/WEB-INF/templates/layout/template.xhtml"
        xmlns="http://www.w3.org/1999/xhtml"
        xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
        xmlns:h="http://xmlns.jcp.org/jsf/html"
        xmlns:f="http://xmlns.jcp.org/jsf/core"
        xmlns:c="http://xmlns.jcp.org/jsp/jstl/core"
        xmlns:p="http://primefaces.org/ui">

    <ui:param name="loginRequired" value="true" />
    <ui:param name="pageTitle" value="#{adminOrganisationBean.selectedOrganisation.title} - #{msg.organization}" />
    <ui:param name="disableGrowl" value="true" />

	<ui:define name="metadata">
	    <f:metadata>
	        <f:viewParam name="organisation_id" value="#{adminOrganisationBean.organisationId}" required="false" requiredMessage="Missing organisation parameter" />
	        <f:viewAction action="#{adminOrganisationBean.onLoad}" />
	    </f:metadata>
	</ui:define>

	<ui:define name="sub_breadcrumb">
		<p:menuitem value="#{msg.organization}" url="admin/organisations.jsf" />
		<p:menuitem value="#{adminOrganisationBean.selectedOrganisation.title}" url="#" />
	</ui:define>

    <ui:define name="center_layout">
        <ui:fragment rendered="#{null ne adminOrganisationBean.selectedOrganisation}">
            <h:form id="editorganizationform">
                <p:panel styleClass="mb-3" header="#{msg.welcome_message}">
                    <p:textEditor height="200" value="#{adminOrganisationBean.selectedOrganisation.welcomeMessage}">
                        <f:facet name="toolbar">
                                    <span class="ql-formats">
                                        <select class="ql-font"></select>
                                        <select class="ql-size"></select>
                                    </span>
                            <span class="ql-formats">
                                        <button class="ql-bold"></button>
                                        <button class="ql-italic"></button>
                                        <button class="ql-underline"></button>
                                        <button class="ql-strike"></button>
                                        <button class="ql-link"></button>
                                    </span>
                        </f:facet>
                    </p:textEditor>
                </p:panel>
                <div class="row s-gutters">
                    <div class="col-12 col-md-6">
                        <p:panel header="Common settings">
                            <div class="form-group">
                                <p:outputLabel for="@next" value="#{msg.title}:"/>
                                <p:inputText id="c_title" value="#{adminOrganisationBean.selectedOrganisation.title}"/>
                                <p:message for="@previous"/>
                            </div>

                            <div class="form-group">
                                <p:outputLabel for="@next" value="Banner image:"/>
                                <p:fileUpload fileUploadListener="#{adminOrganisationBean.handleFileUpload}" styleClass="fileupload-minimal" mode="simple" skinSimple="true" allowTypes="/(\.|\/)(gif|jpe?g|png)$/"  />
                                <p:message for="@previous"/>
                            </div>

                            <div class="form-group">
                                <p:outputLabel for="@next" value="Welcome Page:"/>
                                <p:selectOneMenu id="welcomePage" value="#{adminOrganisationBean.selectedOrganisation.welcomePage}" editable="true">
                                    <f:selectItem itemValue="/lw/myhome/activity.jsf" itemLabel="/lw/myhome/activity.jsf" />
                                    <f:selectItem itemValue="/lw/myhome/welcome.jsf" itemLabel="/lw/myhome/welcome.jsf" />
                                </p:selectOneMenu>
                                <p:message for="@previous"/>
                            </div>

                            <div class="form-group">
                                <p:outputLabel for="@next" value="Logout Page:"/>
                                <p:selectOneMenu value="#{adminOrganisationBean.selectedOrganisation.logoutPage}" editable="true">
                                    <f:selectItem itemValue="/lw/index.jsf" itemLabel="Learnweb index page" />
                                    <f:selectItem itemValue="/ama/index.jsf" itemLabel="AMA index page" />
                                    <f:selectItem itemValue="/aw/index.jsf" itemLabel="Archive index page" />
                                </p:selectOneMenu>
                                <p:message for="@previous"/>
                            </div>

                            <div class="form-group">
                                <p:outputLabel for="@next" value="Default language:"/>
                                <p:selectOneMenu value="#{adminOrganisationBean.selectedOrganisation.defaultLanguage}">
                                    <f:selectItem itemLabel="No default" itemValue="#{null}" />
                                    <f:selectItems value="#{adminOrganisationBean.supportedLanguages}" var="lang"
                                                   itemLabel="${msg['language_' += lang]}" itemValue="#{lang}"></f:selectItems>
                                </p:selectOneMenu>
                                <p:message for="@previous"/>
                            </div>

                            <div class="form-group">
                                <p:outputLabel for="@next" value="Language variant:"/>
                                <p:selectOneMenu value="#{adminOrganisationBean.selectedOrganisation.languageVariant}">
                                    <f:selectItem itemValue="" itemLabel="No variant" />
                                    <f:selectItems value="#{adminOrganisationBean.supportedLanguageVariants}" var="variant"
                                                   itemLabel="#{variant}" itemValue="#{variant}"></f:selectItems>
                                </p:selectOneMenu>
                                <p:message for="@previous"/>
                            </div>

                            <div class="form-group">
                                <p:outputLabel for="@next" value="Glossary languages:"/>
                                <p:selectCheckboxMenu value="#{adminOrganisationBean.selectedOrganisation.glossaryLanguages}" required="true" requiredMessage="#{msg.mandatory_field}"
                                                      label="#{msg.language}" multiple="true" converter="#{localeConverter}">
                                    <f:selectItems value="#{adminOrganisationBean.availableGlossaryLanguages}"></f:selectItems>
                                </p:selectCheckboxMenu>
                                <p:message for="@previous"/>
                            </div>

                            <p:commandButton action="#{adminOrganisationBean.onSave}" value="#{msg.save}" ajax="false" />
                        </p:panel>
                    </div>

                    <div class="col-12 col-md-6">
                        <p:panel header="Additional settings">
                            <p:accordionPanel autoHeight="false" id="courseoptions">
                                <c:forEach items="#{adminOrganisationBean.optionGroups}" var="group" varStatus="status">
                                    <p:tab title="${adminOrganisationBean.optionGroups[status.index].title}">
                                        <p:repeat value="${adminOrganisationBean.optionGroups[status.index].options}" var="option">
                                            <div class="form-group">
                                                <p:selectBooleanCheckbox value="#{option.value}" itemLabel="#{option.name}" id="checkbox"/>
                                            </div>
                                        </p:repeat>
                                    </p:tab>
                                </c:forEach>
                            </p:accordionPanel>
                        </p:panel>
                    </div>
                </div>
            </h:form>
        </ui:fragment>
    </ui:define>
</ui:composition>