<ui:composition
        template="/WEB-INF/templates/layout/template.xhtml"
        xmlns="http://www.w3.org/1999/xhtml"
        xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
        xmlns:h="http://xmlns.jcp.org/jsf/html"
        xmlns:f="http://xmlns.jcp.org/jsf/core"
        xmlns:c="http://xmlns.jcp.org/jsp/jstl/core"
        xmlns:p="http://primefaces.org/ui">

    <ui:param name="loginRequired" value="true" />
    <ui:param name="pageTitle" value="#{adminOrganisationBean.selectedOrganisation.title} - #{msg.organization}" />
    <ui:param name="disableGrowl" value="true" />

	<ui:define name="metadata">
	    <f:metadata>
	        <f:viewParam name="organisation_id" value="#{adminOrganisationBean.organisationId}" required="false" requiredMessage="Missing organisation parameter" />
	        <f:viewAction action="#{adminOrganisationBean.onLoad}" />
	    </f:metadata>
	</ui:define>

	<ui:define name="sub_breadcrumb">
		<p:menuitem value="#{msg.organizations}" url="admin/organisations.jsf" />
		<p:menuitem value="#{adminOrganisationBean.selectedOrganisation.title}" url="#" />
	</ui:define>

    <ui:define name="center_layout">
        <ui:fragment rendered="#{null ne adminOrganisationBean.selectedOrganisation}">
            <h:form id="editwelcomeform">
                <div class="row">
                    <div class="col-12">
                        <p:panel header="#{msg.welcome_message}">
                            <p:textEditor height="184" value="#{adminOrganisationBean.selectedOrganisation.welcomeMessage}" />
                        </p:panel>
                    </div>
                    <div class="col-12">
                        <div class="row">
                            <div class="col-12 col-md-6">
                                <p:panel header="Common settings">
                                    <div class="grid">
                                        <p>
                                            <h:outputText value="#{msg.title}: " />

                                        </p>
                                        <p:inputText value="#{adminOrganisationBean.selectedOrganisation.title}" />


                                        <p class="mt-3">
                                            <h:outputText value="Banner image: " />
                                            <p:fileUpload fileUploadListener="#{adminOrganisationBean.handleFileUpload}" styleClass="imageupload-button" id="imageupload" mode="advanced" update="bannerimage" auto="true" sizeLimit="1000000"
                                                          allowTypes="/(\.|\/)(gif|jpe?g|png)$/"  />
                                            <h:panelGroup id="bannerimage">
                                                <img src="#{adminOrganisationBean.selectedOrganisation.bannerImage}" />
                                            </h:panelGroup>
                                        </p>

                                        <p>
                                            <h:outputText value="Welcome Page: " />
                                        </p>
                                        <p:selectOneMenu id="welcomePage"  value="#{adminOrganisationBean.selectedOrganisation.welcomePage}" editable="true">
                                            <f:selectItem itemValue="/lw/myhome/activity.jsf" itemLabel="/lw/myhome/activity.jsf" />
                                            <f:selectItem itemValue="/lw/myhome/welcome.jsf" itemLabel="/lw/myhome/welcome.jsf" />
                                        </p:selectOneMenu>
                                        <p  class="mt-3">
                                            <h:outputText styleClass="mr-1" value="Logout Page: " />
                                        </p>
                                        <p:selectOneMenu value="#{adminOrganisationBean.selectedOrganisation.logoutPage}" editable="true">
                                            <f:selectItem itemValue="/lw/index.jsf" itemLabel="Learnweb index page" />
                                            <f:selectItem itemValue="/ama/index.jsf" itemLabel="AMA index page" />
                                            <f:selectItem itemValue="/aw/index.jsf" itemLabel="Archive index page" />
                                        </p:selectOneMenu>
                                        <p  class="mt-3">
                                            <h:outputText styleClass="mr-1" value="Default language: " />
                                        </p>
                                        <p:selectOneMenu value="#{adminOrganisationBean.selectedOrganisation.defaultLanguage}">
                                            <f:selectItem itemLabel="No default" itemValue="#{null}" />
                                            <f:selectItems value="#{adminOrganisationBean.supportedLanguages}" var="lang"
                                                           itemLabel="${msg['language_' += lang]}" itemValue="#{lang}"></f:selectItems>
                                        </p:selectOneMenu>
                                        <p  class="mt-3">
                                            <h:outputText styleClass="mr-1" value="Language variant: " />
                                        </p>
                                        <p:selectOneMenu value="#{adminOrganisationBean.selectedOrganisation.languageVariant}">
                                            <f:selectItem itemValue="" itemLabel="No variant" />
                                            <f:selectItems value="#{adminOrganisationBean.supportedLanguageVariants}" var="variant"
                                                           itemLabel="#{variant}" itemValue="#{variant}"></f:selectItems>
                                        </p:selectOneMenu>

                                        <p  class="mt-3">
                                            <h:outputText value="Glossary languages: " />
                                        </p>
                                        <p:selectCheckboxMenu value="#{adminOrganisationBean.selectedOrganisation.glossaryLanguages}" required="true" requiredMessage="#{msg.mandatory_field}"
                                                              label="#{msg.language}" multiple="true" converter="#{localeConverter}">
                                            <f:selectItems value="#{adminOrganisationBean.availableGlossaryLanguages}"></f:selectItems>
                                        </p:selectCheckboxMenu>

                                    </div>
                                </p:panel>

                            </div>
                            <div class="col-12 col-md-6">

                                <p:panel header="Additional settings">
                                    <p:accordionPanel autoHeight="false" id="courseoptions">
                                        <c:forEach items="#{adminOrganisationBean.optionGroups}" var="group" varStatus="status">

                                            <p:tab title="${adminOrganisationBean.optionGroups[status.index].title}">
                                                <h:dataTable value="${adminOrganisationBean.optionGroups[status.index].options}" var="option">
                                                    <h:column>
                                                        <h:selectBooleanCheckbox value="#{option.value}" id="checkbox" />
                                                    </h:column>
                                                    <h:column>
                                                        <h:outputLabel value="#{option.name}" for="checkbox" />
                                                    </h:column>
                                                </h:dataTable>
                                            </p:tab>

                                        </c:forEach>
                                    </p:accordionPanel>
                                </p:panel>
                            </div>
                        </div>
                    </div>


                    <div class="col-12">
                        <p:panel>
<!--                                <p:button rendered="#{userBean.admin}" outcome="organisations" styleClass="command-button mr-4" value="Back to Organisations" />-->
                                <p:commandButton action="#{adminOrganisationBean.onSave}" styleClass="command-button" value="#{msg.save}" ajax="false" />
                        </p:panel>

                    </div>

                </div>

            </h:form>
        </ui:fragment>
    </ui:define>
</ui:composition>