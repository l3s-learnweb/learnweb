<ui:composition
	template="/templates/main/main.xhtml"
	xmlns="http://www.w3.org/1999/xhtml"
	xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
	xmlns:h="http://xmlns.jcp.org/jsf/html"
	xmlns:f="http://xmlns.jcp.org/jsf/core"
	xmlns:p="http://primefaces.org/ui">

	<ui:param name="loginRequired" value="true"/>
	<ui:param name="pageTitle" value="#{msg.requests_header}"/>

	<ui:define name="center_layout">

	<style type="text/css">
		.ui-state-hover, .ui-state-focus, .ui-state-active{
			box-shadow:0 0 0 0 #fff !important;
			background-color:#d1d1d1 !important;
			background-image:none !important;
			border:1px solid #a8a8a8 !important;
		}

		.page_header{margin:5px 5px 0 5px;}
		#banlistform{padding:5px; width:100%;}
	</style>

	<div class="page_header">
		<span>
			#{msg.requests_header}
		</span>
	</div>

	<p:panel>
	<p:tabView>
        <p:tab title="#{msg.requests}">
			<h:form id="requestform" >

					<p:dataTable var="request" value="#{adminRequestListBean.requests}" filteredValue="#{adminRequestListBean.filteredRequests}" rows="100" paginator="true"
			               paginatorTemplate="{FirstPageLink} {PreviousPageLink} {PageLinks} {NextPageLink} {LastPageLink}"
			               currentPageReportTemplate="(Displaying {startRecord} - {endRecord} of {totalRecords})"
			               >

						<p:column headerText="IP" sortBy="#{request.IP}" filterBy="#{request.IP}" filterMatchMode="contains">
							<h:outputText value="#{request.IP}" />
						</p:column>

						<p:column headerText="#{msg.time}" sortBy="#{request.time}" filterBy="#{request.time}" filterFunction="#{adminRequestListBean.filterByDate}">
							<h:outputText value="#{request.time}">
							    <f:convertDateTime pattern="dd.MM.yyyy HH:mm:ss" />
							</h:outputText>
						</p:column>

						<p:column headerText="URL" sortBy="#{request.URL}" filterBy="#{request.URL}" filterMatchMode="contains">
							<h:outputText value="#{request.URL}" />
						</p:column>

					</p:dataTable>
				</h:form>
        </p:tab>

        <p:tab title="#{msg.logins}">
			<h:form>
				<p:dataTable var="login" value="#{adminRequestListBean.logins}" filteredValue="#{adminRequestListBean.filteredLogins}" rows="100" paginator="true"
		               paginatorTemplate="{FirstPageLink} {PreviousPageLink} {PageLinks} {NextPageLink} {LastPageLink}"
		               currentPageReportTemplate="(Displaying {startRecord} - {endRecord} of {totalRecords})"
		               >

					<p:column headerText="IP" sortBy="#{login.key}"  filterBy="#{login.key}" filterMatchMode="contains">
						<h:outputText value="#{login.key}" />
					</p:column>

					<p:column headerText="#{msg.logins_amount}" sortBy="#{login.value.size()}"  filterBy="#{login.value.size()}" filterMatchMode="contains">
						<h:outputText value="#{login.value.size()}" />
					</p:column>

					<p:column headerText="#{msg.request_usernames}" sortBy="#{login.value.toString()}"  filterBy="#{login.value.toString()}" filterMatchMode="contains">
						<h:outputText value="#{login.value.toString()}" />
					</p:column>

				</p:dataTable>
			</h:form>
        </p:tab>

        <p:tab title="#{msg.aggr_requests}">
			<h:form id="aggrrequestform" >

				<span>
					#{msg.aggr_request_updated}:   <h:outputText value="#{adminRequestListBean.aggrRequestsUpdated}">
						    						<f:convertDateTime pattern="dd.MM.yyyy HH:mm" />
													</h:outputText>
					<h:commandButton action="${adminRequestListBean.onUpdateAggregatedRequests}" value="#{msg.update}" style="margin:10px;" immediate="true"/>
				</span>

				<p:dataTable var="aRequest" value="#{adminRequestListBean.aggregatedRequests}" filteredValue="#{adminRequestListBean.filteredAggregatedRequests}" rows="50" paginator="true"
		              paginatorTemplate="{FirstPageLink} {PreviousPageLink} {PageLinks} {NextPageLink} {LastPageLink}">

					<p:column headerText="IP" sortBy="#{aRequest.IP}"  filterBy="#{aRequest.IP}" filterMatchMode="contains">
						<h:outputText value="#{aRequest.IP}" />
					</p:column>

					<p:column headerText="#{msg.requests_count}" sortBy="#{aRequest.requests}"  filterBy="#{aRequest.requests}" filterMatchMode="contains">
						<h:outputText value="#{aRequest.requests}" />
					</p:column>

					<p:column headerText="#{msg.logins_amount}" sortBy="#{aRequest.loginCount}"  filterBy="#{aRequest.loginCount}" filterMatchMode="contains">
						<h:outputText value="#{aRequest.loginCount}" />
					</p:column>

					<p:column headerText="#{msg.request_usernames}" sortBy="#{aRequest.usernames}" filterBy="#{aRequest.usernames}" filterMatchMode="contains">
						<h:outputText value="#{aRequest.usernames}" />
					</p:column>

					<p:column headerText="#{msg.time_stamp}" sortBy="#{aRequest.time}" filterBy="#{aRequest.time}" filterFunction="#{adminRequestListBean.filterByDate}">
						<h:outputText value="#{aRequest.time}">
						    <f:convertDateTime pattern="dd.MM.yyyy HH:mm" />
						</h:outputText>
					</p:column>

				</p:dataTable>
			</h:form>
        </p:tab>
    </p:tabView>


	</p:panel>



	</ui:define>
</ui:composition>