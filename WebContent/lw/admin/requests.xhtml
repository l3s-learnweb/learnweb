<ui:composition
	template="/templates/main/main.xhtml"
	xmlns="http://www.w3.org/1999/xhtml"
	xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
	xmlns:h="http://xmlns.jcp.org/jsf/html"
	xmlns:f="http://xmlns.jcp.org/jsf/core"
	xmlns:p="http://primefaces.org/ui">

	<ui:param name="loginRequired" value="true"/>
	<ui:param name="pageTitle" value="#{msg.requests_header}"/>

	<ui:define name="center_layout">

	<style type="text/css">
		.ui-state-hover, .ui-state-focus, .ui-state-active{
			box-shadow:0 0 0px 0px #fff !important;
			background-color:#d1d1d1 !important;
			background-image:none !important;
			border:1px solid #a8a8a8 !important;
		}

		.page_header{margin:5px 5px 0px 5px;}
		#banlistform{padding:5px; width:100%;}
	</style>

		<div class="page_header">
			<span>
				#{msg.requests_header}
			</span>
		</div>

	<p:panel>
	<p:tabView>
        <p:tab title="#{msg.requests}">
			<h:form id="requestform" >

					<p:dataTable var="entry" value="#{adminRequestListBean.requests}" filteredValue="#{adminRequestListBean.filteredRequests}" rows="100" paginator="true"
			               paginatorTemplate="{FirstPageLink} {PreviousPageLink} {PageLinks} {NextPageLink} {LastPageLink}"
			               currentPageReportTemplate="(Displaying {startRecord} - {endRecord} of {totalRecords})"
			               >

						<p:column headerText="IP" sortBy="#{entry.IP}" filterBy="#{entry.IP}" filterMatchMode="contains">
							<h:outputText value="#{entry.IP}" />
						</p:column>

						<p:column headerText="#{msg.time}" sortBy="#{entry.time}" filterBy="#{entry.time}" filterFunction="#{adminRequestListBean.filterByDate}">
							<h:outputText value="#{entry.time}">
							    <f:convertDateTime pattern="dd.MM.yyyy HH:mm:ss" />
							</h:outputText>
						</p:column>

						<p:column headerText="URL" sortBy="#{entry.URL}" filterBy="#{entry.URL}" filterMatchMode="contains">
							<h:outputText value="#{entry.URL}" />
						</p:column>

					</p:dataTable>
				</h:form>
        </p:tab>

        <p:tab title="#{msg.logins}">
			<h:form>
				<p:dataTable var="entry" value="#{adminRequestListBean.logins}" filteredValue="#{adminRequestListBean.filteredLogins}" rows="100" paginator="true"
		               paginatorTemplate="{FirstPageLink} {PreviousPageLink} {PageLinks} {NextPageLink} {LastPageLink}"
		               currentPageReportTemplate="(Displaying {startRecord} - {endRecord} of {totalRecords})"
		               >

					<p:column headerText="IP" sortBy="#{entry.key}"  filterBy="#{entry.key}" filterMatchMode="contains">
						<h:outputText value="#{entry.key}" />
					</p:column>

					<p:column headerText="#{msg.logins_amount}" sortBy="#{entry.value.size()}"  filterBy="#{entry.value.size()}" filterMatchMode="contains">
						<h:outputText value="#{entry.value.size()}" />
					</p:column>

					<p:column headerText="#{msg.request_usernames}" sortBy="#{entry.value.toString()}"  filterBy="#{entry.value.toString()}" filterMatchMode="contains">
						<h:outputText value="#{entry.value.toString()}" />
					</p:column>

				</p:dataTable>
			</h:form>
        </p:tab>

        <p:tab title="#{msg.aggr_requests}">
			<h:form id="aggrrequestform" >

				<span>
					#{msg.aggr_request_updated}:   <h:outputText value="#{adminRequestListBean.aggrRequestsUpdated}">
						    						<f:convertDateTime pattern="dd.MM.yyyy HH:mm" />
													</h:outputText>
					<h:commandButton action="${adminRequestListBean.onUpdateAggregatedRequests}" value="#{msg.update}" style="margin:10px;" immediate="true"/>
				</span>

				<p:dataTable var="entry" value="#{adminRequestListBean.aggregatedRequests}" filteredValue="#{adminRequestListBean.filteredAggregatedRequests}" rows="50" paginator="true"
		              paginatorTemplate="{FirstPageLink} {PreviousPageLink} {PageLinks} {NextPageLink} {LastPageLink}">

					<p:column headerText="IP" sortBy="#{entry.IP}"  filterBy="#{entry.IP}" filterMatchMode="contains">
						<h:outputText value="#{entry.IP}" />
					</p:column>

					<p:column headerText="#{msg.requests_count}" sortBy="#{entry.requests}"  filterBy="#{entry.requests}" filterMatchMode="contains">
						<h:outputText value="#{entry.requests}" />
					</p:column>

					<p:column headerText="#{msg.logins_amount}" sortBy="#{entry.loginCount}"  filterBy="#{entry.loginCount}" filterMatchMode="contains">
						<h:outputText value="#{entry.loginCount}" />
					</p:column>

					<p:column headerText="#{msg.request_usernames}" sortBy="#{entry.usernames}" filterBy="#{entry.usernames}" filterMatchMode="contains">
						<h:outputText value="#{entry.usernames}" />
					</p:column>

					<p:column headerText="#{msg.time_stamp}" sortBy="#{entry.time}" filterBy="#{entry.time}" filterFunction="#{adminRequestListBean.filterByDate}">
						<h:outputText value="#{entry.time}">
						    <f:convertDateTime pattern="dd.MM.yyyy HH:mm" />
						</h:outputText>
					</p:column>

				</p:dataTable>
			</h:form>
        </p:tab>
    </p:tabView>


	</p:panel>



	</ui:define>
</ui:composition>