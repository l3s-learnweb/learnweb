<ui:composition 
	template="/WEB-INF/templates/layout/template.xhtml"
	xmlns="http://www.w3.org/1999/xhtml" 
	xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
	xmlns:h="http://xmlns.jcp.org/jsf/html"
	xmlns:f="http://xmlns.jcp.org/jsf/core"
	xmlns:p="http://primefaces.org/ui">

<ui:param name="loginRequired" value="true" />
<ui:param name="pageTitle" value="System Tools" />

<ui:define name="sub_breadcrumb">
	<p:menuitem value="Database connections" url="admin/systemtools.jsf"/>
</ui:define>


<ui:define name="center_layout">
	<h:outputText value="Missing authentication" rendered="#{not userBean.admin}" />
	<ui:fragment rendered="#{userBean.admin}">




		<h:form>		
			<p:dataTable id="processTable" var="process"
					value="#{adminSystemBean.databaseProcessList}"
					tableStyle="table-layout:auto"
					emptyMessage="no open connection">

					<p:column headerText="id" sortBy="#{process.id}">
						<h:outputText value="#{process.id}" />
					</p:column>


					<p:column headerText="#{msg.username}" sortBy="#{process.user}">
						<h:outputText value="#{process.user}" />
					</p:column>

					<p:column headerText="host" sortBy="#{process.host}">
						<h:outputText value="#{process.host}" />
					</p:column>

					<p:column headerText="db" sortBy="#{process.db}">
						<h:outputText value="#{process.db}" />
					</p:column>

					<p:column headerText="command" sortBy="#{process.command}">
						<h:outputText value="#{process.command}" />
					</p:column>

					<p:column headerText="time" sortBy="#{process.time}">
						<h:outputText value="#{process.time}" />
					</p:column>

					<p:column headerText="state" sortBy="#{process.state}">
						<h:outputText value="#{process.state}" />
					</p:column>

					<p:column headerText="#{msg.info}" sortBy="#{process.info}">
						<h:outputText value="#{process.info}" />
					</p:column>

					<p:column headerText="progress" sortBy="#{process.progress}">
						<h:outputText value="#{process.progress}" />
					</p:column>

					<p:column headerText="Terminate">
						<p:commandButton styleClass="command-button m-auto d-block" value="terminate"
							actionListener="#{adminSystemBean.onKillDatabaseProcess(process.id)}" update="processTable">
<!--							<h:graphicImage value="/resources/icon/Remove.png" width="16" height="16" alt="#{msg.edit}" />-->
						</p:commandButton>
					</p:column>

				</p:dataTable>
			</h:form>

		<h:form>
			<p:panel styleClass="mt-3">
				<p:commandButton actionListener="#{adminSystemBean.onClearCaches()}" styleClass="command-button" value="Clear caches" />
			</p:panel>
		</h:form>
	</ui:fragment>
</ui:define>

</ui:composition> 