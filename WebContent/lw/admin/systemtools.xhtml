<ui:composition 
	template="/templates/main/main.xhtml" 
	xmlns="http://www.w3.org/1999/xhtml" 
	xmlns:ui="http://java.sun.com/jsf/facelets" 
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:f="http://java.sun.com/jsf/core" 
	xmlns:p="http://primefaces.org/ui">

<ui:param name="loginRequired" value="true" />
<ui:param name="pageTitle" value="System Tools" />

<ui:define name="center_layout">
	<h:outputText value="Missing authentication" rendered="#{not userBean.admin}" />
	<ui:fragment rendered="#{userBean.admin}">
		<div class="page_header" >
			<span>
				Database connections
			</span>
		</div>


		<h:form>		
			<p:dataTable id="processTable" var="process"
					style="margin: 2rem;text-align: right;"
					value="#{adminSystemBean.databaseProcessList}"
					tableStyle="width: 96%;table-layout:auto"
					emptyMessage="no open connection">

					<p:column headerText="id" sortBy="#{process.id}">
						<h:outputText value="#{process.id}" />
					</p:column>


					<p:column headerText="#{msg.username}" sortBy="#{process.user}">
						<h:outputText value="#{process.user}" />
					</p:column>

					<p:column headerText="host" sortBy="#{process.host}">
						<h:outputText value="#{process.host}" />
					</p:column>

					<p:column headerText="db" sortBy="#{process.db}">
						<h:outputText value="#{process.db}" />
					</p:column>

					<p:column headerText="command" sortBy="#{process.command}">
						<h:outputText value="#{process.command}" />
					</p:column>

					<p:column headerText="time" sortBy="#{process.time}">
						<h:outputText value="#{process.time}" />
					</p:column>

					<p:column headerText="state" sortBy="#{process.state}">
						<h:outputText value="#{process.state}" />
					</p:column>

					<p:column headerText="#{msg.info}" sortBy="#{process.info}">
						<h:outputText value="#{process.info}" />
					</p:column>

					<p:column headerText="progress" sortBy="#{process.progress}">
						<h:outputText value="#{process.progress}" />
					</p:column>

					<p:column headerText="Terminate">
						<p:commandButton value="terminate"
							actionListener="#{adminSystemBean.onKillDatabaseProcess(process.id)}" update="processTable"/>
					</p:column>

				</p:dataTable>
			</h:form>
		
		<div class="page_header" style="margin:5px;">
			<span>Caches</span>
		</div>
		<h:form styleClass="grey_border" >
			<p:commandButton actionListener="#{adminSystemBean.onClearCaches()}" value="Clear caches" />
		</h:form>
	</ui:fragment>
</ui:define>

</ui:composition> 