<ui:composition template="/WEB-INF/templates/layout/template.xhtml"
				xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
				xmlns:h="http://xmlns.jcp.org/jsf/html"
				xmlns:f="http://xmlns.jcp.org/jsf/core"
				xmlns:p="http://primefaces.org/ui" xmlns:lw="http://l3s.de/learnweb">

	<ui:param name="loginRequired" value="true"/>
	<ui:param name="pageTitle" value="#{msg.system_tools}"/>

	<ui:define name="breadcrumb">
		<ui:fragment rendered="#{userBean.admin}">
			<lw:breadcrumb-item link="admin.jsf" title="#{msg.admin}">
				<ui:decorate template="/WEB-INF/templates/blocks/breadcrumb/nav_list_first.xhtml"/>
			</lw:breadcrumb-item>

			<lw:breadcrumb-item link="admin/systemtools.jsf" title="#{msg.system_tools}">
				<ui:decorate template="/WEB-INF/templates/blocks/breadcrumb/nav_list_admin.xhtml"/>
			</lw:breadcrumb-item>
		</ui:fragment>
	</ui:define>

	<ui:define name="center_layout">
		<p:panel rendered="#{not userBean.admin}">
			<h:outputText value="#{msg.missing_authentication}"/>
		</p:panel>

		<ui:fragment rendered="#{userBean.admin}">
			<h:form>
				<p:blockUI block="processTable" widgetVar="processTableOverlay">
					<h:outputText value="#{msg.please_wait}"/>
				</p:blockUI>

				<p:dataTable id="processTable" var="process" value="#{adminSystemBean.databaseProcessList}" emptyMessage="no open connection">
					<f:facet name="header">#{msg.database_connections}</f:facet>

					<p:column headerText="#{msg.id}" sortBy="#{process.id}">
						<h:outputText value="#{process.id}"/>
					</p:column>

					<p:column headerText="#{msg.username}" sortBy="#{process.user}">
						<h:outputText value="#{process.user}"/>
					</p:column>

					<p:column headerText="#{msg.host}" sortBy="#{process.host}">
						<h:outputText value="#{process.host}"/>
					</p:column>

					<p:column headerText="#{msg.db}" sortBy="#{process.db}">
						<h:outputText value="#{process.db}"/>
					</p:column>

					<p:column headerText="#{msg.command}" sortBy="#{process.command}">
						<h:outputText value="#{process.command}"/>
					</p:column>

					<p:column headerText="#{msg.time}" sortBy="#{process.time}">
						<h:outputText value="#{process.time}"/>
					</p:column>

					<p:column headerText="${msg.state}" sortBy="#{process.state}">
						<h:outputText value="#{process.state}"/>
					</p:column>

					<p:column headerText="#{msg.info}" sortBy="#{process.info}">
						<h:outputText value="#{process.info}"/>
					</p:column>

					<p:column headerText="#{msg.progress}" sortBy="#{process.progress}">
						<h:outputText value="#{process.progress}"/>
					</p:column>

					<p:column headerText="#{msg.terminate}">
						<p:commandButton styleClass="m-auto d-block text-lowercase" value="#{msg.terminate}"
										 actionListener="#{adminSystemBean.onKillDatabaseProcess(process.id)}" onstart="PF('processTableOverlay').show()" oncomplete="PF('processTableOverlay').hide()" global="false" update="processTable">
						</p:commandButton>
					</p:column>
				</p:dataTable>

				<p:commandButton actionListener="#{adminSystemBean.onClearCaches()}" global="false" onstart="PF('processTableOverlay').show()" oncomplete="PF('processTableOverlay').hide()" styleClass="mt-3" value="#{msg.clear_caches}"/>
			</h:form>
		</ui:fragment>
	</ui:define>
</ui:composition>
