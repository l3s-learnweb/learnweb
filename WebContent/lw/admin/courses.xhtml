<ui:composition
    template="/WEB-INF/templates/layout/template.xhtml"
	xmlns="http://www.w3.org/1999/xhtml" 
	xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
	xmlns:h="http://xmlns.jcp.org/jsf/html"
	xmlns:f="http://xmlns.jcp.org/jsf/core"
    xmlns:c="http://xmlns.jcp.org/jsp/jstl/core"
	xmlns:p="http://primefaces.org/ui">

	<ui:param name="loginRequired" value="true"/>
	<ui:param name="pageTitle" value="#{msg.courses}"/>

	<ui:define name="content">
		<div class="page-header">
			<h1>#{msg.courses}</h1>
		</div>
		
		<h:form id="courses_form" styleClass="form">
			<div class="p-grid">
				<div class="p-col-12">
					<p:blockUI block="courses_table" widgetVar="courses_form_blocker">
				<div class="float-left">#{msg.please_wait}. This action may take several minutes for big courses.</div>
				<div class="loading-animation small float-left">
					<div></div>
					<div></div>
					<div></div>
				</div>
			</p:blockUI>
					<p:dataTable id="courses_table" var="course" value="#{adminCoursesBean.courses}">
				    <p:column headerText="#{msg.title}" sortBy="#{course.title}">
					    <h:outputText value="#{course.title}" />
				    </p:column>
						
				    <p:column headerText="#{msg.organization}" sortBy="#{course.organisation.title}">
					    <h:outputText value="#{course.organisation.title}" rendered="#{not empty course.organisation}" />
				    </p:column>
					
				    <p:column headerText="#{msg.members}" sortBy="#{course.memberCount}">
					    <h:outputLink value="users.jsf?course_id=#{course.id}">#{course.memberCount}</h:outputLink>
				    </p:column>
						
				    <p:column headerText="#{msg.options}" styleClass="options_column">
					    <f:facet name="header">
						    #{msg.options}
					    </f:facet>

					    <h:outputLink value="course.jsf?course_id=#{course.id}" title="#{msg.edit}">
						    <h:graphicImage value="/resources/icon/silk/pencil.png" width="16" height="16" alt="#{msg.edit}" />
						    <!--<h:outputText value="#{msg.edit}" />-->
					    </h:outputLink>
							
					    <p:commandLink actionListener="#{adminCoursesBean.onDeleteCourse(course)}" process="@this"
						update="@form :growl" rendered="#{course.memberCount == 0 || userBean.admin}"	title="#{msg.delete}"
						onclick="PF('courses_form_blocker').show()" oncomplete="PF('courses_form_blocker').hide()">															
						<h:graphicImage value="/resources/icon/silk/delete.png" width="16" height="16" alt="#{msg.delete}" />
						<h:outputText value="#{msg.delete}" /> 
						<p:confirm message="Do you really want to delete course '#{course.title}'? All users and their resources will be deleted. Except for users who are also member of other courses." />
					</p:commandLink>
					
					    <p:commandLink actionListener="#{adminCoursesBean.onAnonymiseCourse(course)}" process="@this"
						update="@form :growl" rendered="#{userBean.admin}"	
						onstart="PF('courses_form_blocker').show()" oncomplete="PF('courses_form_blocker').hide()">																					
						<h:graphicImage value="/resources/icon/silk/delete.png" width="16" height="16" alt="#{msg.delete}" />
						<h:outputText value="Anonymise" /> 
						<p:confirm message="Do you really want to anonymise course '#{course.title}'? The personal information of all course members will be removed and they won't be able to login anymore. Users who are also member of other courses are not affected." />
					</p:commandLink>
					
					    <h:outputLink value="users_submissions.jsf?course_id=#{course.id}" title="#{msg['Submission.view_user_submissions']}">
                            <h:graphicImage value="/resources/icon/user_submission.png" width="16" height="16" alt="#{msg['Submission.view_user_submissions']}" />
					    </h:outputLink>
				    </p:column>
			    </p:dataTable>
				</div>
			</div>
		</h:form>

			<h:form id="addcourse" styleClass="form margin-top no-padding-top">
				<div class="p-grid">
					<div class="p-col-12">
						<div class="card card-w-title grid">
							<h2><h:outputText value="#{msg.add_new_course}"/></h2>
							<p class="no-margin-top">
								#{msg.course_title}:
							</p>
							<h:inputText value="#{adminCoursesBean.newCourseTitle}" id="c_title"/>
							<p:message for="c_title" showSummary="true" showDetail="false" id="message_c_title"/>
						</div>
					</div>
					<div class="p-col-12">
						<div class="card card-w-title" id="notification-save-button" >
							<p>
								<p:commandButton type="submit" action="${adminCoursesBean.onCreateCourse}" value="#{msg.add}" process="@form"/>
							</p>
						</div>

					</div>


				</div>
			</h:form>

		<p:panel header="#{msg.add_new_organization}" rendered="#{userBean.admin}">
			<h:form id="addorganisation">
				#{msg.organization_title}: 
				<h:inputText value="#{adminCoursesBean.newOrganisationTitle}" id="c_organisation"/>
				<p:message for="c_organisation" showSummary="true" showDetail="false" id="message_c_organisation"/>
				<h:button action="${adminCoursesBean.onCreateOrganisation}" value="#{msg.add}" type="button" process="@form" styleClass="margin-top"/>
			</h:form>
		</p:panel>


		
	</ui:define>
</ui:composition>