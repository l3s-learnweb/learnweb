<ui:composition
        template="/WEB-INF/templates/layout/template.xhtml"
        xmlns="http://www.w3.org/1999/xhtml"
        xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
        xmlns:h="http://xmlns.jcp.org/jsf/html"
        xmlns:f="http://xmlns.jcp.org/jsf/core"
        xmlns:c="http://xmlns.jcp.org/jsp/jstl/core"
        xmlns:p="http://primefaces.org/ui">

<ui:param name="loginRequired" value="true"/>
<ui:param name="pageTitle" value="#{msg.courses}"/>
<ui:define name="sub_breadcrumb">
    <p:menuitem value="#{msg.courses}" url="admin/courses.jsf#"/>
</ui:define>
<ui:define name="center_layout">
    <div class="row s-gutters">
        <div class="col-12 col-sm-6">
            <p:panel header="#{msg.add_new_course}" >
                <h:form id="addcourse">
                    <div class="form-group">
                        <p:outputLabel for="@next" value="#{msg.course_title}:"/>
                        <h:inputText value="#{adminCoursesBean.newCourseTitle}"/>
                        <p:message for="@previous"/>
                    </div>

                    <p:commandButton type="submit" action="${adminCoursesBean.onCreateCourse}" value="#{msg.add}" update=":message :growl" process="@form"/>
                </h:form>
            </p:panel>
        </div>

        <div class="col-12 col-sm-6">
            <p:panel header="#{msg.add_new_organization}" rendered="#{userBean.admin}">
                <h:form id="addorganisation" >
                    <div class="form-group">
                        <p:outputLabel value="#{msg.organization_title}:"/>
                        <h:inputText value="#{adminCoursesBean.newOrganisationTitle}"/>
                        <p:message for="@previous"/>
                    </div>

                    <p:commandButton action="${adminCoursesBean.onCreateOrganisation}" value="#{msg.add}" type="submit" process="@form" update=":message :growl"/>
                </h:form>
            </p:panel>
        </div>
    </div>

    <h:form id="courses_form">
        <p:blockUI block="courses_table" widgetVar="courses_form_blocker">
            <div class="float-left">#{msg.please_wait}. This action may take several minutes for big courses.</div>
            <div class="loading-animation small float-left">
                <div></div>
                <div></div>
                <div></div>
            </div>
        </p:blockUI>

        <p:panel styleClass="mt-3" header="All courses">
            <p:dataTable tableStyleClass="table-sm table-responsive" id="courses_table" var="course" value="#{adminCoursesBean.courses}">
                <p:column headerText="#{msg.title}" sortBy="#{course.title}">
                    <h:outputText value="#{course.title}"/>
                </p:column>

                <p:column headerText="#{msg.organization}" sortBy="#{course.organisation.title}">
                    <h:outputText value="#{course.organisation.title}" rendered="#{not empty course.organisation}"/>
                </p:column>

                <p:column headerText="#{msg.members}" sortBy="#{course.memberCount}">
                    <h:outputLink value="users.jsf?course_id=#{course.id}">#{course.memberCount}</h:outputLink>
                </p:column>

                <p:column headerText="#{msg.options}">
                    <f:facet name="header">
                        #{msg.options}
                    </f:facet>

                    <div class="text-right">
                        <h:outputLink styleClass="mr-2" value="admin/course.jsf?course_id=#{course.id}" title="#{msg.edit}">
                            <i class="fa fa-pencil" aria-hidden="true"></i>
                            <h:outputText value="#{msg.edit}"/>
                        </h:outputLink>

                        <p:commandLink styleClass="mr-2" actionListener="#{adminCoursesBean.onDeleteCourse(course)}" process="@this"
                                       update="@form :growl" rendered="#{course.memberCount == 0 || userBean.admin}" title="#{msg.delete}"
                                       onclick="PF('courses_form_blocker').show()" oncomplete="PF('courses_form_blocker').hide()">
                            <i class="fa fa-trash" aria-hidden="true"></i>
                            <h:outputText value="#{msg.delete}"/>
                            <p:confirm
                                    message="Do you really want to delete course '#{course.title}'? All users and their resources will be deleted. Except for users who are also member of other courses."/>
                        </p:commandLink>

                        <p:commandLink styleClass="mr-2" actionListener="#{adminCoursesBean.onAnonymiseCourse(course)}" process="@this"
                                       update="@form :growl" rendered="#{userBean.admin}"
                                       onstart="PF('courses_form_blocker').show()" oncomplete="PF('courses_form_blocker').hide()">
                            <i class="fa fa-eye-slash" aria-hidden="true"></i>
                            <h:outputText value="Anonymise"/>
                            <p:confirm
                                    message="Do you really want to anonymise course '#{course.title}'? The personal information of all course members will be removed and they won't be able to login anymore. Users who are also member of other courses are not affected."/>
                        </p:commandLink>

                        <h:outputLink value="admin/users_submissions.jsf?course_id=#{course.id}" alt="user_submissions"
                                      title="#{msg['Submission.view_user_submissions']}">
                            <i class="fa fa-check-circle-o" aria-hidden="true"></i>
                            <h:outputText value="user_submissions"/>
                        </h:outputLink>
                    </div>
                </p:column>
            </p:dataTable>
        </p:panel>
    </h:form>

</ui:define>
</ui:composition>