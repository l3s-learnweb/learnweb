<ui:composition
        xmlns:ui="http://java.sun.com/jsf/facelets"
        xmlns:p="http://primefaces.org/ui"
        xmlns:h="http://xmlns.jcp.org/jsf/html"
        xmlns:f="http://xmlns.jcp.org/jsf/core">


<p:blockUI block="usersSelectForm:usersSelectPanel" widgetVar="buiForUsers"/>
<p:blockUI block="usersSelectForm:groupsSelectPanel" widgetVar="buiForGroups"/>
<p:panelGrid columns="2" style="margin: 10px;">
    <p:outputPanel>
        <p:selectOneRadio widgetVar="widgetSorType" layout="grid" columns="1"
                          value="Users" required="true"
                          onchange="blockSelectPanel(PF('widgetSorType').getJQ().find(':checked').val());">
            <f:selectItem itemLabel="Users" itemValue="Users"/>
            <f:selectItem itemLabel="Groups" itemValue="Groups"/>
        </p:selectOneRadio>
    </p:outputPanel>
    <p:outputPanel>
        <h:form id="usersSelectForm">
            <p:panelGrid columns="2">
                <p:outputPanel>
                    <p:outputPanel id="usersSelectPanel">
                        <p:panel>
                            <p:selectCheckboxMenu style="width: 75px;"
                                                  value="#{nameOfBean.selectedUsersIds}"
                                                  var="user"
                                                  itemValue="#{user.id}"
                                                  itemLabel="#{user.username}" label="Users"
                                                  filter="true" filterMatchMode="startsWith">
                                <p:ajax global="false"
                                        update="dateAndSubmitPanel"/>
                                <p:ajax event="toggleSelect" global="false"
                                        update="dateAndSubmitPanel"/>
                                <f:selectItems value="#{nameOfBean.getAllUsers()}" var="user"
                                               itemValue="#{user.id}"
                                               itemLabel="#{user.username}"/>
                            </p:selectCheckboxMenu>
                        </p:panel>
                    </p:outputPanel>
                    <p:outputPanel id="groupsSelectPanel">
                        <p:panel>
                            <p:selectCheckboxMenu
                                                  style="width: 75px;"
                                                  value="#{nameOfBean.selectedGroupsIds}"
                                                  var="Group" label="Groups"
                                                  filter="true" filterMatchMode="startsWith">
                                <p:ajax global="false"
                                        update="dateAndSubmitPanel"/>
                                <p:ajax event="toggleSelect" global="false"
                                        update="dateAndSubmitPanel"/>
                                <f:selectItems
                                        value="#{nameOfBean.getAllGroups()}" var="group"
                                        itemValue="#{group.id}"/>
                            </p:selectCheckboxMenu>
                        </p:panel>
                    </p:outputPanel>

                </p:outputPanel>
                <p:outputPanel id="dateAndSubmitPanel" style="width: 300px; padding-top:6px;">

                    <div class="p-grid">
                        <div class="p-col-12">
                            <div class="ui-inputgroup">
                                <p:outputLabel for="dateStart"/>
                                <p:calendar id="dateStart" var="date"
                                            value="#{nameOfBean.startDate}"
                                            showOn="button"/>
                            </div>
                        </div>

                        <div class="p-col-12">
                            <div class="ui-inputgroup">
                                <p:outputLabel for="dateEnd"/>
                                <p:calendar id="dateEnd" var="date" value="#{nameOfBean.endDate}"
                                            showOn="button"/>
                            </div>
                        </div>
                        <div class="p-col-12">
                            <div class="ui-inputgroup">
                                <h:outputText
                                        value="Users selected: #{nameOfBean.getSelectedUsersIds().size()}"
                                        rendered="#{!empty(nameOfBean.getSelectedUsersIds())}"/>
                            </div>
                        </div>
                        <div class="p-col-12 auto-button">
                            <p:ajaxStatus onstart="PF('statusDialog').show()" oncomplete="PF('statusDialog').hide()">
                                <p:commandButton value="Update"
                                                 icon="ui-icon-check"
                                                 update=":content"
                                                 process="@this,content, dateAndSubmitPanel"
                                                 disabled="#{empty(nameOfBean.getSelectedUsersIds())}"
                                                 action="#{nameOfBean.cleanAndUpdateStoredData()}">
                                </p:commandButton>
                            </p:ajaxStatus>
                            <p:dialog widgetVar="statusDialog" modal="true" draggable="false" closable="false" resizable="false"
                                      showHeader="false">
                                <p:graphicImage value="/resources/glossary/ajax-loader.gif"/>
                            </p:dialog>
                        </div>
                    </div>

                </p:outputPanel>
            </p:panelGrid>
        </h:form>
    </p:outputPanel>
</p:panelGrid>

<script>
    $(document).ready(function () {
        PF('buiForGroups').show();

    });

    function blockSelectPanel(currentRadioState) {
        if (currentRadioState == "Users") {
            PF('buiForGroups').show();
            PF('buiForUsers').hide();
        }
        if (currentRadioState == "Groups") {
            PF('buiForUsers').show()
            PF('buiForGroups').hide();
        }
    }

</script>
</ui:composition>