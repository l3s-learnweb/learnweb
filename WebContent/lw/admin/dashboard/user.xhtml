<ui:composition template="/templates/main/main.xhtml" xmlns:ui="http://java.sun.com/jsf/facelets"
                xmlns:h="http://java.sun.com/jsf/html" xmlns:f="http://java.sun.com/jsf/core"
                xmlns:p="http://primefaces.org/ui">

    <ui:define name="metadata">
        <f:metadata>
            <f:viewParam name="userId" value="#{dashboardUserBean.paramUserId}"/>
            <f:viewAction action="#{dashboardUserBean.onLoad}"/>
        </f:metadata>
    </ui:define>

    <ui:param name="loginRequired" value="true"/>
    <ui:param name="pageTitle" value="Dashboard"/>

    <style>
        ul {
            list-style: none;
        }
    </style>

    <ui:define name="center_layout">
        <div class="ui-g" style="margin: 5px;">
            <!--<div class="ui-g-12 ui-md-2">
                <div id="sidebar-menu" class="main_menu_side hidden-print main_menu">

                    <div class="menu_section" style="height: 350px; width: 100%;">
                        <h:form id="form">
                            <p:panel header="Navigation">
                                <a href="admin/dashboard/index.jsf"><i class="fa fa-chevron-left"></i> To all users</a>
                            </p:panel>
                        </h:form>
                    </div>
                </div>
            </div>-->
            <div class="ui-g-12 ui-g-nopad" style="padding: .5em;">
                <div class="center-header user-activities" id="group_header">
                    <h2>Users' Activities</h2>
                    <span class="header_detail"><h:outputText value="#{dashboardUserBean.selectedUser.getRealUsername()}"/></span>
                </div>

                <h:panelGroup id="dashboardMain" styleClass="dashboard" layout="block">
                    <div class="ui-g">
                        <div class="ui-g-2">
                            <p:panel header="Total Concepts">
                                <f:facet name="actions">
                                    <p:button id="totalConcepts" styleClass="ui-panel-titlebar-icon ui-corner-all ui-state-default ui-icon" icon="ui-icon-help" onclick="return false;" />
                                    <p:tooltip for="totalConcepts" value="Concept - a general notion" />
                                </f:facet>
                                <div class="count">
                                    <h:outputText value="#{dashboardUserBean.totalConcepts}"/>
                                </div>
                            </p:panel>
                        </div>
                        <div class="ui-g-2">
                            <p:panel header="Total Terms">
                                <f:facet name="actions">
                                    <p:button id="totalTerms" styleClass="ui-panel-titlebar-icon ui-corner-all ui-state-default ui-icon" icon="ui-icon-help" onclick="return false;" />
                                    <p:tooltip for="totalTerms" value="Term - a word/phrase, that is used to describe a concept" />
                                </f:facet>
                                <div class="count">
                                    <h:outputText value="#{dashboardUserBean.totalTerms}"/>
                                </div>
                            </p:panel>
                        </div>
                        <div class="ui-g-2">
                            <p:panel header="Total Sources">
                                <f:facet name="actions">
                                    <p:button id="totalSources" styleClass="ui-panel-titlebar-icon ui-corner-all ui-state-default ui-icon" icon="ui-icon-help" onclick="return false;" />
                                    <p:tooltip for="totalSources" value="??" />
                                </f:facet>
                                <div class="count">
                                    <h:outputText value="#{dashboardUserBean.totalSources}"/>
                                </div>
                            </p:panel>
                        </div>
                        <div class="ui-g-3">
                            <p:panel header="Ratio terms/concept">
                                <div class="count">
                                    <h:outputText value="#{dashboardUserBean.ratioTermConcept}"/>
                                </div>
                            </p:panel>
                        </div>
                    </div>
                    <div class="ui-g">
                        <div class="ui-g-6">
                            <h:form id="dateForm">
                                <div class="ui-g ui-fluid">
                                    <div class="ui-g-12 ui-md-4">
                                        <div class="ui-inputgroup">
                                            <p:outputLabel for="dateStart"/>
                                            <p:calendar id="dateStart" value="#{dashboardUserBean.startDate}"
                                                        showOn="button"/>
                                        </div>
                                    </div>

                                    <div class="ui-g-12 ui-md-4">
                                        <div class="ui-inputgroup">
                                            <p:outputLabel for="dateEnd"/>
                                            <p:calendar id="dateEnd" value="#{dashboardUserBean.endDate}" showOn="button"/>
                                        </div>
                                    </div>

                                    <div class="ui-g-12 ui-md-4">
                                        <div class="ui-inputgroup">
                                            <p:commandButton value="Update" update=":dashboardMain :growl"
                                                             actionListener="#{dashboardUserBean.cleanAndUpdateStoredData}"
                                                             icon="ui-icon-check"/>
                                        </div>
                                    </div>
                                </div>
                            </h:form>
                        </div>
                    </div>

                    <div class="ui-g">
                        <div class="ui-g-9">
                            <p:panel id="chart_plot_Interactions" header="Interactions" style="margin-bottom:20px">
                                <f:facet name="actions">
                                    <p:button id="interactions" styleClass="ui-panel-titlebar-icon ui-corner-all ui-state-default ui-icon" icon="ui-icon-help" onclick="return false;" />
                                    <p:tooltip for="interactions" value="Total number of interactions (of all selected users) per day" />
                                </f:facet>
                                <p:chart type="line" model="#{dashboardUserBean.interactionsChart}" style="height:300px;"/>
                            </p:panel>
                        </div>
                        <div class="ui-g-3">
                            <p:panel id="chart_bar_userActivity" header="Users' Activity types"
                                     style="margin-bottom:20px">
                                <f:facet name="actions">
                                    <p:button id="userActivityTypes" styleClass="ui-panel-titlebar-icon ui-corner-all ui-state-default ui-icon" icon="ui-icon-help" onclick="return false;" />
                                    <p:tooltip for="userActivityTypes" value="Total number of interactions grouped by categories" />
                                </f:facet>
                                <p:chart type="bar" model="#{dashboardUserBean.usersActivityTypesChart}" xaxisAngle="60"
                                         style="height:300px"/>
                            </p:panel>
                        </div>
                    </div>

                    <div class="page_header" style="margin:5px;">
                        <span>Glossary</span>
                    </div>
                    <p:panel style="min-width:628px; margin:5px;">
                        <div class="ui-g">
                            <div class="ui-g-4">
                                <h:form>
                                    <p:panel id="chart_plot_userFields" header="Fields" style="margin-bottom:20px">
                                        <f:facet name="actions">
                                            <p:button id="fieldsChart" styleClass="ui-panel-titlebar-icon ui-corner-all ui-state-default ui-icon" icon="ui-icon-help" onclick="return false;" />
                                            <p:tooltip for="fieldsChart" value="??" />
                                        </f:facet>
                                        <p:chart type="bar" model="#{dashboardUserBean.userFieldsChart}" xaxisAngle="60"
                                                 style="height:300px"/>
                                    </p:panel>
                                </h:form>
                            </div>
                            <div class="ui-g-8">
                                <p:panel id="table_descriptions"
                                         header="Descriptions of entries from class-mates" stickyHeader="true"
                                         style="height:361px; overflow-y: scroll;">
                                    <p:dataTable value="#{dashboardUserBean.usersGlossaryDescriptions}" var="descr"
                                                 styleClass="countries_list">
                                        <p:column headerText="Description">
                                            <h:outputText value="#{descr}"/>
                                        </p:column>
                                        <p:column headerText="Length">
                                            <h:outputText value="#{descr.length()}"/>
                                        </p:column>
                                    </p:dataTable>
                                </p:panel>
                            </div>
                        </div>
                    </p:panel>
                    <div class="page_header" style="margin:5px; margin-top: 1.5em;">
                        <span>Tracker</span>
                    </div>
                    <p:panel style="min-width:628px; margin:5px;">
                        <div class="ui-g">
                            <div class="ui-g-4">
                                <p:panel id="pie_chart_sources" header="Sources" style="margin-bottom:20px">
                                    <f:facet name="actions">
                                        <p:button id="sourcesChart" styleClass="ui-panel-titlebar-icon ui-corner-all ui-state-default ui-icon" icon="ui-icon-help" onclick="return false;" />
                                        <p:tooltip for="sourcesChart" value="Percentage ratio of visited pages (grouped by categories) by users" />
                                    </f:facet>
                                    <p:chart type="pie" model="#{dashboardUserBean.usersSourcesChart}"/>
                                </p:panel>
                            </div>
                            <div class="ui-g-6">
                                <p:panel id="table_sources_list" header="User Proxy sources list" widgetVar="panel"
                                         stickyHeader="true"
                                         style="margin-bottom:20px; height:362px; overflow-y: scroll;">
                                    <f:facet name="actions">
                                        <p:button id="sourcesListTable" styleClass="ui-panel-titlebar-icon ui-corner-all ui-state-default ui-icon" icon="ui-icon-help" onclick="return false;" />
                                        <p:tooltip for="sourcesListTable" value="The ratio between how many times user visited the web page" />
                                    </f:facet>
                                    <h:form>
                                        <p:dataTable var="pll" value="#{dashboardUserBean.usersProxySourcesList}" styleClass="countries_list">
                                            <p:column headerText="Web Site">
                                                <h:outputText value="#{pll.key}"/>
                                            </p:column>

                                            <p:column headerText="Occurrences">
                                                <h:outputText value="#{pll.value}"/>
                                            </p:column>
                                        </p:dataTable>
                                    </h:form>
                                </p:panel>
                            </div>
                            <div class="ui-g-2" style="padding: 0">
                                <div class="ui-g">
                                    <div class="ui-g-12">
                                        <p:panel header="Total events">
                                            <f:facet name="actions">
                                                <p:button id="eventsNumber" styleClass="ui-panel-titlebar-icon ui-corner-all ui-state-default ui-icon" icon="ui-icon-help" onclick="return false;" />
                                                <p:tooltip for="eventsNumber" value="Events like mouse movements, clicks, etc." />
                                            </f:facet>
                                            <div class="count">
                                                <h:outputText value="#{dashboardUserBean.trackerStatistic.totalEvents}"/>
                                            </div>
                                        </p:panel>
                                    </div>
                                </div>
                                <div class="ui-g">
                                    <div class="ui-g-12">
                                        <p:panel header="Time stay">
                                            <f:facet name="actions">
                                                <p:button id="timeStay" styleClass="ui-panel-titlebar-icon ui-corner-all ui-state-default ui-icon" icon="ui-icon-help" onclick="return false;" />
                                                <p:tooltip for="timeStay" value="Total time when web pages were opened by the user" />
                                            </f:facet>
                                            <div class="count">
                                                <h:outputText value="#{dashboardUserBean.trackerStatistic.timeStayFormatted}"/>
                                            </div>
                                        </p:panel>
                                    </div>
                                </div>
                                <div class="ui-g">
                                    <div class="ui-g-12">
                                        <p:panel header="Time active">
                                            <f:facet name="actions">
                                                <p:button id="timeActive" styleClass="ui-panel-titlebar-icon ui-corner-all ui-state-default ui-icon" icon="ui-icon-help" onclick="return false;" />
                                                <p:tooltip for="timeActive" value="Active time on web pages" />
                                            </f:facet>
                                            <div class="count">
                                                <h:outputText value="#{dashboardUserBean.trackerStatistic.timeActiveFormatted}"/>
                                            </div>
                                        </p:panel>
                                    </div>
                                </div>
                                <div class="ui-g">
                                    <div class="ui-g-12">
                                        <p:panel header="Clicks">
                                            <f:facet name="actions">
                                                <p:button id="clicks" styleClass="ui-panel-titlebar-icon ui-corner-all ui-state-default ui-icon" icon="ui-icon-help" onclick="return false;" />
                                                <p:tooltip for="clicks" value="Mouse clicks" />
                                            </f:facet>
                                            <div class="count">
                                                <h:outputText value="#{dashboardUserBean.trackerStatistic.clicks}"/>
                                            </div>
                                        </p:panel>
                                    </div>
                                </div>
                                <div class="ui-g">
                                    <div class="ui-g-12">
                                        <p:panel header="Key presses">
                                            <f:facet name="actions">
                                                <p:button id="keyPresses" styleClass="ui-panel-titlebar-icon ui-corner-all ui-state-default ui-icon" icon="ui-icon-help" onclick="return false;" />
                                                <p:tooltip for="keyPresses" value="Total number of key presses on the keyboard" />
                                            </f:facet>
                                            <div class="count">
                                                <h:outputText value="#{dashboardUserBean.trackerStatistic.keyPresses}"/>
                                            </div>
                                        </p:panel>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </p:panel>
                </h:panelGroup>
            </div>

        </div>
            <footer>
                <div class="pull-left">
                    Davide Taibi
                    <a href="http://www.itd.cnr.it">CNR-ITD</a>
                </div>
                <div class="clearfix"></div>
            </footer>

    </ui:define>
</ui:composition>
