<ui:composition template="/WEB-INF/templates/layout/template.xhtml"
	xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
	xmlns:h="http://xmlns.jcp.org/jsf/html"
	xmlns:f="http://xmlns.jcp.org/jsf/core"
	xmlns:p="http://primefaces.org/ui">

	<ui:param name="loginRequired" value="true" />
	<ui:define name="metadata">
		<f:metadata>
			<f:viewAction action="#{activityDashboardBean.onLoad}" />
		</f:metadata>
	</ui:define>
	<ui:param name="loginRequired" value="true" />
	<ui:param name="pageTitle" value="Activity Dashboard" />

	<ui:define name="content">
		<h:outputStylesheet library="admin-dashboard" name="activity.css" />
		<h:outputScript library="admin-dashboard" name="activity.js" target="body" />

		<div class="page-header">
			<h1>
				Activity Dashboard
			</h1>
		</div>

		<div class="form">
			<div class="p-grid">
				<div class="p-col-12">
					<div class="p-grid">
						<div class="p-col-2">
							<div class="card card-w-title">
								<div class="center-header" id="group_header">
									<h2>User List</h2>
								</div>

								<div class="menu_section"
									 style="height: calc(100vh - 102px); overflow-y: auto; width: 100%;">
									<p:dataList id="usersList"
												value="#{activityDashboardUsersBean.usersList}" var="user"
												type="ordered">
										<div>
											<h:outputText value="#{user.username}" />
										</div>

									</p:dataList>
								</div>
							</div>
						</div>

						<div class="p-col no-padding">
							<div class="p-col-12">
								<div class="card card-w-title">
									<div class="center-header user-activities" id="group_header">
										<h2>Users' Activities</h2>
										<p class="header_detail no-margin-top">All user interactions</p>
									</div>

									<h:panelGroup id="dashboardOptions" styleClass="dashboard"
												  layout="block">
										<div class="p-grid">
											<div class="p-col-3">
												<div class="p-grid ui-fluid">
													<div class="p-col-12 auto-button">
														<p:commandButton value="Select Users" type="button"
																		 onclick="PF('dlg2').show();" />
														<p:dialog header="Select Users" widgetVar="dlg2" modal="true"
																  height="300" width="450">
															<h:form id="user_form" style="padding:0 5px;"
																	prependId="false">
																<div style="overflow-y: auto; max-height: 265px;">
																	<ui:include src="/templates/user/user_select_form.xhtml" />
																</div>
																<p:commandButton
																				 actionListener="#{activityDashboardBean.onSubmitSelectedUsers}"
																				 value="Gather data of selected users" process="@form"
																				 update=":dashboardMain1 :usersList :growl"
																				 oncomplete="PF('dlg2').hide();" />
															</h:form>
														</p:dialog>
													</div>
												</div>
											</div>
										</div>
									</h:panelGroup>
									<div class="p-col-9 no-padding">
										<h:form id="dateForm">
											<div class="p-grid ui-fluid">
												<div class="p-col-4">
													<div class="ui-inputgroup">
														<p:outputLabel for="dateStart" />
														<p:calendar id="dateStart"
																	value="#{activityDashboardBean.startDate}" showOn="button" />
													</div>
												</div>

												<div class="p-col-4">
													<div class="ui-inputgroup">
														<p:outputLabel for="dateEnd" />
														<p:calendar id="dateEnd"
																	value="#{activityDashboardBean.endDate}" showOn="button" />
													</div>
												</div>

												<div class="p-col-4">
													<div class="auto-button">
														<p:commandButton value="Update"
																		 update=":dashboardMain1 :growl  "
																		 actionListener="#{activityDashboardBean.cleanAndUpdateStoredData}"
																		 icon="ui-icon-check" />
													</div>
												</div>
												<div id="grouped_activities" class="p-col-12">

													<p:selectManyCheckbox id="grid1" widgetVar="grid1"
																		  value="#{activityDashboardBean.selectedActionItems}"
																		  layout="responsive" columns="3" multiple="true"
																		  onchange="unselectAllCheckBoxes(PF('grid2'))">

														<f:selectItems
																value="#{activityDashboardBean.actions.keySet()}"
																var="action" itemLabel="#{action}" itemValue="#{action}" />

													</p:selectManyCheckbox>
												</div>

												<div class="p-col-4 no-padding-bottom">
													<div id="advanced_options">
														<span><h:outputText value="Advanced options" /></span> <i
															class="fa fa-angle-double-up" />
													</div>
												</div>
												<div id="all_activities" class="p-col-12">
													<p:selectManyCheckbox id="grid2" widgetVar="grid2"
																		  value="#{activityDashboardBean.selectedGroupedActions}"
																		  layout="responsive" columns="3"
																		  onchange="unselectAllCheckBoxes(PF('grid1'))">

														<f:selectItems value="#{activityDashboardBean.groupedActions}"
																	   var="groupedAction" itemLabel="#{groupedAction}"
																	   itemValue="#{groupedAction}" />
													</p:selectManyCheckbox>

												</div>

											</div>



										</h:form>
									</div>



									<h:panelGroup id="dashboardMain1" styleClass="dashboard"
												  layout="block">
										<div class="p-col-12">
											<p:panel
													rendered="#{activityDashboardBean.interactionsChart!=null}"
													id="chart_plot_011" header="Activities">
												<f:facet name="actions">
													<p:button id="interactions"
															  styleClass="ui-panel-titlebar-icon ui-corner-all ui-state-default ui-icon"
															  icon="ui-icon-help" onclick="return false;" />
													<p:tooltip for="interactions"
															   value="Number of selected activities (of all selected users) per day" />
												</f:facet>
												<p:chart type="line"
														 model="#{activityDashboardBean.interactionsChart}"
														 style="height:300px;" responsive="true" />
											</p:panel>

										</div>
									</h:panelGroup>


								</div>
							</div>
						</div>

					</div>
				</div>
			</div>
		</div>


	</ui:define>

</ui:composition>