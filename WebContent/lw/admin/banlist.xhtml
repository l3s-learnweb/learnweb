<ui:composition
	template="/WEB-INF/templates/layout/template.xhtml"
	xmlns="http://www.w3.org/1999/xhtml"
	xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
	xmlns:h="http://xmlns.jcp.org/jsf/html"
	xmlns:f="http://xmlns.jcp.org/jsf/core"
    xmlns:p="http://primefaces.org/ui"
	xmlns:pt="http://xmlns.jcp.org/jsf/passthrough">

	<ui:param name="loginRequired" value="true"/>
	<ui:param name="pageTitle" value="#{msg.banlist_header}"/>

	<ui:define name="content">


	<h:outputScript library="admin" name="banlist.js" target="head" />

       <!-- <div class="page-header">
            <h1>Banlist</h1>
        </div>-->

        <ui:fragment>
            <div class="p-grid" >
                <div class="p-col-12 border-box no-padding-bottom">
                    <div class="card card-w-title">
                        <h2><h:outputText value="#{msg.manual_ban}" /></h2>
                        <div class="panel-as-block">
                            <p:panel>
                                <h:form class="banform" id="banformreg">
                                <h:panelGrid columns="3">
                                    <h:outputText value="#{msg.name_or_ip}:" />
                                    <p:inputText value="#{adminBanlistBean.name}" id="name" required="true" />
                                    <p:selectOneRadio value="#{adminBanlistBean.type}" required="true" id="type">
                                        <f:selectItem itemValue="user" itemLabel="User" />
                                        <f:selectItem itemValue="ip" itemLabel="IP" />
                                    </p:selectOneRadio>

                                    <h:outputText value="#{msg.ban_for}:" />
                                    <ui:fragment>
                                        <h:inputText value="#{adminBanlistBean.banDays}" required="false" pt:placeholder="Days" pt:value="" class="numinput" style="width:50px" />
                                        <h:inputText value="#{adminBanlistBean.banHours}" required="false" pt:placeholder="Hours" pt:value="" class="numinput" style="width:50px;     margin: 0 9px;" />
                                        <h:inputText value="#{adminBanlistBean.banMinutes}" required="false" pt:placeholder="Mins" pt:value="" class="numinput" style="width:50px" />
                                    </ui:fragment>

                                    <ui:fragment>
                                        <p:selectBooleanCheckbox value="#{adminBanlistBean.permaban}" style="margin-right: 5px;" id="permabancheckbox"/> <p:outputLabel for="permabancheckbox">#{msg.permaban}</p:outputLabel>
                                    </ui:fragment>

                                    <p:commandButton action="${adminBanlistBean.onManualBan}" value="#{msg.manual_ban}" process="@form" style="margin-top:10px;" ajax="false" />
                                    <h:outputText />
                                    <h:outputText />

                                </h:panelGrid>
                            </h:form>
                        </p:panel>
                        </div>
                    </div>
                </div>
            </div>
            <h:form styleClass="no-padding margin-top" id="banlistform" >
                <p:dataTable var="accessData" paginatorPosition="bottom" value="#{adminBanlistBean.banlist}" rows="50" paginator="true"
                             paginatorTemplate="{FirstPageLink} {PreviousPageLink} {PageLinks} {NextPageLink} {LastPageLink}">

                    <p:column headerText="#{msg.name}" sortBy="#{accessData.name}">
                        <h:outputText value="#{accessData.name}" />
                    </p:column>

                    <p:column headerText="#{msg.bandate}" sortBy="#{accessData.banDate}">
                        <h:outputText value="#{accessData.banDate}">
                            <f:convertDateTime pattern="dd.MM.yyyy HH:mm" />
                        </h:outputText>
                    </p:column>

                    <p:column headerText="#{msg.bannedon}" sortBy="#{accessData.bannedOn}">
                        <h:outputText value="#{accessData.bannedOn}">
                            <f:convertDateTime pattern="dd.MM.yyyy HH:mm" />
                        </h:outputText>
                    </p:column>

                    <p:column headerText="#{msg.attempts}" sortBy="#{accessData.attempts}">
                        <h:outputText value="#{accessData.attempts}"/>
                    </p:column>

                    <p:column styleClass="column-button" headerText="#{msg.options}">
                        <f:facet name="header">
                            #{msg.options}
                        </f:facet>
                        <p:commandLink actionListener="#{adminBanlistBean.onUnban(accessData.name)}" process="@this"
                                       update=":banlistform :growl"
                                       style="text-decoration:none;" title="#{msg.unban}">
                            <p:confirm message="#{msg.unban} #{accessData.name}?" />
                            <h:graphicImage value="/resources/icon/Remove.png" width="16" height="16" alt="#{msg.unban}" />
                        </p:commandLink>
                    </p:column>
                </p:dataTable>
            </h:form>
        </ui:fragment>



		<p:panel header="#{msg.suspicious_activity}" rendered="#{not empty adminBanlistBean.suspiciousActivityList}">

		<p>#{msg.suspicious_activity_message}</p>

			<p:dialog header="Ban" widgetVar="bandialog" modal="true" height="100">
				<h:form class="banform" id="banformdialog">
					<h:panelGrid columns="3">
						<h:outputText value="#{msg.name_or_ip}:" />						
						<p:inputText value="#{adminBanlistBean.name}" id="name" required="true" />
						<p:selectOneRadio value="#{adminBanlistBean.type}" required="true" id="type">
							<f:selectItem itemValue="user" itemLabel="User" />
							<f:selectItem itemValue="ip" itemLabel="IP" />
						</p:selectOneRadio>
						
						<h:outputText value="#{msg.ban_for}:" />
						<ui:fragment>
							<h:inputText value="#{adminBanlistBean.banDays}" required="false" pt:placeholder="Days" pt:value="" class="numinput" style="width:50px" />
							<h:inputText value="#{adminBanlistBean.banHours}" required="false" pt:placeholder="Hours" pt:value="" class="numinput" style="width:50px" />
							<h:inputText value="#{adminBanlistBean.banMinutes}" required="false" pt:placeholder="Mins" pt:value="" class="numinput" style="width:50px" />
						</ui:fragment>

						<ui:fragment>
							<p:selectBooleanCheckbox value="#{adminBanlistBean.permaban}" style="margin-right: 5px;" id="permabancheckbox"/> <p:outputLabel for="permabancheckbox">#{msg.permaban}</p:outputLabel>
						</ui:fragment>

						<p:commandButton action="${adminBanlistBean.onManualBan}" value="#{msg.manual_ban}" process="@form" style="margin-top:10px;" />
						<h:outputText />
						<h:outputText />
					</h:panelGrid>
				</h:form>
			</p:dialog>

			<h:form id="suspiciouslistform" >
			<p:dataTable  paginatorPosition="bottom" var="aggrReqData" value="#{adminBanlistBean.suspiciousActivityList}" rows="50" paginator="true"
						 paginatorTemplate="{FirstPageLink} {PreviousPageLink} {PageLinks} {NextPageLink} {LastPageLink}">

					<p:column headerText="IP" sortBy="#{aggrReqData.IP}" >
						<h:outputText value="#{aggrReqData.IP}" />
					</p:column>

					<p:column headerText="#{msg.requests_count}" sortBy="#{aggrReqData.requests}"  >
						<h:outputText value="#{aggrReqData.requests}" />
					</p:column>

					<p:column headerText="#{msg.logins_amount}" sortBy="#{aggrReqData.loginCount}">
						<h:outputText value="#{aggrReqData.loginCount}" />
					</p:column>

					<p:column headerText="#{msg.request_usernames}" sortBy="#{aggrReqData.usernames}">
						<h:outputText value="#{aggrReqData.usernames}" />
					</p:column>

					<p:column headerText="#{msg.time_stamp}" sortBy="#{aggrReqData.time}">
						<h:outputText value="#{aggrReqData.time}">
						    <f:convertDateTime pattern="dd.MM.yyyy HH:mm" />
						</h:outputText>
					</p:column>

					<p:column headerText="#{msg.options}">
						<f:facet name="header">
							#{msg.options}
						</f:facet>

						<p:commandLink onclick="PF('bandialog').show(); setname('#{entry.IP}')" process="@this"
							update=":suspiciouslistform :growl"
							style="text-decoration:none;" title="#{msg.ban}">
							<h:graphicImage value="/resources/icon/silk/delete.png" width="16" height="16" alt="#{msg.ban}" />
						</p:commandLink>

						<p:commandLink actionListener="#{adminBanlistBean.onRemoveSuspicious(aggrReqData.IP)}" 
									   update=":suspiciouslistform :growl"
									   style="text-decoration:none;" title="#{msg.remove}">
							<p:confirm message="#{msg.remove} #{aggrReqData.IP}?" />
							<h:graphicImage value="/resources/icon/Remove.png" width="16" height="16" alt="#{msg.remove}" />
						</p:commandLink>
					</p:column>
			</p:dataTable>
		</h:form>

		</p:panel>

		<!--<p:panel header="#{msg.banlist}"></p:panel>-->

	</ui:define>
</ui:composition>