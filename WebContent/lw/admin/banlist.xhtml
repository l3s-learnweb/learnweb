<ui:composition
	template="/templates/main/main.xhtml"
	xmlns="http://www.w3.org/1999/xhtml"
	xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
	xmlns:h="http://xmlns.jcp.org/jsf/html"
	xmlns:f="http://xmlns.jcp.org/jsf/core"
    xmlns:p="http://primefaces.org/ui"
	xmlns:pt="http://xmlns.jcp.org/jsf/passthrough">

	<ui:param name="loginRequired" value="true"/>
	<ui:param name="pageTitle" value="#{msg.banlist_header}"/>

	<ui:define name="center_layout">

	<style type="text/css">
		.ui-state-hover, .ui-state-focus, .ui-state-active{
			box-shadow:0 0 0px 0px #fff !important;
			background-color:#d1d1d1 !important;
			background-image:none !important;
			border:1px solid #a8a8a8 !important;
		}

		.page_header{margin:5px 5px 0px 5px;}
		#banlistform{padding:5px; width:100%;}
	</style>

	<h:outputScript library="admin" name="banlist.js" target="head" />
		<p:panel header="#{msg.suspicious_activity}" style="margin:5px;" rendered="#{not empty adminBanlistBean.suspiciousActivityList}">

		<p style="color: #c94132;">#{msg.suspicious_activity_message}</p> <br/>

		<p:dialog header="Ban" widgetVar="bandialog" modal="true" height="100">
			<h:form class="banform" id="banformdialog">
			<h:panelGrid columns="3">
				#{msg.name_or_ip}:
				<h:inputText value="#{adminBanlistBean.name}" id="name" required="true"/>

				<h:selectOneRadio value="#{adminBanlistBean.type}" required="true" id="type">
				   	<f:selectItem itemValue="user" itemLabel="User"/>
				   	<f:selectItem itemValue="ip" itemLabel="IP" />
				</h:selectOneRadio>
				<br/>

				#{msg.ban_for}: <br/>

				<ui:fragment>
					<h:inputText value="#{adminBanlistBean.banDays}" required="false" pt:placeholder="Days" pt:value="" class="numinput"/>
					<h:inputText value="#{adminBanlistBean.banHours}" required="false" pt:placeholder="Hours" pt:value="" class="numinput"/>
					<h:inputText value="#{adminBanlistBean.banMinutes}" required="false" pt:placeholder="Mins" pt:value="" class="numinput"/>
				</ui:fragment>

				<ui:fragment>
					<label><h:selectBooleanCheckbox value="#{adminBanlistBean.permaban}" style="margin-right: 5px;"/>
					#{msg.permaban}</label>
				</ui:fragment>

				<h:commandButton action="${adminBanlistBean.onManualBan}" value="#{msg.manual_ban}" process="@form" style="margin-top:10px;"/>
				</h:panelGrid>
			</h:form>
		</p:dialog>

		<h:form id="suspiciouslistform" >
			<p:dataTable var="aggrReqData" value="#{adminBanlistBean.suspiciousActivityList}" rows="50" paginator="true"
						 paginatorTemplate="{FirstPageLink} {PreviousPageLink} {PageLinks} {NextPageLink} {LastPageLink}">

					<p:column headerText="IP" sortBy="#{aggrReqData.IP}" >
						<h:outputText value="#{aggrReqData.IP}" />
					</p:column>

					<p:column headerText="#{msg.requests_count}" sortBy="#{aggrReqData.requests}"  >
						<h:outputText value="#{aggrReqData.requests}" />
					</p:column>

					<p:column headerText="#{msg.logins_amount}" sortBy="#{aggrReqData.loginCount}">
						<h:outputText value="#{aggrReqData.loginCount}" />
					</p:column>

					<p:column headerText="#{msg.request_usernames}" sortBy="#{aggrReqData.usernames}">
						<h:outputText value="#{aggrReqData.usernames}" />
					</p:column>

					<p:column headerText="#{msg.time_stamp}" sortBy="#{aggrReqData.time}">
						<h:outputText value="#{aggrReqData.time}">
						    <f:convertDateTime pattern="dd.MM.yyyy HH:mm" />
						</h:outputText>
					</p:column>

					<p:column headerText="#{msg.options}">
						<f:facet name="header">
							#{msg.options}
						</f:facet>

						<p:commandLink onclick="PF('bandialog').show(); setname('#{entry.IP}')" process="@this"
							update=":suspiciouslistform :growl"
							style="text-decoration:none;" title="#{msg.ban}">
							<h:graphicImage value="/resources/icon/silk/delete.png" width="16" height="16" alt="#{msg.ban}" />
						</p:commandLink>

						<p:commandLink actionListener="#{adminBanlistBean.onRemoveSuspicious(aggrReqData.IP)}" process="@this"
									   update=":suspiciouslistform :growl"
									   style="text-decoration:none;" title="#{msg.remove}">
							<p:confirm message="#{msg.remove} #{aggrReqData.IP}?" />
							<h:graphicImage value="/resources/icon/Remove.png" width="16" height="16" alt="#{msg.remove}" />
						</p:commandLink>
					</p:column>
			</p:dataTable>
		</h:form>
		</p:panel>

		<br/>
		<p:panel header="#{msg.manual_ban}" style="margin:5px;">
			<h:form class="banform" id="banformreg">
			<h:panelGrid columns="3">
				#{msg.name_or_ip}:
				<h:inputText value="#{adminBanlistBean.name}" id="name" required="true"/>

				<h:selectOneRadio value="#{adminBanlistBean.type}" required="true" id="type">
				   	<f:selectItem itemValue="user" itemLabel="User"/>
				   	<f:selectItem itemValue="ip" itemLabel="IP" />
				</h:selectOneRadio>
				<br/>

				#{msg.ban_for}: <br/>

				<ui:fragment>
					<h:inputText value="#{adminBanlistBean.banDays}" required="false" pt:placeholder="Days" pt:value="" class="numinput"/>
					<h:inputText value="#{adminBanlistBean.banHours}" required="false" pt:placeholder="Hours" pt:value="" class="numinput"/>
					<h:inputText value="#{adminBanlistBean.banMinutes}" required="false" pt:placeholder="Mins" pt:value="" class="numinput"/>
				</ui:fragment>

				<ui:fragment>
					<h:selectBooleanCheckbox value="#{adminBanlistBean.permaban}" style="margin-right: 5px;"/>
					#{msg.permaban}
				</ui:fragment>

				<h:commandButton action="${adminBanlistBean.onManualBan}" value="#{msg.manual_ban}" process="@form" style="margin-top:10px;"/>
				</h:panelGrid>
			</h:form>
		</p:panel>

		<br/>

		<p:panel header="#{msg.banlist}">
		<h:form id="banlistform" >
			<p:dataTable var="accessData" value="#{adminBanlistBean.banlist}" rows="50" paginator="true"
						 paginatorTemplate="{FirstPageLink} {PreviousPageLink} {PageLinks} {NextPageLink} {LastPageLink}">

				<p:column headerText="#{msg.name}" sortBy="#{accessData.name}">
					<h:outputText value="#{accessData.name}" />
				</p:column>

				<p:column headerText="#{msg.bandate}" sortBy="#{accessData.banDate}">
					<h:outputText value="#{accessData.banDate}">
					    <f:convertDateTime pattern="dd.MM.yyyy HH:mm" />
					</h:outputText>
				</p:column>

				<p:column headerText="#{msg.bannedon}" sortBy="#{accessData.bannedOn}">
					<h:outputText value="#{accessData.bannedOn}">
					    <f:convertDateTime pattern="dd.MM.yyyy HH:mm" />
					</h:outputText>
				</p:column>

				<p:column headerText="#{msg.attempts}" sortBy="#{accessData.attempts}">
					<h:outputText value="#{accessData.attempts}"/>
				</p:column>

				<p:column headerText="#{msg.options}">
					<f:facet name="header">
						#{msg.options}
					</f:facet>
					<p:commandLink actionListener="#{adminBanlistBean.onUnban(accessData.name)}" process="@this"
								   update=":banlistform :growl"
								   style="text-decoration:none;" title="#{msg.unban}">
						<p:confirm message="#{msg.unban} #{accessData.name}?" />
						<h:graphicImage value="/resources/icon/Remove.png" width="16" height="16" alt="#{msg.unban}" />
					</p:commandLink>
				</p:column>
			</p:dataTable>
		</h:form>
	</p:panel>

	</ui:define>
</ui:composition>