<ui:composition template="/lw/templates/new_main_t.xhtml" 
	xmlns:ui="http://java.sun.com/jsf/facelets" 
	xmlns:h="http://java.sun.com/jsf/html" 
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:p="http://primefaces.org/ui">

	<ui:param name="helpText" value="#{msg.groupResourceHelp}"/>
	
	<ui:define name="metadata">
		<f:metadata>
			<f:viewParam name="group_id" value="#{groupDetailBean.groupId}" />
			<f:event type="javax.faces.event.PreRenderViewEvent" listener="#{groupDetailBean.preRenderView}" /> 
		</f:metadata>
	</ui:define>	

	<ui:param name="loginRequired" value="true" />
	<ui:param name="pageTitle" value="#{msg.group} - #{msg.resources}" />
	  
		<ui:define name="center_layout">
	
			<div class="center-header" id="group_header">
				<span>
					#{msg.resources}
				</span> 
				#{msg.of} #{groupDetailBean.group.title}
				<h:form id="center_header_form">
					<p:commandButton rendered="#{groupDetailBean.member}" styleClass="resource_button greenbutton" value="#{msg.upload_resource}" update=":add_resource_panel" oncomplete="update_header()">
						<f:setPropertyActionListener target="#{addResourceBean.resourceTargetGroupId}" value="#{groupDetailBean.groupId}"></f:setPropertyActionListener>
						<f:setPropertyActionListener target="#{groupDetailBean.newResourceClicked}" value="true"></f:setPropertyActionListener>
					</p:commandButton>
				
					<p:commandLink rendered="#{not groupDetailBean.member}" action="#{groupsBean.joinGroup}" styleClass="resource_button greenbutton"  update=":growl :group_menu @form" partialSubmit="true" process="@this" value="#{msg.join_group}">
						<f:setPropertyActionListener target="#{groupsBean.selectedGroup}" value="#{groupDetailBean.group}" />
					</p:commandLink>
				</h:form>
				
				<ul>								
					<li>
						<a class="" href="./group/overview.jsf?group_id=#{groupDetailBean.group.id}">
							<h:outputText value="#{msg.overview}" />
						</a>
					</li>								
					<li>
						<a class="active" href="./group/resources.jsf?group_id=#{groupDetailBean.group.id}">
							<h:outputText value="#{msg.resources}" />
						</a>
					</li>								
					<li>
						<a class="" href="./group/members.jsf?group_id=#{groupDetailBean.group.id}">
							<h:outputText value="#{msg.members}" />
						</a>
					</li>								
					<li>
						<a class="" href="./group/presentations.jsf?group_id=#{groupDetailBean.group.id}">
							<h:outputText value="#{msg.presentations}" />
						</a>
					</li>								
					<li>
						<a class="" href="./group/links.jsf?group_id=#{groupDetailBean.group.id}">
							<h:outputText value="#{msg.links}" />
						</a>
					</li>
				</ul>
			</div>			
			<br />
	
			<script type="text/javascript">
			/* <!-- */
				$("#center_pane").prepend($("#group_header"));
			/* --> */
			</script>
				
				<p:dialog id="confirmDialog" header="#{msg.delete_resource_title}"  widgetVar="confirmation" appendTo="@(body)" >
			        
			        <h:form prependId="false" id="confirm_dialog_form">
				        <p> <h:outputText value="#{msg.theResource}"/>
				        <b> <h:outputText value="#{groupDetailBean.clickedResource.title}" escape="false" /> </b> 
				        <h:outputText value=" #{msg.part_of}:"/></p>
				        <ul>
					        <ui:repeat var="group" value="#{groupDetailBean.clickedResource.groups}" escape="false">				       
					        	<li><h:outputText value="#{msg.the_group_genitive} " />
						        	<h:outputLink value="group/overview.jsf?group_id=#{group.id}">
						        		<h:outputText value="#{group.title}" />
						        	</h:outputLink>
					        	</li>
					        </ui:repeat>
					        <li> <h:outputText value="#{msg.private_resource} "/>
					         <h:outputText value=" #{groupDetailBean.clickedResource.ownerUser.username}"/></li>
				        </ul>
				        <p:commandButton value="#{msg.delete_from_group} '#{groupDetailBean.group.title}'" update=":datagrid :growl :add_resource_panel" oncomplete="PF('confirmation').hide(); update_header(); ;" actionListener="#{groupDetailBean.removeResourceFromGroup}" process=":datagrid" style="display:block; margin: 10px 0;"/>  
			        
			        </h:form>
			    </p:dialog>
				
				<p:dialog header="#{msg.upload_file}" widgetVar="file_dialog" modal="true" appendTo="@(body)" width="600" height="150">
					<h:form>
						<p:fileUpload  rendered="true" fileUploadListener="#{addResourceBean.handleFileUpload}" mode="advanced" auto="true" sizeLimit="10000000" widgetVar="fileUpload" oncomplete="PF('file_dialog').hide()" update=":add_resource_form:preview" label="#{msg.choose_file}" cancelLabel="abb"/> 
					</h:form>
				</p:dialog>
				<p:dialog header="#{msg.edit}" id="comment_dialog1" modal="true" minWidth="440" appendTo="@(body)" widgetVar="comment_dialog">
					<h:form id="comment_dialog_form">	
						<p:inputTextarea autoResize="1" maxHeight="20" value="#{resourceDetailBean.clickedComment.text}" id="edit_comment_textbox"></p:inputTextarea>
						<p:commandButton actionListener="#{resourceDetailBean.onEditComment}" update=":add_resource_panel" title="#{msg.save}" value="#{msg.save}"	onsuccess="PF('comment_dialog').hide();"></p:commandButton>
					</h:form>
				</p:dialog>
				<p:dialog header="#{msg.options}" closable="false" widgetVar="resource_dialog" appendTo="@(body)" modal="true" minWidth="540">
					<h:form id="resource_form">
						<h:panelGrid columns="2">
							<h:outputText value="#{msg.add_to}:" />
							<h:selectOneMenu value="#{groupDetailBean.selectedResourceTargetGroupId}">
								<f:selectItem itemLabel="#{msg.myResourcesTitle}" itemValue="0" />
								<f:selectItem itemLabel="------------" itemValue="-1" itemDisabled="true" />
								<f:selectItems var="group" value="#{userBean.user.writeAbleGroups}" itemLabel="#{group.title}" itemValue="#{group.id}" />
							</h:selectOneMenu>
		
							<h:outputText value="#{msg.title}:" />
							<p:inputText value="#{groupDetailBean.clickedResource.title}" styleClass="resource_dialog_field" />
		
							<h:outputText value="#{msg.description}:" />
							<p:inputTextarea value="#{groupDetailBean.clickedResource.description}" autoResize="true" styleClass="resource_dialog_field"/>
		
							<h:outputText value="Url:" />
							<p:inputText value="#{groupDetailBean.clickedResource.url}" disabled="true" styleClass="resource_dialog_field" />
		
							<h:outputText value="#{msg.type}:" />
							<p:inputText value="#{groupDetailBean.clickedResource.type}" disabled="true" styleClass="resource_dialog_field" />
		
							<h:outputText value="#{msg.author}:" />
							<p:inputText value="#{groupDetailBean.clickedResource.author}" styleClass="resource_dialog_field" />
							
							<h:outputText value=""></h:outputText>
							<h:panelGroup layout="block" styleClass="align-right">
								<p:commandButton value="#{msg.cancel}" onclick="PF('resource_dialog').hide(); return false;" />
								
								<p:commandButton value="#{msg.save}" action="#{groupDetailBean.addSelectedResource}" update=":datagrid :growl" process="@form :datagrid" oncomplete="PF('resource_dialog').hide()" />
							</h:panelGroup>
							
						</h:panelGrid>
					</h:form>
				</p:dialog>
				
				<p:dialog header="#{msg.link_to}" widgetVar="resource_link_dialog" modal="false" minWidth="540" styleClass="zindex10000">			
					<h:form id="resource_link_form">
						<h:panelGrid columns="2">
							<h:outputText value="#{msg.link_to}:"/>
							<h:selectOneMenu value="#{groupDetailBean.selectedResourceTargetGroupId}">
								<f:selectItems var="group" value="#{userBean.user.writeAbleGroups}" itemLabel="#{group.title}" itemValue="#{group.id}"/>
							</h:selectOneMenu>					
							
							<h:outputText value="" />
							<p:commandButton value="#{msg.save}" action="#{groupDetailBean.addSelectedResourceLink}" process="@form" update=":growl" oncomplete="PF('resource_link_dialog').hide()"/>
						</h:panelGrid>					
					</h:form>			
				</p:dialog>			
		

	
				<h:panelGroup id="datagrid" layout="block">
				
					<h:outputText value="#{msg.no_resources_found}" rendered="#{empty groupDetailBean.resources}" class="nothing_found"></h:outputText>
					
				    <ui:repeat var="result" value="#{groupDetailBean.resources}"> 
				     
			  		<h:form styleClass="resource_panel grey_border">
			  		
			        <p:commandLink styleClass="resource_command_link" update=":add_resource_panel" oncomplete="update_header()">
			        	<f:setPropertyActionListener target="#{groupDetailBean.clickedResource}" value="#{result}"></f:setPropertyActionListener>
			        	<f:setPropertyActionListener target="#{resourceDetailBean.clickedResource}" value="#{result}"></f:setPropertyActionListener>
			        	
				        	<h:outputText value="#{result.title}" escape="false" styleClass="resource_short_title" /> 
				             
				            <h:panelGrid styleClass="resource_panelgrid" columns="1">
				            	<p:row>
				            		<span class="groupid">#{result.id}</span>

									<h:graphicImage styleClass="resource_thumbnail" width="150" height="150" value="#{result.thumbnail1.url}" rendered="#{not empty result.thumbnail1}" alt="#{result.title}" />
						    		<h:outputText styleClass="resource_thumbnail" value='#{result.embeddedSize1.replaceAll("width=\".*\"","").replaceAll("height=\".*\"","").replaceAll("/>","").replaceAll(">","").concat(" width=\"150\" height=\"150\" />")}' escape="false" rendered="#{empty result.thumbnail1}"></h:outputText>

				            		<div class="buttons">
				            			<p:commandLink oncomplete="PF('resource_dialog').show()" title="#{msg.addToMyResources}" update=":resource_form" styleClass="buttons_link" process="@this"> <!-- resource_commandlink -->
											<h:graphicImage alt="Add" value="/resources/icon/Add.png"/>
											<f:setPropertyActionListener value="#{result}" target="#{groupDetailBean.clickedResource}" />
											<f:param name="group_id" value="#{groupDetailBean.groupId}" />
										</p:commandLink>
										
										<p:commandLink oncomplete="PF('resource_link_dialog').show();" title="#{msg.link_to}" rendered="#{userBean.isModerator() or true}" styleClass="buttons_link"> <!-- resource_commandlink -->
											<h:graphicImage alt="Add" value="/resources/icon/Add_blue.png" title="#{msg.link_to}" /> 
											<f:setPropertyActionListener value="#{result}" target="#{groupDetailBean.clickedResource}" />
											<f:param name="group_id" value="#{groupDetailBean.groupId}" /> 
										</p:commandLink>
				            			
				            			<p:commandLink  oncomplete="PF('confirmation').show();" title="#{msg.removeFromGroup}" rendered="#{groupDetailBean.canDeleteResource(result)}" styleClass="buttons_link" update=":confirm_dialog_form">
											<h:graphicImage alt="Remove" value="../resources/icon/Remove.png"/>
											
											<f:setPropertyActionListener value="#{result}" target="#{groupDetailBean.clickedResource}" />
											<f:param name="group_id" value="#{groupDetailBean.groupId}" />
										</p:commandLink>
										
										<p:commandLink title="#{msg.edit}" rendered="#{groupDetailBean.canDeleteResource(result)}" update=":add_resource_panel" styleClass="buttons_link">
											<h:graphicImage alt="Edit" value="../resources/icon/Edit.png"/>
												<f:setPropertyActionListener value="#{result}" target="#{groupDetailBean.clickedResource}" />
												<f:setPropertyActionListener target="#{groupDetailBean.editResourceClicked}" value="true"></f:setPropertyActionListener>
											<f:param name="group_id" value="#{groupDetailBean.groupId}" />
										</p:commandLink>
										
										<p:commandLink update=":resource_form" oncomplete="PF('resource_move_dialog').show();" title="#{msg.move_to}" rendered="#{userBean.isModerator() and false}" >
											<h:graphicImage value="/resources/icon/silk/delete.png" width="16" height="16" title="#{msg.move_to}" style="padding: 3px;"/> 
											<f:setPropertyActionListener value="#{result}" target="#{searchBean.selectedResource}" />
											<f:param name="group_id" value="#{groupDetailBean2.groupId}" /> 
										</p:commandLink>
				            		</div>
				            	</p:row>
				            	
				            	<div class="resource_summary">
									<span>${learnwebBean.getLocaleMessage(result.type)}</span> #{msg.added_by} <span>#{result.getOwnerUser().username}</span>
						        </div>
				            
					          
				            </h:panelGrid>  
				            
				    </p:commandLink>
				    </h:form>
				    </ui:repeat>
			    </h:panelGroup>				
			
				<ui:decorate  template="/lw/templates/paging.xhtml">
					<ui:param name="paginator" value="${groupDetailBean.paginator}" />
				</ui:decorate >
		</ui:define>
		<ui:define name="right_layout">
			<ui:decorate  template="/lw/templates/right_pane.xhtml">
				<ui:param name="bean" value="#{groupDetailBean}" />
			</ui:decorate >
		</ui:define>
</ui:composition>