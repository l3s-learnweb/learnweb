<ui:composition template="/templates/main/main_old.xhtml"
                xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
                xmlns:h="http://xmlns.jcp.org/jsf/html"
                xmlns:f="http://xmlns.jcp.org/jsf/core"
                xmlns:pt="http://xmlns.jcp.org/jsf/passthrough"
                xmlns:c="http://xmlns.jcp.org/jsp/jstl/core"
                xmlns:p="http://primefaces.org/ui">

    <ui:param name="loginRequired" value="true"/>
    <ui:param name="disableGrowl" value="false"/>
    <ui:param name="helpText" value="#{msg.groupResourceHelp}"/>
    <ui:param name="pageTitle" value="#{msg.group} - #{msg.resources}"/>

    <ui:define name="head-meta">
        <ui:fragment rendered="#{userBean.user.organisation.id eq 480}">
            <h:outputScript target="head" name="vendor/d3js-v3.5.17/d3.min.js" />
            <h:outputScript library="resources" name="resource_chloe_interface.js" target="head"/>
            <h:outputStylesheet library="resources" name="resource_chloe_interface.css" />
        </ui:fragment>
    </ui:define>

    <ui:define name="metadata">
        <f:metadata>
            <f:viewParam name="group_id" value="#{groupDetailBean.groupId}"/>
            <f:viewParam name="folder_id" value="#{groupDetailBean.selectedFolderId}"/>
            <f:viewParam name="resource_id" value="#{rightPaneBean.resourceId}"/>
            <f:viewAction action="#{groupDetailBean.onLoad}"/>
            <f:viewAction action="#{rightPaneBean.onLoad}"/>
        </f:metadata>
    </ui:define>

    <ui:define name="center_layout">

        <h:form>
            <p:remoteCommand name="selectGroupItemCommand" actionListener="#{groupDetailBean.actionSelectGroupItem}"
                             update=":right_pane_wrapper :growl" oncomplete="update_header();resourceDND();"/>
            <p:remoteCommand name="editGroupItemCommand" actionListener="#{groupDetailBean.actionEditGroupItem}"
                             update=":right_pane_wrapper :growl" oncomplete="update_header()"/>
            <p:remoteCommand name="createGroupItemCommand" actionListener="#{groupDetailBean.actionCreateGroupItem}"
                             update=":right_pane_wrapper :growl :resourcesView" oncomplete="update_header();"/>
            <p:remoteCommand name="openFolderCommand" actionListener="#{groupDetailBean.actionOpenFolder}"
                             update=":group_menu_tree :breadcrumbs :resourcesView :paginator :resourcesFilters :right_pane_wrapper :growl" oncomplete="update_header();resourceDND();scroller();"/>
            <p:remoteCommand name="updateGroupItemsCommand" actionListener="#{groupDetailBean.actionUpdateGroupItems}"
                             update=":group_menu_tree :resourcesView :paginator :resourcesFilters :right_pane_wrapper :growl" oncomplete="resourceDND();update_header();"/>
            <p:remoteCommand name="updateAddResourcePaneCommand" actionListener="#{groupDetailBean.updateTargetForAddResourceBean}"
                             update=":right_pane_wrapper :growl" oncomplete="update_header()"/>
            <p:remoteCommand name="updateThumbnailCommand" actionListener="#{resourceDetailBean.setResourceThumbnail}"
                             update=":right_pane_wrapper :resourcesView :growl" oncomplete="update_header();resourceDND();"/>
            <p:remoteCommand name="filterByCategoryCommand" actionListener="#{groupDetailBean.onCategoryFilterClick}"
                             update=":resourcesView :paginator :resourcesFilters" oncomplete="$('#center_pane .content').scrollTop(0);resourceDND();scroller();"/>
        </h:form>

        <div class="center-header" id="group_header">
            <h2>#{msg.resources}</h2>
            <span class="header_detail">
                    #{msg.of}
                #{groupDetailBean.group.title}
                (#{groupDetailBean.group.resourcesCount} #{msg.resources})
            </span>

            <c:if test="${userBean.user.organisation.id eq 480}">
                <h:form styleClass="layout_button" id="group_layout_options" prependId="false">
                    <p:commandButton value="#{msg.list_view}" icon="ui-icon-mylist"
                                     update=":resourcesView :group_layout_options"
                                     rendered="#{groupDetailBean.gridView}">
                        <f:setPropertyActionListener target="#{groupDetailBean.gridView}" value="false"/>
                    </p:commandButton>
                    <p:commandButton value="#{msg.grid_view}" icon="ui-icon-mygrid"
                                     update=":resourcesView :group_layout_options"
                                     rendered="#{!groupDetailBean.gridView}">
                        <f:setPropertyActionListener target="#{groupDetailBean.gridView}" value="true"/>
                    </p:commandButton>
                </h:form>
            </c:if>

            <h:form id="center_header_form">
                <p:commandButton id="add_group_resource_button" value="#{msg.upload_resource}" menuStyleClass="test"
                                 iconPos="right" styleClass="resource_button greenbutton resourcetoolbutton"
                                 type="button" rendered="#{groupDetailBean.group.canAddResources(userBean.user)}"/>
                <p:tieredMenu overlay="true" trigger="add_group_resource_button" my="left top" at="left bottom"
                              style="width:200px" widgetVar="add_resource_menu"
                              rendered="#{groupDetailBean.group.canAddResources(userBean.user)}">
                    <p:menuitem value="#{msg.create_folder}" icon="ui-icon-folder-collapsed"
                                onclick="doAction('create-folder'); PF('add_resource_menu').hide(); return false;"/>
                    <p:separator/>
                    <p:submenu label="#{msg.create}" icon="fa fa-plus-square">
                        <p:menuitem value="#{msg.office_document}"
                                    onclick="doAction('new-file', 'document'); PF('add_resource_menu').hide(); return false;"
                                    icon="fa fa-file-word-o" update=":right_pane_wrapper" oncomplete="update_header()"
                                    actionListener="#{addResourceBean.clearForm()}">
                        </p:menuitem>
                        <p:menuitem value="#{msg.office_spreadsheet}"
                                    onclick="doAction('new-file','spreadsheet'); PF('add_resource_menu').hide(); return false;"
                                    icon="fa fa-file-excel-o" update=":right_pane_wrapper" oncomplete="update_header()"
                                    actionListener="#{addResourceBean.clearForm()}">
                        </p:menuitem>
                        <p:menuitem value="#{msg.office_presentation}"
                                    onclick="doAction('new-file', 'presentation'); PF('add_resource_menu').hide(); return false;"
                                    icon="fa fa-file-powerpoint-o" update=":right_pane_wrapper"
                                    oncomplete="update_header()" actionListener="#{addResourceBean.clearForm()}">
                        </p:menuitem>
                    </p:submenu>
                    <p:menuitem value="#{msg.upload_file}" icon="ui-icon-disk"
                                onclick="doAction('upload-file'); PF('add_resource_menu').hide(); return false;"/>
                    <p:menuitem value="#{msg.upload_url}" icon="ui-icon-link"
                                onclick="doAction('add-website'); PF('add_resource_menu').hide(); return false;"/>
                    <p:menuitem value="#{msg['Glossary.add_glossary']}" icon="ui-icon-link"
                                onclick="doAction('add-glossary'); PF('add_resource_menu').hide(); return false;"/>
                </p:tieredMenu>

                <p:commandLink rendered="#{groupDetailBean.group.canJoinGroup(userBean.user)}" value="#{msg.join_group}"
                               action="#{groupsBean.joinGroup}" styleClass="resource_button greenbutton"
                               update=":growl :group_menu @form" partialSubmit="true" process="@this">
                    <f:setPropertyActionListener target="#{groupsBean.selectedGroup}" value="#{groupDetailBean.group}"/>
                </p:commandLink>
            </h:form>

            <ul>
                <li>
                    <a href="./group/overview.jsf?group_id=#{groupDetailBean.group.id}">
                        <h:outputText value="#{msg.overview}"/>
                    </a>
                </li>
                <li>
                    <a class="active" href="./group/resources.jsf?group_id=#{groupDetailBean.group.id}">
                        <h:outputText value="#{msg.resources}"/>
                    </a>
                </li>
                <li>
                    <a href="./group/members.jsf?group_id=#{groupDetailBean.group.id}">
                        <h:outputText value="#{msg.members}"/>
                    </a>
                </li>
				<ui:fragment rendered="#{not empty groupDetailBean.group.links or not empty groupDetailBean.group.documentLinks}">								
				<li>
					<a href="./group/links.jsf?group_id=#{groupDetailBean.group.id}">
						<h:outputText value="#{msg.links}" />
					</a>
				</li>	
				</ui:fragment>	
                <li>
                    <a href="./group/forum.jsf?group_id=#{groupDetailBean.group.id}">
                        <h:outputText value="#{msg.forum}"/>
                    </a>
                </li>
                <ui:fragment rendered="${groupDetailBean.group.course.isModerator(userBean.user) || groupDetailBean.group.isLeader(userBean.user)}">
                    <li>
                        <a href="./group/options.jsf?group_id=#{groupDetailBean.group.id}">
                            <h:outputText value="#{msg.options}"/>
                        </a>
                    </li>
                </ui:fragment>
            </ul>

            <c:if test="${userBean.user.organisation.id ne 480}">
                <h:panelGroup id="resourcesFilters" layout="block">
                    <h:form styleClass="resources-filters" id="filters">
                        <ul>
                            <ui:repeat value="#{groupDetailBean.availableFilters}" var="filter">
                                <li class="filter #{filter.disabled ? 'disabled' : (filter.active ? 'active' : null)}">
                                <span class="filter-name">
                                    <span class="trimmed-text">#{filter.name}</span>
                                    <span class="arrow"/>
                                </span>
                                    <ul class="filter-sub-bar vCarousel-wrapper filter-vCarousel">
                                        <h:panelGroup styleClass="vCarousel-container" layout="block">
                                            <li class="#{!filter.active ? 'active' : null}">
                                                <p:commandButton value="#{filter.anyText}"
                                                                 action="#{groupDetailBean.changeFilters(filter.anyUrl)}"
                                                                 update=":resourcesView :paginator :resourcesFilters"
                                                                 oncomplete="updateCarousel();resourceDND();"/>
                                            </li>

                                            <ui:repeat value="#{filter.items}" var="item">
                                                <li class="#{item.active ? 'active' : null}">
                                                    <p:commandButton
                                                            value="#{item.name} #{item.counter != null ? '('.concat(item.counter).concat(')') : null}"
                                                            action="#{groupDetailBean.changeFilters(item.url)}"
                                                            update=":resourcesView :paginator :resourcesFilters"
                                                            oncomplete="updateCarousel();resourceDND();"/>
                                                </li>
                                            </ui:repeat>

                                        </h:panelGroup>
                                        <li class="vCarousel-expand">
                                            <p:commandButton value="#{msg.filter_carousel_all}"/>
                                        </li>
                                    </ul>
                                </li>
                            </ui:repeat>

                            <li class="search-box #{groupDetailBean.query != null ? 'active' : null}">
                                <img src="#{request.contextPath}/resources/main-template/img/search.png" id="search_filter_icon"/>

                                <div id="search_filter_form">
                                    <h:inputText value="#{groupDetailBean.query}"/>

                                    <p:commandButton actionListener="${groupDetailBean.onQueryChange()}" partialSubmit="true"
                                                     oncomplete="$('#center_pane .content').scrollTop(0);resourceDND();scroller();"
                                                     process="@form" update=":resourcesView :paginator :resourcesFilters" value=""/>
                                </div>
                            </li>

                            <h:panelGroup rendered="#{groupDetailBean.searchFilters != null or groupDetailBean.query != null}">
                                <li class="filter clear-filters">
                                    <p:commandButton value="#{msg.clear_filters}"
                                                     action="#{groupDetailBean.clearFilters()}"
                                                     update=":resourcesView :paginator :resourcesFilters"
                                                     oncomplete="updateCarousel();resourceDND();"/>
                                </li>
                            </h:panelGroup>
                        </ul>
                    </h:form>
                </h:panelGroup>
            </c:if>

            <h:panelGroup id="breadcrumbs" styleClass="breadcrumbs" layout="block">
                <ui:fragment rendered="#{not empty groupDetailBean.breadcrumbs}">
                    <ul>
                        <li data-folderId="0">
                            <h:outputLink value="#" onclick="openFolder(0); return false;">#{groupDetailBean.group.title}</h:outputLink>
                        </li>

                        <ui:repeat var="folder" value="#{groupDetailBean.breadcrumbs}" varStatus="status">
                            <li data-folderId="#{folder.id}">
                                <h:outputLink rendered="#{not status.last}" value="#" nclick="openFolder(#{folder.id}); return false;">#{folder.name}</h:outputLink>
                                <h:outputText rendered="#{status.last}" value="#{folder.name}" escape="false" styleClass="bold"/>
                            </li>
                        </ui:repeat>
                    </ul>
                </ui:fragment>
            </h:panelGroup>
        </div>

        <ui:fragment rendered="${not groupDetailBean.group.canViewResources(userBean.user)}">
            <h3 class="error">
                #{msg.group_resources_access_denied}
                <h:outputText
                        rendered="${groupDetailBean.group.policyView != 'GROUP_LEADER' and groupDetailBean.group.canJoinGroup(userBean.user)}"
                        value="#{msg.group_resources_access_denied_join_first}"/>
            </h3>
        </ui:fragment>

        <c:if test="${userBean.user.organisation.id eq 480}">
            <h:panelGroup id="resourcesFilters" layout="block">
                <!-- from here begins the new metadata visualization -->
                <h:form id="yell-filters-tabs">
                    <p:tabView id="tabs">
                        <p:ajax event="tabChange" update=":resourcesView"/>

                        <p:tab id="keyword_tab" title="Keyword Search">
                            <h:form id="header_query_form" prependId="false">
                                <h:inputText style="width: 400px; padding: 3px 0;" value="#{groupDetailBean.query}"
                                             id="input_query_form"
                                             onkeyup="if (event.keyCode === 13) {document.getElementById('group_resource_searchbutton').click(); return false; }"/>

                                <p:commandButton actionListener="${groupDetailBean.onQueryChange()}" partialSubmit="false"
                                                 oncomplete="$('#center_pane .content').scrollTop(0);resourceDND();scroller();"
                                                 process="@form" update=":resourcesView :paginator :resourcesFilters"
                                                 value="#{msg.searchLabel}" id="group_resource_searchbutton"/>
                            </h:form>
                            <br/>

                            <h:form id="accordion_form" style="width:530px;">
                                <p:accordionPanel activeIndex="-2">
                                    <p:tab title="Filters - refine your search or narrow down your search results!">
                                        <h:form id="metadata_filter_form">
                                            <p:panelGrid columns="3" cellpadding="20" layout="grid">

                                                <h:panelGroup>
                                                    <h:outputLabel for="alist" value="Author:  "/>
                                                    <p:selectCheckboxMenu id="alist"
                                                                          value="#{groupDetailBean.selectedAuthors}"
                                                                          label="Authors" multiple="true" filter="true"
                                                                          filterMatchMode="startsWith">
                                                        <f:selectItems value="#{groupDetailBean.authors}"/>
                                                    </p:selectCheckboxMenu>
                                                </h:panelGroup>

                                                <h:panelGroup>
                                                    <h:outputLabel for="mtlist" value="Media Type:  "/>
                                                    <p:selectCheckboxMenu id="mtlist"
                                                                          value="#{groupDetailBean.selectedMtypes}"
                                                                          label="Media Types" multiple="true" filter="true"
                                                                          filterMatchMode="startsWith"
                                                                          panelStyle="width:250px">
                                                        <f:selectItems value="#{searchFilterBean.mtypes}"/>
                                                    </p:selectCheckboxMenu>
                                                </h:panelGroup>

                                                <h:panelGroup>
                                                    <h:outputLabel for="slist" value="Media Source:  "/>
                                                    <p:selectCheckboxMenu id="slist"
                                                                          value="#{groupDetailBean.selectedSources}"
                                                                          label="Sources" multiple="true" filter="true"
                                                                          filterMatchMode="startsWith"
                                                                          panelStyle="width:250px">
                                                        <f:selectItems value="#{groupDetailBean.msources}"/>
                                                    </p:selectCheckboxMenu>
                                                </h:panelGroup>

                                                <h:panelGroup>
                                                    <h:outputLabel for="llist" value="Language:"/>
                                                    <p:selectCheckboxMenu id="llist"
                                                                          value="#{groupDetailBean.selectedLanguages}"
                                                                          label="Languages" multiple="true" filter="true"
                                                                          filterMatchMode="startsWith"
                                                                          panelStyle="width:250px">
                                                        <f:selectItems value="#{searchFilterBean.langs}"/>
                                                    </p:selectCheckboxMenu>
                                                </h:panelGroup>

                                                <h:panelGroup>
                                                    <h:outputLabel for="levlist" value="Language Level:"/>
                                                    <p:selectCheckboxMenu id="levlist"
                                                                          value="#{groupDetailBean.selectedLevels}"
                                                                          label="Levels" multiple="true" filter="true"
                                                                          filterMatchMode="startsWith"
                                                                          panelStyle="width:250px">
                                                        <f:selectItems value="#{searchFilterBean.levels}"/>
                                                    </p:selectCheckboxMenu>
                                                </h:panelGroup>

                                                <h:panelGroup>
                                                    <h:outputLabel for="aglist" value="Target Learner:"/>
                                                    <p:selectCheckboxMenu id="aglist"
                                                                          value="#{groupDetailBean.selectedTargets}"
                                                                          label="Target Learners" multiple="true"
                                                                          filter="true" filterMatchMode="startsWith"
                                                                          panelStyle="width:250px">
                                                        <f:selectItems value="#{searchFilterBean.targets}"/>
                                                    </p:selectCheckboxMenu>
                                                </h:panelGroup>

                                                <h:panelGroup>
                                                    <h:outputLabel for="aclist" value="Purpose of Use:"/>
                                                    <p:selectCheckboxMenu id="aclist"
                                                                          value="#{groupDetailBean.selectedPurposes}"
                                                                          label="Purposes of Use" multiple="true"
                                                                          filter="true" filterMatchMode="startsWith"
                                                                          panelStyle="width:250px">
                                                        <f:selectItems value="#{searchFilterBean.purposes}"/>
                                                    </p:selectCheckboxMenu>
                                                </h:panelGroup>


                                                <p:commandButton styleClass="greenbutton" value="Filter"
                                                                 actionListener="#{groupDetailBean.onMetadataFilterClick}"
                                                                 oncomplete="$('#center_pane .content').scrollTop(0);resourceDND();scroller();"
                                                                 process="@form"
                                                                 update=":paginator :resourcesView"/>
                                            </p:panelGrid>
                                        </h:form>
                                    </p:tab>
                                </p:accordionPanel>
                            </h:form>
                            <hr/>

                            <b><h:outputText
                                    value="Click on the resource to view details or add more useful information to help community to discover!"/></b>
                        </p:tab>

                        <p:tab id="category_tab" title="Category Navigation">
                            <b><h:outputText
                                    value="Click on the category to view resources belonging to that category!"/></b>
                            <h:panelGroup id="catTreeSection">
                                <div id="cattree"></div>
                            </h:panelGroup>
                            <hr/>
                        </p:tab>

                    </p:tabView>
                </h:form>

                <h:outputText id="cat_tree" value="#{groupDetailBean.groupCatJson}" style="display:none"/>
                <h:outputText id="group_name" value="#{groupDetailBean.group.title}" style="display:none"/>
                <h:outputText id="group_resource" value="#{groupDetailBean.group.resourcesCount}" style="display:none"/>

                <script type="text/javascript">

                    $(document).on('ready', prepareCatInterface($("#cat_tree").text(), $("#group_name").text(), $("#group_resource").text()));

                </script>
            </h:panelGroup>
        </c:if>

        <ui:fragment rendered="#{groupDetailBean.group.canViewResources(userBean.user)}">
            <h:panelGroup id="resourcesView" layout="block" style="height: 100%; width: 100%;"
                          pt:data-canAddResources="#{groupDetailBean.group.canAddResources(userBean.user)}"
                          pt:data-canMoveResources="#{groupDetailBean.group.canMoveResources(userBean.user)}">

                <c:if test="${userBean.user.organisation.id eq 480}">
                    <ui:fragment rendered="#{not empty groupDetailBean.selectedCatNode}">
                        <h:outputText value="Selected category is: #{groupDetailBean.selectedCatNode}"/>
                    </ui:fragment>

                    <ui:fragment rendered="#{!groupDetailBean.gridView}">
                        <ui:decorate template="/lw/group/resources_list_view.xhtml"></ui:decorate>
                    </ui:fragment>

                    <ui:fragment rendered="#{groupDetailBean.gridView}">
                        <ui:decorate template="/lw/group/resources_grid_view.xhtml"></ui:decorate>
                    </ui:fragment>
                </c:if>

                <c:if test="${userBean.user.organisation.id ne 480}">
                    <ui:decorate template="/lw/group/resources_grid_view.xhtml"></ui:decorate>
                </c:if>
            </h:panelGroup>

            <h:panelGroup id="paginator" layout="block">
                <ui:decorate template="/templates/main/paging.xhtml">
                    <ui:param name="paginator" value="${groupDetailBean.paginator}"/>
                </ui:decorate>
            </h:panelGroup>

            <div class="context-menu resource-context-menu" role="menu" id="context-menu">
                <div class="context-menu-item action-open-folder" role="menuitem" data-action="open-folder" data-per="canViewResource">
                    <div class="context-menu-item-wrapper">
                        <span class="context-menu-item-icon"/>
                        <span class="context-menu-item-content">#{msg.open}</span>
                    </div>
                </div>
                <div class="context-menu-item action-create-folder" role="menuitem" data-action="create-folder" data-per="canAddResources">
                    <div class="context-menu-item-wrapper">
                        <span class="context-menu-item-icon"/>
                        <span class="context-menu-item-content">#{msg.create_folder}</span>
                    </div>
                </div>
                <div class="context-menu-item divider action-upload-file" role="menuitem" data-action="upload-file" data-per="canAddResources">
                    <div class="context-menu-item-wrapper">
                        <span class="context-menu-item-icon"/>
                        <span class="context-menu-item-content">#{msg.upload_file}</span>
                    </div>
                </div>
                <div class="context-menu-item action-add-website" role="menuitem" data-action="add-website" data-per="canAddResources">
                    <div class="context-menu-item-wrapper">
                        <span class="context-menu-item-icon"/>
                        <span class="context-menu-item-content">#{msg.upload_url}</span>
                    </div>
                </div>
                <div class="context-menu-item action-add-tag" role="menuitem" data-action="add-tag" data-per="canAnnotateResource">
                    <div class="context-menu-item-wrapper">
                        <span class="context-menu-item-icon"/>
                        <span class="context-menu-item-content">#{msg.addTag}</span>
                    </div>
                </div>
                <div class="context-menu-item action-edit" role="menuitem" data-action="edit" data-per="canEditResource">
                    <div class="context-menu-item-wrapper">
                        <span class="context-menu-item-icon"/>
                        <span class="context-menu-item-content">#{msg.edit}</span>
                    </div>
                </div>
                <div class="context-menu-item action-copy" role="menuitem" data-action="copy" data-per="canViewResource">
                    <div class="context-menu-item-wrapper">
                        <span class="context-menu-item-icon"/>
                        <span class="context-menu-item-content">#{msg.copy}</span>
                    </div>
                </div>
                <div class="context-menu-item action-move" role="menuitem" data-action="move" data-per="canDeleteResource">
                    <div class="context-menu-item-wrapper">
                        <span class="context-menu-item-icon"/>
                        <span class="context-menu-item-content">#{msg.move}</span>
                    </div>
                </div>
                <div class="context-menu-item action-delete" role="menuitem" data-action="delete" data-per="canDeleteResource">
                    <div class="context-menu-item-wrapper">
                        <span class="context-menu-item-icon"/>
                        <span class="context-menu-item-content">#{msg.removeFromGroup}</span>
                    </div>
                </div>
            </div>
        </ui:fragment>

        <p:dialog id="deleteConfirmDialog" header="#{msg.delete_resource_title}" widgetVar="deleteConfirm"
                  appendTo="@(body)" closable="false" minWidth="540" modal="true">
            <p>
                <h:outputText value="#{msg.delete_confirm_dialog_content_folder}" styleClass="single-folder"/>
                <h:outputText value="#{msg.delete_confirm_dialog_content}" styleClass="single-resource"/>
                <h:outputText value="#{msg.delete_confirm_dialog_content_plural}" styleClass="plural"/>
            </p>

            <h:panelGroup colspan="2" styleClass="float-right" style="margin: 10px 0;">
                <p:button value="#{msg.cancel}" styleClass="graybutton"
                          onclick="PF('deleteConfirm').hide(); return false;"/>
                <p:button value="#{msg.delete}" styleClass="confirm greenbutton" onclick="return false"/>
            </h:panelGroup>
        </p:dialog>

        <p:dialog id="selectDestinationDialog" header="#{msg.selectDestination}" widgetVar="selectDestination" appendTo="@(body)" closable="false" minWidth="540" modal="true">
            <h:panelGrid columns="2">
                <h:outputText value="#{msg.add_to}:"/>

                <h:form>
                    <p:tree id="folders_tree" value="#{userBean.writeAbleGroupsTree}" var="node" animate="true" dynamic="true" selectionMode="single" selection="#{groupDetailBean.selectedTargetNode}" style="max-height:28rem; overflow:auto;">
                        <p:ajax event="select" listener="#{groupDetailBean.onTargetNodeSelect}"/>

                        <p:treeNode type="group">
                            <h:outputText id="group" value="#{node.title}"/>
                        </p:treeNode>

                        <p:treeNode type="folder" expandedIcon="ui-icon-folder-open" collapsedIcon="ui-icon-folder-collapsed">
                            <h:outputText value="#{node.name}"/>
                        </p:treeNode>
                    </p:tree>
                </h:form>
            </h:panelGrid>

            <h:panelGroup colspan="2" styleClass="float-right" style="margin: 10px 0;">
                <p:button value="#{msg.cancel}" styleClass="graybutton" onclick="PF('selectDestination').hide(); return false;"/>
                <p:button value="#{msg.save}" styleClass="confirm greenbutton" onclick="return false;"/>
            </h:panelGroup>
        </p:dialog>

        <p:dialog id="addTagDialog" header="#{msg.addTag}" widgetVar="addTag" appendTo="@(body)" closable="false" minWidth="540" modal="true">
            <h:panelGrid columns="1">
                <p:inputText id="modal_tag_name"/>
            </h:panelGrid>

            <h:panelGroup colspan="2" styleClass="float-right" style="margin: 10px 0;">
                <p:button value="#{msg.cancel}" styleClass="graybutton" onclick="PF('addTag').hide(); return false;"/>
                <p:button value="#{msg.save}" styleClass="confirm greenbutton" onclick="return false"/>
            </h:panelGroup>
        </p:dialog>

        <script type="text/javascript">
            $(document).on("click", "#search_filter_icon", function ()
            {
                $("#search_filter_form").animate({width: "toggle"}, 500, 'swing');
                $("#search_filter_form input").focus();
                $("#search_filter_icon").hide();
            });

            updateCarousel();

            $("#center_pane").prepend($("#group_header")).append($("#paginator"));
        </script>
    </ui:define>

    <ui:define name="right_layout">
        <ui:decorate template="/templates/resources/right_pane.xhtml">
            <ui:param name="bean" value="#{groupDetailBean}"/>
        </ui:decorate>
    </ui:define>
</ui:composition>