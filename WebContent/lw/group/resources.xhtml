<ui:composition template="/lw/templates/new_main_t.xhtml" 
	xmlns:ui="http://java.sun.com/jsf/facelets" 
	xmlns:h="http://java.sun.com/jsf/html" 
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:p="http://primefaces.org/ui">

	<ui:define name="metadata">
		<f:metadata>
			<f:viewParam name="group_id" value="#{groupDetailBean.groupId}" />
			<f:event type="javax.faces.event.PreRenderViewEvent" listener="#{groupDetailBean.preRenderView}" /> 
		</f:metadata>
	</ui:define>	

	<ui:param name="loginRequired" value="true" />
	<ui:param name="pageTitle" value="#{msg.group} - #{msg.resources}" />

	  
		<ui:define name="center_layout">
				<h:form id="mode_selection" rendered="false">
					<p:selectOneButton value="#{groupDetailBean.mode}">  
		            <f:selectItem itemLabel="Everything" itemValue="everything" />  
		            <f:selectItem itemLabel="Multimedia" itemValue="multimedia" />  
		            <f:selectItem itemLabel="Web" itemValue="text" /> 
		             <p:ajax event="change" update=":resource_disp"></p:ajax> 
	        		</p:selectOneButton> 
				</h:form>
				<br></br>
				<h:form id="add_resource">
					<p:commandButton styleClass="resource_button greenbutton" value="#{msg.upload_resource}" widgetVar="add_resource" update=":add_resource_panel" oncomplete="update_header()">
						<f:setPropertyActionListener target="#{addResourceBean.resourceTargetGroupId}" value="#{groupDetailBean.groupId}"></f:setPropertyActionListener>
						<f:setPropertyActionListener target="#{groupDetailBean.newResourceClicked}" value="true"></f:setPropertyActionListener>
					</p:commandButton>
				</h:form>
				<script type="text/javascript">
					var div = document.createElement("div");
					var group_header = document.createElement("span");
					$(group_header).addClass("group_header");
					$(group_header).html("#{msg.resources}");
					var group_owner = document.createElement("span");
					$(group_owner).addClass("group_owner");
					$(group_owner).html(" #{msg.of} #{groupDetailBean.group.title}");
					var cl = $("#add_resource").clone();
		            $(cl).appendTo(div);
		            $("#add_resource").remove()
					$(div).append(group_header);
					$(div).append(group_owner);
					$(div).addClass("ui-layout-unit-header ui-widget-header ui-corner-all");
					$("#center_pane").prepend(div);
		
										
					$(document).ready(nCol);
					window.onresize = nCol;
					
					var columns = 3;
					function nCol(){
						var w = $(window).width();
						var c = 3;
						
						if(w &lt; 1360)
							c = 2;
						
						console.log(columns, c);
						
						if(columns != c) {
							columns = c;
							updateColumns([{name:'cols',value: columns}]);
						}
						
					}
				</script>
				
				<p:dialog id="confirmDialog" header="#{msg.delete_resource_title}"  widgetVar="confirmation" appendTo="@(body)" >
			        
			        <h:form prependId="false" id="confirm_dialog_form">
				        <p> <h:outputText value="#{msg.theResource}"/>
				        <b> <h:outputText value="#{groupDetailBean.clickedResource.title}" escape="false" /> </b> 
				        <h:outputText value=" #{msg.part_of}:"/></p>
				        <ul>
					        <ui:repeat var="group" value="#{groupDetailBean.clickedResource.groups}" escape="false">				       
					        	<li><h:outputText value="#{msg.the_group_genitive} " />
						        	<h:outputLink value="group/overview.jsf?group_id=#{group.id}">
						        		<h:outputText value="#{group.title}" />
						        	</h:outputLink>
					        	</li>
					        </ui:repeat>
					        <li> <h:outputText value="#{msg.private_resource} "/>
					         <h:outputText value=" #{groupDetailBean.clickedResource.ownerUser.username}"/></li>
				        </ul>
				        <p:commandButton value="#{msg.delete_from_group} '#{groupDetailBean.group.title}'" update=":datagrid :growl :add_resource_panel" oncomplete="PF('confirmation').hide(); update_header(); ;"  
				                   actionListener="#{groupDetailBean.removeResourceFromGroup}" process=":datagrid" style="display:block; margin: 10px 0;"/>  
			              
		   
				        
			        </h:form>
			    </p:dialog>
				
				<p:dialog header="Upload File" widgetVar="file_dialog" modal="true" appendTo="@(body)" width="600" height="150">
					<h:form>
						<p:fileUpload  rendered="true" fileUploadListener="#{addResourceBean.handleFileUpload}"  
			            mode="advanced"  
			            auto="true"
			            sizeLimit="10000000"   
			            widgetVar="fileUpload"
			            oncomplete="PF('file_dialog').hide()"
			            update=":add_resource_form:preview"
			            /> 
					</h:form>
				</p:dialog>
				<p:dialog header="#{msg.edit}" id="comment_dialog1" modal="true" minWidth="440" appendTo="@(body)" widgetVar="comment_dialog">
					<h:form id="comment_dialog_form">	
						<p:inputTextarea autoResize="1" maxHeight="20" value="#{groupDetailBean.clickedComment.text}" id="edit_comment_textbox"></p:inputTextarea>
						<p:commandButton actionListener="#{groupDetailBean.onEditComment}" update=":add_resource_panel" 
											title="#{msg.save}" value="#{msg.save}"								
											onsuccess="PF('comment_dialog').hide();">
						</p:commandButton>
					</h:form>
				</p:dialog>
				<p:dialog header="#{msg.options}" closable="false" widgetVar="resource_dialog" appendTo="@(body)" modal="true" minWidth="540">
					<h:form id="resource_form">
						<h:panelGrid columns="2">
							<h:outputLabel value="#{msg.add_to}:" />
							<h:selectOneMenu value="#{groupDetailBean.selectedResourceTargetGroupId}">
								<f:selectItem itemLabel="#{msg.myResourcesTitle}" itemValue="0" />
								<f:selectItem itemLabel="------------" itemValue="-1" itemDisabled="true" />
								<f:selectItems var="group" value="#{userBean.user.writeAbleGroups}" itemLabel="#{group.title}" itemValue="#{group.id}" />
							</h:selectOneMenu>
		
							<h:outputLabel value="#{msg.title}:" />
							<p:inputText value="#{groupDetailBean.clickedResource.title}" styleClass="resource_dialog_field" />
		
							<h:outputLabel value="#{msg.description}:" />
							<p:inputTextarea value="#{groupDetailBean.clickedResource.description}" autoResize="true" styleClass="resource_dialog_field"/>
		
							<h:outputLabel value="Url:" />
							<p:inputText value="#{groupDetailBean.clickedResource.url}" disabled="true" styleClass="resource_dialog_field" />
		
							<h:outputLabel value="#{msg.type}:" />
							<p:inputText value="#{groupDetailBean.clickedResource.type}" disabled="true" styleClass="resource_dialog_field" />
		
							<h:outputLabel value="#{msg.author}:" />
							<p:inputText value="#{groupDetailBean.clickedResource.author}" styleClass="resource_dialog_field" />
							
								<h:outputText value=""></h:outputText>
								<p:column styleClass="resource_pcolumn">
									<div class="resource_pcolumn_div"><p:commandButton value="#{msg.cancel}" onclick="resource_dialog.hide()" />
									<p:commandButton value="#{msg.save}" action="#{groupDetailBean.addSelectedResource}" update=":datagrid :growl" process="@form :datagrid" oncomplete="resource_dialog.hide()" /></div>
								</p:column>
						</h:panelGrid>
					</h:form>
				</p:dialog>
				
				<p:dialog header="#{msg.link_to}" widgetVar="resource_link_dialog" modal="false" minWidth="540" styleClass="zindex10000">
			
					<h:form id="resource_link_form">
						<h:panelGrid columns="2">
							<h:outputLabel value="#{msg.link_to}"/>
							<h:selectOneMenu value="#{groupDetailBean.selectedResourceTargetGroupId}">
								<f:selectItems var="group" value="#{userBean.user.writeAbleGroups}" itemLabel="#{group.title}" itemValue="#{group.id}"/>
							</h:selectOneMenu>					
							
							<h:outputText value="" />
							<p:commandButton value="#{msg.save}" action="#{groupDetailBean.addSelectedResourceLink}" process="@form" update=":growl" oncomplete="resource_link_dialog.hide()"/>
						</h:panelGrid>
					
					</h:form>			
				</p:dialog>					
		
			 <h:form>
			 	<p:remoteCommand name="updateColumns" update=":resource_disp" actionListener="#{groupDetailBean.updateColumns}"></p:remoteCommand>
	         </h:form>
	         <h:panelGroup id="resource_disp">
	
				<p:dataGrid id="datagrid" var="result" value="#{groupDetailBean.resources}" columns="#{groupDetailBean.numberOfColumns}" paginator="false" widgetVar="datagrid">  
			  		<h:form>
			        <p:commandLink styleClass="resource_command_link" update=":resource_form :add_resource_panel" oncomplete="update_header()">
			        	<f:setPropertyActionListener target="#{groupDetailBean.clickedResource}" value="#{result}"></f:setPropertyActionListener>
				        <p:panel styleClass="resource_panel"> 
				        	<h:outputText value="#{result.title}" escape="false" styleClass="resource_short_title" style="white-space: nowrap; overflow:hidden; text-overflow: ellipsis; max-width:185px; width:185px; display:block;" /> 
				             
				            <h:panelGrid styleClass="resource_panelgrid" columns="1">
				            	<p:row>
				            		<span class="groupid">#{result.id}</span>

				            		<h:outputText styleClass="resource_thumbnail" value='#{result.embeddedSize1.replaceAll("width=\".*\"","").replaceAll("height=\".*\"","").replaceAll("/>","").replaceAll(">","").concat(" width=\"140\" height=\"140\" />")}' escape="false"></h:outputText>

				            		<div class="buttons">
				            			<p:commandLink onclick="PF('resource_dialog').show()" title="#{msg.addToMyResources}"
											update=":datagrid" styleClass="buttons_link resource_commandlink">
											<h:graphicImage alt="Add" value="/resources/icon/Add.png"/>
											<f:setPropertyActionListener value="#{result}" target="#{groupDetailBean.clickedResource}" />
											<f:param name="group_id" value="#{groupDetailBean.groupId}" />
										</p:commandLink>
										
										<p:commandLink oncomplete="PF('resource_link_dialog').show();" title="#{msg.link_to}" 
											rendered="#{userBean.isModerator() or true}" update=":datagrid" styleClass="buttons_link resource_commandlink">
											<h:graphicImage alt="Add" value="/resources/icon/Add_blue.png" title="#{msg.link_to}" /> 
											<f:setPropertyActionListener value="#{result}" target="#{groupDetailBean.clickedResource}" />
											<f:param name="group_id" value="#{groupDetailBean.groupId}" /> 
										</p:commandLink>
				            			
				            			<p:commandLink  oncomplete="PF('confirmation').show();" title="#{msg.removeFromGroup}" rendered="#{groupDetailBean.canDeleteResource(result)}" styleClass="buttons_link" update=":confirm_dialog_form">
											<h:graphicImage alt="Remove" value="../resources/icon/Remove.png"/>
											
											<f:setPropertyActionListener value="#{result}" target="#{groupDetailBean.clickedResource}" />
											<f:param name="group_id" value="#{groupDetailBean.groupId}" />
										</p:commandLink>
										
										<p:commandLink title="#{msg.edit}" rendered="#{groupDetailBean.canDeleteResource(result)}" update=":add_resource_panel" styleClass="buttons_link">
											<h:graphicImage alt="Edit" value="../resources/icon/Edit.png"/>
												<f:setPropertyActionListener value="#{result}" target="#{groupDetailBean.clickedResource}" />
												<f:setPropertyActionListener target="#{groupDetailBean.editResourceClicked}" value="true"></f:setPropertyActionListener>
											<f:param name="group_id" value="#{groupDetailBean.groupId}" />
										</p:commandLink>
										
										<p:commandLink update="resource_form" oncomplete="PF('resource_move_dialog').show();" title="#{msg.move_to}" 
											rendered="#{userBean.isModerator() and false}" >
											<h:graphicImage value="/resources/icon/silk/delete.png" width="16" height="16" title="#{msg.move_to}" style="padding: 3px;"/> 
											<f:setPropertyActionListener value="#{result}" target="#{searchBean.selectedResource}" />
											<f:param name="group_id" value="#{groupDetailBean2.groupId}" /> 
										</p:commandLink>
				            		</div>
					            	
					            	<!-- <h:outputText value="#{result.shortDescription}" escape="false"></h:outputText> -->
				            	</p:row>
				            	
					            	<div class="resource_summary" style="white-space: nowrap; overflow:hidden; text-overflow: ellipsis; max-width:185px; width:185px;">
									<span>${learnwebBean.getLocaleMessage(result.type)}</span> #{msg.added_by} <span>#{result.getOwnerUser().username}</span>
							            </div>
				            
					          
				            </h:panelGrid>  
				            
				        </p:panel>
				    </p:commandLink>
				    </h:form>
			    </p:dataGrid>
			   
			   
			 </h:panelGroup>      
			    
		</ui:define>
		<ui:define name="right_layout">
			<ui:decorate  template="/lw/templates/right_pane.xhtml">
				<ui:param name="bean" value="#{groupDetailBean}" />
			</ui:decorate >
		</ui:define>
</ui:composition>