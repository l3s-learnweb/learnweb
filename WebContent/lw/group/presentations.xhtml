<ui:composition template="/templates/main/main_old.xhtml" 
	xmlns:ui="http://java.sun.com/jsf/facelets" 
	xmlns:h="http://java.sun.com/jsf/html" 
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:p="http://primefaces.org/ui">

	<ui:param name="helpText" value="#{msg.groupPresentationHelp}"/>

	<ui:define name="metadata">
		<f:metadata>
			<f:viewParam name="group_id" value="#{groupDetailBean.groupId}" />
			<f:event type="javax.faces.event.PreRenderViewEvent" listener="#{groupDetailBean.preRenderView}" /> 
		</f:metadata>
	</ui:define>	

	<ui:param name="loginRequired" value="true" />
	<ui:param name="pageTitle" value="#{msg.groupsTitle}" />
	    		
	<ui:define name="center_layout">
		<h:outputStylesheet library="group" name="group.css" />

		<h:form target="new_presentation" id="new_presentation_form"></h:form>
		<div class="center-header" id="group_header">
			<h2>
				#{msg.presentations}
			</h2> 
			<span class="header_detail">
				#{msg.of} 
			</span>
			<span class="header_detail">
				#{groupDetailBean.group.title}
			</span>
			
			<h:form id="center_header_form">
				<p:commandButton rendered="#{groupDetailBean.member}" styleClass="resource_button greenbutton" 
					onclick="PF('format_dialog').show()" value="#{msg.presentation_new}" />
			
				<p:commandLink rendered="#{not groupDetailBean.member}" action="#{groupsBean.joinGroup}" 
					styleClass="resource_button greenbutton"  update=":growl :group_menu @form" partialSubmit="true" 
					process="@this" value="#{msg.join_group}">
					<f:setPropertyActionListener target="#{groupsBean.selectedGroup}" value="#{groupDetailBean.group}" />
				</p:commandLink>
			</h:form>
			
			<ul>								
				<li>
					<a class="" href="./group/overview.jsf?group_id=#{groupDetailBean.group.id}">
						<h:outputText value="#{msg.overview}" />
					</a>
				</li>								
				<li>
					<a class="" href="./group/resources.jsf?group_id=#{groupDetailBean.group.id}">
						<h:outputText value="#{msg.resources}" />
					</a>
				</li>								
				<li>
					<a class="" href="./group/members.jsf?group_id=#{groupDetailBean.group.id}">
						<h:outputText value="#{msg.members}" />
					</a>
				</li>								
				<li>
					<a class="active" href="./group/presentations.jsf?group_id=#{groupDetailBean.group.id}">
						<h:outputText value="#{msg.presentations}" />
					</a>
				</li>								
				<li>
					<a class="" href="./group/links.jsf?group_id=#{groupDetailBean.group.id}">
						<h:outputText value="#{msg.links}" />
					</a>
				</li>
				<li>
					<a href="./group/forum.jsf?group_id=#{groupDetailBean.group.id}">
						<h:outputText value="#{msg.forum}" />
					</a>
				</li>
				<ui:fragment rendered="${groupDetailBean.group.course.isModerator(userBean.user) || groupDetailBean.group.isLeader(userBean.user)}">							
				<li>
					<a href="./group/options.jsf?group_id=#{groupDetailBean.group.id}">
						<h:outputText value="#{msg.options}" />
					</a>
				</li>
				</ui:fragment>
			</ul>
		</div>
		
		
		<script type="text/javascript">
		/* <![CDATA[ */
			$("#center_pane").prepend($("#group_header"));			
		/* ]]> */
		</script>

		<p:confirmDialog id="confirmDialog" message="#{msg.delete_message_presentation}" header="delete_presentation" severity="alert" 
			widgetVar="confirmation" appendTo="@(body)">
			<h:form>
				<p:commandButton id="confirm" value="#{msg.yes}" update=":datagrid :right_form" 
					oncomplete="update_header(); PF('confirmation').hide();" actionListener="#{groupDetailBean.removePresentationFromGroup}" 
					process=":right_form" />
				<p:commandButton id="decline" value="#{msg.no}" onclick="PF('confirmation').hide()" type="button" />
			</h:form>
		</p:confirmDialog>

		<p:dialog resizable="false" header="#{msg.layout_selection}" widgetVar="format_dialog" modal="true" appendTo="@(body)">
				<h:form>
					#{msg.select_layout}<br/><br/>
			    	<a onclick="PF('format_dialog').hide()" class="format_button_link" target="new_presentation" 
			    		href="#{groupDetailBean.edit('1')}">
						<img class="format_button" src="../resources/icon/format1.jpg"></img>
						<br/>
						#{msg.layout_single_silde}
					</a>
			    	<a onclick="PF('format_dialog').hide()" class="format_button_link" target="new_presentation" 
			    		href="#{groupDetailBean.edit('2')}">
						<img class="format_button" src="../resources/icon/format2.jpg"></img>
						<br/>
						#{msg.layout_two_silde}
					</a>
		    	</h:form>
		    </p:dialog>
		    <p:dialog resizable="false" header="#{msg.layout_selection}" widgetVar="format_dialog2" modal="true" appendTo="@(body)">
				<h:form id="edit_presentation_layout">
					#{msg.select_layout}
					<br/>
					<br/>
			    	<a onclick="PF('format_dialog2').hide()" class="format_button_link" target="edit_presentation" 
			    		href="#{groupDetailBean.editPresentation('1')}">
						<img class="format_button" src="../resources/icon/format1.jpg"></img>
						<br/>
						#{msg.layout_single_silde}
					</a>
			    	<a onclick="PF('format_dialog2').hide()" class="format_button_link" target="edit_presentation" 
			    		href="#{groupDetailBean.editPresentation('2')}">
						<img class="format_button" src="../resources/icon/format2.jpg"></img>
						<br/>
						#{msg.layout_two_silde}
					</a>
		    	</h:form>
		    </p:dialog>
		    
 			<h:panelGroup id="datagrid">
				<h:outputText value="#{msg.no_presentation}" rendered="#{empty groupDetailBean.presentations}"></h:outputText>
			
				<ui:repeat var="result" value="#{groupDetailBean.presentations}" >
				   
				    <h:form value="#{groupDetailBean.presentations}">   
					    
					    <p:commandLink styleClass="resource_command_link" update=":right_form :edit_presentation_layout" 
					    	oncomplete="update_header()">
				        	<f:setPropertyActionListener target="#{groupDetailBean.clickedPresentation}" value="#{result}"/>
					            <div class="members_panelgrid grey_border"> 
					            	<img src="../resources/icon/presentation.png" width="100" height="100" />
					            	<div class="member_username_small">
					            		#{result.presentationName}
					            	</div>
					            	<span class="groupid">
					            		#{result.presentationId}
					            	</span>
					            </div>
					    </p:commandLink>
					    
				    </h:form>
				    
			   </ui:repeat>
	   
		    </h:panelGroup>
		    
		    <script type="text/javascript">
		    	
				function resize_preview()
				{
					if($("#presentation_preview"))
					{
						var width = $("#presentation_preview").width();
						var height = 3*width/4;
						$("#presentation_preview").height(height);
					}
				}
		    </script>
		</ui:define>
		
		<ui:define name="right_layout">
			<p:layoutUnit rendered="#{userBean.loggedIn}" position="east" size="38%" resizable="false" closable="false" collapsible="false" 
				header="#{groupDetailBean.clickedPresentation.presentationId eq -1? msg.presentation_details:groupDetailBean.clickedPresentation.presentationName}" 
				id="right_pane">
				<div id="right_pane_wrapper">
					<h:form id="right_form" target="presentation">
						<script type="text/javascript">
							function update_header()
							{
								$(".ui-layout-unit-header","#right_pane").html("#{groupDetailBean.clickedPresentation.presentationName}");
								resize_preview();
								scroller();
							}
						</script>
						<ui:fragment rendered="#{groupDetailBean.clickedPresentation.presentationId != -1}">
							
							<div id="presentation_preview">
							    <span class="aligner"></span>
							    <h:outputText value="#{groupDetailBean.clickedPresentation.presentationTitle}" escape="false" 
							    	styleClass="align" />
							</div>
							<p:commandButton styleClass="presentation_commandbutton" action="#{groupDetailBean.present}" ajax="false" 
								value="#{msg.present}"/>
							<p:commandButton styleClass="presentation_commandbutton" onclick="PF('format_dialog2').show(); return false" 
								ajax="false" value="#{msg.edit}"/>
							<p:commandButton styleClass="presentation_commandbutton" onclick="PF('confirmation').show(); return false" 
								ajax="false" value="#{msg.delete}"
								rendered="#{userBean.admin || userBean.moderator || groupDetailBean.clickedPresentation.ownerId == userBean.user.id || groupDetailBean.group.leaderUserId == userBean.user.id}" />
							<div class="presentation_clear"></div>
							<div class="presentation_detail_div">
								<div class="data">
									<span class="resource_field">
										#{msg.author}: 
									</span>
									#{groupDetailBean.clickedPresentation.getOwner().username}
								</div>
								<div class="data">
									<span class="resource_field">
										#{msg.date}: 
									</span>
									<h:outputText value="#{groupDetailBean.clickedPresentation.date}">	
										<f:convertDateTime type="date" dateStyle="long" timeZone="#{userBean.timeZone}" />
									</h:outputText>
								</div>
							</div>
							<br/><br/>
						</ui:fragment>						
					</h:form>
				</div>
			</p:layoutUnit>
			<script type="text/javascript">
				$(document).ready(function(){
					setTimeout("resize_preview()",50);
				});
			</script>
		</ui:define>
</ui:composition>