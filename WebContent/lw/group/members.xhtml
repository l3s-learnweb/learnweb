<ui:composition template="/lw/templates/new_main_t.xhtml" 
	xmlns:ui="http://java.sun.com/jsf/facelets" 
	xmlns:h="http://java.sun.com/jsf/html" 
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:p="http://primefaces.org/ui">

	<ui:param name="helpText" value="#{msg.groupMembersHelp}"/>

	<ui:define name="metadata">
		<f:metadata>
			<f:viewParam name="group_id" value="#{groupDetailBean.groupId}" />
			<f:event type="javax.faces.event.PreRenderViewEvent" listener="#{groupDetailBean.preRenderView}" /> 
		</f:metadata>
	</ui:define>

	<ui:param name="loginRequired" value="true" />
	<ui:param name="pageTitle" value="#{msg.groupMember}" />	
    		
	<ui:define name="center_layout">
	
		<h:outputStylesheet library="group" name="group.css" />

		<div class="center-header" id="group_header">
			<span>
				#{msg.members}
			</span> 
			#{msg.of} #{groupDetailBean.group.title}
			
			<h:form id="center_header_form">
				<p:commandLink rendered="#{not groupDetailBean.member}" action="#{groupsBean.joinGroup}" 
					styleClass="resource_button greenbutton" update=":growl :group_menu @form :resource_disp" partialSubmit="true" 
					process="@this" value="#{msg.join_group}">
					<f:setPropertyActionListener target="#{groupsBean.selectedGroup}" value="#{groupDetailBean.group}" />
				</p:commandLink>
			</h:form>
			
			<ul>								
				<li>
					<a class="" href="./group/overview.jsf?group_id=#{groupDetailBean.group.id}">
						<h:outputText value="#{msg.overview}" />
					</a>
				</li>								
				<li>
					<a class="" href="./group/resources.jsf?group_id=#{groupDetailBean.group.id}">
						<h:outputText value="#{msg.resources}" />
					</a>
				</li>								
				<li>
					<a class="active" href="./group/members.jsf?group_id=#{groupDetailBean.group.id}">
						<h:outputText value="#{msg.members}" />
					</a>
				</li>								
				<li>
					<a class="" href="./group/presentations.jsf?group_id=#{groupDetailBean.group.id}">
						<h:outputText value="#{msg.presentations}" />
					</a>
				</li>								
				<li>
					<a class="" href="./group/links.jsf?group_id=#{groupDetailBean.group.id}">
						<h:outputText value="#{msg.links}" />
					</a>
				</li>
				<li>
					<a href="./group/forum.jsf?group_id=#{groupDetailBean.group.id}">
						<h:outputText value="#{msg.forum}" />
					</a>
				</li>
				<ui:fragment rendered="${userBean.admin || userBean.moderator || groupDetailBean.group.isLeader(userBean.user)}">							
				<li>
					<a href="./group/options.jsf?group_id=#{groupDetailBean.group.id}">
						<h:outputText value="#{msg.options}" />
					</a>
				</li>
				</ui:fragment>
			</ul>
		</div>
		
		<script type="text/javascript">
		/* <!-- */
			$("#center_pane").prepend($("#group_header"));
		/* --> */
		</script>	
      
        <h:panelGrid id="resource_disp">
	        <h:form>
				<ui:repeat id="datagrid" var="user" value="#{groupDetailBean.getMembers()}">  
			        
			        <p:commandLink  styleClass="resource_command_link" update=":right_form" oncomplete="update_header()">
			        	<f:setPropertyActionListener target="#{groupDetailBean.clickedUser}" value="#{user}"/>
				            <div class="members_panelgrid grey_border"> 
				            	<img src="#{user.image}" width="100" height="100" />
				            	<ui:fragment rendered="#{not empty user.credits}">
				            		<div class="member_star"></div>
				            	</ui:fragment>
				            	<div class="member_username_small">
				            		#{user.username}
				            	</div>
				            </div>
			        </p:commandLink>	        
			    </ui:repeat>
		    </h:form>
	    </h:panelGrid>
	</ui:define>
	
	<ui:define name="right_layout">
		<p:layoutUnit rendered="#{userBean.loggedIn}" position="east" size="38%" resizable="false" closable="false" collapsible="false" 
			header="#{groupDetailBean.clickedUser.id eq -1? msg.user_details : groupDetailBean.clickedUser.username}" id="right_pane">
			<div id="right_pane_wrapper">
				<h:form id="right_form" target="presentation">
					<script type="text/javascript">
						function update_header()
						{
							//$(".ui-layout-unit-header","#right_pane").html("#{groupDetailBean.clickedUser.username}");
							$(".ui-layout-unit-header","#right_pane").hide();
							scroller();
						}
					</script>
					
					<ui:fragment rendered="#{groupDetailBean.clickedUser.id != -1}">
					
						<ui:decorate template="/templates/user/profile.xhtml">
							<ui:param name="user" value="#{groupDetailBean.clickedUser}" />		
						</ui:decorate>
						
					</ui:fragment>
				</h:form>
			</div>
		</p:layoutUnit>
	</ui:define>
</ui:composition>