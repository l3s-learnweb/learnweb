<ui:composition template="/lw/templates/new_main_t.xhtml" 
	xmlns:ui="http://java.sun.com/jsf/facelets" 
	xmlns:h="http://java.sun.com/jsf/html" 
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:p="http://primefaces.org/ui">

	<ui:param name="helpText" value="#{msg.groupMembersHelp}"/>

	<ui:define name="metadata">
		<f:metadata>
			<f:viewParam name="group_id" value="#{groupDetailBean.groupId}" />
			<f:event type="javax.faces.event.PreRenderViewEvent" listener="#{groupDetailBean.preRenderView}" /> 
		</f:metadata>
	</ui:define>

	<ui:param name="loginRequired" value="true" />
	<ui:param name="pageTitle" value="#{msg.groupMember}" />	
	    		
		<ui:define name="center_layout">
			<div class="ui-layout-unit-header ui-widget-header ui-corner-all" id="group_header">
				<span class="group_header">#{msg.members}</span> #{msg.of} #{groupDetailBean.group.title}
				
				<ul>								
					<li>
						<a class="" href="./group/overview.jsf?group_id=#{groupDetailBean.group.id}">
							<h:outputText value="#{msg.overview}" />
						</a>
					</li>								
					<li>
						<a class="" href="./group/resources.jsf?group_id=#{groupDetailBean.group.id}">
							<h:outputText value="#{msg.resources}" />
						</a>
					</li>								
					<li>
						<a class="active" href="./group/members.jsf?group_id=#{groupDetailBean.group.id}">
							<h:outputText value="#{msg.members}" />
						</a>
					</li>								
					<li>
						<a class="" href="./group/presentations.jsf?group_id=#{groupDetailBean.group.id}">
							<h:outputText value="#{msg.presentations}" />
						</a>
					</li>								
					<li>
						<a class="" href="./group/links.jsf?group_id=#{groupDetailBean.group.id}">
							<h:outputText value="#{msg.links}" />
						</a>
					</li>
				</ul>
			</div>
			
			<script type="text/javascript">
			/* <!-- */
				$("#center_pane").prepend($("#group_header"));
			/* --> */
			</script>
		
			<h:form>
			 	<p:remoteCommand name="updateColumns" update=":resource_disp" actionListener="#{groupDetailBean.updateColumns}"></p:remoteCommand>
	        </h:form>
	        <h:panelGrid id="resource_disp">
	        <h:form>
			<p:dataGrid id="datagrid" var="result" value="#{groupDetailBean.getMembers()}" columns="#{groupDetailBean.numberOfColumns}" paginator="false" rows="100" widgetVar="datagrid">  
		      
		        <p:commandLink rendered="#{groupDetailBean.numberOfColumns != 3}" styleClass="resource_command_link" update=":right_form" oncomplete="update_header()">
		        	<f:setPropertyActionListener target="#{groupDetailBean.clickedUser}" value="#{result}"></f:setPropertyActionListener>
			        <p:panel styleClass="members_panel">  
			            <h:panelGrid columns="1" styleClass="members_panelgrid"> 
			            	<img src="#{result.image}" width="120" height="120" />
			            	<div class="member_username">#{result.username}</div>
			            </h:panelGrid>
			        </p:panel>
		        </p:commandLink>
		        <p:commandLink rendered="#{groupDetailBean.numberOfColumns == 3}" styleClass="resource_command_link" update=":right_form" oncomplete="update_header()">
		        	<f:setPropertyActionListener target="#{groupDetailBean.clickedUser}" value="#{result}"></f:setPropertyActionListener>
			        <p:panel styleClass="members_panel_small">  
			            <h:panelGrid columns="1" styleClass="members_panelgrid"> 
			            	<img src="#{result.image}" width="100" height="100" />
			            	<div class="member_username_small">#{result.username}</div>
			            </h:panelGrid>
			        </p:panel>
		        </p:commandLink>
		        
		    </p:dataGrid>
		    </h:form>
		    </h:panelGrid>
		</ui:define>
		<ui:define name="right_layout">
			<p:layoutUnit rendered="#{userBean.loggedIn}" position="east" size="38%" resizable="false" closable="false" collapsible="false" header="#{groupDetailBean.clickedUser.id eq -1? msg.user_details : groupDetailBean.clickedUser.username}" id="right_pane">
				<div id="right_pane_wrapper">
					<h:form id="right_form" target="presentation">
						<script type="text/javascript">
							function update_header()
							{
								//$(".ui-layout-unit-header","#right_pane").html("#{groupDetailBean.clickedUser.username}");
								$(".ui-layout-unit-header","#right_pane").hide();
								scroller();
							}
						</script>
						<style>
						#right_pane .ui-layout-unit-header{
							text-align:left;
							background-color:#eee !important;
							color: #489a83 !important;
							font-size: 20px !important;
							font-weight: 100 !important;
							border: 1px solid #ddd !important;
							padding:10px;
							width:88%;
							margin:0 auto;
						}
						</style>
						
						<ui:fragment rendered="#{groupDetailBean.clickedUser.id != -1}">
						
							<ui:decorate template="/templates/user/profile.xhtml">
								<ui:param name="user" value="#{groupDetailBean.clickedUser}" />		
							</ui:decorate>
							<!-- 
							<p:panel header="#{msg.myProfileTitle}">
								<h:panelGrid columns="2" styleClass="members_panelgrid" style="width:75%;text-align:left;">
									<h:outputText value="#{msg.username}:" />
									<h:outputText id="username" value="#{groupDetailBean.clickedUser.username}" />
					
									<h:outputText value="#{msg.email_address}:" rendered="#{not empty groupDetailBean.clickedUser.email}" />
									<h:outputText value="#{groupDetailBean.clickedUser.email}" rendered="#{not empty groupDetailBean.clickedUser.email}" />
					
									<h:outputText value="#{msg.gender}:" />
7									<h:outputText value="-" rendered="#{groupDetailBean.clickedUser.gender == 0}" />					
									<h:outputText value="#{msg.gender_male}" rendered="#{groupDetailBean.clickedUser.gender == 1}" />
									<h:outputText value="#{msg.gender_female}" rendered="#{groupDetailBean.clickedUser.gender == 2}" />				
									
									<h:outputText value="#{msg.address}:" rendered="#{not empty groupDetailBean.clickedUser.address}" />
									<h:outputText value="#{groupDetailBean.clickedUser.address}" rendered="#{not empty groupDetailBean.clickedUser.address}"/>
					
									<h:outputText value="#{msg.profession}:" rendered="#{not empty groupDetailBean.clickedUser.profession}"/> 
									<h:outputText value="#{groupDetailBean.clickedUser.profession}" rendered="#{not empty groupDetailBean.clickedUser.profession}"/>
					
									<h:outputText value="#{msg.interest}:" rendered="#{not empty groupDetailBean.clickedUser.interest}" />
									<h:outputText value="#{groupDetailBean.clickedUser.interest}" rendered="#{not empty groupDetailBean.clickedUser.interest}" />
					
									<h:outputText value="#{msg.additionalinformation}:" rendered="#{not empty groupDetailBean.clickedUser.additionalInformation}" />
									<h:outputText value="#{groupDetailBean.clickedUser.additionalInformation}" rendered="#{not empty groupDetailBean.clickedUser.additionalInformation}" />
								
									<h:outputText value="#{msg.registered_since}:" />
									<h:outputText value="#{groupDetailBean.clickedUser.registrationDate}">
										<f:convertDateTime dateStyle="default" type="date" timeZone="#{userBean.timeZone}" />
									</h:outputText>
								</h:panelGrid>
								
								<h:graphicImage height="100" width="100" value="${learnwebBean.getProfileImage(groupDetailBean.clickedUser)}" id="profile_image" alt="profile picture" />
								<br class="clear" />
							</p:panel>
							
							<br/>
							
							<p:panel header="#{groupDetailBean.clickedUser.username}'s #{msg.groupsTitle}">
								<h:form>
									<p:dataGrid var="group" value="#{groupDetailBean.clickedUser.groups}">
										<p:column>
											<h:outputLink value="group/overview.jsf">
												<f:param name="group_id" value="#{group.id}" />
												<h:outputText value="#{group.title}" />
											</h:outputLink>
										</p:column>
									</p:dataGrid>
								</h:form>
					
							</p:panel>
							
							<br class="clear" />
							<br/>
							-->
						</ui:fragment>
					</h:form>
				</div>
			</p:layoutUnit>
		</ui:define>
</ui:composition>