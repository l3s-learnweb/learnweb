<ui:composition template="/lw/templates/new_main_t.xhtml" 
	xmlns:ui="http://java.sun.com/jsf/facelets" 
	xmlns:h="http://java.sun.com/jsf/html" 
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:p="http://primefaces.org/ui">

	<ui:define name="metadata">
		<f:metadata>
			<f:viewParam name="group_id" value="#{groupDetailBean.groupId}" />
			<f:event type="javax.faces.event.PreRenderViewEvent" listener="#{groupDetailBean.preRenderView}" /> 
		</f:metadata>
	</ui:define>

	<ui:param name="loginRequired" value="true" />
	<ui:param name="pageTitle" value="Group members" />	
	    		
		<ui:define name="center_layout">
			<script type="text/javascript">
				var div = document.createElement("div");
				var group_header = document.createElement("span");
				$(group_header).addClass("group_header");
				$(group_header).html("#{msg.members}");
				var group_owner = document.createElement("span");
				$(group_owner).addClass("group_owner");
				$(group_owner).html(" #{msg.of} #{groupDetailBean.group.title}");
				$(div).append(group_header);
				$(div).append(group_owner);
				$(div).addClass("ui-layout-unit-header ui-widget-header ui-corner-all");
				$("#center_pane").prepend(div);
				
				$(document).ready(nCol);
				window.onresize = nCol;
				
				function nCol(){
					var w = $(window).width();
					var c = 4;
					if(w == 1366)
						c = 4;
					if(w &lt; 1366)
						c = 3;
					updateColumns([{name:'cols',value: c}]);
				}
			</script>
			<script type="text/javascript">
				function select(panel)
				{
					$(".members_panel").css("border","1px solid #ccc");
					$(panel).css("border","1px solid #666");
				}
			</script>
			<h:form>
			 	<p:remoteCommand name="updateColumns" update=":resource_disp" actionListener="#{groupDetailBean.updateColumns}"></p:remoteCommand>
	        </h:form>
	        <h:panelGrid id="resource_disp">
	        <h:form>
			<p:dataGrid id="datagrid" var="result" value="#{groupDetailBean.getMembers()}" columns="#{groupDetailBean.numberOfColumns}" paginator="false" rows="100" widgetVar="datagrid">  
		      
		        <p:commandLink rendered="#{groupDetailBean.numberOfColumns != 3}" styleClass="resource_command_link" update=":right_form" oncomplete="update_header()">
		        	<f:setPropertyActionListener target="#{groupDetailBean.clickedUser}" value="#{result}"></f:setPropertyActionListener>
			        <p:panel styleClass="members_panel">  
			            <h:panelGrid columns="1" styleClass="members_panelgrid"> 
			            	<img src="#{result.image}" width="120" height="120" />
			            	<div class="member_username">#{result.username}</div>
			            </h:panelGrid>
			        </p:panel>
		        </p:commandLink>
		        <p:commandLink rendered="#{groupDetailBean.numberOfColumns == 3}" styleClass="resource_command_link" update=":right_form" oncomplete="update_header()">
		        	<f:setPropertyActionListener target="#{groupDetailBean.clickedUser}" value="#{result}"></f:setPropertyActionListener>
			        <p:panel styleClass="members_panel_small">  
			            <h:panelGrid columns="1" styleClass="members_panelgrid"> 
			            	<img src="#{result.image}" width="100" height="100" />
			            	<div class="member_username_small">#{result.username}</div>
			            </h:panelGrid>
			        </p:panel>
		        </p:commandLink>
		        
		    </p:dataGrid>
		    </h:form>
		    </h:panelGrid>
		    <script type="text/javascript">
		    	$(".ui-panel").click(function(){
		    		select(this);
		    	});
		    </script>
		</ui:define>
		<ui:define name="right_layout">
			<p:layoutUnit rendered="#{userBean.loggedIn}" position="east" size="38%" resizable="false" closable="false" collapsible="false" header="" id="right_pane">
				<div id="right_pane_wrapper">
					<h:form id="right_form" target="presentation">
						<script type="text/javascript">
							function update_header()
							{
								$(".ui-layout-unit-header","#right_pane").html("#{groupDetailBean.clickedUser.username}");
							}
						</script>
						<ui:fragment rendered="#{groupDetailBean.clickedUser.id eq -1}">
							<div class="click_message">
								<h:outputText value="#{msg.user_details}"></h:outputText>
							</div>
						</ui:fragment>
						<ui:fragment rendered="#{groupDetailBean.clickedUser.id != -1}">
							<p:panel header="#{msg.myProfileTitle}">
								<h:panelGrid columns="2" styleClass="members_panelgrid">
									<h:outputText value="#{msg.username}:" />
									<h:outputText id="username" value="#{groupDetailBean.clickedUser.username}" />
					
									<h:outputText value="#{msg.email_address}:" />
									<h:outputText value="#{groupDetailBean.clickedUser.email}" />
					
									<h:outputText value="#{msg.gender}:" />
									<h:outputText value="--" rendered="#{groupDetailBean.clickedUser.gender == 0}" />					
									<h:outputText value="#{msg.gender_male}" rendered="#{groupDetailBean.clickedUser.gender == 1}" />
									<h:outputText value="#{msg.gender_female}" rendered="#{groupDetailBean.clickedUser.gender == 2}" />				
									
									<h:outputText value="#{msg.address}:" />
									<h:outputText value="#{groupDetailBean.clickedUser.address}" />
					
									<h:outputText value="#{msg.profession}:" />
									<h:outputText value="#{groupDetailBean.clickedUser.profession}" />
					
									<h:outputText value="#{msg.interest}:" rendered="#{not empty groupDetailBean.clickedUser.interest}" />
									<h:outputText value="#{groupDetailBean.clickedUser.interest}" rendered="#{not empty groupDetailBean.clickedUser.interest}" />
					
									<h:outputText value="#{msg.additionalinformation}:" rendered="#{not empty groupDetailBean.clickedUser.additionalInformation}" />
									<h:outputText value="#{groupDetailBean.clickedUser.additionalInformation}" rendered="#{not empty groupDetailBean.clickedUser.additionalInformation}" />
								
									<h:outputText value="#{msg.registered_since}:" />
									<h:outputText value="#{groupDetailBean.clickedUser.registrationDate}">
										<f:convertDateTime dateStyle="default" type="date" timeZone="#{userBean.timeZone}" />
									</h:outputText>
								</h:panelGrid>
								
								<h:graphicImage height="100" width="100" value="${learnwebBean.getProfileImage(groupDetailBean.clickedUser)}" id="profile_image" />
								<br class="clear" />
							</p:panel>
							
							<br/>
							
							<p:panel header="#{groupDetailBean.clickedUser.username}'s groups">
								<h:form>
									<p:dataGrid var="group" value="#{groupDetailBean.clickedUser.groups}">
										<p:column>
											<h:outputLink value="group/overview.jsf">
												<f:param name="group_id" value="#{group.id}" />
												<h:outputText value="#{group.title}" />
											</h:outputLink>
										</p:column>
									</p:dataGrid>
								</h:form>
					
							</p:panel>
						</ui:fragment>
					</h:form>
				</div>
			</p:layoutUnit>
		</ui:define>
</ui:composition>