<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" 
	xmlns:ui="http://java.sun.com/jsf/facelets" 
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:f="http://java.sun.com/jsf/core" 
	xmlns:c="http://java.sun.com/jsp/jstl/core" 
	xmlns:p="http://primefaces.org/ui">

<f:metadata>
	<f:viewParam name="group_id" value="#{groupDetailBean.groupId}" />
	<f:event type="javax.faces.event.PreRenderViewEvent" listener="#{groupDetailBean.preRenderView}" /> 
</f:metadata>

<ui:composition template="/lw/templates/new_main_t.xhtml">

	<ui:param name="loginRequired" value="true" />
	<ui:param name="pageTitle" value="Groups" />

	
	    		
		<ui:define name="center_layout">
			<script type="text/javascript">
				var div = document.createElement("div");
				var group_header = document.createElement("span");
				$(group_header).addClass("group_header");
				$(group_header).html("#{msg.subgroupsLabel}");
				var group_owner = document.createElement("span");
				$(group_owner).addClass("group_owner");
				$(group_owner).html(" #{msg.of} #{groupDetailBean.group.title}");
				$(div).append(group_header);
				$(div).append(group_owner);
				$(div).addClass("ui-layout-unit-header ui-widget-header ui-corner-all");
				$("#center_pane").prepend(div);
				
				$(document).ready(nCol);
				window.onresize = nCol;
				
				function nCol(){
					var w = $(window).width();
					var c = 4;
					if(w == 1366)
						c = 4;
					if(w &lt; 1366)
						c = 3;
					updateColumns([{name:'cols',value: c}]);
				}
			</script>
			<script type="text/javascript">
				function select(panel)
				{
					$(".members_panel").css("border","1px solid #ccc");
					$(panel).css("border","1px solid #666");
				}
			</script>
			<h:form>
			 	<p:remoteCommand name="updateColumns" update=":resource_disp" actionListener="#{groupDetailBean.updateColumns}"></p:remoteCommand>
	        </h:form>
			<h:panelGroup id="resource_disp">
				<p:dataGrid id="datagrid" var="result" value="#{groupDetailBean.getGroup().getSubgroups()}" columns="#{groupDetailBean.numberOfColumns}" paginator="false" widgetVar="datagrid">  
			        <ui:fragment rendered="#{groupDetailBean.numberOfColumns != 10 and groupDetailBean.numberOfColumns != 3}">
				        <a class="newsfeed_query_link" href="group/overview.jsf?group_id=#{result.id}">
					        <p:panel styleClass="members_panel">  
					            <h:panelGrid columns="1" styleClass="members_panelgrid"> 
					            	<img src="../resources/icon/subgroup.jpg" width="120" height="120" />
					            	<div class="member_username">#{result.title}</div>
					            </h:panelGrid>
					        </p:panel>
				        </a>
			        </ui:fragment>
			        <ui:fragment rendered="#{groupDetailBean.numberOfColumns == 3}">
				        <a class="newsfeed_query_link" href="group/overview.jsf?group_id=#{result.id}">
					        <p:panel styleClass="members_panel_small">  
					            <h:panelGrid columns="1" styleClass="members_panelgrid"> 
					            	<img src="../resources/icon/subgroup.jpg" width="100" height="100" />
					            	<div class="member_username_small">#{result.title}</div>
					            </h:panelGrid>
					        </p:panel>
				        </a>
			        </ui:fragment>
			    </p:dataGrid>
			</h:panelGroup>
		    <script type="text/javascript">
		    	$(".ui-panel").click(function(){
		    		select(this);
		    	});
		    </script>
		</ui:define>
		<ui:define name="right_layout">
			<p:layoutUnit rendered="#{userBean.loggedIn}" position="east" size="38%" resizable="false" closable="false" collapsible="false" header="Create Subgroup" id="right_pane">
				<div id="right_pane_wrapper">
					<h:form id="right_form">
						<p:fieldset legend="#{msg.mandatory_field}">
						
							<h:panelGrid columns="3" columnClasses="medium-width">
							
								<h:outputText value="#{msg.title}*:" />
								<p:inputText id="new_title" value="#{groupDetailBean.newGroup.title}" validator="#{groupDetailBean.validateGroupTitle}">
									
								</p:inputText>
								<p:message for="new_title" showSummary="true" showDetail="false" id="message_new_title"/>
			
							</h:panelGrid>
						</p:fieldset>
						<br/>
						<p:fieldset legend="#{msg.optional_data}">
							<h:panelGrid columns="3" columnClasses="medium-width">
							
								<h:outputText value="#{msg.description}:" />					
								<p:inputTextarea id="new_description" value="#{groupDetailBean.newGroup.description}" />
								<p:message for="new_description" showSummary="true" showDetail="false"/>	
		
								<h:outputText value="#{msg.language}:" />
								<p:inputText id="new_language" value="#{groupDetailBean.newGroup.language}" />
								<p:message for="new_language" showSummary="true" showDetail="false"/>
									
							</h:panelGrid>
						</p:fieldset>
						<br/>
						<p:fieldset legend="Group protection" rendered="false">
							<h:panelGrid columns="3" columnClasses="medium-width">	
							
								<h:outputText value="" />
								<h:selectBooleanCheckbox value="#{groupDetailBean.newGroup.restrictionOnlyLeaderCanAddResources}" />
								<h:outputText value="Only the group leader can add resources" />
						
							</h:panelGrid>
						</p:fieldset>
						<br/>
						<p:commandButton value="#{msg.createGroup}" ajax="true" actionListener="#{groupDetailBean.onCreateGroup()}" process="@form" update="@form :datagrid :group_menu:groupmenu">
							<f:param name="group_id" value="#{groupDetailBean.group.id}"/>
						</p:commandButton>
					</h:form>
				</div>
			</p:layoutUnit>
		</ui:define>
</ui:composition>
</html>