<ui:composition template="/WEB-INF/templates/layout/template.xhtml"
				xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
				xmlns:h="http://xmlns.jcp.org/jsf/html"
				xmlns:f="http://xmlns.jcp.org/jsf/core"
				xmlns:p="http://primefaces.org/ui"
				xmlns:of="http://omnifaces.org/functions"
                xmlns:c="http://xmlns.jcp.org/jsp/jstl/core"
				xmlns:lw="http://l3s.de/learnweb">

<ui:param name="hideGrowl" value="false"/>
<ui:param name="pageTitle" value="#{groupOptionsBean.group.title}"/>
<ui:param name="helpText" value="#{msg.groupOptionsHelp}"/>

<ui:define name="metadata">
	<f:metadata>
		<f:viewParam name="group_id" value="#{groupOptionsBean.groupId}" converter="idConverter"/>
		<f:viewAction action="#{groupOptionsBean.onLoad}"/>
	</f:metadata>
</ui:define>

<ui:define name="breadcrumb">
	<lw:breadcrumb-item link="myhome/groups.jsf" title="#{msg.myGroups}">
		<ui:decorate template="/WEB-INF/templates/blocks/breadcrumb/nav_list_first.xhtml"/>
	</lw:breadcrumb-item>

	<lw:breadcrumb-item link="group/resources.jsf?group_id=#{groupOptionsBean.groupId}" title="#{groupOptionsBean.group.title}" >
		<ui:repeat var="groups" value="#{userBean.user.groups}">
			<li><a href="group/resources.jsf?group_id=#{groups.id}">#{groups.title}</a></li>
		</ui:repeat>
	</lw:breadcrumb-item>

	<lw:breadcrumb-item link="group/options.jsf?group_id=#{groupOptionsBean.groupId}" title="#{msg.options}">
		<ui:decorate template="/WEB-INF/templates/blocks/breadcrumb/nav_list_my_groups.xhtml">
			<ui:param name="groupId" value="#{groupOptionsBean.groupId}"/>
		</ui:decorate>
	</lw:breadcrumb-item>
</ui:define>

<ui:define name="center_layout">
		<div class="row">
			<div class="col-md-6">
				<p:outputPanel rendered="${groupOptionsBean.group.course.isModerator(userBean.user) || groupOptionsBean.group.isLeader(userBean.user)}">
				<p:panel header="#{msg.edit_group}">
					<h:form id="group_moderator_form">
						<div class="form-group">
							<p:outputLabel for="@next" value="#{msg.title}:"/>
							<p:inputText id="edit_group_title" value="#{groupOptionsBean.editedGroupTitle}" required="true"/>
							<p:message for="@previous"/>
						</div>

						<div class="form-group">
							<p:outputLabel for="@next" value="#{msg.description}:"/>
							<p:textEditor id="edit_group_description" widgetVar="editorWidget" value="#{groupOptionsBean.editedGroupDescription}" height="150">
								<f:facet name="toolbar">
										<span class="ql-formats">
											<button class="ql-bold"></button>
											<button class="ql-italic"></button>
											<button class="ql-underline"></button>
											<button class="ql-strike"></button>
											<button class="ql-list" value="ordered"></button>
											<button class="ql-list" value="bullet"></button>
											<button class="ql-link"></button>
										</span>
								</f:facet>
							</p:textEditor>
							<p:message for="@previous"/>
						</div>
						<div class="form-group">
							<p:outputLabel for="@next" value="#{msg.leader}:"/>
							<p:link outcome="/lw/user/detail" value="#{groupOptionsBean.group.leader.username}">
								<f:param name="user_id" value="#{groupOptionsBean.group.leader.id}"/>
							</p:link>
							<p:commandLink title="#{msg.change_leader}" styleClass="fa fa-fw fa-pencil text-decoration-none text-secondary ml-2" onclick="PF('changeLeader').show(); return false;" style="cursor: pointer; width: 0;" aria-hidden="true"/>
						</div>
						<ui:fragment rendered="#{groupOptionsBean.hypothesisEnabled}">
							<div class="form-group">
								<p:outputLabel for="@next">
								#{msg.hypothesis_group_link}:
								<h:outputLink value="discussion_help.jsf" target="_blank">
										<f:param name="type" value="admin"/>[?]
								</h:outputLink>
								</p:outputLabel>
								<p:inputText id="set_hypothesis_link" value="#{groupOptionsBean.newHypothesisLink}"/>
								<p:message for="@previous"/>
							</div>

							<ui:fragment rendered="#{not empty groupOptionsBean.newHypothesisLink}">
								<div class="form-group">
									<p:outputLabel for="@next">
								#{msg.hypothesis_token}:
								<h:outputLink value="discussion_help.jsf" target="_blank" rendered="#{empty groupOptionsBean.newHypothesisToken}">
											<f:param name="type" value="admin"/>[?]
								</h:outputLink>
									</p:outputLabel>
									<p:inputText id="set_hypothesis_token" value="#{groupOptionsBean.newHypothesisToken}"/>
									<p:message for="@previous"/>
								</div>

								<div class="form-group">
									<h:outputLink value="admin/group_discussion_activity.jsf" rendered="#{not empty groupOptionsBean.newHypothesisToken}">
										<f:param name="group_id" value="#{groupOptionsBean.groupId}"/>
										Discussion Activity
									</h:outputLink>
								</div>
							</ui:fragment>
						</ui:fragment>

						<div class="d-flex justify-content-end">
							<p:commandButton value="#{msg.save}" action="#{groupOptionsBean.onGroupEdit}" update=":group_moderator_form"/>
						</div>
					</h:form>
				</p:panel>

				<p:panel header="#{msg.options}">
					<h:form id="group_security_form">
						<div class="form-group">
							<p:outputLabel for="@next" value="#{msg['policy.title.join']}" styleClass="h5"/>
							<p:selectOneRadio value="#{groupOptionsBean.group.policyJoin}" layout="grid" columns="1">
                                <c:if test="#{userBean.admin}">
								    <f:selectItem itemValue="ALL_LEARNWEB_USERS" itemLabel="#{msg['policy.option.ALL_LEARNWEB_USERS']}" />
                                </c:if>
                                <c:if test="#{not empty groupOptionsBean.group.course.organisation.courses}">
                                    <f:selectItem itemValue="ORGANISATION_MEMBERS" itemLabel="#{msg['policy.option.ORGANISATION_MEMBERS']} (#{groupOptionsBean.group.course.organisation.title})" />
                                </c:if>
                                <f:selectItem itemValue="COURSE_MEMBERS" itemLabel="#{msg['policy.option.COURSE_MEMBERS']}"/>
                                <f:selectItem itemValue="NOBODY" itemLabel="#{msg['policy.option.NOBODY']}"/>                               
           
							</p:selectOneRadio>
							<p:message for="@previous"/>
						</div>

						<div class="form-group">
							<p:outputLabel for="@next" value="#{msg['Limit_number_of_members']}:" styleClass="h5"/>
							<p:selectBooleanButton value="#{groupOptionsBean.group.memberCountLimited}" style="max-width: 5rem;" styleClass="d-block"
												   onLabel="#{msg.yes}" offLabel="#{msg.no}" onIcon="ui-icon-check" offIcon="ui-icon-close">
								<p:ajax update="member_limit_input"/>
							</p:selectBooleanButton>
							<h:panelGroup id="member_limit_input">
								<ui:fragment rendered="#{groupOptionsBean.group.memberCountLimited}">
									#{msg.How_many_users_can_join_the_group}:
									<p:inputNumber value="#{groupOptionsBean.group.maxMemberCount}" style="max-width: 5rem;" styleClass="d-block"
												   minValue="#{groupOptionsBean.group.memberCount}" maxValue="10000" decimalPlaces="0" thousandSeparator=""/>
								</ui:fragment>
							</h:panelGroup>
							<p:message for="@previous"/>
						</div>

						<div class="form-group">
							<p:outputLabel for="@next" value="#{msg['policy.title.add']}" styleClass="h5"/>
							<p:selectOneRadio value="#{groupOptionsBean.group.policyAdd}" layout="grid" columns="1">
								<f:selectItems value="#{groupOptionsBean.group.policyAddOptions}" var="option" itemValue="#{option}" itemLabel="#{msg['policy.option.' += option]}"/>
							</p:selectOneRadio>
							<p:message for="@previous"/>
						</div>

						<div class="form-group">
							<p:outputLabel for="@next" value="#{msg['policy.title.edit']}" styleClass="h5"/>
							<p:selectOneRadio value="#{groupOptionsBean.group.policyEdit}" layout="grid" columns="1">
								<f:selectItems value="#{groupOptionsBean.group.policyEditOptions}" var="option" itemValue="#{option}" itemLabel="#{msg['policy.option.' += option]}"/>
							</p:selectOneRadio>
							<p:message for="@previous"/>
						</div>

						<div class="form-group">
							<p:outputLabel for="@next" value="#{msg['policy.title.view']}" styleClass="h5"/>
							<p:selectOneRadio value="#{groupOptionsBean.group.policyView}" layout="grid" columns="1">
								<f:selectItems value="#{groupOptionsBean.group.policyViewOptions}" var="option" itemValue="#{option}" itemLabel="#{msg['policy.option.' += option]}"/>
							</p:selectOneRadio>
							<p:message for="@previous"/>
						</div>

						<div class="form-group">
							<p:outputLabel for="@next" value="#{msg['policy.title.annotate']}" styleClass="h5"/>
							<p:selectOneRadio value="#{groupOptionsBean.group.policyAnnotate}" layout="grid" columns="1">
								<f:selectItems value="#{groupOptionsBean.group.policyAnnotateOptions}" var="option" itemValue="#{option}" itemLabel="#{msg['policy.option.' += option]}"/>
							</p:selectOneRadio>
							<p:message for="@previous"/>
						</div>

						<ui:fragment rendered="#{groupOptionsBean.group.restrictionForumCategoryEnabled}">
							<div class="form-group">
								<p:outputLabel for="@next" value="#{msg['Miscellaneous']}" styleClass="h5"/>
								<p:selectBooleanCheckbox id="restriction_mandatory_forum_category" value="#{groupOptionsBean.group.restrictionForumCategoryRequired}" itemLabel="#{msg['policy.forum_category']}"/>
								<p:message for="@previous"/>
							</div>
						</ui:fragment>

						<div class="d-flex justify-content-end">
							<p:commandButton value="#{msg.save}" action="#{groupOptionsBean.onGroupEdit}" update=":group_security_form"/>
						</div>
					</h:form>
				</p:panel>
				</p:outputPanel>

				<p:panel header="#{msg.options}" rendered="${groupOptionsBean.group.isMember(userBean.user) and !groupOptionsBean.group.course.isModerator(userBean.user)}">
					<h:form>
						<div class="form-group">
							<p:outputLabel for="@next" value="#{msg['policy.title.join']}" styleClass="h5"/>
							<h:outputText value="#{msg['policy.option.' +=groupOptionsBean.group.policyJoin]}"/>
						</div>

						<div class="form-group">
							<p:outputLabel for="@next" value="#{msg['Limit_number_of_members']}:" styleClass="h5"/>
							<h:outputText value="#{groupOptionsBean.group.maxMemberCount}" rendered="#{groupOptionsBean.group.maxMemberCount ge 0}"/>
							<h:outputText value="-" rendered="#{groupOptionsBean.group.maxMemberCount lt 0}"/>
						</div>

						<div class="form-group">
							<p:outputLabel for="@next" value="#{msg['policy.title.add']}" styleClass="h5"/>
							<h:outputText value="#{msg['policy.option.' +=groupOptionsBean.group.policyAdd]}"/>
						</div>

						<div class="form-group">
							<p:outputLabel for="@next" value="#{msg['policy.title.edit']}" styleClass="h5"/>
							<h:outputText value="#{msg['policy.option.' +=groupOptionsBean.group.policyEdit]}"/>
						</div>

						<div class="form-group">
							<p:outputLabel for="@next" value="#{msg['policy.title.view']}" styleClass="h5"/>
							<h:outputText value="#{msg['policy.option.' +=groupOptionsBean.group.policyView]}"/>
						</div>

						<div class="form-group">
							<p:outputLabel for="@next" value="#{msg['policy.title.annotate']}" styleClass="h5"/>
							<h:outputText value="#{msg['policy.option.' +=groupOptionsBean.group.policyAnnotate]}"/>
						</div>

						<div class="form-group">
							<p:outputLabel for="@next" value="#{msg.leader}:" styleClass="h5"/>
							<p:link outcome="/lw/user/detail" value="#{groupOptionsBean.group.leader.username}">
								<f:param name="user_id" value="#{groupOptionsBean.group.leader.id}"/>
							</p:link>
						</div>
					</h:form>
				</p:panel>
			</div>

			<p:outputPanel styleClass="col-md-6" layout="block" rendered="${groupOptionsBean.group.course.isModerator(userBean.user) || groupOptionsBean.group.isLeader(userBean.user) || groupOptionsBean.group.isMember(userBean.user)}">
				<p:panel header="#{msg.copy_resources}">
					<h:form id="group_copy_form">
						<div class="form-group">
							<p:outputLabel for="@next" value="#{msg.copy_all_resources}"/>
							<p:selectOneMenu value="#{groupOptionsBean.selectedResourceTargetGroupId}">
								<f:selectItems var="g" value="#{groupOptionsBean.userCopyableGroups}" itemLabel="#{g.title}" itemValue="#{g.id}"/>
							</p:selectOneMenu>
						</div>

						<div class="d-flex justify-content-end">
							<p:commandButton value="#{msg.copy}" action="#{groupOptionsBean.copyGroup}" process="@form">
								<p:confirm message="#{of:format1(msg.group_copy_resources_question, groupOptionsBean.group.resources.size())}"/>
							</p:commandButton>
						</div>
					</h:form>
				</p:panel>

				<p:panel header="#{msg.notifications}" rendered="#{groupOptionsBean.group.isMember(userBean.user)}">
					<h:form>
						<p:selectOneMenu value="#{groupOptionsBean.groupUser.notificationFrequency}" styleClass="w-100 mb-3">
							<f:selectItems var="frequency" value="#{profileBean.notificationFrequencies}" itemValue="#{frequency}" itemLabel="#{msg['notification_type.'+=frequency]}"/>
						</p:selectOneMenu>

						<div class="d-flex justify-content-between">
							<p:link outcome="/lw/myhome/profile" value="#{msg['notification_settings.set_frequency_for_all_my_groups']}"/>
							<p:commandButton value="#{msg.save}" actionListener="#{profileBean.onSaveNotificationFrequency(groupOptionsBean.groupUser, userBean.user.id)}"/>
						</div>
					</h:form>
				</p:panel>

				<p:panel header="#{msg['Miscellaneous']}">
					<h:form id="group_delete_form" styleClass="d-flex justify-content-between">
						<p:commandButton value="#{msg.delete_group}" rendered="${groupOptionsBean.group.course.isModerator(userBean.user) || groupOptionsBean.group.isLeader(userBean.user)}" title="#{msg.delete}" action="#{groupsBean.deleteGroup}" process="@this">
							<p:confirm message="#{of:format1(msg.group_delete_question, groupOptionsBean.group.title)}"/>
							<f:setPropertyActionListener target="#{groupsBean.selectedGroup}" value="#{groupOptionsBean.group}"/>
						</p:commandButton>
						<p:commandButton action="#{groupsBean.leaveGroup}" value="#{msg.leave_group}" immediate="true"
										 oncomplete="window.location.replace(window.location.href);" rendered="${groupOptionsBean.group.isMember(userBean.user)}">
							<f:setPropertyActionListener target="#{groupsBean.selectedGroup}" value="#{groupOptionsBean.group}"/>
							<f:setPropertyActionListener target="#{userBean.sidebarMenuModel}" value="#{null}"/>
							<p:confirm message="#{of:format1(msg.leave_group_question, groupOptionsBean.group.title)}"/>
						</p:commandButton>
					</h:form>
				</p:panel>
			</p:outputPanel>
		</div>

	<p:dialog widgetVar="changeLeader" header="#{msg.change_leader}" modal="true" styleClass="overflow-hidden">
		<h:form>
			<p:selectOneMenu id="edit_group_leader" value="#{groupOptionsBean.editedGroupLeaderId}" styleClass="mb-3 w-100" immediate="true" required="true">
				<f:selectItems value="#{groupOptionsBean.group.members}" var="user" itemValue="#{user.id}" itemLabel="#{user.username}"/>
			</p:selectOneMenu>
			<div class="d-flex justify-content-end">
				<p:commandButton value="#{msg.save}" action="#{groupOptionsBean.onGroupEdit}" process="@form" oncomplete="PF('changeLeader').hide()" update=":group_moderator_form">
					<p:confirm message="#{msg.change_leader_are_you_sure}" escape="false"/>
				</p:commandButton>
			</div>
		</h:form>
	</p:dialog>
</ui:define>
</ui:composition>
