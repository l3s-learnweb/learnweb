<ui:composition template="/WEB-INF/templates/blocks/group/template.xhtml"
                xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
                xmlns:h="http://xmlns.jcp.org/jsf/html"
                xmlns:f="http://xmlns.jcp.org/jsf/core"
                xmlns:p="http://primefaces.org/ui" xmlns:lw="http://l3s.de/learnweb">

<ui:param name="helpText" value="#{msg.groupLinkHelp}"/>
<ui:param name="loginRequired" value="true"/>
<ui:param name="pageTitle" value="#{groupLinksBean.group.title}"/>
<ui:param name="group" value="#{groupLinksBean.group}"/>

<ui:define name="metadata">
    <f:metadata>
        <f:viewParam name="group_id" value="#{groupLinksBean.groupId}"/>
        <f:viewAction action="#{groupLinksBean.onLoad}"/>
    </f:metadata>
</ui:define>


<ui:define name="breadcrumb">
    <lw:breadcrumb-item link="myhome/groups.jsf" title="#{msg.myGroups}">
        <ui:decorate template="/WEB-INF/templates/blocks/breadcrumb/nav_list_first.xhtml"/>
    </lw:breadcrumb-item>

    <lw:breadcrumb-item link="group/resources.jsf?group_id=#{userBean.user.activeGroup.id}" title="#{userBean.user.activeGroup.title}" >
        <p:repeat var="groups" value="#{userBean.user.groups}">
            <li><a href="group/resources.jsf?group_id=#{groups.id}">#{groups.title}</a></li>
        </p:repeat>
    </lw:breadcrumb-item>

    <lw:breadcrumb-item link="group/links.jsf?group_id=#{userBean.user.activeGroup.id}" title="#{msg.links}">
        <ui:decorate template="/WEB-INF/templates/blocks/breadcrumb/nav_list_my_groups.xhtml"/>
    </lw:breadcrumb-item>
</ui:define>

<ui:define name="group_layout">
    <div class="row">
        <div class="col-md-12">
            <h:form id="group_links">
                <p:panel header="#{msg.links}">
                    <f:facet name="actions">
                        <p:commandButton value="#{msg.addLink}" onclick="PF('addLinkDialog').show();" styleClass="alt-btn" global="false"
                                         rendered="${groupLinksBean.group.isMember(userBean.user)}"/>
                    </f:facet>

                    <ui:fragment rendered="${empty groupLinksBean.links}">
                        No links have been added.
                    </ui:fragment>

                    <h:panelGroup rendered="${not empty groupLinksBean.links}">
                        <ul class="pl-3 m-0">
                            <p:repeat value="${groupLinksBean.links}" var="link">
                                <li>
                                    <h:outputLink value="#{link.url}" styleClass="mr-3" target="_blank">
                                        <h:outputText value="#{link.title}"/>
                                    </h:outputLink>

                                    <p:commandLink title="#{msg.edit}" styleClass="icon-link"
                                                   process="@this" update=":edit_link_dialog" oncomplete="PF('editLinkDialog').show();"
                                                   rendered="${userBean.moderator || groupLinksBean.group.isMember(userBean.user)}">
                                        <f:setPropertyActionListener value="#{link}" target="#{groupLinksBean.selectedLink}"/>
                                        <i class="fa fa-fw fa-pencil text-warning" aria-hidden="true"></i>
                                        <h:outputText value="#{msg.edit}"/>
                                    </p:commandLink>

                                    <p:commandLink title="#{msg.delete}" styleClass="icon-link" process="@this" update=":growl :group_links"
                                                   actionListener="#{groupLinksBean.onDeleteLinkFromGroup(link.id)}"
                                                   onstart="return confirm('#{utilBean.getLocaleMessage('link_delete_question', link.title)}');"
                                                   rendered="${userBean.moderator || groupLinksBean.group.isLeader(userBean.user)}">
                                        <i class="fa fa-fw fa-trash text-danger" aria-hidden="true"></i>
                                        <h:outputText value="#{msg.delete}"/>
                                    </p:commandLink>
                                </li>
                            </p:repeat>
                        </ul>
                    </h:panelGroup>
                </p:panel>
            </h:form>
            <p:panel header="#{msg.documents}" id="group_documents">
                <ui:fragment rendered="${empty groupLinksBean.documentLinks}">
                    No documents have been added.
                </ui:fragment>

                <h:form rendered="${not empty groupLinksBean.documentLinks}">
                    <ul class="pl-3 m-0">
                        <p:repeat value="${groupLinksBean.documentLinks}" var="link">
                            <li>
                                <h:outputLink value="#{link.url}" styleClass="mr-3" target="_blank">
                                    <h:outputText value="#{link.title}"/>
                                </h:outputLink>

                                <p:commandLink title="#{msg.edit}" process="@this" styleClass="icon-link" update=":edit_link_dialog" oncomplete="PF('editLinkDialog').show();"
                                               rendered="${userBean.moderator || groupLinksBean.group.isMember(userBean.user)}">
                                    <f:setPropertyActionListener value="#{link}" target="#{groupLinksBean.selectedLink}"/>
                                    <i class="fa fa-fw fa-pencil text-warning" aria-hidden="true"></i>
                                    <h:outputText value="#{msg.edit}"/>
                                </p:commandLink>

                                <p:commandLink title="#{msg.delete}" process="@this" styleClass="icon-link" update=":growl :group_documents"
                                               actionListener="#{groupLinksBean.onDeleteLinkFromGroup(link.id)}"
                                               onstart="return confirm('#{utilBean.getLocaleMessage('link_delete_question', link.title)}');"
                                               rendered="${userBean.moderator || groupLinksBean.group.isLeader(userBean.user)}">
                                    <i class="fa fa-fw fa-trash text-danger" aria-hidden="true"></i>
                                    <h:outputText value="#{msg.delete}"/>
                                </p:commandLink>
                            </li>
                        </p:repeat>
                    </ul>
                </h:form>
            </p:panel>
        </div>
    </div>

    <p:dialog header="#{msg.addLink}" widgetVar="addLinkDialog" rendered="${groupLinksBean.group.isMember(userBean.user)}"
              modal="true" resizable="false" draggable="false" responsive="true" closeOnEscape="true">
        <h:form id="add_link_form">
            <div class="form-group">
                <p:outputLabel for="@next" value="#{msg.type}:"/>
                <p:selectOneMenu id="link_type" value="#{groupLinksBean.newLinkType}">
                    <p:ajax process="@this" event="change" update="url_input_wrapper" global="false"/>

                    <f:selectItem itemValue="document" itemLabel="Google Document (Word)"/>
                    <f:selectItem itemValue="spreadsheet" itemLabel="Google Spreadsheet (Excel)"/>
                    <f:selectItem itemValue="presentation" itemLabel="Google Presentation (PowerPoint)"/>
                    <f:selectItem itemValue="url" itemLabel="#{msg.website}"/>
                </p:selectOneMenu>
                <p:message for="@previous"/>
            </div>

            <div class="form-group">
                <p:outputLabel for="@next" value="#{msg.title}:"/>
                <p:inputText id="link_title" value="#{groupLinksBean.newLinkTitle}" required="true"/>
                <p:message for="@previous"/>
            </div>

            <h:panelGroup id="url_input_wrapper" styleClass="form-group" layout="block">
                <ui:fragment rendered="#{groupLinksBean.newLinkType eq 'url'}">
                    <p:outputLabel for="@next" value="#{msg.url}:"/>
                    <p:inputText id="link_url" value="#{groupLinksBean.newLinkUrl}" required="true"/>
                    <p:message for="@previous"/>
                </ui:fragment>
            </h:panelGroup>

            <p:commandButton ajax="true" value="#{msg.addLink}" action="#{groupLinksBean.onAddLink}"
                             oncomplete="if (!args.validationFailed) PF('addLinkDialog').hide();"
                             process="@form" update=":group_links :group_documents @form"/>
        </h:form>
    </p:dialog>

    <p:dialog header="#{msg.edit} (#{groupLinksBean.selectedLink.title})" widgetVar="editLinkDialog" id="edit_link_dialog"
              modal="true" resizable="false" draggable="false" responsive="true" closeOnEscape="true">
        <h:form rendered="#{groupLinksBean.selectedLink != null}" id="edit_link_form">
            <div class="form-group">
                <p:outputLabel for="@next" value="#{msg.title}:"/>
                <p:inputText id="link_title_edit" value="#{groupLinksBean.selectedLink.title}" required="true"/>
                <p:message for="@previous"/>
            </div>

            <p:commandButton ajax="true" value="#{msg.save}" actionListener="#{groupLinksBean.onEditLink}"
                             oncomplete="if (!args.validationFailed) PF('editLinkDialog').hide();"
                             process="@form" update=":group_links :group_documents @form :message">
                <f:setPropertyActionListener target="#{groupLinksBean.editLink}" value="#{groupLinksBean.selectedLink}"/>
            </p:commandButton>
        </h:form>
    </p:dialog>
</ui:define>
</ui:composition>
