<ui:composition template="/WEB-INF/templates/blocks/group/template.xhtml"
                xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
                xmlns:h="http://xmlns.jcp.org/jsf/html"
                xmlns:f="http://xmlns.jcp.org/jsf/core"
                xmlns:p="http://primefaces.org/ui">

<ui:param name="helpText" value="#{msg.groupLinkHelp}"/>
<ui:param name="loginRequired" value="true"/>
<ui:param name="pageTitle" value="#{groupLinksBean.group.title}"/>
<ui:param name="group" value="#{groupLinksBean.group}"/>

<ui:define name="metadata">
    <f:metadata>
        <f:viewParam name="group_id" value="#{groupLinksBean.groupId}"/>
        <f:viewAction action="#{groupLinksBean.onLoad}"/>
    </f:metadata>
</ui:define>

<ui:define name="breadcrumb_ext">
    <p:menuitem value="#{groupLinksBean.group.title}" url="group/overview.jsf?group_id=#{groupLinksBean.groupId}"/>
    <p:menuitem value="#{msg.links}" url=""/>
</ui:define>

<ui:define name="group_layout">
    <div class="row">
        <div class="col-md-6">
            <p:panel header="#{msg.links}" id="group_links" styleClass="mb-3">
                <ui:fragment rendered="${empty groupLinksBean.links or empty groupLinksBean.documentLinks}">
                    No links have been added.
                </ui:fragment>

                <h:form rendered="${not empty groupLinksBean.links}">
                    <ul>
                        <p:repeat value="${groupLinksBean.links}" var="link">
                            <li>
                                <h:outputLink value="#{link.url}" target="_blank">
                                    #{link.title}
                                </h:outputLink>

                                <p:commandLink update=":link_dialog" oncomplete="PF('link_dialog').show();" title="#{msg.edit}" process="@this"
                                               rendered="${link.id != -1 and (userBean.moderator or groupLinksBean.group.isMember(userBean.user))}">
                                    <f:setPropertyActionListener value="#{link}" target="#{groupLinksBean.selectedLink}"/>
                                    <i class="fa fa-fw fa-pencil text-warning" aria-hidden="true"></i>
                                </p:commandLink>

                                <p:commandLink actionListener="#{groupLinksBean.onDeleteLinkFromGroup(link.id)}" update=":message :group_links"
                                               title="#{msg.delete}"
                                               onstart="return confirm('#{utilBean.getLocaleMessage('link_delete_question', link.title)}');"
                                               rendered="${(userBean.moderator || groupLinksBean.group.isLeader(userBean.user))}">
                                    <i class="fa fa-fw fa-trash text-danger" aria-hidden="true"></i>
                                </p:commandLink>
                            </li>
                        </p:repeat>
                    </ul>
                </h:form>
            </p:panel>

            <p:panel header="#{msg.documents}" id="group_documents" styleClass="mb-3">
                <ui:fragment rendered="${empty groupLinksBean.documentLinks}">
                    No documents have been added.
                </ui:fragment>

                <h:form rendered="${not empty groupLinksBean.documentLinks}">
                    <ul>
                        <p:repeat value="${groupLinksBean.documentLinks}" var="link">
                            <li>
                                <h:outputLink value="#{link.url}" target="_blank" onclick="return onLinkClick(this);">
                                    #{link.title}
                                </h:outputLink>

                                <p:commandLink update=":link_dialog" oncomplete="PF('link_dialog').show();" title="#{msg.edit}" process="@this"
                                               rendered="${link.id != -1 and (userBean.moderator || groupLinksBean.group.isMember(userBean.user))}">
                                    <f:setPropertyActionListener value="#{link}" target="#{groupLinksBean.selectedLink}"/>
                                    <i class="fa fa-fw fa-pencil text-warning" aria-hidden="true"></i>
                                </p:commandLink>

                                <p:commandLink actionListener="#{groupLinksBean.onDeleteLinkFromGroup(link.id)}" update=":message :group_documents"
                                               title="#{msg.delete}"
                                               onstart="return confirm('#{utilBean.getLocaleMessage('link_delete_question', link.title)}');"
                                               rendered="${link.id != -1 and (userBean.moderator || groupLinksBean.group.isLeader(userBean.user))}">
                                    <i class="fa fa-fw fa-trash text-danger" aria-hidden="true"></i>
                                </p:commandLink>
                            </li>
                        </p:repeat>
                    </ul>
                </h:form>
            </p:panel>
        </div>

        <div class="col-md-6">
            <p:panel toggleable="true" header="#{msg.options}" rendered="${groupLinksBean.group.isMember(userBean.user)}">
                <h:form id="link_form">
                    <div class="form-group">
                        <p:outputLabel for="@next" value="#{msg.type}:"/>
                        <p:selectOneMenu id="link_type" value="#{groupLinksBean.newLinkType}">
                            <f:selectItem itemValue="document" itemLabel="Google Document (Word)"/>
                            <f:selectItem itemValue="spreadsheet" itemLabel="Google Spreadsheet (Excel)"/>
                            <f:selectItem itemValue="presentation" itemLabel="Google Presentation (PowerPoint)"/>
                            <f:selectItem itemValue="url" itemLabel="#{msg.website}"/>
                            <p:ajax process="@this" update="urlpanel1"/>
                            <f:param name="group_id" value="#{groupLinksBean.group.id}"/>
                        </p:selectOneMenu>
                        <p:message for="@previous"/>
                    </div>

                    <h:panelGroup id="urlpanel1" styleClass="form-group" layout="block" rendered="#{groupLinksBean.newLinkType == 'url'}">
                        <p:outputLabel for="@next" value="#{msg.url}:"/>
                        <p:inputText id="link_url" value="#{groupLinksBean.newLinkUrl}"/>
                        <p:message for="@previous"/>
                    </h:panelGroup>

                    <div class="form-group">
                        <p:outputLabel for="@next" value="#{msg.title}:"/>
                        <p:inputText id="link_title" value="#{groupLinksBean.newLinkTitle}"/>
                        <p:message for="@previous"/>
                    </div>

                    <p:commandButton action="#{groupLinksBean.onAddLink}" ajax="true" value="#{msg.addLink}" process="@form"
                                     update=":group_links :group_documents @form :growl"/>
                </h:form>
            </p:panel>
        </div>
    </div>

    <p:dialog appendTo="@(body)" header="#{msg.edit}" widgetVar="link_dialog" id="link_dialog" modal="true" minWidth="540">
        <h:form rendered="#{groupLinksBean.selectedLink != null}">
            <div class="form-group">
                <p:outputLabel for="@next" value="#{msg.title}:"/>
                <p:inputText id="link_title_edit" value="#{groupLinksBean.selectedLink.title}"/>
                <p:message for="@previous"/>
            </div>

            <p:commandButton value="#{msg.save}" ajax="true" actionListener="#{groupLinksBean.onEditLink}" process="@form"
                             oncomplete="PF('link_dialog').hide();" update=":message :group_links :group_documents">
                <f:setPropertyActionListener target="#{groupLinksBean.editLink}" value="#{groupLinksBean.selectedLink}"/>
            </p:commandButton>
        </h:form>
    </p:dialog>
</ui:define>
</ui:composition>