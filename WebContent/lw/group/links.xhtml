<ui:composition template="/lw/templates/new_main_t.xhtml" 
	xmlns:ui="http://java.sun.com/jsf/facelets" 
	xmlns:h="http://java.sun.com/jsf/html" 
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:p="http://primefaces.org/ui">

	<ui:param name="helpText" value="#{msg.groupLinkHelp}"/>

	<ui:define name="metadata">
		<f:metadata>
			<f:viewParam name="group_id" value="#{groupDetailBean.groupId}" />
			<f:event type="javax.faces.event.PreRenderViewEvent" listener="#{groupDetailBean.preRenderView}" /> 
		</f:metadata>
	</ui:define>			

	<ui:param name="loginRequired" value="true" />
	<ui:param name="pageTitle" value="#{groupDetailBean.group.title}" />

	<ui:define name="center_layout">
	
		<div class="center-header" id="group_header">
			<span>#{msg.links}</span> #{msg.of} #{groupDetailBean.group.title}
			
			<h:form id="center_header_form">
				<p:commandLink rendered="#{not groupDetailBean.member}" action="#{groupsBean.joinGroup}" styleClass="resource_button greenbutton"  update=":growl :group_menu @form" partialSubmit="true" process="@this" value="#{msg.join_group}">
					<f:setPropertyActionListener target="#{groupsBean.selectedGroup}" value="#{groupDetailBean.group}" />
				</p:commandLink>
			</h:form>
				
			<ul>								
				<li>
					<a class="" href="./group/overview.jsf?group_id=#{groupDetailBean.group.id}">
						<h:outputText value="#{msg.overview}" />
					</a>
				</li>								
				<li>
					<a class="" href="./group/resources.jsf?group_id=#{groupDetailBean.group.id}">
						<h:outputText value="#{msg.resources}" />
					</a>
				</li>								
				<li>
					<a class="" href="./group/members.jsf?group_id=#{groupDetailBean.group.id}">
						<h:outputText value="#{msg.members}" />
					</a>
				</li>								
				<li>
					<a class="" href="./group/presentations.jsf?group_id=#{groupDetailBean.group.id}">
						<h:outputText value="#{msg.presentations}" />
					</a>
				</li>								
				<li>
					<a class="active" href="./group/links.jsf?group_id=#{groupDetailBean.group.id}">
						<h:outputText value="#{msg.links}" />
					</a>
				</li>
			</ul>
		</div>
		
		<script type="text/javascript">
		/* <!-- */
			$("#center_pane").prepend($("#group_header"));
		/* --> */
		</script>
		
		<p:dialog appendTo="@(body)" header="#{msg.edit}" widgetVar="link_dialog" modal="true" minWidth="540" styleClass="zindex10000">
			<h:form id="link_edit_form">
				<h:panelGrid columns="2" rendered="#{groupDetailBean.selectedLink != null}">					
					<h:outputLabel value="#{msg.title}:" for="link_title_edit"/>
					<p:inputText value="#{groupDetailBean.selectedLink.title}" id="link_title_edit" styleClass="links_input" />
					
					<h:outputText value="" />
					<p:commandButton value="#{msg.save}" ajax="true" actionListener="#{groupDetailBean.onEditLink}" process="@form" oncomplete="PF('link_dialog').hide();" update=":message :grouplinks">
						<f:setPropertyActionListener target="#{groupDetailBean.editLink}" value="#{groupDetailBean.selectedLink}" />
						<f:param name="group_id" value="#{groupDetailBean.group.id}"/>						
					</p:commandButton>
				</h:panelGrid>
			</h:form>						
		</p:dialog>	
		
		
		<h:panelGroup id="grouplinks" layout="block" style="padding-right:5px;">		

		
			<h:panelGroup rendered="${not empty groupDetailBean.links}">	
				<h:form styleClass="links_form">		
					<h4 class="clear"><h:outputText value="#{msg.links}" />:</h4>
					<p:dataList var="link" value="${groupDetailBean.links}" styleClass="links_datalist">		
						<p:column>
							<h:outputLink value="#{link.url}" target="_blank" styleClass="links_output">#{link.title}</h:outputLink>	
						
							<p:commandLink update=":link_edit_form" oncomplete="PF('link_dialog').show();" title="#{msg.edit}" process="@this" styleClass="links_commandlink" rendered="${link.id != -1 and (userBean.admin || userBean.moderator || groupDetailBean.group.isMember(userBean.user))}">
								<h:graphicImage value="/resources/icon/silk/pencil.png" width="16" height="16" alt="#{msg.edit}" styleClass="links_graphic" />
								<f:setPropertyActionListener value="#{link}" target="#{groupDetailBean.selectedLink}" />
								<f:param name="group_id" value="#{groupDetailBean.groupId}" /> 
							</p:commandLink> 
							
							<p:commandLink actionListener="#{groupDetailBean.onDeleteLinkFromGroup(link.id)}" update=":message :grouplinks" title="#{msg.delete}" onstart="return confirm('${utilBean.getLocaleMessage('link_delete_question', link.title)}');" rendered="${(userBean.admin || userBean.moderator || groupDetailBean.group.isLeader(userBean.user))}">
								<f:param name="group_id" value="#{groupDetailBean.group.id}"/>
								<h:graphicImage value="/resources/icon/silk/delete.png" width="16" height="16" alt="#{msg.delete}" styleClass="links_graphic"/> 
							</p:commandLink>
						</p:column>
					</p:dataList>
				</h:form>
			</h:panelGroup>
				
			<h:panelGroup rendered="${not empty groupDetailBean.documentLinks}">	
				<h:form styleClass="links_form">				
					<h4 class="clear">
						<h:outputText value="#{msg.documents}" />:
					</h4>
					<p:dataList var="link" value="${groupDetailBean.documentLinks}" styleClass="links_datalist">		
						<p:column>
							<h:outputLink value="#{link.url}" target="_blank" styleClass="links_output">
								#{link.title}
							</h:outputLink>	
							
							<p:commandLink update=":link_edit_form" oncomplete="PF('link_dialog').show();" title="#{msg.edit}" process="@this" styleClass="links_commandlink" rendered="${link.id != -1 and (userBean.admin || userBean.moderator || groupDetailBean.group.isMember(userBean.user))}">
								<h:graphicImage value="/resources/icon/silk/pencil.png" width="16" height="16" styleClass="links_graphic" />
								<f:setPropertyActionListener value="#{link}" target="#{groupDetailBean.selectedLink}" />
								<f:param name="group_id" value="#{groupDetailBean.groupId}" /> 
							</p:commandLink>
									
							<p:commandLink actionListener="#{groupDetailBean.onDeleteLinkFromGroup(link.id)}" update=":message :grouplinks" title="#{msg.delete}" onstart="return confirm('${utilBean.getLocaleMessage('link_delete_question', link.title)}');" rendered="${link.id != -1 and (userBean.admin || userBean.moderator || groupDetailBean.group.isLeader(userBean.user))}">
								<f:param name="group_id" value="#{groupDetailBean.group.id}"/>
								<h:graphicImage value="/resources/icon/silk/delete.png" width="16" height="16" alt="#{msg.delete}" styleClass="links_graphic"/> 
							</p:commandLink>
						</p:column>
					</p:dataList>
				</h:form>			
			</h:panelGroup>
		</h:panelGroup>

		<p:panel toggleable="true" header="#{msg.options}" rendered="${groupDetailBean.group.isMember(userBean.user)}" styleClass="clear links_panel" style="margin-top:20px; margin-right:5px;">
			<h:form id="link_form">
				<h:panelGrid columns="3">	
					<h:outputText value="" rendered="${groupDetailBean.group.forumId == 0}" />
					<p:commandButton rendered="${groupDetailBean.group.forumId == 0}" immediate="true" value="#{msg.createForum}" actionListener="#{groupDetailBean.onCreateForum}" update=":message :grouplinks @form" style="margin-bottom:10px;">
						<f:param name="group_id" value="#{groupDetailBean.group.id}"/>
					</p:commandButton>
					<h:outputText value="" rendered="${groupDetailBean.group.forumId == 0}" />					
							
					<h:outputLabel value="#{msg.type}:" for="link_type" />
					<h:selectOneMenu value="#{groupDetailBean.newLinkType}" id="link_type">
						<f:selectItem itemValue="document" itemLabel="Google Document (Word)" />
						<f:selectItem itemValue="spreadsheet" itemLabel="Google Spreadsheet (Excel)" />
						<f:selectItem itemValue="presentation" itemLabel="Google Presentation (PowerPoint)" />
						<f:selectItem itemValue="url" itemLabel="#{msg.website}"  />	 
						<p:ajax process="@this" update="urlpanel1 urlpanel2 urlpanel3" />
						<f:param name="group_id" value="#{groupDetailBean.group.id}"/>
					</h:selectOneMenu>
					<h:outputText value="" />					
					
					<h:panelGroup id="urlpanel1">
						<h:outputLabel rendered="#{groupDetailBean.newLinkType == 'url'}" for="link_url" value="URL:" />
					</h:panelGroup>
					<h:panelGroup id="urlpanel2">
						<p:inputText rendered="#{groupDetailBean.newLinkType == 'url'}" styleClass="links_inputtext" id="link_url" value="#{groupDetailBean.newLinkUrl}" />
					</h:panelGroup>
					<h:panelGroup id="urlpanel3">
						<p:message rendered="#{groupDetailBean.newLinkType == 'url'}" showSummary="true" showDetail="false" styleClass="error" for="link_url" />
					</h:panelGroup>
					
						
					<h:outputLabel for="link_title" value="#{msg.title}:" />
					<p:inputText id="link_title" value="#{groupDetailBean.newLinkTitle}" styleClass="links_inputtext2"/>
					<p:message showSummary="true" showDetail="false" styleClass="error" for="link_title"/>
	
					<h:outputText value="" />
					<p:commandButton action="#{groupDetailBean.onAddLink}" ajax="true" value="#{msg.addLink}" process="@form" update=":grouplinks link_form :growl">					
						<f:param name="group_id" value="#{groupDetailBean.group.id}"/>
					</p:commandButton>
					<h:outputText value="" />
				</h:panelGrid>
			</h:form>
		</p:panel>	
	</ui:define>
</ui:composition>