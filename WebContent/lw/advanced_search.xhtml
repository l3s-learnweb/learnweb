<ui:composition template="/templates/main/main_old.xhtml"
				xmlns:ui="http://java.sun.com/jsf/facelets"
				xmlns:h="http://java.sun.com/jsf/html"
				xmlns:f="http://java.sun.com/jsf/core"
				xmlns:p="http://primefaces.org/ui"
				xmlns:pt="http://xmlns.jcp.org/jsf/passthrough">

	<ui:param name="loginRequired" value="true" />
	<ui:param name="pageTitle" value="#{msg.advancedSearch}" />
	<ui:param name="disableGrowl" value="false" />

	<ui:define name="metadata">
		<f:metadata>
			<f:event type="javax.faces.event.PreRenderViewEvent" listener="#{resourceDetailBean.preRenderView}" />
		</f:metadata>
	</ui:define>

	<ui:define name="center_layout">

		<h:form>
			<p:remoteCommand name="selectGroupItemCommand" actionListener="#{advSearchBean.actionSelectGroupItem}" update=":add_resource_panel :growl" oncomplete="update_header();resourceDND();"/>
			<p:remoteCommand name="editGroupItemCommand" actionListener="#{advSearchBean.actionEditGroupItem}" update=":add_resource_panel :growl" oncomplete="update_header()"/>
			<p:remoteCommand name="updateGroupItemsCommand" actionListener="#{advSearchBean.actionUpdateGroupItems}" update=":group_menu_tree :datagrid :paginator :add_resource_panel :growl" oncomplete="resourceDND()"/>
			<p:remoteCommand name="updateAddResourcePaneCommand" actionListener="#{advSearchBean.updateTargetForAddResourceBean}" update=":add_resource_panel :growl" oncomplete="update_header()"/>
			<p:remoteCommand name="updateThumbnailCommand" actionListener="#{resourceDetailBean.setResourceThumbnail}" update=":add_resource_panel :datagrid :growl" oncomplete="update_header();resourceDND();"/>
		</h:form>

		<div class="center-header" id="group_header">
			<h2>#{msg.advancedSearch}</h2>			

			<h:form styleClass="resources-filters" id="filters">	
				<table>
					<c:forEach var="field" items="#{userBean.user.organisation.metadataFields}">
						<tr>
							<c:if test="#{fn:startsWith(field.type,'FULLWIDTH_')}">	
								<td colspan="2">
									<c:if test="#{field.type eq 'FULLWIDTH_HEADER'}">
										<h3><h:outputText value="${utilBean.getLocaleMessage(field.label, null)}" /></h3>
									</c:if> 
									<c:if test="#{field.type eq 'FULLWIDTH_DESCRIPTION'}">
										<h4><h:outputText value="${utilBean.getLocaleMessage(field.label, null)}" /></h4>
									</c:if> 
									
								</td>
							</c:if>	
							<c:if test="#{not fn:startsWith(field.type,'FULLWIDTH_')}">	
								<td>
									<h:outputText value="${utilBean.getLocaleMessage(field.name, null)}" />:
								</td>
								<td>	
									
									<c:if test="#{field.type eq 'INPUT_TEXT' or field.type eq 'INPUT_TEXTAREA'}">					
										<p:inputText id="input_#{field.name}" required="#{field.required}" class="border-box-100" value="#{res.metadataWrapper[field.name]}" title="#{field.info}" />
										<p:tooltip for="input_#{field.name}" showEvent="focus" hideEvent="blur" position="left" rendered="#{not empty field.info}" />
									</c:if>
									
									<c:if test="#{field.type eq 'AUTOCOMPLETE'}">	 				
										<p:autoComplete id="input_complete_#{field.name}" required="#{field.required}" value="#{res.metadataWrapper[field.name]}" 
											completeMethod="#{field.completeText}" class="border-box-100" /> 
										<p:tooltip for="input_complete_#{field.name}" showEvent="hover" position="left" rendered="#{true}" value="blaaaaaaa #{field.info}" /> 
									</c:if>
				
									<c:if test="#{field.type eq 'ONE_MENU' or field.type eq 'ONE_MENU_EDITABLE'}">
										<p:selectOneMenu id="input_selectone_#{field.name}" value="#{res.metadataWrapper[field.name]}" editable="#{field.type eq 'ONE_MENU_EDITABLE'}" required="#{field.required}"
											class="border-box-100" title="#{field.info}">
											<f:selectItems value="#{field.options}" var="option" itemLabel="#{option}" itemValue="#{option}" />
										</p:selectOneMenu>
										<p:tooltip for="input_selectone_#{field.name}" position="left" rendered="#{not empty field.info}" /> 
									</c:if>	
				
									<c:if test="#{field.type eq 'MULTIPLE_MENU'}">
										<p:selectCheckboxMenu id="input_selectmultiple_#{field.name}" value="#{res.metadataMultiValue[field.name]}" label="" multiple="true" title="#{field.info}"
					                              required="#{field.required}" filter="#{field.optionsList.size() gt 8}" filterMatchMode="startsWith" panelStyle="width:250px" >
								            <f:selectItems value="#{field.optionsList}" var="option" itemLabel="#{option.label}" itemValue="#{option.value}" />
								        </p:selectCheckboxMenu>			
										<p:tooltip for="input_selectmultiple_#{field.name}" position="left" rendered="#{not empty field.info}" /> 
									</c:if>							
									
								</td>
							</c:if>
						</tr>
					</c:forEach>
			
				</table>
			</h:form>
			
			<h:form styleClass="resources-filters" id="filters">
				<ul>
					<ui:repeat value="#{advSearchBean.availableFilters}" var="filter">
						<li class="filter #{filter.disabled ? 'disabled' : (filter.active ? 'active' : null)}">
								<span class="filter-name">
									<span class="trimmed-text">#{filter.name}</span>
									<span class="arrow" />
								</span>
							<ul class="filter-sub-bar vCarousel-wrapper filter-vCarousel">
								<h:panelGroup styleClass="vCarousel-container" layout="block">
									<li class="#{!filter.active ? 'active' : null}">
										<p:commandButton value="#{filter.anyText}" action="#{advSearchBean.changeFilters(filter.anyUrl)}" update=":datagrid :paginator :filters" oncomplete="updateCarousel()"/>
									</li>

									<ui:repeat value="#{filter.items}" var="item">
										<li class="#{item.active ? 'active' : null}">
											<p:commandButton value="#{item.name} #{item.counter != null ? '('.concat(item.counter).concat(')') : null}" action="#{advSearchBean.changeFilters(item.url)}" update=":datagrid :paginator :filters" oncomplete="updateCarousel()"/>
										</li>
									</ui:repeat>

								</h:panelGroup>
								<li class="vCarousel-expand">
									<p:commandButton value="#{msg.filter_carousel_all}"/>
								</li>
							</ul>
						</li>
					</ui:repeat>
					<h:panelGroup rendered="#{advSearchBean.searchFilters != null}">
						<li class="filter clear-filters">
							<p:commandButton value="#{msg.clear_filters}" action="#{advSearchBean.changeFilters(null)}" update=":datagrid :paginator :filters" oncomplete="updateCarousel()"/>
						</li>
					</h:panelGroup>
				</ul>
			</h:form>
		</div>
		
		<ui:fragment rendered="${true}">
			<h:panelGroup id="datagrid" styleClass="datagrid" layout="block" pt:data-isEnabledMoving="false">

	
				<h:panelGroup id="resourceGrid" styleClass="resource-grid" layout="block">
					<ui:repeat value="#{advSearchBean.paginator.currentPage}" var="res">
						<h:panelGroup styleClass="resource-item group-resources-item" pt:data-itemType="resource" pt:data-itemId="#{res.resource.id}" layout="block">
							<div class="resource-block">
	
								<div class="resource-preview">
									<div class="resource-preview-wrapper">
										<div class="resource-preview-wrapper2">
											<div class="resource-preview-block"></div>
											<div class="resource-preview-block2"></div>
											<ui:fragment rendered="#{not empty res.thumbnail1}"><img class="resource-preview-image" src="#{res.thumbnail1.url}" alt="#{res.title}" /></ui:fragment>											
											<h:outputText styleClass="resource-preview-empty" escape="false" value='#{res.resource.embeddedSize1.replaceAll("width=\".*\"","").replaceAll("height=\".*\"","").replaceAll("/>","").replaceAll(">","").concat(" width=\"150\" height=\"150\" />")}' rendered="#{empty res.thumbnail1}"/>
										</div>
									</div>
	
									<h:panelGroup class="resource-controls" layout="block">
										<h:outputLink value="#" title="#{msg.copy}" styleClass="action-copy">
											<h:graphicImage alt="Copy" value="/resources/icon/Add.png"/>
										</h:outputLink>
	
										<ui:fragment rendered="${advSearchBean.canDeleteResourcesInTheGroup()}">
											<h:outputLink value="#" title="#{msg.edit}" styleClass="action-edit" >
												<h:graphicImage alt="Edit" value="../resources/icon/Edit.png"/>
											</h:outputLink>
	
											<h:outputLink value="#" title="#{msg.delete}" styleClass="action-delete">
												<h:graphicImage alt="Delete" value="../resources/icon/Remove.png"/>
											</h:outputLink>
										</ui:fragment>
									</h:panelGroup>
								</div>
	
								<div class="resource-title">
									<div class="resource-title-wrapper">
										<!--<div class="resource-title-icon">
											<div class="resource-title-icon-wrapper">
												<img src="img.png" alt="Title" />
											</div>
										</div>-->
										<div class="resource-title-text">
											<h:outputText value="#{res.title}" escape="false" styleClass="resource-title-name" title="#{res.title}" />
											<span class="resource-title-summary"><span>${learnwebBean.getLocaleMessage(res.type)}</span> #{msg.added_by} <span>#{res.ownerUser.username}</span></span>
										</div>
									</div>
								</div>
	
							</div>
						</h:panelGroup>
					</ui:repeat>
				</h:panelGroup>
	
				<h:outputText value="${msg.no_resources_found}" class="nothing_found"
							  rendered="#{advSearchBean.paginator.isEmpty() and advSearchBean.paginator.getClass().getSimpleName() eq 'GroupPaginator'}"/>
	
				<h:outputText value="#{msg.no_results_found}" class="nothing_found"
							  rendered="#{advSearchBean.paginator.isEmpty() and advSearchBean.paginator.getClass().getSimpleName() eq 'SearchPaginator'}"/>
	
			</h:panelGroup>
	
			<h:panelGroup id="paginator" layout="block">
				<ui:decorate template="/templates/main/paging.xhtml">
					<ui:param name="paginator" value="${advSearchBean.paginator}" />
				</ui:decorate>
			</h:panelGroup>
	
			<div class="context-menu resource-context-menu" role="menu">
				<div class="context-menu-item action-open-folder" role="menuitem">
					<div class="context-menu-item-wrapper">
						<span class="context-menu-item-icon" />
						<span class="context-menu-item-content">#{msg.open}</span>
					</div>
				</div>


				<div class="context-menu-item action-copy" role="menuitem">
					<div class="context-menu-item-wrapper">
						<span class="context-menu-item-icon" />
						<span class="context-menu-item-content">#{msg.copy}</span>
					</div>
				</div>
				<ui:fragment rendered="#{advSearchBean.canDeleteResourcesInTheGroup()}">
					<div class="context-menu-item action-move" role="menuitem">
						<div class="context-menu-item-wrapper">
							<span class="context-menu-item-icon" />
							<span class="context-menu-item-content">#{msg.move}</span>
						</div>
					</div>
					<div class="context-menu-item action-delete" role="menuitem">
						<div class="context-menu-item-wrapper">
							<span class="context-menu-item-icon" />
							<span class="context-menu-item-content">#{msg.removeFromGroup}</span>
						</div>
					</div>
				</ui:fragment>
			</div>
		</ui:fragment>
		
		<script type="text/javascript">
			$("#header_query_form").css("display","none");

			$("#search_group_resource").click(function () {
				$("#header_query_form").animate({ width: "toggle" }, 500, 'swing');
				$("#input_query_form").focus();
				$("#search_group_resource").hide();
			});

			updateCarousel();

			$("#center_pane").prepend($("#group_header")).append($("#paginator"));
		</script>

	</ui:define>
	<ui:define name="right_layout">
		<ui:decorate  template="/templates/resources/right_pane.xhtml">
			<ui:param name="bean" value="#{advSearchlBean}" />
		</ui:decorate>
		 
	</ui:define>
</ui:composition>