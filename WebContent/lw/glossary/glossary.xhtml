<ui:composition template="/templates/main/main_old.xhtml"
	xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
	xmlns:h="http://xmlns.jcp.org/jsf/html"
	xmlns:f="http://xmlns.jcp.org/jsf/core"
	xmlns:p="http://primefaces.org/ui"
	xmlns:pt="http://xmlns.jcp.org/jsf/passthrough">

	<ui:param name="pageTitle" value="#{msg['Glossary.glossary']}" />
	<ui:param name="loginRequired" value="true" />
	
	<ui:define name="metadata">
		<f:metadata>
			<f:viewParam name="resource_id" value="#{glossaryBeanNEW.resourceId}"></f:viewParam>
			<f:viewAction action="#{glossaryBeanNEW.onLoad()}" />
		</f:metadata>
	</ui:define>
	
	<ui:define name="center_layout">
		<h:outputStylesheet library="glossary" name="glossary.css" />
		<h:outputScript library="glossary" name="glossary.js" />
		<ui:fragment rendered="#{glossaryBeanNEW.resourceId gt 0 }">
			<h:panelGroup id="main_component" layout="block">
				
				<h:form id= "form" prependId="false">
				<p:dataTable id="my_gloss_table" var="item" value="#{glossaryBeanNEW.tableItems}" widgetVar="glossTable" tableStyle="table-layout: auto;" paginator="true" rows="12"
						paginatorPosition="bottom" filteredValue="#{glossaryBeanNEW.filteredTableItems}" sortBy="#{item.getTimestamp()}" sortOrder="descending"
						paginatorTemplate="{FirstPageLink} {PreviousPageLink} {PageLinks} {NextPageLink} {LastPageLink} Exporters">

						<p:ajax event="filter" oncomplete="groupRow()" />
						<p:ajax event="page" oncomplete="groupRow()" />
						<p:ajax event="sort" oncomplete="groupRow()" />

						<f:facet name="header">
							<p:outputPanel autoUpdate="true">
								<h:outputText value="#{msg['Glossary.search_all_field']} " />
								<p:inputText id="globalFilter" onkeyup="PF('glossTable').filter()" style="width:150px" placeholder="#{msg['Glossary.search_filter_placeholder']}" />
							</p:outputPanel>
						</f:facet>

						<f:facet name="Exporters">
							<h:commandLink styleClass="excel_export_todo_use">
								<p:graphicImage library="default" value="/resources/icon/excel_icon.jpg" width="24" style="top:7px;left:3px;position:relative;" />
								<p:dataExporter type="xls" target="my_gloss_table" fileName="glossary" postProcessor="#{glossaryBeanNEW.postProcessXls}" />
								</h:commandLink>
								<h:commandLink>
								<p:graphicImage library="default" value="/resources/icon/pdf_icon.png" width="24" style="top:7px;left:3px;position:relative;" />
								<p:dataExporter type="pdf" fileName="glossary" target="my_gloss_table" preProcessor="#{glossaryBeanNEW.rotatePDF}"></p:dataExporter>

							</h:commandLink>
						</f:facet>
						<p:column style=" width:20px;">
							<p:commandLink action="#{glossaryBeanNEW.deleteEntry(item)}" process="@this">
								<h:graphicImage value="/resources/icon/silk/delete.png" width="16" height="16" alt="#{msg.delete}" />
							</p:commandLink>


							<p:commandLink action="#{glossaryBeanNEW.setGlossaryForm(item)}" process="@this" oncomplete="openGlossForm();" update=":glossary_add">
								<h:graphicImage value="/resources/icon/silk/pencil.png" width="16" height="16" alt="#{msg.edit}" />
							</p:commandLink>
						</p:column>

						<p:column headerText="#{msg['Glossary.topic']} 1" filterable="true" filterBy="#{item.getTopicOne()}" filterMatchMode="contains" filterStyle="width: 90%;"
							sortBy="#{item.getTopicOne()}">
							<h:outputText value="#{item.topic1}" pt:data-itemId="#{item.getEntryId()}" id="cell1" />
						</p:column>
						<p:column headerText="#{msg['Glossary.topic']} 2" filterable="true" filterBy="#{item.getTopicTwo()}" filterMatchMode="contains" filterStyle="width: 90%;"
							sortBy="#{item.getTopicTwo()}">
							<h:outputText value="#{item.topic2}" pt:data-itemId="#{item.getEntryId()}" id="cell2" />
						</p:column>
						<p:column headerText="#{msg['Glossary.topic']} 3" filterable="true" filterBy="#{item.getTopicThree()}" filterMatchMode="contains" filterStyle="width: 90%;"
							sortBy="#{item.getTopicThree()}">
							<h:outputText value="#{item.topic3}" pt:data-itemId="#{item.getEntryId()}" id="cell3" />
						</p:column>
						<p:column headerText="#{msg['Glossary.description']}" sortBy="#{item.getDescription()}" filterBy="#{item.description}" filterable="true" filterMatchMode="contains"
							filterStyle="width: 90%;">
							<h:outputText value="#{item.getDescription()}" pt:data-itemId="#{item.getEntryId()}" id="cell4" />
						</p:column>

						<p:column headerText="#{msg['Glossary.term']}" filterable="true" filterMatchMode="contains" filterBy="#{item.getTerm()}" filterStyle="width: 90%;"
							sortBy="#{item.getTopicOne()}#{item.getTopicTwo()}#{item.getEntryId()}#{item.getTerm()}">
							<h:outputText value="#{item.value}" />
						</p:column>
						<p:column headerText="#{msg.language}" filterBy="#{item.getLanguage()}">
							<h:outputText value="#{item.getLanguage()}" />
						</p:column>
						<p:column headerText="#{msg['Glossary.use']}">
							<h:outputText value="#{item.getUses()}" />
						</p:column>
						<p:column headerText="#{msg['Glossary.pronounciation']}">
							<h:outputText value="#{item.getPronounciation()}" />
						</p:column>
						<p:column headerText="#{msg['Glossary.acronym']}">
							<h:outputText value="#{item.getAcronym()}" />
						</p:column>
						<p:column headerText="#{msg.source}">
							<h:outputText value="#{item.getSource()}" />
						</p:column>
						<p:column headerText="#{msg['Glossary.phraseology']}">
							<h:outputText value="#{item.getPhraseology()}" />
						</p:column>
						
						
						<f:facet name="footer">
							<p:outputPanel>
								<h:outputText value="#{msg['Glossary.total_concept']} = #{glossaryBeanNEW.getCount()}"></h:outputText>
							</p:outputPanel>
						</f:facet>
						</p:dataTable>

					<br />
					<br />
					<br />

				
				</h:form>
				
				
				<button type="button" onclick="openGlossForm()" class="ui-button ui-widget ui-state-default ui-corner-all ui-button-text-only greenbutton">
					<h:outputText value="#{msg['Glossary.add_new_entry']}"></h:outputText>
				</button>
				
				<div id="glossform" style="display: none">
					<h:form id="glossary_add" styleClass="grey_border" prependId="false">
						<p:growl id="glossgrowl" autoUpdate="true" redisplay="false" globalOnly="true" showDetail="true"></p:growl>
						<p:panelGrid id="grid" styleClass="centered-form" columns="3" style="border-style: none !important; margin: 0 auto;">
							<p:outputLabel for="topic_1" value="#{msg['Glossary.topic']} 1 " />
							<p:selectOneMenu id="topic_1" value="#{glossaryBeanNEW.formEntry.topicOne}" required="true" requiredMessage="#{msg['Glossary.topic_one_message']}">
								<f:selectItems value="#{glossaryBeanNEW.availableTopicOne}" />
								<f:ajax listener="#{glossaryBeanNEW.changeTopicOne}" render="topic_2 topic_3" />
							</p:selectOneMenu>
							<p:message for="topic_1" />

							<p:outputLabel for="topic_2" value="#{msg['Glossary.topic']} 2 " />
							<h:panelGroup id="topic_2">
								<p:selectOneMenu rendered="#{not empty glossaryBeanNEW.availableTopicTwo}" value="#{glossaryBeanNEW.formEntry.topicTwo}" editable="true">
									<f:selectItems value="#{glossaryBeanNEW.availableTopicTwo}" />
									<f:ajax listener="#{glossaryBeanNEW.changeTopicTwo}" render="topic_3" />
								</p:selectOneMenu>
								<p:inputText rendered="#{empty glossaryBeanNEW.availableTopicTwo}" value="#{glossaryBeanNEW.formEntry.topicTwo}" />
							</h:panelGroup>
							<p:message for="topic_2" />

							<p:outputLabel for="topic_3" value="#{msg['Glossary.topic']} 3 " />
							<h:panelGroup id="topic_3">
								<p:selectOneMenu rendered="#{not empty glossaryBeanNEW.availableTopicThree}" value="#{glossaryBeanNEW.formEntry.topicThree}" editable="true">
									<f:selectItems value="#{glossaryBeanNEW.availableTopicThree}" />
								</p:selectOneMenu>
								<p:inputText rendered="#{empty glossaryBeanNEW.availableTopicThree}" value="#{glossaryBeanNEW.formEntry.topicThree}" />
							</h:panelGroup>
							<h:outputText value="" />

							<p:outputLabel value="#{msg['Glossary.description']} " for="description"></p:outputLabel>
							<p:inputText id="description" value="#{glossaryBeanNEW.formEntry.description}" styleClass="inputfield" required="true" requiredMessage="#{msg['Glossary.description_message']}" />
							<p:message for="description" />
				</p:panelGrid>
				
				<br />
						<p:dataTable value="#{glossaryBeanNEW.formTerms}" var="term" id="lang_terms" tableStyle="width:100%">
							<!-- <f:facet name="header">
								<h:outputText value="#{glossaryBean.primaryLanguage.label}"></h:outputText>
							</f:facet> -->

							<p:column headerText="#{msg['Glossary.term']}">

								<p:inputText id="term" value="#{term.term}" style="width: 90%" requiredMessage="#{msg.mandatory_field}" />
								<p:message for="term" />
								
							</p:column>
							
							<p:column headerText="#{msg.language}">

								<p:selectOneMenu id="language" value="#{term.language}">
									<f:selectItems value="#{glossaryBeanNEW.availableLanguages}" />
								</p:selectOneMenu>
								<p:message for="language" />
								</p:column>

							<p:column headerText="#{msg['Glossary.use']}" style="text-align: center">
								<p:selectCheckboxMenu id="use" value="#{term.uses}" label="#{term.getUsesDisplayLabel()}"><!-- Test this -->
									<f:selectItem itemValue="technical" itemLabel="#{msg['Glossary.use_technical']}" />
									<f:selectItem itemValue="popular" itemLabel="#{msg['Glossary.use_popular']}" />
									<f:selectItem itemValue="informal" itemLabel="#{msg['Glossary.use_informal']}" />
									<p:ajax event="change" update="use"></p:ajax>
									<p:ajax event="toggleSelect"  update="use" />
								</p:selectCheckboxMenu>
							</p:column>
							<p:column headerText="#{msg['Glossary.pronounciation']}">

								<p:inputText id="pronoun" value='#{term.pronounciation}' style="width: 90%" />
							</p:column>
							<p:column headerText="#{msg['Glossary.acronym']}">

								<p:inputText id="acro" value='#{term.acronym}' style="width: 90%" />
							</p:column>
							<p:column headerText="#{msg.source}">

								<p:selectOneMenu id="ref" value="#{term.source}" style="width: 80% !important" autoWidth="false">
									<f:selectItem itemValue="#{null}" itemLabel="--#{msg['Glossary.select']}--" />
									<f:selectItem itemValue="Wikipedia" itemLabel="#{msg['Glossary.wikipedia']}"></f:selectItem>
									<f:selectItem itemValue="encyclopaedia" itemLabel="#{msg['Glossary.encyclopaedia']}"></f:selectItem>
									<f:selectItem itemValue="monolingual dictionary" itemLabel="#{msg['Glossary.mono_dictionary']}"></f:selectItem>
									<f:selectItem itemValue="bilingual dictionary" itemLabel="#{msg['Glossary.bi_dictionary']}"></f:selectItem>
									<f:selectItem itemValue="scientific/academic publication" itemLabel="#{msg['Glossary.publication']}"></f:selectItem>
									<f:selectItem itemValue="institutional website" itemLabel="#{msg['Glossary.website']}"></f:selectItem>
									<f:selectItem itemValue="glossary" itemLabel="#{msg['Glossary.glossary']}"></f:selectItem>
									<f:selectItem itemValue="Linguee or Reverso" itemLabel="Linguee or Reverso"></f:selectItem>
									<f:selectItem itemValue="patients' websites and blogs" itemLabel="#{msg['Glossary.web_blog']}"></f:selectItem>
									<f:selectItem itemValue="other" itemLabel="other"></f:selectItem>
								</p:selectOneMenu>
							</p:column>
							<p:column headerText="#{msg['Glossary.phraseology']}">

								<p:inputTextarea id="phras" value="#{term.phraseology}" style="width: 90% !important" autoResize="false" />
							</p:column>
							<p:column width="10">
								<p:commandLink id="delete_term" actionListener="#{glossaryBeanNEW.deleteTerm(term)}" update=":glossgrowl :lang_terms">
									<f:ajax execute="lang_terms" />
									<h:graphicImage value="/resources/icon/silk/delete.png" width="16" height="16" alt="#{msg.delete}" />
								</p:commandLink>
								<p:tooltip for="delete_term" value="#{msg['Glossary.remove_row']}" position="bottom" />
							</p:column>
						</p:dataTable>
						<br />
						<p:commandButton value="#{msg['Glossary.add_synonym']}" actionListener="#{glossaryBeanNEW.addTerm()}" styleClass="greenbutton"
							update=":glossary_add :lang_terms">
							<f:ajax execute="@this lang_terms" />
						</p:commandButton>

						<br />
						<br />
						<p:commandButton id="save" value="#{msg.save}" action="#{glossaryBeanNEW.onSave()}" styleClass="greenbutton resource_button" update=":glossary_add" binding="#{save}">
							<f:ajax execute="@form" />


						</p:commandButton>
						<p:commandButton value="#{msg.cancel}" actionListener="#{glossaryBeanNEW.setNewFormEntry()}" styleClass="greenbutton resource_button" update="@form :glossary_add"
							onclick="$('#glossform').css('display', 'none')" process="@this" resetValues="true">

						</p:commandButton>

						<br />
						<br />
				
				</h:form>
				</div>
				
			</h:panelGroup>
		</ui:fragment>
	</ui:define>
</ui:composition>
