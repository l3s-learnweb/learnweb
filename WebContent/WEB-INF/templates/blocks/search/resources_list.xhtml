<ui:composition xmlns="http://www.w3.org/1999/xhtml"
                xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
                xmlns:h="http://xmlns.jcp.org/jsf/html"
                xmlns:f="http://xmlns.jcp.org/jsf/core"
                xmlns:p="http://primefaces.org/ui">

<!--@elvariable id="resources" type="java.util.LinkedList<de.l3s.learnweb.resource.ResourceDecorator>"-->

<div class="d-flex flex-column bg-white pt-2">
    <p:repeat value="#{resources}" var="res">
        <h:panelGroup layout="block" styleClass="m-2 font-weight-bold border-bottom" rendered="#{res.rank gt 1 and res.rank % 10 eq 1}">
            <h:outputText value="#{msg.page} "/>
            <h:outputText value="#{(res.rank+9) / 10}">
                <f:convertNumber maxFractionDigits="0"/>
            </h:outputText>
        </h:panelGroup>

        <div class="resource m-sm-2 ml-sm-3 m-1 tooltip-trigger d-flex" style="max-width: 68em;" id="resource_#{res.rank}">
            <div class="opacity-hover text-center">
                <div class="d-flex flex-column mr-md-2 mr-1 mt-1">
                    <div class="d-flex">
                        <h:form>
                            <p:commandLink actionListener="#{searchBean.setSelectedResource(res)}"
                                           update=":resource_form" process="@this"
                                           oncomplete="PF('resource_dialog').show();"
                                           styleClass="fa fa-fw fa-files-o text-decoration-none text-secondary">

                            </p:commandLink>
                            <p:tooltip for="@previous" value="#{msg.addToMyResources}" position="right"  hideEffect="clip" />
                        </h:form>

                        <!--
                       TODO add better tooltip
                         <span class="tooltip-data bg-gray400">#{msg.addToMyResources}</span>

                        -->
                    </div>
                    <ui:fragment rendered="${res.archived}">
                        <h:outputLink id="archive" value="#{res.firstArchivedObject.archiveUrl}">
                            <h:outputText styleClass="fa fa-floppy-o mb-1" value="" />
                        </h:outputLink>
                        <p:tooltip for="archive" position="right" hideEffect="clip">
                            #{msg['Archive.captured_between']}
                            <h:outputText value="${res.firstArchivedObject.timestamp}"><f:convertDateTime type="date" dateStyle="short"/></h:outputText>
                            #{msg['Archive.captured_between_and']}
                            <h:outputText value="#{res.lastArchivedObject.timestamp}"><f:convertDateTime type="date" dateStyle="short"/></h:outputText>
                        </p:tooltip>
                        <!--<div class="fa fa-floppy-o tooltip-container mb-1" aria-hidden="true">
                            <span class="tooltip-data">
                                #{msg['Archive.captured_between']}
                                <a href="#{res.firstArchivedObject.archiveUrl}" style="color:green;" target="_blank">
                                    <h:outputText value="${res.firstArchivedObject.timestamp}"><f:convertDateTime type="date" dateStyle="short"/></h:outputText>
                                </a>
                                #{msg['Archive.captured_between_and']}
                                <a href="#{res.lastArchivedObject.archiveUrl}" style="color:green;" target="_blank">
                                    <h:outputText value="#{res.lastArchivedObject.timestamp}"><f:convertDateTime type="date" dateStyle="short"/></h:outputText>
                                </a>
                            </span>
                        </div>-->
                    </ui:fragment>
                    <!--rendered="#{not empty res.group}"-->
                    <ui:fragment rendered="#{not empty res.group}">
                        <h:outputLink id="group" value="group/overview.jsf">
                            <h:outputText styleClass="fa fa-users mb-1" value="" />
                            <f:param name="group_id" value="#{res.group.id}"/>
                        </h:outputLink>
                        <p:tooltip for="group" value="#{msg.group}: #{res.group.title}" position="right" hideEffect="clip" />
                        <!--<div class="fa fa-users tooltip-container mb-1" aria-hidden="true">
                            <div class="tooltip-data">
                                <p:outputLabel for="@next" value="#{msg.group}:" styleClass="mr-1 font-weight-bold my-0"/>
                                <h:outputLink value="group/resources.jsf" title="#{res.group.description}">
                                    <f:param name="group_id" value="#{res.group.id}"/>
                                    <h:outputText value="#{res.group.title}"/>
                                </h:outputLink>
                            </div>
                        </div>-->
                    </ui:fragment>
                    <!--rendered="#{not empty res.getMetadataValue('collector')}"-->
                    <ui:fragment rendered="#{not empty res.getMetadataValue('collector')}">
                        <p:outputLabel id="collector" class="fa fa-user-plus mb-1"/>
                        <p:tooltip for="collector" value="#{msg.collector}: #{res.getMetadataValue('collector')}" position="right" hideEffect="clip" />
                        <!--<div class="tooltip-container fa fa-user-plus mb-1">
                            <div class="tooltip-data">
                                <p:outputLabel for="@next" value="#{msg.collector}: " styleClass="mr-1 font-weight-bold my-0"/>
                                <h:outputText value="#{res.getMetadataValue('collector')}"/>
                            </div>
                        </div>-->
                    </ui:fragment>
                    <!--rendered="#{empty res.getMetadataValue('collector') and not empty res.user.fullName}"-->
                    <ui:fragment rendered="#{empty res.getMetadataValue('collector') and not empty res.user.fullName}">
                        <p:outputLabel id="collector-fullname" class="fa fa-user-plus mb-1"/>
                        <p:tooltip for="collector-fullname" value="#{msg.collector}: #{res.resource.user.fullName}" position="right" hideEffect="clip" />
                        <!--<div class="tooltip-container fa fa-user-plus mb-1">
                            <div class="tooltip-data">
                                <p:outputLabel for="@next" value="#{msg.collector}:" styleClass="mr-1 font-weight-bold my-0"/>
                                <h:outputText value="#{res.resource.user.fullName}"/>
                            </div>
                        </div>-->
                    </ui:fragment>
                </div>
            </div>

            <div class="overflow-hidden">
                <h:outputLink styleClass="resource-web-link text-truncate h4" target="_blank" value="#{res.urlProxied}">
                    <span class="d-block text-truncate w-100">
                        <h:outputText value="#{res.title}" escape="false"/>
                    </span>
                </h:outputLink>
                <div class="text-truncate">
                    <h:outputLink rendered="#{res.id != -1}" value="#{res.learnwebUrl}" escape="true">#{msg['application.name']} <span>&#187;</span> #{res.url}</h:outputLink>
                    <h:outputLink rendered="#{res.id == -1}" value="#{res.learnwebUrl}" escape="true" target="_blank">#{res.url}</h:outputLink>
                </div>
                <span class="truncate-two-lines d-block w-100">
                     <h:outputText value="#{res.snippet}" escape="false"></h:outputText>
                </span>
            </div>
        </div>
    </p:repeat>
</div>

</ui:composition>
