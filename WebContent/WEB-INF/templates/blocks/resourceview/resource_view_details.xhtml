<ui:composition xmlns="http://www.w3.org/1999/xhtml"
				xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
				xmlns:h="http://xmlns.jcp.org/jsf/html"
				xmlns:f="http://xmlns.jcp.org/jsf/core"
				xmlns:p="http://primefaces.org/ui"
				xmlns:lw="http://l3s.de/learnweb">

<!--@elvariable id="res" type="de.l3s.learnweb.resource.Resource"-->

<dl class="row mb-n2">
	<ui:fragment rendered="${not empty res.fileName and res.source ne 'loro'}">
		<dt class="col-sm-3">#{msg.file}:</dt>
		<dd class="col-sm-9">
			<a href="#{res.fileUrl}">
				<i class="fa fa-fw fa-download" aria-hidden="true"></i>
				#{res.fileName}
			</a>

			<ui:fragment rendered="${not empty res.originalFile}">
				<div>
					<a href="#{res.originalFile.url}">
						<i class="fa fa-fw fa-download" aria-hidden="true"></i>
						#{res.originalFile.name}
					</a>
					(Backup <h:outputText value="#{res.originalFile.lastModified}">
						<f:convertDateTime type="date" timeStyle="short" dateStyle="long" timeZone="#{userBean.timeZone}"/>
					</h:outputText>)
				</div>
			</ui:fragment>
		</dd>
	</ui:fragment>

	<ui:fragment rendered="${empty res.fileName and res.type == 'file' }">
		<dt class="col-sm-3">#{msg.resource}:</dt>
		<dd class="col-sm-9">
			<a href="#{res.urlProxied}" target="_blank">#{res.url}</a>
		</dd>
	</ui:fragment>

	<ui:fragment rendered="#{userBean.starRatingEnabled}">
		<dt class="col-sm-3">#{msg.relevance}:</dt>
		<dd class="col-sm-9">
			<h:form>
				<p:rating value="#{res.starRatingRounded}" cancel="false" disabled="${res.isRatedByUser(userBean.user.id) or not res.canAnnotateResource(userBean.user)}">
					<p:ajax event="rate" listener="#{resourceDetailBean.handleRate}" update="@form :growl"/>
				</p:rating>

				<h:outputText value="#{res.starRating}">
					<f:convertNumber maxFractionDigits="1" minFractionDigits="1"/>
				</h:outputText>
				(<h:outputFormat value="#{msg.votes}"><f:param value="#{res.rateNumber}"/></h:outputFormat>)
			</h:form>
		</dd>
	</ui:fragment>

	<ui:fragment rendered="#{not empty res.group and res.type eq 'website' and not empty res.group.hypothesisLink}">
		<dt class="col-sm-3">#{msg.discuss}:</dt>
		<dd class="col-sm-9">
			<h:outputLink value="#{resourceDetailBean.hypothesisLink}">#{msg.link_to_discuss}</h:outputLink>
			<h:outputLink value="#{res.group.hypothesisLink}">(#{msg.discuss_group_invite})</h:outputLink>

			<h:outputLink value="discussion_help.jsf" target="_blank">
				<f:param name="type" value="user"/>[?]
			</h:outputLink>
		</dd>
	</ui:fragment>

	<ui:fragment rendered="#{userBean.thumbRatingEnabled}">
		<dt class="col-sm-3">#{msg.reliability}:</dt>
		<dd class="col-sm-9">
			<h:form>
				<h:panelGrid columns="4">
					<h:outputText value="+#{res.thumbUp}"/>
					<p:commandLink actionListener="#{resourceDetailBean.onThumbUp}" update="@form :growl" ariaLabel="Rate thump up">
						<f:param name="resource_id" value="#{res.id}"/>
						<i class="fa fa-fw fa-thumbs-up text-success" aria-hidden="true"></i>
					</p:commandLink>

					<p:commandLink actionListener="#{resourceDetailBean.onThumbDown}" update="@form :growl" ariaLabel="Rate thump down">
						<f:param name="resource_id" value="#{res.id}"/>
						<i class="fa fa-fw fa-thumbs-down text-danger" aria-hidden="true"></i>
					</p:commandLink>
					<h:outputText value="-#{res.thumbDown}"/>
				</h:panelGrid>
			</h:form>
		</dd>
	</ui:fragment>

	<ui:fragment rendered="#{not empty res.author}">
		<dt class="col-sm-3">#{msg.author}:</dt>
		<dd class="col-sm-9">
			<h:outputText value="#{res.author}"/>
		</dd>
	</ui:fragment>

	<dt class="col-sm-3">#{msg.source}:</dt>
	<dd class="col-sm-9">
		<a href="#{res.urlProxied}"><h:outputText value="#{res.source.label}"/></a>
	</dd>

	<ui:fragment rendered="${not empty res.group}">
		<dt class="col-sm-3">#{msg.group}:</dt>
		<dd class="col-sm-9">
			<h:outputLink value="group/overview.jsf">
				<f:param name="group_id" value="#{res.group.id}"/>
				<h:outputText value="#{res.group.title}"/>
			</h:outputLink>
		</dd>
	</ui:fragment>

	<ui:fragment rendered="${not empty res.originalGroup}">
		<dt class="col-sm-3">#{msg.copied_from}:</dt>
		<dd class="col-sm-9">
			<h:outputLink value="group/overview.jsf">
				<f:param name="group_id" value="#{res.originalGroup.id}"/>
				<h:outputText value="#{res.originalGroup.title}"/>
			</h:outputLink>
		</dd>
	</ui:fragment>

	<ui:fragment rendered="#{not empty res.language}">
		<dt class="col-sm-3">#{msg.language}:</dt>
		<dd class="col-sm-9">
			<p:repeat value="#{res.metadataMultiValue['language']}" var="language" varStatus="status">
				<h:outputText value="#{msg['language_' += language]}"/>
				<h:outputText value=", " rendered="#{!status.last}" escape="false"/>
			</p:repeat>
		</dd>
	</ui:fragment>

	<ui:repeat var="entry" value="#{res.metadataEntries}">
		<ui:fragment rendered="#{not empty entry.value}">
			<dt class="col-sm-3"><h:outputText value="#{utilBean.getLocaleMessage(entry.key, null)}"/>:</dt>

			<dd class="col-sm-9">
				<ui:fragment rendered="#{entry.key eq 'language_level'}">
					<ui:repeat value="#{res.metadataMultiValue[entry.key]}" var="langLevel" varStatus="status">
						<h:outputText value="#{langLevel}"/>
						<h:outputText value=", " rendered="#{!status.last}" escape="false"/>
					</ui:repeat>
				</ui:fragment>

				<ui:fragment rendered="#{entry.key eq 'yell_target'}">
					<p:repeat value="#{res.metadataMultiValue[entry.key]}" var="target">
						<ui:fragment rendered="#{target == 'Pre-school'}">
							<i class="fa fa-fw fa-circle text-success" aria-hidden="true"></i>
						</ui:fragment>
						<ui:fragment rendered="#{target == 'Young learners'}">
							<i class="fa fa-fw fa-circle text-info" aria-hidden="true"></i>
						</ui:fragment>
						<ui:fragment rendered="#{target == 'Teens'}">
							<i class="fa fa-fw fa-circle text-warning" aria-hidden="true"></i>
						</ui:fragment>
						<ui:fragment rendered="#{target == 'Teachers' or target == 'Adult learners'}">
							<i class="fa fa-fw fa-circle text-danger" aria-hidden="true"></i>
						</ui:fragment>

						<h:outputText value="#{target}"/>
					</p:repeat>
				</ui:fragment>

				<ui:fragment rendered="#{entry.key eq 'yell_purpose'}">
					<p:repeat value="#{res.metadataMultiValue[entry.key]}" var="purpose">
						<span class="text-nowrap d-inline-block">
							<span class="bg-highlight">
								<ui:fragment rendered="#{purpose == 'Speaking'}">
									 <i class="fa fa-fw fa-volume-up" aria-hidden="true"></i>
								</ui:fragment>
								<ui:fragment rendered="#{purpose == 'Listening'}">
									 <i class="fa fa-fw fa-headphones" aria-hidden="true"></i>
								</ui:fragment>
								<ui:fragment rendered="#{purpose == 'Writing'}">
									 <i class="fa fa-fw fa-pencil-square-o" aria-hidden="true"></i>
								</ui:fragment>
								<ui:fragment rendered="#{purpose == 'Reading'}">
									<i class="fa fa-fw fa-book" aria-hidden="true"></i>
								</ui:fragment>

								<h:outputText value="#{purpose}"/>
							</span>
						</span>
					</p:repeat>
				</ui:fragment>

				<ui:fragment rendered="#{entry.key ne 'language_level' and entry.key ne 'yell_target' and entry.key ne 'yell_purpose'}">
					<h:outputText value="#{entry.value}"/>
				</ui:fragment>
			</dd>
		</ui:fragment>
	</ui:repeat>

	<ui:fragment rendered="${res.source == 'ted' or res.source == 'tedx'}">
		<dt class="col-sm-3">#{msg.transcript}:</dt>
		<dd class="col-sm-9">
			<h:outputLink value="ted_transcript.jsf">
				<f:param name="resource_id" value="#{res.id}"/>
				#{msg.link_to_transcript}
			</h:outputLink>
		</dd>
	</ui:fragment>

	<ui:fragment rendered="#{(userBean.optionContentAnnotationFieldEnabled and res.type eq 'website')}">
		<dt class="col-sm-3">#{msg.content}:</dt>
		<dd class="col-sm-9">
			<h:outputLink value="resource_transcript.jsf">
				<f:param name="resource_id" value="#{res.id}"/>
				#{msg.link_to_content}
			</h:outputLink>
		</dd>
	</ui:fragment>

	<ui:fragment rendered="${not empty res.creationDate}">
		<dt class="col-sm-3">#{msg.date}:</dt>
		<dd class="col-sm-9">
			<h:outputText value="#{res.creationDate}">
				<f:convertDateTime type="date" dateStyle="long" timeZone="#{userBean.timeZone}"/>
			</h:outputText>
		</dd>
	</ui:fragment>

	<ui:fragment rendered="#{res.folderId != 0}">
		<dt class="col-sm-3">#{msg.path}:</dt>
		<dd class="col-sm-9">
			<h:outputLink value="group/resources.jsf">
				<f:param name="group_id" value="#{res.groupId}"/>
				<f:param name="folder_id" value="#{res.folderId}"/>
				<f:param name="resource_id" value="#{res.id}"/>
				#{res.prettyPath}
			</h:outputLink>
		</dd>
	</ui:fragment>

	<ui:fragment rendered="#{not empty res.description}">
		<dt class="col-sm-3">#{msg.description}:</dt>
		<dd class="col-sm-9">
			<h:outputText value="#{res.descriptionHTML}" escape="false"/>
		</dd>
	</ui:fragment>

	<ui:fragment rendered="#{not empty res.tags or res.canAnnotateResource(userBean.user)}">
		<dt class="col-sm-3">#{msg.tags}:</dt>
		<dd class="col-sm-9">
			<h:panelGroup layout="block" id="tags_list">
				<ul class="list-inline list-unstyled mb-1">
					<ui:repeat var="tag" value="#{res.tags}">
						<li class="list-inline-item mr-0 mb-1">
							<p:linkButton outcome="/lw/search" value="#{tag.name}" styleClass="secondary-btn mr-0 rounded-0">
								<f:param name="action" value="image"/>
								<f:param name="query" value="#{tag.name}"/>
							</p:linkButton>
							<p:commandButton action="#{resourceDetailBean.onDeleteTag}" icon="fa fa-times" styleClass="secondary-btn rounded-0"
											 global="false" update=":tags_list :growl" process="@this"
											 onstart="PF('detailsOverlay').show();" oncomplete="PF('detailsOverlay').hide();"
											 rendered="#{res.canEditResource(userBean.user)}">
								<f:setPropertyActionListener target="#{resourceDetailBean.selectedTag}" value="#{tag}"/>
							</p:commandButton>
						</li>
					</ui:repeat>
				</ul>
			</h:panelGroup>

			<h:form id="tag_input_form" rendered="#{res.canAnnotateResource(userBean.user)}">
				<div class="form-group mb-0">
					<p:inputText value="#{resourceDetailBean.tagName}" id="tag_name" styleClass="flex-grow-1" placeholder="Enter new tag..."/>
					<p:message for="@previous"/>
				</div>

				<p:commandButton actionListener="#{resourceDetailBean.addTag}" value="#{msg.addTag}"
								 update=":tags_list :growl tag_name" partialSubmit="true" process="@form"
								 global="false" onstart="PF('detailsOverlay').show();" oncomplete="PF('detailsOverlay').hide();">
					<f:setPropertyActionListener target="#{activityResourceBean.reloadLogs}" value="true"/>
				</p:commandButton>
			</h:form>
		</dd>
	</ui:fragment>

	<ui:fragment rendered="#{not empty res.comments or res.canAnnotateResource(userBean.user)}">
		<dt class="col-sm-3">#{msg.comments}:</dt>
		<dd class="col-sm-9">
			<h:form styleClass="mb-2" id="new_comment_form">
				<ui:fragment rendered="#{res.canAnnotateResource(userBean.user)}">
					<div class="form-group mb-0">
						<p:inputTextarea rows="3" value="#{resourceDetailBean.newComment}" placeholder="#{msg.addComment}" required="true" styleClass="d-block"/>
						<p:message for="@previous"/>
					</div>

					<p:commandButton value="#{msg.addComment}" actionListener="#{resourceDetailBean.addComment}" update=":comments_list @form :growl" process="@form"
									 global="false" onstart="PF('detailsOverlay').show();" oncomplete="PF('detailsOverlay').hide();">
						<f:setPropertyActionListener target="#{activityResourceBean.reloadLogs}" value="true"/>
					</p:commandButton>
				</ui:fragment>
			</h:form>
			<h:panelGroup layout="block" id="comments_list">
				<ui:repeat var="comment" varStatus="status" value="#{res.comments}" rendered="#{not empty res.comments}">
					<div class="d-flex comment-entry bg-light p-2 #{!status.last ? 'mb-2' : ''}">
						<img class="profile-picture mr-3" src="#{comment.user.image}" alt="Profile picture"/>

						<div class="comment-details">
							<p class="mb-0">
								<h:link value="#{comment.user.username}" outcome="/lw/user/detail.jsf?user_id=#{comment.user.id}" styleClass="font-weight-bold comment-author mr-3"/>
								<lw:timeAgo date="#{comment.date}" styleClass="small font-weight-light mb-0 comment-date"/>
							</p>
							<div class="mb-1">#{comment.text}</div>
							<div class="small">
								<p:commandLink value="#{msg.edit}" styleClass="text-success mr-2" ajax="true" update=":comment_edit_form"
											   process="@this" onsuccess="PF('commentEditDialog').show();"
											   rendered="#{resourceDetailBean.canEditComment(comment)}">
									<f:setPropertyActionListener target="#{resourceDetailBean.clickedComment}" value="#{comment}"/>
								</p:commandLink>
								<p:commandLink value="#{msg.delete}" styleClass="text-danger" action="#{resourceDetailBean.onDeleteComment}"
											   ajax="true" update=":comments_list :growl" process="@this" onstart="return confirm('#{msg.delete_message_comments}');"
											   rendered="#{resourceDetailBean.canEditComment(comment)}">
									<f:setPropertyActionListener target="#{resourceDetailBean.clickedComment}" value="#{comment}"/>
								</p:commandLink>
							</div>
						</div>
					</div>
				</ui:repeat>
			</h:panelGroup>
		</dd>
	</ui:fragment>
</dl>

<p:dialog header="#{msg.edit}" appendTo="@(body)" widgetVar="commentEditDialog"
		  modal="true" resizable="false" draggable="false" responsive="true" closeOnEscape="true">
	<h:form id="comment_edit_form">
		<div class="form-group">
			<p:inputTextarea autoResize="1" maxHeight="20" value="#{resourceDetailBean.clickedComment.text}"/>
		</div>

		<p:commandButton actionListener="#{resourceDetailBean.onEditComment}" update=":comments_list :growl" title="#{msg.save}" process="@form"
			value="#{msg.save}" onsuccess="PF('commentEditDialog').hide();"/>
	</h:form>
</p:dialog>
</ui:composition>
