<ui:composition xmlns="http://www.w3.org/1999/xhtml"
				xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
				xmlns:h="http://xmlns.jcp.org/jsf/html"
				xmlns:f="http://xmlns.jcp.org/jsf/core"
				xmlns:p="http://primefaces.org/ui"
				xmlns:lw="http://l3s.de/learnweb">

<!--@elvariable id="res" type="de.l3s.learnweb.resource.Resource"-->

<dl class="row mb-n2">
	<ui:fragment rendered="${not empty res.fileName and res.source ne 'loro'}">
		<dt class="col-sm-3">#{msg.file}:</dt>
		<dd class="col-sm-9">
			<a href="#{res.fileUrl}">
				<i class="fa fa-fw fa-download" aria-hidden="true"></i>
				#{res.fileName}
			</a>

			<ui:fragment rendered="${not empty res.originalFile}">
				<div>
					<a href="#{res.originalFile.url}">
						<i class="fa fa-fw fa-download" aria-hidden="true"></i>
						#{res.originalFile.name}
					</a>
					(Backup <h:outputText value="#{res.originalFile.lastModified}">
						<f:convertDateTime type="date" timeStyle="short" dateStyle="long" timeZone="#{userBean.timeZone}"/>
					</h:outputText>)
				</div>
			</ui:fragment>
		</dd>
	</ui:fragment>

	<ui:fragment rendered="${empty res.fileName and res.type == 'file' }">
		<dt class="col-sm-3">#{msg.resource}:</dt>
		<dd class="col-sm-9">
			<a href="#{res.urlProxied}" target="_blank">#{res.url}</a>
		</dd>
	</ui:fragment>

	<ui:fragment rendered="#{userBean.starRatingEnabled}">
		<dt class="col-sm-3">#{msg.relevance}:</dt>
		<dd class="col-sm-9">
			<h:panelGroup id="relevance" layout="block">
				<p:rating value="#{res.starRatingRounded}" cancel="false" global="false" immediate="true"
						  disabled="${res.isRatedByUser(userBean.user.id) or not res.canAnnotateResource(userBean.user)}">
					<p:ajax event="rate" listener="#{resourceDetailBean.handleRate}" update=":relevance :growl"/>
				</p:rating>

				<h:outputText value="#{res.starRating}">
					<f:convertNumber maxFractionDigits="1" minFractionDigits="1"/>
				</h:outputText>
				(<h:outputFormat value="#{msg.votes}"><f:param value="#{res.rateNumber}"/></h:outputFormat>)
			</h:panelGroup>
		</dd>
	</ui:fragment>

	<ui:fragment rendered="#{not empty res.group and res.type eq 'website' and not empty res.group.hypothesisLink}">
		<dt class="col-sm-3">#{msg.discuss}:</dt>
		<dd class="col-sm-9">
			<h:outputLink value="#{resourceDetailBean.hypothesisLink}">#{msg.link_to_discuss}</h:outputLink>
			<h:outputLink value="#{res.group.hypothesisLink}">(#{msg.discuss_group_invite})</h:outputLink>

			<h:outputLink value="discussion_help.jsf" target="_blank">
				<f:param name="type" value="user"/>[?]
			</h:outputLink>
		</dd>
	</ui:fragment>

	<ui:fragment rendered="#{userBean.thumbRatingEnabled}">
		<dt class="col-sm-3">#{msg.reliability}:</dt>
		<dd class="col-sm-9">
			<h:panelGrid id="reliability" columns="4">
				<h:outputText value="+#{res.thumbUp}"/>
				<p:commandLink action="#{resourceDetailBean.onThumbUp}" global="false" update=":reliability :growl" ariaLabel="Rate thump up" process="@this">
					<i class="fa fa-fw fa-thumbs-up text-success" aria-hidden="true"></i>
				</p:commandLink>

				<p:commandLink action="#{resourceDetailBean.onThumbDown}" global="false" update=":reliability :growl" ariaLabel="Rate thump down" process="@this">
					<i class="fa fa-fw fa-thumbs-down text-danger" aria-hidden="true"></i>
				</p:commandLink>
				<h:outputText value="-#{res.thumbDown}"/>
			</h:panelGrid>
		</dd>
	</ui:fragment>

	<ui:fragment rendered="#{not empty res.author}">
		<dt class="col-sm-3">#{msg.author}:</dt>
		<dd class="col-sm-9">
			<h:outputText value="#{res.author}"/>
		</dd>
	</ui:fragment>

	<dt class="col-sm-3">#{msg.source}:</dt>
	<dd class="col-sm-9">
		<a href="#{res.urlProxied}"><h:outputText value="#{res.source.label}"/></a>
	</dd>

	<ui:fragment rendered="${not empty res.group}">
		<dt class="col-sm-3">#{msg.group}:</dt>
		<dd class="col-sm-9">
			<h:outputLink value="group/overview.jsf">
				<f:param name="group_id" value="#{res.group.id}"/>
				<h:outputText value="#{res.group.title}"/>
			</h:outputLink>
		</dd>
	</ui:fragment>

	<ui:fragment rendered="${not empty res.originalGroup}">
		<dt class="col-sm-3">#{msg.copied_from}:</dt>
		<dd class="col-sm-9">
			<h:outputLink value="group/overview.jsf">
				<f:param name="group_id" value="#{res.originalGroup.id}"/>
				<h:outputText value="#{res.originalGroup.title}"/>
			</h:outputLink>
		</dd>
	</ui:fragment>

	<ui:fragment rendered="#{not empty res.language}">
		<dt class="col-sm-3">#{msg.language}:</dt>
		<dd class="col-sm-9">
			<p:repeat value="#{res.metadataMultiValue['language']}" var="language" varStatus="status">
				<h:outputText value="#{msg['language_' += language]}" rendered="#{language.length() eq 2}" />
                <h:outputText value="#{language}" rendered="#{language.length() ne 2}" />
				<h:outputText value=", " rendered="#{!status.last}" escape="false"/>
			</p:repeat>
		</dd>
	</ui:fragment>

	<ui:repeat var="entry" value="#{res.metadataEntries}">
		<ui:fragment rendered="#{not empty entry.value}">
			<dt class="col-sm-3"><h:outputText value="#{utilBean.getLocaleMessage(entry.key, null)}"/>:</dt>

			<dd class="col-sm-9">
				<ui:fragment rendered="#{entry.key eq 'language_level'}">
					<ui:repeat value="#{res.metadataMultiValue[entry.key]}" var="langLevel" varStatus="status">
						<h:outputText value="#{langLevel}"/>
						<h:outputText value=", " rendered="#{!status.last}" escape="false"/>
					</ui:repeat>
				</ui:fragment>

				<ui:fragment rendered="#{entry.key eq 'yell_target'}">
					<p:repeat value="#{res.metadataMultiValue[entry.key]}" var="target">
						<ui:fragment rendered="#{target == 'Pre-school'}">
							<i class="fa fa-fw fa-circle text-success" aria-hidden="true"></i>
						</ui:fragment>
						<ui:fragment rendered="#{target == 'Young learners'}">
							<i class="fa fa-fw fa-circle text-info" aria-hidden="true"></i>
						</ui:fragment>
						<ui:fragment rendered="#{target == 'Teens'}">
							<i class="fa fa-fw fa-circle text-warning" aria-hidden="true"></i>
						</ui:fragment>
						<ui:fragment rendered="#{target == 'Teachers' or target == 'Adult learners'}">
							<i class="fa fa-fw fa-circle text-danger" aria-hidden="true"></i>
						</ui:fragment>

						<h:outputText value="#{target}"/>
					</p:repeat>
				</ui:fragment>

				<ui:fragment rendered="#{entry.key eq 'yell_purpose'}">
					<p:repeat value="#{res.metadataMultiValue[entry.key]}" var="purpose">
						<span class="text-nowrap d-inline-block">
							<span class="bg-highlight">
								<ui:fragment rendered="#{purpose == 'Speaking'}">
									 <i class="fa fa-fw fa-volume-up" aria-hidden="true"></i>
								</ui:fragment>
								<ui:fragment rendered="#{purpose == 'Listening'}">
									 <i class="fa fa-fw fa-headphones" aria-hidden="true"></i>
								</ui:fragment>
								<ui:fragment rendered="#{purpose == 'Writing'}">
									 <i class="fa fa-fw fa-pencil-square-o" aria-hidden="true"></i>
								</ui:fragment>
								<ui:fragment rendered="#{purpose == 'Reading'}">
									<i class="fa fa-fw fa-book" aria-hidden="true"></i>
								</ui:fragment>

								<h:outputText value="#{purpose}"/>
							</span>
						</span>
					</p:repeat>
				</ui:fragment>

				<ui:fragment rendered="#{entry.key ne 'language_level' and entry.key ne 'yell_target' and entry.key ne 'yell_purpose'}">
					<h:outputText value="#{entry.value}"/>
				</ui:fragment>
			</dd>
		</ui:fragment>
	</ui:repeat>

	<ui:fragment rendered="${res.source == 'ted' or res.source == 'tedx'}">
		<dt class="col-sm-3">#{msg.transcript}:</dt>
		<dd class="col-sm-9">
			<h:outputLink value="ted_transcript.jsf">
				<f:param name="resource_id" value="#{res.id}"/>
				#{msg.link_to_transcript}
			</h:outputLink>
		</dd>
	</ui:fragment>

	<ui:fragment rendered="#{(userBean.optionContentAnnotationFieldEnabled and res.type eq 'website')}">
		<dt class="col-sm-3">#{msg.content}:</dt>
		<dd class="col-sm-9">
			<h:outputLink value="resource_transcript.jsf">
				<f:param name="resource_id" value="#{res.id}"/>
				#{msg.link_to_content}
			</h:outputLink>
		</dd>
	</ui:fragment>

	<ui:fragment rendered="${not empty res.creationDate}">
		<dt class="col-sm-3">#{msg.date}:</dt>
		<dd class="col-sm-9">
			<h:outputText value="#{res.creationDate}">
				<f:convertDateTime type="date" dateStyle="long" timeZone="#{userBean.timeZone}"/>
			</h:outputText>
		</dd>
	</ui:fragment>

	<ui:fragment rendered="#{res.folderId != 0}">
		<dt class="col-sm-3">#{msg.path}:</dt>
		<dd class="col-sm-9">
			<h:outputLink value="group/resources.jsf">
				<f:param name="group_id" value="#{res.groupId}"/>
				<f:param name="folder_id" value="#{res.folderId}"/>
				<f:param name="resource_id" value="#{res.id}"/>
				#{res.prettyPath}
			</h:outputLink>
		</dd>
	</ui:fragment>

	<ui:fragment rendered="#{not empty res.description}">
		<dt class="col-sm-3">#{msg.description}:</dt>
		<dd class="col-sm-9">
			<h:outputText value="#{res.descriptionHTML}" escape="false"/>
		</dd>
	</ui:fragment>

	<ui:fragment rendered="#{not empty res.tags or res.canAnnotateResource(userBean.user)}">
		<dt class="col-sm-3">#{msg.tags}:</dt>
		<dd class="col-sm-9">
			<h:panelGroup id="tags_list" layout="block">
				<ul class="list-inline list-unstyled mb-1">
					<ui:repeat var="tag" value="#{res.tags}">
						<li class="list-inline-item mr-0 mb-1">
							<p:linkButton outcome="/lw/search" value="#{tag.name}" styleClass="secondary-btn mr-0 rounded-0">
								<f:param name="action" value="image"/>
								<f:param name="query" value="#{tag.name}"/>
							</p:linkButton>
							<p:commandButton action="#{resourceDetailBean.onDeleteTag}" icon="fa fa-times" styleClass="secondary-btn rounded-0"
											 global="false" update=":tags_list :growl" process="@this"
											 onstart="PF('detailsOverlay').show();" oncomplete="PF('detailsOverlay').hide();"
											 rendered="#{res.canEditResource(userBean.user)}">
								<f:setPropertyActionListener target="#{resourceDetailBean.selectedTag}" value="#{tag}"/>
							</p:commandButton>
						</li>
					</ui:repeat>
				</ul>
			</h:panelGroup>

			<h:panelGroup layout="block" rendered="#{res.canAnnotateResource(userBean.user)}">
				<div class="form-group mb-1">
					<p:inputText id="tag_text_input" value="#{resourceDetailBean.tagName}" styleClass="flex-grow-1" placeholder="#{msg.new_tag_placeholder}" required="true"/>
					<p:message for="@previous"/>
				</div>

				<p:commandButton action="#{resourceDetailBean.addTag}" value="#{msg.add_tag}" global="false" process=":tag_text_input" partialSubmit="true"
								 update=":tag_text_input :tags_list :growl" onstart="PF('detailsOverlay').show();" oncomplete="PF('detailsOverlay').hide();">
					<f:setPropertyActionListener target="#{activityResourceBean.reloadLogs}" value="true"/>
				</p:commandButton>
			</h:panelGroup>
		</dd>
	</ui:fragment>

	<ui:fragment rendered="#{not empty res.comments or res.canAnnotateResource(userBean.user)}">
		<dt class="col-sm-3">#{msg.comments}:</dt>
		<dd class="col-sm-9">
			<h:panelGroup styleClass="mb-2" layout="block" rendered="#{res.canAnnotateResource(userBean.user)}">
				<div class="form-group mb-1">
					<p:inputTextarea id="comment_text_input" rows="3" value="#{resourceDetailBean.newComment}" placeholder="#{msg.new_comment_placeholder}" required="true" styleClass="d-block"/>
					<p:message for="@previous"/>
				</div>

				<p:commandButton value="#{msg.addComment}" action="#{resourceDetailBean.addComment}" global="false"
								 update=":comments_list :comment_text_input :growl" process=":comment_text_input" partialSubmit="true"
								 onstart="PF('detailsOverlay').show();" oncomplete="PF('detailsOverlay').hide();">
					<f:setPropertyActionListener target="#{activityResourceBean.reloadLogs}" value="true"/>
				</p:commandButton>
			</h:panelGroup>
			<h:panelGroup layout="block" id="comments_list">
				<ui:repeat var="comment" varStatus="status" value="#{res.comments}" rendered="#{not empty res.comments}">
					<div class="d-flex comment-entry bg-light p-2 #{!status.last ? 'mb-2' : ''}">
						<img class="profile-picture mr-3" src="#{comment.user.image}" alt="Profile picture"/>

						<div class="comment-details">
							<p class="mb-0">
								<h:link value="#{comment.user.username}" outcome="/lw/user/detail.jsf?user_id=#{comment.user.id}" styleClass="font-weight-bold comment-author mr-3"/>
								<lw:timeAgo date="#{comment.date}" styleClass="small font-weight-light mb-0 comment-date"/>
							</p>
							<div class="mb-1">#{comment.text}</div>
							<div class="small">
								<p:commandLink value="#{msg.edit}" styleClass="text-success mr-2" ajax="true" update=":comment_edit_form"
											   process="@this" onsuccess="PF('editCommentDialog').show();"
											   rendered="#{resourceDetailBean.canEditComment(comment)}">
									<f:setPropertyActionListener target="#{resourceDetailBean.clickedComment}" value="#{comment}"/>
								</p:commandLink>
								<p:commandLink value="#{msg.delete}" styleClass="text-danger" ajax="true" global="false"
											   action="#{resourceDetailBean.onDeleteComment}" update=":comments_list :growl" process="@this"
											   onstart="PF('detailsOverlay').show();" oncomplete="PF('detailsOverlay').hide();"
											   rendered="#{resourceDetailBean.canEditComment(comment)}">
									<f:setPropertyActionListener target="#{resourceDetailBean.clickedComment}" value="#{comment}"/>
									<p:confirm message="#{msg.delete_message_comments}"/>
								</p:commandLink>
							</div>
						</div>
					</div>
				</ui:repeat>
			</h:panelGroup>
		</dd>
	</ui:fragment>
</dl>

<ui:decorate template="/WEB-INF/templates/blocks/modal/edit_comment_dialog.xhtml"/>
</ui:composition>
