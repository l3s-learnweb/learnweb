<ui:composition xmlns="http://www.w3.org/1999/xhtml"
                xmlns:f="http://xmlns.jcp.org/jsf/core"
                xmlns:h="http://xmlns.jcp.org/jsf/html"
                xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
                xmlns:p="http://primefaces.org/ui">

<h:form id="add_resource_upload_form" rendered="#{addResourceBean.formStep > 0}">
    <div class="form-group row">
        <h:outputText value="#{msg.type}:" styleClass="col-sm-4 col-form-label"/>
        <div class="col-sm-8 align-self-center text-capitalize">
            <h:outputText value="#{addResourceBean.resource.type}"/>
        </div>
    </div>

    <div class="form-group row">
        <h:outputText value="#{msg.location}:" styleClass="col-sm-4 col-form-label"/>
        <div class="col-sm-8 align-self-center">
            <h:outputText value="#{addResourceBean.currentPath}" rendered="#{addResourceBean.formStep != 1}"/>
            <p:button onclick="createConfirmDialog('selectDestination', updateAddResourcePaneCommand);return false;" value="#{addResourceBean.currentPath}"
                      rendered="#{addResourceBean.formStep == 1}"/>
        </div>
    </div>

    <h:panelGroup styleClass="form-group row" layout="block" rendered="#{addResourceBean.resource.type eq 'website'}">
        <h:outputText value="#{msg.url}:" styleClass="col-sm-4 col-form-label"/>
        <div class="col-sm-8 align-self-center">
            <h:outputText value="#{addResourceBean.resource.url}" rendered="#{addResourceBean.formStep != 1}"/>
            <p:inputText value="#{addResourceBean.resource.url}" required="true" requiredmessage="#{msg.mandatory_field}"
                         validator="#{addResourceBean.validateUrl}" rendered="#{addResourceBean.formStep == 1}"/>
        </div>
    </h:panelGroup>

    <h:panelGroup styleClass="form-group row" layout="block" rendered="#{addResourceBean.resource.type eq 'file'}">
        <h:outputText value="#{msg.file}:" styleClass="col-sm-4 col-form-label"/>
        <div class="col-sm-8 align-self-center">
            <h:outputText value="#{addResourceBean.resource.url}" rendered="#{addResourceBean.formStep != 1}"/>
            <p:fileUpload fileUploadListener="#{addResourceBean.handleFileUpload}" mode="advanced" auto="true" sizeLimit="10000000000"
                          fileLimit="1" label="#{msg.choose_file}" update=":growl :add_resource_upload_form" required="true"
                          rendered="#{addResourceBean.formStep == 1}"/>
        </div>
    </h:panelGroup>

    <h:panelGroup styleClass="form-group row" layout="block" rendered="#{addResourceBean.resource.thumbnail3 != null}">
        <h:outputText value="#{msg.preview}:" styleClass="col-sm-4 col-form-label"/>
        <div class="col-sm-8 align-self-center">
            <h:outputText id="preview" escape="false" value="#{addResourceBean.resource.thumbnail1.html}"/>
        </div>
    </h:panelGroup>

    <ui:fragment rendered="#{addResourceBean.resource.type eq 'glossary2'}">
        <div class="form-group row">
            <h:outputText value="#{msg.title}:" styleClass="col-sm-4 col-form-label"/>
            <div class="col-sm-8 align-self-center">
                <h:outputText value="#{addResourceBean.resource.title}" rendered="#{addResourceBean.formStep != 1}"/>
                <p:inputText id="title_input" value="#{addResourceBean.resource.title}" required="true" requiredmessage="#{msg.mandatory_field}"
                             rendered="#{addResourceBean.formStep == 1}"/>
            </div>
        </div>

        <div class="form-group row">
            <h:outputText value="Allowed languages:" styleClass="col-sm-4 col-form-label"/>
            <div class="col-sm-8 align-self-center">
                <h:outputText value="#{addResourceBean.resource.allowedLanguages}" rendered="#{addResourceBean.formStep != 1}"/>
                <p:selectCheckboxMenu value="#{addResourceBean.resource.allowedLanguages}" required="true" requiredMessage="#{msg.mandatory_field}"
                                      label="#{msg.language}" multiple="true" converter="#{localeConverter}" rendered="#{addResourceBean.formStep == 1}">
                    <f:selectItems value="#{addResourceBean.availableGlossaryLanguages}"></f:selectItems>
                </p:selectCheckboxMenu>
            </div>
        </div>
    </ui:fragment>

    <ui:fragment rendered="#{addResourceBean.resource.type eq 'survey'}">
        <div class="form-group row">
            <h:outputText value="#{msg.title}:" styleClass="col-sm-4 col-form-label"/>
            <div class="col-sm-8 align-self-center">
                <h:outputText value="#{addResourceBean.resource.title}" rendered="#{addResourceBean.formStep != 1}"/>
                <p:inputText id="survey_title" value="#{addResourceBean.resource.title}" required="true" requiredmessage="#{msg.mandatory_field}"
                             rendered="#{addResourceBean.formStep == 1}"/>
            </div>
        </div>

        <div class="form-group row">
            <h:outputText value="#{msg.description}:" styleClass="col-sm-4 col-form-label"/>
            <div class="col-sm-8 align-self-center">
                <h:outputText value="#{addResourceBean.resource.description}" rendered="#{addResourceBean.formStep != 1}"/>
                <p:inputText id="survey_desc" value="#{addResourceBean.resource.description}"
                             rendered="#{addResourceBean.formStep == 1}"/>
            </div>
        </div>

        <div class="form-group row">
            <h:outputText value="Survey Open Date:" styleClass="col-sm-4 col-form-label"/>
            <div class="col-sm-8 align-self-center">
                <h:outputText value="#{addResourceBean.surveyOpenDate}" rendered="#{addResourceBean.formStep != 1}"/>
                <p:calendar id="open" value="#{addResourceBean.surveyOpenDate}" showOn="button" rendered="#{addResourceBean.formStep == 1}"/>
            </div>
        </div>

        <div class="form-group row">
            <h:outputText value="Survey Close Date:" styleClass="col-sm-4 col-form-label"/>
            <div class="col-sm-8 align-self-center">
                <h:outputText value="#{addResourceBean.surveyCloseDate}" rendered="#{addResourceBean.formStep != 1}"/>
                <p:calendar id="close" value="#{addResourceBean.surveyCloseDate}" showOn="button" rendered="#{addResourceBean.formStep == 1}"/>
            </div>
        </div>
    </ui:fragment>

    <ui:fragment rendered="#{addResourceBean.formStep != 1}">
        <ui:decorate template="/WEB-INF/templates/blocks/resources/edit.xhtml">
            <ui:param name="res" value="#{addResourceBean.resource}"/>
        </ui:decorate>
    </ui:fragment>

    <div class="row">
        <div class="col text-right">
            <p:commandButton value="#{msg.cancel}" styleClass="secondary-btn" immediate="true" ajax="true"
                             actionListener="#{addResourceBean.clearForm}" update=":right_pane">
                <f:setPropertyActionListener target="#{rightPaneBean.paneAction}" value="none"/>
            </p:commandButton>

            <p:commandButton id="next_button" value="#{msg.next}" action="#{addResourceBean.handleUrlInput}" update=":growl :add_resource_upload_form"
                             onstart="PF('rightPaneOverlay').show()" oncomplete="PF('rightPaneOverlay').hide()" global="false"
                             rendered="#{addResourceBean.formStep == 1 and addResourceBean.resource.type eq 'website'}">
            </p:commandButton>

            <p:commandButton value="#{msg.addResource}" ajax="true" action="#{addResourceBean.addResource}" update=":growl :right_pane"
                             oncomplete="resourceAddedHook();load_editor();" rendered="#{addResourceBean.formStep != 1 or addResourceBean.resource.type eq 'glossary2'or addResourceBean.resource.type eq 'survey'}">
                <f:setPropertyActionListener target="#{activityResourceBean.reloadLogs}" value="true"/>
                <f:setPropertyActionListener target="#{rightPaneBean.viewResource}" value="#{addResourceBean.resource}"/>
            </p:commandButton>
        </div>
    </div>
</h:form>

</ui:composition>