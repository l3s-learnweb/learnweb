<ui:composition xmlns="http://www.w3.org/1999/xhtml"
                xmlns:f="http://xmlns.jcp.org/jsf/core"
                xmlns:h="http://xmlns.jcp.org/jsf/html"
                xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
                xmlns:p="http://primefaces.org/ui">

<h:form id="add_resource_upload_form">
    <p:remoteCommand name="updateLocationCommand" actionListener="#{addResourceBean.updateTargetLocation}" update=":right_pane :growl"
                     global="false" onstart="PF('rightPaneOverlay').show();" oncomplete="PF('rightPaneOverlay').hide()"/>

    <h:panelGroup layout="block" styleClass="fg-grid mb-3" rendered="#{addResourceBean.formStep == 1}">
        <h:outputText value="#{msg.type}:" styleClass="ui-outputlabel"/>
        <h:outputText value="#{addResourceBean.resource.type}" styleClass="fg-col text-capitalize"/>

        <p:outputLabel for="@next" value="#{msg.location}:"/>
        <p:commandLink update=":selectDestinationDialog" value="#{addResourceBean.currentPath}"
                       oncomplete="createConfirmDialog('selectDestination', updateLocationCommand);return false;"/>

        <ui:fragment rendered="#{addResourceBean.resource.type eq 'website'}">
            <p:outputLabel for="@next" value="#{msg.url}:"/>
            <p:inputText value="#{addResourceBean.resource.url}" required="true" requiredmessage="#{msg.mandatory_field}" validator="#{addResourceBean.validateUrl}"/>
        </ui:fragment>

        <ui:fragment rendered="#{addResourceBean.resource.type eq 'file'}">
            <p:outputLabel for="@next" value="#{msg.file}:"/>
            <p:fileUpload listener="#{addResourceBean.handleFileUpload}" styleClass="fileupload-minimal" mode="advanced" auto="true"
                          sizeLimit="10000000000" fileLimit="1" label="#{msg.choose_file}" update=":growl :add_resource_upload_form" required="true"/>
        </ui:fragment>

        <ui:fragment rendered="#{addResourceBean.resource.thumbnail3 != null}">
            <p:outputLabel value="#{msg.preview}:"/>
            <h:outputText escape="false" value="#{addResourceBean.resource.thumbnail1.html}"/>
        </ui:fragment>

        <ui:fragment rendered="#{addResourceBean.resource.type eq 'glossary2'}">
            <p:outputLabel for="@next" value="#{msg.title}:"/>
            <p:inputText value="#{addResourceBean.resource.title}" required="true" requiredmessage="#{msg.mandatory_field}"/>

            <p:outputLabel for="@next" value="Allowed languages:"/>
            <p:selectCheckboxMenu value="#{addResourceBean.resource.allowedLanguages}" required="true" requiredMessage="#{msg.mandatory_field}"
                                  label="#{msg.language}" multiple="true" converter="#{localeConverter}">
                <f:selectItems value="#{addResourceBean.availableGlossaryLanguages}"></f:selectItems>
            </p:selectCheckboxMenu>
        </ui:fragment>

        <ui:fragment rendered="#{addResourceBean.resource.type eq 'survey'}">
            <p:outputLabel for="@next" value="#{msg.title}:"/>
            <p:inputText value="#{addResourceBean.resource.title}" required="true" requiredmessage="#{msg.mandatory_field}"/>

            <p:outputLabel for="@next" value="#{msg.description}:"/>
            <p:inputText value="#{addResourceBean.resource.description}"/>

            <p:outputLabel for="@next" value="Survey Open Date:"/>
            <p:calendar value="#{addResourceBean.surveyOpenDate}" showOn="button"/>

            <p:outputLabel for="@next" value="Survey Close Date:"/>
            <p:calendar value="#{addResourceBean.surveyCloseDate}" showOn="button"/>
        </ui:fragment>
    </h:panelGroup>

    <h:panelGroup layout="block" styleClass="fg-grid mb-3" rendered="#{addResourceBean.formStep != 1}">
        <h:outputText value="#{msg.type}:" styleClass="ui-outputlabel"/>
        <h:outputText value="#{addResourceBean.resource.type}" styleClass="fg-col text-capitalize"/>

        <p:outputLabel for="@next" value="#{msg.location}:"/>
        <p:inputText value="#{addResourceBean.currentPath}" readonly="true"/>

        <ui:fragment rendered="#{addResourceBean.resource.type eq 'website'}">
            <p:outputLabel for="@next" value="#{msg.url}:"/>
            <p:inputText value="#{addResourceBean.resource.url}" readonly="true"/>
        </ui:fragment>

        <ui:fragment rendered="#{addResourceBean.resource.type eq 'file'}">
            <p:outputLabel for="@next" value="#{msg.file}:"/>
            <p:inputText value="#{addResourceBean.resource.url}" readonly="true"/>
        </ui:fragment>

        <ui:fragment rendered="#{addResourceBean.resource.thumbnail3 != null}">
            <p:outputLabel value="#{msg.preview}:"/>
            <h:outputText escape="false" value="#{addResourceBean.resource.thumbnail1.html}"/>
        </ui:fragment>

        <ui:fragment rendered="#{addResourceBean.resource.type eq 'glossary2'}">
            <p:outputLabel for="@next" value="#{msg.title}:"/>
            <p:inputText value="#{addResourceBean.resource.title}" readonly="true"/>

            <p:outputLabel for="@next" value="Allowed languages:"/>
            <p:inputText value="#{addResourceBean.resource.allowedLanguages}" readonly="true"/>
        </ui:fragment>

        <ui:fragment rendered="#{addResourceBean.resource.type eq 'survey'}">
            <p:outputLabel for="@next" value="#{msg.title}:"/>
            <p:inputText value="#{addResourceBean.resource.title}" readonly="true"/>

            <p:outputLabel for="@next" value="#{msg.description}:"/>
            <p:inputText value="#{addResourceBean.resource.description}" readonly="true"/>

            <p:outputLabel for="@next" value="Survey Open Date:"/>
            <p:inputText value="#{addResourceBean.surveyOpenDate}" readonly="true"/>

            <p:outputLabel for="@next" value="Survey Close Date:"/>
            <p:inputText value="#{addResourceBean.surveyCloseDate}" readonly="true"/>
        </ui:fragment>

        <ui:decorate template="/WEB-INF/templates/blocks/resources/edit.xhtml">
            <ui:param name="res" value="#{addResourceBean.resource}"/>
        </ui:decorate>
    </h:panelGroup>

    <div class="d-flex">
        <p:defaultCommand target="nextButton" rendered="#{addResourceBean.formStep == 1 and addResourceBean.resource.type eq 'website'}"/>
        <p:defaultCommand target="addResourceButton" rendered="#{addResourceBean.formStep != 1 or addResourceBean.resource.type eq 'glossary2' or addResourceBean.resource.type eq 'survey'}"/>

        <div class="mr-auto">
            <h:outputText value="* #{msg.mandatory_field}"/>
        </div>
        <div>
            <p:commandButton value="#{msg.cancel}" styleClass="secondary-btn" update=":right_pane" immediate="true" actionListener="#{addResourceBean.reset}">
                <f:setPropertyActionListener target="#{rightPaneBean.paneAction}" value="none"/>
            </p:commandButton>

            <p:commandButton id="nextButton" value="#{msg.next}" action="#{addResourceBean.handleUrlInput}" update=":growl :add_resource_upload_form"
                             onstart="PF('rightPaneOverlay').show()" oncomplete="PF('rightPaneOverlay').hide()" global="false"
                             rendered="#{addResourceBean.formStep == 1 and addResourceBean.resource.type eq 'website'}">
            </p:commandButton>

            <p:commandButton id="addResourceButton" value="#{msg.addResource}" ajax="true" action="#{addResourceBean.addResource}" update=":growl :right_pane"
                             oncomplete="resourceAddedHook();" rendered="#{addResourceBean.formStep != 1 or addResourceBean.resource.type eq 'glossary2' or addResourceBean.resource.type eq 'survey'}">
                <f:setPropertyActionListener target="#{activityResourceBean.reloadLogs}" value="true"/>
                <f:setPropertyActionListener target="#{rightPaneBean.viewResource}" value="#{addResourceBean.resource}"/>
            </p:commandButton>
        </div>
    </div>
</h:form>

</ui:composition>
