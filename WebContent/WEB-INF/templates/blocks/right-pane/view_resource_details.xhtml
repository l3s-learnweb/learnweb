<ui:composition xmlns="http://www.w3.org/1999/xhtml"
	xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
	xmlns:h="http://xmlns.jcp.org/jsf/html"
	xmlns:f="http://xmlns.jcp.org/jsf/core"
	xmlns:p="http://primefaces.org/ui">

<dl class="row mb-n2">
	<ui:fragment rendered="${not empty rightPaneBean.clickedResource.fileName and rightPaneBean.clickedResource.source ne 'loro'}">
		<dt class="col-sm-3">#{msg.file}:</dt>
		<dd class="col-sm-9">
			<a href="#{rightPaneBean.clickedResource.fileUrl}">
				<i class="fa fa-fw fa-download" aria-hidden="true"></i>
				#{rightPaneBean.clickedResource.fileName}
			</a>

			<ui:fragment rendered="${not empty rightPaneBean.clickedResource.originalFile}">
				<div>
					<a href="#{rightPaneBean.clickedResource.originalFile.url}">
						<i class="fa fa-fw fa-download" aria-hidden="true"></i>
						#{rightPaneBean.clickedResource.originalFile.name}
					</a>
					(Backup <h:outputText value="#{rightPaneBean.clickedResource.originalFile.lastModified}">
						<f:convertDateTime type="date" timeStyle="short" dateStyle="long" timeZone="#{userBean.timeZone}"/>
					</h:outputText>)
				</div>
			</ui:fragment>
		</dd>
	</ui:fragment>

	<ui:fragment rendered="${empty rightPaneBean.clickedResource.fileName and rightPaneBean.clickedResource.type == 'file' }">
		<dt class="col-sm-3">#{msg.resource}:</dt>
		<dd class="col-sm-9">
			<a href="#{rightPaneBean.clickedResource.urlProxied}" target="_blank">#{rightPaneBean.clickedResource.url}</a>
		</dd>
	</ui:fragment>

	<ui:fragment rendered="#{userBean.starRatingEnabled}">
		<dt class="col-sm-3">#{msg.relevance}:</dt>
		<dd class="col-sm-9">
			<h:form>
				<p:rating value="#{resourceDetailBean.clickedResource.starRatingRounded}" cancel="false"
						disabled="${resourceDetailBean.starRatedByUser or not resourceDetailBean.clickedResource.canAnnotateResource(userBean.user)}">
					<p:ajax event="rate" listener="#{resourceDetailBean.handleRate}" update="@form :growl"/>
				</p:rating>

				<h:outputText value="#{rightPaneBean.clickedResource.starRating}">
					<f:convertNumber maxFractionDigits="1" minFractionDigits="1"/>
				</h:outputText>
				(<h:outputFormat value="#{msg.votes}"><f:param value="#{rightPaneBean.clickedResource.rateNumber}"/></h:outputFormat>)
			</h:form>
		</dd>
	</ui:fragment>

	<ui:fragment rendered="#{not empty rightPaneBean.clickedResource.group and rightPaneBean.clickedResource.type eq 'website' and not empty rightPaneBean.clickedResource.group.hypothesisLink}">
		<dt class="col-sm-3">#{msg.discuss}:</dt>
		<dd class="col-sm-9">
			<h:outputLink value="#{resourceDetailBean.hypothesisLink}">#{msg.link_to_discuss}</h:outputLink>
			<h:outputLink value="#{rightPaneBean.clickedResource.group.hypothesisLink}">(#{msg.discuss_group_invite})</h:outputLink>

			<h:outputLink value="discussion_help.jsf" target="_blank">
				<f:param name="type" value="user"/>[?]
			</h:outputLink>
		</dd>
	</ui:fragment>

	<ui:fragment rendered="#{userBean.thumbRatingEnabled}">
		<dt class="col-sm-3">#{msg.reliability}:</dt>
		<dd class="col-sm-9">
			<h:form>
				<h:panelGrid columns="4">
					<h:outputText value="+#{rightPaneBean.clickedResource.thumbUp}"/>
					<p:commandLink actionListener="#{resourceDetailBean.onThumbUp}" update="@form :growl" ariaLabel="Rate thump up">
						<f:param name="resource_id" value="#{rightPaneBean.clickedResource.id}"/>
						<i class="fa fa-fw fa-thumbs-up text-success" aria-hidden="true"></i>
					</p:commandLink>

					<p:commandLink actionListener="#{resourceDetailBean.onThumbDown}" update="@form :growl" ariaLabel="Rate thump down">
						<f:param name="resource_id" value="#{rightPaneBean.clickedResource.id}"/>
						<i class="fa fa-fw fa-thumbs-down text-danger" aria-hidden="true"></i>
					</p:commandLink>
					<h:outputText value="-#{rightPaneBean.clickedResource.thumbDown}"/>
				</h:panelGrid>
			</h:form>
		</dd>
	</ui:fragment>

	<ui:fragment rendered="#{not empty rightPaneBean.clickedResource.author}">
		<dt class="col-sm-3">#{msg.author}:</dt>
		<dd class="col-sm-9">
			<h:outputText value="#{rightPaneBean.clickedResource.author}"/>
		</dd>
	</ui:fragment>

	<ui:fragment rendered="#{not empty rightPaneBean.clickedResource.language}">
		<dt class="col-sm-3">#{msg.language}:</dt>
		<dd class="col-sm-9">
			<p:repeat var="language" value="#{rightPaneBean.clickedResource.metadataMultiValue['language']}" varStatus="status">
				<h:outputText value="#{msg['language_' += language]}"/>
				<h:outputText value=", " rendered="#{!status.last}" escape="false"/>
			</p:repeat>
		</dd>
	</ui:fragment>

	<dt class="col-sm-3">#{msg.source}:</dt>
	<dd class="col-sm-9">
		<a href="#{rightPaneBean.clickedResource.urlProxied}"><h:outputText value="#{rightPaneBean.clickedResource.source.label}"/></a>
	</dd>

	<ui:repeat var="entry" value="#{rightPaneBean.clickedResource.metadataEntries}">
		<ui:fragment rendered="#{not empty entry.value}">
			<dt class="col-sm-3"><h:outputText value="#{utilBean.getLocaleMessage(entry.key, null)}"/>:</dt>
			<dd class="col-sm-9"><h:outputText value="#{entry.value}"/></dd>
		</ui:fragment>
	</ui:repeat>

	<ui:fragment rendered="${not empty rightPaneBean.clickedResource.group}">
		<dt class="col-sm-3">#{msg.group}:</dt>
		<dd class="col-sm-9">
			<h:outputLink value="group/overview.jsf">
				<f:param name="group_id" value="#{rightPaneBean.clickedResource.group.id}"/>
				<h:outputText value="#{rightPaneBean.clickedResource.group.title}"/>
			</h:outputLink>
		</dd>
	</ui:fragment>

	<ui:fragment rendered="${not empty rightPaneBean.clickedResource.originalGroup}">
		<dt class="col-sm-3">#{msg.copied_from}:</dt>
		<dd class="col-sm-9">
			<h:outputLink value="group/overview.jsf">
				<f:param name="group_id" value="#{rightPaneBean.clickedResource.originalGroup.id}"/>
				<h:outputText value="#{rightPaneBean.clickedResource.originalGroup.title}"/>
			</h:outputLink>
		</dd>
	</ui:fragment>

	<ui:fragment rendered="${rightPaneBean.clickedResource.source == 'ted' or rightPaneBean.clickedResource.source == 'tedx'}">
		<dt class="col-sm-3">#{msg.transcript}:</dt>
		<dd class="col-sm-9">
			<h:outputLink value="ted_transcript.jsf">
				<f:param name="resource_id" value="#{rightPaneBean.clickedResource.id}"/>
				#{msg.link_to_transcript}
			</h:outputLink>
		</dd>
	</ui:fragment>

	<ui:fragment rendered="#{(userBean.optionContentAnnotationFieldEnabled and rightPaneBean.clickedResource.type eq 'website')}">
		<dt class="col-sm-3">#{msg.content}:</dt>
		<dd class="col-sm-9">
			<h:outputLink value="resource_transcript.jsf">
				<f:param name="resource_id" value="#{rightPaneBean.clickedResource.id}"/>
				#{msg.link_to_content}
			</h:outputLink>
		</dd>
	</ui:fragment>

	<ui:fragment rendered="${not empty rightPaneBean.clickedResource.creationDate}">
		<dt class="col-sm-3">#{msg.date}:</dt>
		<dd class="col-sm-9">
			<h:outputText value="#{rightPaneBean.clickedResource.creationDate}">
				<f:convertDateTime type="date" dateStyle="long" timeZone="#{userBean.timeZone}"/>
			</h:outputText>
		</dd>
	</ui:fragment>

	<ui:fragment rendered="#{rightPaneBean.clickedResource.folderId != 0}">
		<dt class="col-sm-3">#{msg.path}:</dt>
		<dd class="col-sm-9">
			<h:outputLink value="group/resources.jsf">
				<f:param name="group_id" value="#{rightPaneBean.clickedResource.groupId}"/>
				<f:param name="folder_id" value="#{rightPaneBean.clickedResource.folderId}"/>
				<f:param name="resource_id" value="#{rightPaneBean.clickedResource.id}"/>
				#{rightPaneBean.clickedResource.prettyPath}
			</h:outputLink>
		</dd>
	</ui:fragment>

	<ui:fragment rendered="#{not empty rightPaneBean.clickedResource.description}">
		<dt class="col-sm-3">#{msg.description}:</dt>
		<dd class="col-sm-9">
			<h:outputText value="#{rightPaneBean.clickedResource.descriptionHTML}" escape="false"/>
		</dd>
	</ui:fragment>

	<ui:fragment rendered="#{not empty rightPaneBean.clickedResource.tags or rightPaneBean.clickedResource.canAnnotateResource(userBean.user)}">
		<dt class="col-sm-3">#{msg.tags}:</dt>
		<dd class="col-sm-9">
			<h:form id="tag_form">
				<ul class="list-inline list-unstyled mb-1">
					<ui:repeat var="tag" value="#{rightPaneBean.clickedResource.tags}">
						<li class="list-inline-item mr-0 mb-1">
							<p:linkButton outcome="/lw/search" value="#{tag.name}" styleClass="secondary-btn mr-0 rounded-0">
								<f:param name="action" value="image"/>
								<f:param name="query" value="#{tag.name}"/>
							</p:linkButton>
							<p:commandButton action="#{resourceDetailBean.onDeleteTag}" update=":right_pane :growl" process="@this" icon="fa fa-times" styleClass="secondary-btn rounded-0"
											 rendered="#{rightPaneBean.clickedResource.canEditResource(userBean.user)}">
								<f:setPropertyActionListener target="#{resourceDetailBean.selectedTag}" value="#{tag}"/>
							</p:commandButton>
						</li>
					</ui:repeat>
				</ul>
			</h:form>

			<h:form id="tag_input_form" rendered="#{rightPaneBean.clickedResource.canAnnotateResource(userBean.user)}">
				<div class="form-group mb-0">
					<p:inputText value="#{resourceDetailBean.tagName}" id="tag_name" styleClass="flex-grow-1" placeholder="Enter new tag..."/>
					<p:message for="@previous"/>
				</div>

				<p:commandButton actionListener="#{resourceDetailBean.addTag}" value="#{msg.addTag}"
								 update=":tag_form :growl tag_name" partialSubmit="true" process="@form">
					<f:setPropertyActionListener target="#{activityResourceBean.reloadLogs}" value="true"/>
				</p:commandButton>
			</h:form>
		</dd>
	</ui:fragment>

	<ui:fragment rendered="#{not empty rightPaneBean.clickedResource.comments or rightPaneBean.clickedResource.canAnnotateResource(userBean.user)}">
		<dt class="col-sm-3">#{msg.comments}:</dt>
		<dd class="col-sm-9">
			<h:form styleClass="mb-2" id="new_comment_form">
				<ui:fragment rendered="#{rightPaneBean.clickedResource.canAnnotateResource(userBean.user)}">
					<div class="form-group mb-0">
						<p:inputTextarea rows="3" value="#{resourceDetailBean.newComment}" placeholder="#{msg.addComment}" required="true" styleClass="d-block"/>
						<p:message for="@previous"/>
					</div>

					<p:commandButton value="#{msg.addComment}" actionListener="#{resourceDetailBean.addComment()}" update=":comments_list_form @form :growl">
						<f:setPropertyActionListener target="#{activityResourceBean.reloadLogs}" value="true"/>
					</p:commandButton>
				</ui:fragment>
			</h:form>
			<h:form id="comments_list_form">
				<ui:repeat var="comment" varStatus="status" value="#{rightPaneBean.clickedResource.comments}" rendered="#{not empty rightPaneBean.clickedResource.comments}">
					<div class="d-flex comment-entry bg-light p-2 #{!status.last ? 'mb-2' : ''}">
						<img class="profile-picture mr-3" src="#{comment.user.image}" alt="Profile picture"/>

						<div class="comment-details">
							<p class="mb-0">
								<h:link value="#{comment.user.username}" outcome="/lw/user/detail.jsf?user_id=#{comment.user.id}" styleClass="font-weight-bold comment-author mr-3"/>
								<h:outputText value="${userBean.getPrettyDate(comment.date)}" escape="false" styleClass="small font-weight-light mb-0 comment-date"/>
							</p>
							<div class="mb-1">#{comment.text}</div>
							<div class="small">
								<p:commandLink value="#{msg.edit}" styleClass="text-success mr-2" rendered="#{resourceDetailBean.canEditComment(comment)}"
											   onsuccess="PF('commentEditDialog').show();" ajax="true" update=":comment_edit_form">
									<f:setPropertyActionListener target="#{resourceDetailBean.clickedComment}" value="#{comment}"/>
								</p:commandLink>
								<p:commandLink value="#{msg.delete}" styleClass="text-danger" rendered="#{resourceDetailBean.canEditComment(comment)}"
											   action="#{resourceDetailBean.onDeleteComment}" onstart="return confirm('#{msg.delete_message_comments}');"
											   ajax="true" update=":right_pane :growl">
									<f:setPropertyActionListener target="#{resourceDetailBean.clickedComment}" value="#{comment}"/>
								</p:commandLink>
							</div>
						</div>
					</div>
				</ui:repeat>
			</h:form>
		</dd>
	</ui:fragment>
</dl>

<p:dialog header="#{msg.edit}" appendTo="@(body)" widgetVar="commentEditDialog"
		  modal="true" resizable="false" draggable="false" responsive="true" closeOnEscape="true">
	<h:form id="comment_edit_form">
		<div class="form-group">
			<p:inputTextarea autoResize="1" maxHeight="20" value="#{resourceDetailBean.clickedComment.text}"/>
		</div>

		<p:commandButton actionListener="#{resourceDetailBean.onEditComment}" update=":comments_list_form :growl" title="#{msg.save}"
			value="#{msg.save}" onsuccess="PF('commentEditDialog').hide();"/>
	</h:form>
</p:dialog>
</ui:composition>