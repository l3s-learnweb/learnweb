<ui:composition xmlns="http://www.w3.org/1999/xhtml"
    xmlns:h="http://xmlns.jcp.org/jsf/html"
    xmlns:f="http://xmlns.jcp.org/jsf/core"
    xmlns:p="http://primefaces.org/ui"
    xmlns:ui="http://xmlns.jcp.org/jsf/facelets">

    <!--@elvariable id="res" type="de.l3s.learnweb.resource.Resource"-->

    <div class="lightbox section-resources" id="lightbox">
        <div id="lightbox_background" onclick="lightbox_close();"></div>

        <div id="lightbox_container">
            <div id="lightbox_title">
                <h:outputText value="#{res.title}" escape="false"/>
                <a href="#" onclick="lightbox_close(); return false;" id="lightbox_close" title="close"></a>
            </div>
            <div id="lightbox_content">
                <ui:fragment rendered="#{res.isOfficeResource()}">
                    <div id="lightbox_editor"></div>
                    <script type="text/javascript"> load_editor();</script>
                </ui:fragment>
                <ui:fragment rendered="#{res.type eq 'pdf'}">
                    <iframe src="#{res.url}" style="width:100%; height:100%;"></iframe>
                </ui:fragment>
                <ui:fragment rendered="#{res.type eq 'image' or res.type eq 'survey'}">
                    <img src="#{res.thumbnail4.url}" height="#{res.thumbnail4.height}" width="#{res.thumbnail4.width}"
                         style="height:auto; width:auto; max-height:100%; max-width:100%; display:block; margin:0 auto; position: relative; top: 50%; transform: translateY(-50%);-moz-transform:translateY(-50%);-webkit-transform:translateY(-50%); -o-transform:translateY(-50%);-ms-transform:translateY(-50%);"/>
                </ui:fragment>
                <ui:fragment rendered="#{res.storageType == 2 and (res.type eq 'text' or res.type eq 'website')}">
                    <div style="overflow:auto; height:100%; width:100%; text-align:center;">
                        <img src="#{res.thumbnail4.url}" height="#{res.thumbnail4.height}" width="#{res.thumbnail4.width}"/>
                    </div>
                </ui:fragment>

                <h:panelGroup layout="block" id="archive_lightbox_content" style="display:none;height:97%;" rendered="${not empty res.archiveUrls and res.canEditResource(userBean.user)}">
                    <div id="archive_list">
                        <ui:fragment rendered="${res.archiveUrls.size() le 100}">
                            <ul>
                                <ui:repeat var="entry" value="#{res.archiveUrls}">
                                    <li>
                                        <a href="#{entry.archiveUrl}" onclick="onclick_archive_url(event);">
                                            <h:outputText value="${userBean.formatDate(entry.timestamp)}"/>
                                        </a>
                                    </li>
                                </ui:repeat>
                            </ul>
                        </ui:fragment>
                        <ui:fragment rendered="${res.archiveUrls.size() gt 100}">
                            <script type="text/javascript">archiveListInitialize();</script>
                            <ul>
                                <ui:repeat var="entry" value="#{res.archiveUrlsAsYears.entrySet().toArray()}">
                                    <!--@elvariable id="entry" type="java.util.Map.Entry<java.lang.String, java.util.List<de.l3s.learnweb.ArchiveUrl>>"-->
                                    <li class="years">
                                        <span>#{entry.key}</span>
                                        <ul class="archive-versions">
                                            <ui:repeat var="version" value="#{entry.value}">
                                                <li>
                                                    <a href="#{version.archiveUrl}" onclick="onclick_archive_url(event);">
                                                        <h:outputText value="${userBean.formatDate(version.timestamp)}"/>
                                                    </a>
                                                </li>
                                            </ui:repeat>
                                        </ul>
                                    </li>
                                </ui:repeat>
                            </ul>
                        </ui:fragment>
                    </div>
                    <div id="archive_iframe_div">
                        <i class="fa fa-cog fa-spin fa-4x fa-fw" aria-hidden="true"></i>
                        <iframe id="archive_iframe" data-src="#{res.lastArchivedObject.archiveUrl}"></iframe>
                    </div>
                    <div id="archive_timestamp_overlay">
                        <span class="archive_timestamp_overlay_text">
                            #{msg["Archive.show_version"]}:
                            <h:outputText id="archive_timestamp" value="${userBean.formatDate(res.lastArchivedObject.timestamp)}"/>
                        </span>
                        <button id="set_thumbnail_button" class="greenbutton float-right" style="top:3px;right:3px;position:relative;" onclick="updateThumbnail();">#{msg["Archive.set_thumbnail"]}</button>
                    </div>
                </h:panelGroup>
                <h:panelGroup rendered="${not empty res.thumbnailUpdateInfo}">
                    <div id="lightbox_footer">
                        <span class="archive_timestamp_overlay_text">
                            #{msg["Archive.thumbnail_update_info"]}:
                            <h:outputText value="${userBean.formatDate(res.thumbnailUpdateInfo.date)}"/>
                            (#{msg.by} ${res.thumbnailUpdateInfo.username})
                        </span>
                    </div>
                </h:panelGroup>
            </div>
        </div>
    </div>

    <div class="shadow border resource-preview">
        <ui:fragment rendered="#{res.isOfficeResource() and not (res.isOffline())}">
            <div class="editor-wrapper">
                <ui:decorate template="/WEB-INF/templates/blocks/resources/openoffice-editor.xhtml"/>
            </div>
        </ui:fragment>

        <ui:fragment rendered="#{res.type eq 'video' or res.type eq 'audio'}">
            <div class="video-wrapper">
                <h:outputText value='#{res.embedded}' escape="false"/>
            </div>
        </ui:fragment>

        <ui:fragment rendered="#{not empty res.thumbnail3 and res.type ne 'video' and res.type ne 'audio' and not res.isOfficeResource()}">
            <div class="image-wrapper">
                <a data-fancybox="lightbox" href="#lightbox_container">
                    <img src="#{res.thumbnail3.url}" alt="#{res.title}" height="#{res.thumbnail3.height}" width="#{res.thumbnail3.width}"
                         onclick="lightbox_open();" class="img-fluid mx-auto" style="cursor:zoom-in;"/>
                </a>
            </div>
        </ui:fragment>
    </div>

    <div class="my-3 text-center resource-links">
        <p:link href="#{rightPaneBean.clickedResource.urlProxied}" target="_blank" value="#{rightPaneBean.clickedResource.url}"
                rendered="#{rightPaneBean.clickedResource.type eq 'text' or rightPaneBean.clickedResource.type eq 'website' or rightPaneBean.clickedResource.type eq 'pdf'}"/>

        <p:button onclick="lightbox_open();change_lightbox_content(true);return false;" title="#{msg['Archive.change_thumbnail']}?" aria-label="#{msg['Archive.change_thumbnail']}?"
                  styleClass="secondary-btn mx-2" rendered="#{not empty rightPaneBean.clickedResource.archiveUrls}" icon="fa fa-pencil">
        </p:button>

        <p:linkButton onclick="load_lightbox_editor();return false;" value="Open editor" icon="fa fa-arrows-alt"
                      rendered="#{res.isOfficeResource() and not res.isOffline()}"/>

        <p:linkButton outcome="/lw/glossary/glossary" value="#{msg['Glossary.open']}" rendered="#{rightPaneBean.clickedResource.type eq 'glossary2'}">
            <f:param name="resource_id" value="#{rightPaneBean.clickedResource.id}"/>
        </p:linkButton>

        <p:linkButton outcome="/lw/survey/survey" value="#{msg['survey.open']}" rendered="#{rightPaneBean.clickedResource.type eq 'survey'}">
            <f:param name="resource_id" value="#{rightPaneBean.clickedResource.id}"/>
        </p:linkButton>

        <p:linkButton outcome="/lw/survey/results" value="Results" rendered="#{rightPaneBean.clickedResource.type eq 'survey' and userBean.user.moderator}">
            <f:param name="resource_id" value="#{rightPaneBean.clickedResource.id}"/>
        </p:linkButton>
    </div>
</ui:composition>
