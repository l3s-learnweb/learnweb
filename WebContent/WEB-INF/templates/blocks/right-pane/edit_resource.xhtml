<ui:composition xmlns="http://www.w3.org/1999/xhtml"
                xmlns:f="http://xmlns.jcp.org/jsf/core"
                xmlns:h="http://xmlns.jcp.org/jsf/html"
                xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
                xmlns:p="http://primefaces.org/ui">

<h:form id="edit_resource_form">
    <p:remoteCommand name="onUnloadCommand" actionListener="#{resourceDetailBean.releaseResourceIfLocked}"/>
    <p:poll interval="60" listener="#{resourceDetailBean.editActivityListener}"/>

    <ui:fragment rendered="#{resourceDetailBean.clickedResource.type eq 'text' or
                             resourceDetailBean.clickedResource.type eq 'website' or
                             resourceDetailBean.clickedResource.type eq 'pdf' or
                             resourceDetailBean.clickedResource.type eq 'video' or
                             resourceDetailBean.clickedResource.type eq 'image' or
                             resourceDetailBean.clickedResource.type eq 'audio'}">
        <ui:decorate template="/WEB-INF/templates/blocks/right-pane/preview_box.xhtml">
            <ui:param name="res" value="#{resourceDetailBean.clickedResource}"/>
        </ui:decorate>
    </ui:fragment>

    <div class="fg-grid mb-3">
        <ui:decorate template="/WEB-INF/templates/blocks/resources/edit.xhtml">
            <ui:param name="res" value="#{resourceDetailBean.clickedAbstractResource}"/>
        </ui:decorate>
    </div>

    <div class="d-flex">
        <p:defaultCommand target="saveResourceButton"/>
        <div class="mr-auto">
            <p:commandButton styleClass="alt-btn" value="Recreate thumbnail" actionListener="#{resourceDetailBean.onUpdateThumbnail}"
                             update=":right_pane" global="false" immediate="true" rendered="#{userBean.admin}"
                             onstart="PF('rightPaneOverlay').show();" oncomplete="PF('rightPaneOverlay').hide()">
                <f:setPropertyActionListener target="#{resourceDetailBean.paneAction}" value="viewResource"/>
                <f:setPropertyActionListener target="#{resourceDetailBean.clickedResource}" value="#{resourceDetailBean.clickedAbstractResource}"/>
            </p:commandButton>
        </div>
        <div>
            <p:commandButton value="#{msg.cancel}" styleClass="secondary-btn" actionListener="#{resourceDetailBean.cancelEditClickedResource}"
                             update=":right_pane" global="false" immediate="true"
                             onstart="PF('rightPaneOverlay').show();" oncomplete="PF('rightPaneOverlay').hide()"/>
            <p:commandButton id="saveResourceButton" value="#{msg.save}" actionListener="#{resourceDetailBean.editClickedResource}" update=":right_pane :growl" global="false"
                             onstart="PF('rightPaneOverlay').show();" oncomplete="PF('rightPaneOverlay').hide();resourceUpdatedHook();"/>
        </div>
    </div>
</h:form>

</ui:composition>
