<ui:composition xmlns="http://www.w3.org/1999/xhtml"
                xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
                xmlns:h="http://xmlns.jcp.org/jsf/html"
                xmlns:f="http://xmlns.jcp.org/jsf/core"
                xmlns:p="http://primefaces.org/ui"
                xmlns:c="http://xmlns.jcp.org/jsp/jstl/core"
                xmlns:fn="http://xmlns.jcp.org/jsp/jstl/functions">

<!--@elvariable id="question" type="de.l3s.learnweb.resource.survey.SurveyQuestion"-->
<!--@elvariable id="associated" type="java.lang.Boolean"-->
    <div class="mb-3">
        <div class="d-flex justify-content-between flex-nowrap mb-3">
            <div class="d-flex flex-column">
                <p:outputLabel for="selectTypeWrapper" value="#{msg['survey.question_type']}:" styleClass="fw-bold"/>
                <p:tooltip for="selectTypeWrapper" value="#{msg['survey.tooltip_select_type']}" rendered="#{question.id !=0 and associated}" position="left"/>
                <h:panelGroup id="selectTypeWrapper" layout="block">
                <p:selectOneMenu value="#{question.type}" disabled="#{associated and question.id != 0}">
                    <f:selectItems value="#{question.questionTypes}" var="type" itemValue="#{type}" itemLabel="#{msg['question_type.'+=type]}" itemDescription="#{msg['question_type.desc_'+=type]}"/>
                    <p:ajax event="change" update="answers" process="@this answers"/>
                </p:selectOneMenu>
                </h:panelGroup>
            </div>
            <div class="d-flex flex-column">
                <p:outputLabel for="@next" value="#{msg['survey.required']}:" styleClass="fw-bold"/>
                <p:tooltip for="@next" value="#{msg['survey.tooltip_required']}" rendered="#{!associated}" position="right"/>
                <p:toggleSwitch value="#{question.required}"/>
            </div>
        </div>

        <div class="d-flex flex-column mb-3">
            <div class="field">
                <p:outputLabel for="@next" value="#{msg['survey.question_text']}:" styleClass="fw-bold"/>
                <p:textEditor id="post_message" value="#{question.label}" required="true">
                    <f:facet name="toolbar">
							<span class="ql-formats">
								<button class="ql-bold"></button>
								<button class="ql-italic"></button>
								<button class="ql-underline"></button>
							</span>
                    </f:facet>
                </p:textEditor>
                <p:message for="@previous"/>
            </div>
        </div>

        <p:outputPanel id="answers">
            <p:outputPanel rendered="#{fn:startsWith(question.type,'INPUT_')}" styleClass="mb-3">
                <div class="d-flex flex-nowrap justify-content-between mb-3">
                    <div class="d-flex flex-column me-1">
                        <p:outputLabel for="@next" value="#{msg['survey.min_length']}:" styleClass="fw-bold"/>
                        <p:tooltip for="@next" value="#{msg['survey.tooltip_min_length']}" position="left"/>
                        <p:inputNumber value="#{question.options['minLength']}" decimalPlaces="0" leadingZero="deny" minValue="0" maxValue="6000" thousandSeparator="" required="true"/>
                        <p:message for="@previous"/>
                    </div>
                    <div class="d-flex flex-column ms-1">
                        <p:outputLabel for="@next" value="#{msg['survey.max_length']}:" styleClass="fw-bold"/>
                        <p:tooltip for="@next" value="#{msg['survey.tooltip_max_length']}" position="right"/>
                        <p:inputNumber value="#{question.options['maxLength']}" decimalPlaces="0" leadingZero="deny" minValue="0" maxValue="6000" thousandSeparator="" required="true"/>
                        <p:message for="@previous"/>
                    </div>
                </div>
            </p:outputPanel>
            <p:outputPanel rendered="#{!fn:startsWith(question.type,'FULLWIDTH_') and !fn:startsWith(question.type,'INPUT_')}">
                <div class="d-flex flex-column">
                    <p:outputLabel for="@next" value="#{msg['survey.answers']}:" styleClass="fw-bold"/>
                    <ui:repeat value="#{question.answers}" var="answer">
                        <h:panelGroup layout="block" styleClass="d-flex flex-row flex-nowrap my-1" rendered="#{!answer.deleted}">
                            <p:outputPanel rendered="#{question.type eq 'MULTIPLE_MENU' or question.type eq 'MANY_CHECKBOX' or question.type eq 'ONE_RADIO'}">
                                <i class="mx-1 fas #{question.type eq 'ONE_RADIO' ? 'fa-circle-thin' : 'fa-square-o'}" style="vertical-align: sub;"/>
                            </p:outputPanel>
                            <p:inputText value="#{answer.value}" placeholder="#{question.type eq 'AUTOCOMPLETE' ? msg['survey.auto_complete'] : msg['survey.option']}"/>
                            <p:tooltip for="@next" value="#{msg['survey.delete_answer']}" position="right"/>
                            <p:outputPanel>
                                <p:commandButton styleClass="bg-transparent border-0 text-dark fas fa-minus align-self-center" style="vertical-align: sub;"
                                                 action="#{surveyTemplateBean.onDeleteAnswer(answer)}" update="updateForm:answers" value="" process="@form"/>
                            </p:outputPanel>
                        </h:panelGroup>
                    </ui:repeat>
                    <p:tooltip for="@next" value="#{msg['survey.add_answer']}" position="left"/>
                    <p:commandButton styleClass="bg-transparent border-0 text-dark fas fa-plus align-self-center mt-2"
                                     action="#{surveyTemplateBean.onAddEmptyAnswer}" update="@form" value="" process="@form"/>
                </div>
            </p:outputPanel>
        </p:outputPanel>
    </div>
    <div class="d-flex flex-nowrap justify-content-between">
        <p:commandButton value="#{msg['delete']}" actionListener="#{surveyTemplateBean.onDeleteQuestion(question)}" update="surveyForm" oncomplete="PF('updateSurvey').hide();" styleClass="float-start">
            <p:confirm message="#{msg['survey.are_you_sure']}"/>
        </p:commandButton>
        <p:commandButton id="saveBtn" value="#{msg['save']}" actionListener="#{surveyTemplateBean.onAddQuestion}" oncomplete="if(!args.validationFailed){PF('updateSurvey').hide()}" update="surveyForm @form" process="@form"/>
    </div>
</ui:composition>