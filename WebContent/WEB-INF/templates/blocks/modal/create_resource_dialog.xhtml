<ui:composition xmlns="http://www.w3.org/1999/xhtml"
                xmlns:f="http://xmlns.jcp.org/jsf/core"
                xmlns:h="http://xmlns.jcp.org/jsf/html"
                xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
                xmlns:p="http://primefaces.org/ui">

<p:dialog id="createResourceDialog" widgetVar="createResourceDialog" header="#{msg.create_resource}"
          modal="true" resizable="false" draggable="false" responsive="true" closeOnEscape="true" dynamic="true">
    <h:form id="create_resource_form">
        <h:panelGroup layout="block" styleClass="fg-grid mb-3" rendered="#{addResourceBean.formStep == 1}">
            <h:outputText value="#{msg.type}:" styleClass="ui-outputlabel"/>
            <h:outputText value="#{addResourceBean.resource.type}" styleClass="fg-col text-capitalize"/>

            <h:outputText value="#{msg.location}:" styleClass="ui-outputlabel"/>
            <h:outputText value="#{addResourceBean.currentPath}" styleClass="fg-col"/>

            <ui:fragment rendered="#{addResourceBean.resource.officeResource}">
                <p:outputLabel for="@next" value="#{msg.title}:"/>
                <div class="fg-col">
                    <p:inputText value="#{addResourceBean.resource.fileName}" required="true" />
                    <p:message for="@previous"/>
                </div>
            </ui:fragment>

            <ui:fragment rendered="#{addResourceBean.resource.type eq 'website'}">
                <p:outputLabel for="@next" value="#{msg.url}:"/>
                <div class="fg-col">
                    <p:inputText value="#{addResourceBean.resource.url}" required="true" requiredmessage="#{msg.mandatory_field}" validator="#{addResourceBean.validateUrl}"/>
                    <p:message for="@previous"/>
                </div>
            </ui:fragment>

            <ui:fragment rendered="#{addResourceBean.resource.type eq 'file'}">
                <p:outputLabel for="@next" value="#{msg.file}:"/>
                <p:fileUpload id="fileUploadInput" listener="#{addResourceBean.handleFileUpload}" styleClass="fileupload-minimal" mode="advanced" auto="true"
                              sizeLimit="10000000000" fileLimit="1" label="#{msg.choose_file}" update="@form" required="true"/>
            </ui:fragment>

            <ui:fragment rendered="#{addResourceBean.resource.thumbnail3 != null}">
                <p:outputLabel value="#{msg.preview}:"/>
                <h:outputText escape="false" value="#{addResourceBean.resource.thumbnail1.html}"/>
            </ui:fragment>

            <ui:fragment rendered="#{addResourceBean.resource.type eq 'glossary2'}">
                <p:outputLabel for="@next" value="#{msg.title}:"/>
                <div class="fg-col">
                    <p:inputText value="#{addResourceBean.resource.title}" required="true" />
                    <p:message for="@previous"/>
                </div>
                <p:outputLabel for="@next" value="Allowed languages:"/>
                <p:selectCheckboxMenu value="#{addResourceBean.resource.allowedLanguages}" required="true" requiredMessage="#{msg.mandatory_field}"
                                      label="#{msg.language}" multiple="true" converter="localeConverter">
                    <f:selectItems value="#{addResourceBean.availableGlossaryLanguages}"></f:selectItems>
                </p:selectCheckboxMenu>
            </ui:fragment>

            <ui:fragment rendered="#{addResourceBean.resource.type eq 'survey'}">
                <p:outputLabel for="@next" value="#{msg.title}:"/>
                <div class="fg-col">
                    <p:inputText value="#{addResourceBean.resource.title}" required="true" requiredmessage="#{msg.mandatory_field}"/>
                    <p:message for="@previous"/>
                </div>

                <p:outputLabel for="@next" value="#{msg.description}:"/>
                <div class="fg-col">
                    <p:inputText value="#{addResourceBean.resource.description}"/>
                </div>

                <p:outputLabel for="@next" value="#{msg['Submission.open_date']}:"/>
                <div class="fg-col">
                    <p:calendar value="#{addResourceBean.resource.start}" id="editDialogOpenDate" binding="#{startDateComponent}"
                                required="true" locale="#{userBean.locale}" navigator="true" showOn="button">
                    </p:calendar>
                    <p:message for="@previous"/>
                </div>

                <p:outputLabel for="@next" value="#{msg['Submission.close_date']}:"/>
                <div class="fg-col">
                    <p:calendar value="#{addResourceBean.resource.end}" id="editDialogCloseDate" required="true"
                                locale="#{userBean.locale}" navigator="true" showOn="button">
                        <f:validator validatorId="dateRangeValidator"/>
                        <f:attribute name="startDate" value="#{startDateComponent}"/>
                    </p:calendar>
                    <p:message for="@previous"/>
                </div>
            </ui:fragment>
        </h:panelGroup>

        <h:panelGroup layout="block" styleClass="fg-grid mb-3" rendered="#{addResourceBean.formStep != 1}">
            <h:outputText value="#{msg.type}:" styleClass="ui-outputlabel"/>
            <h:outputText value="#{addResourceBean.resource.type}" styleClass="fg-col text-capitalize"/>

            <h:outputText value="#{msg.location}:" styleClass="ui-outputlabel"/>
            <h:outputText value="#{addResourceBean.currentPath}"/>

            <ui:fragment rendered="#{addResourceBean.resource.type eq 'website'}">
                <h:outputText value="#{msg.url}:" styleClass="ui-outputlabel"/>
                <h:outputText value="#{addResourceBean.resource.url}" />
            </ui:fragment>

            <ui:fragment rendered="#{addResourceBean.resource.type eq 'file'}">
                <h:outputText value="#{msg.file}:" styleClass="ui-outputlabel"/>
                <h:outputText value="#{addResourceBean.resource.url}" />
            </ui:fragment>

            <ui:fragment rendered="#{addResourceBean.resource.thumbnail3 != null}">
                <h:outputText value="#{msg.preview}:" styleClass="ui-outputlabel"/>
                <h:outputText escape="false" value="#{addResourceBean.resource.thumbnail1.html}"/>
            </ui:fragment>

            <ui:decorate template="/WEB-INF/templates/blocks/resources/edit.xhtml">
                <ui:param name="res" value="#{addResourceBean.resource}"/>
            </ui:decorate>
        </h:panelGroup>

        <div class="d-flex">
            <div class="mr-auto">
                <h:outputText value="* #{msg.mandatory_field}"/>
            </div>
            <div class="d-flex flex-row-reverse">
                <p:commandButton value="#{msg.next_step}" action="#{addResourceBean.handleUrlInput}" update="@form" global="false"
                                 rendered="#{addResourceBean.formStep == 1 and addResourceBean.resource.type eq 'website'}">
                </p:commandButton>

                <p:commandButton value="#{msg.addResource}" action="#{addResourceBean.addResource}" update="create_resource_form" global="false"
                                 onsuccess="resourceAddedHook(); return false;"
                                 oncomplete="handleDialogSubmit(xhr, status, args)"
                                 rendered="#{addResourceBean.formStep != 1 or addResourceBean.resource.type eq 'glossary2' or addResourceBean.resource.type eq 'survey' or addResourceBean.resource.officeResource}">
                </p:commandButton>

                <p:commandButton value="#{msg.cancel}" styleClass="secondary-btn" immediate="true" onclick="PF('createResourceDialog').hide();return false;"/>
            </div>
        </div>
    </h:form>
</p:dialog>

<script type="text/javascript">
  function handleDialogSubmit(xhr, status, args) {
    if (!args.validationFailed)
      PF('createResourceDialog').hide();
  }
</script>
</ui:composition>
