<ui:composition xmlns="http://www.w3.org/1999/xhtml"
                xmlns:f="http://xmlns.jcp.org/jsf/core"
                xmlns:h="http://xmlns.jcp.org/jsf/html"
                xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
                xmlns:p="http://primefaces.org/ui">

<!--@elvariable id="cbean" type="de.l3s.learnweb.dashboard.CommonDashboardUserBean"-->
<h:form>
    <div class="row">
        <p:outputPanel styleClass="col-md-4 align-items-end border-right" rendered="#{!cbean.singleUser}">
            <h5 class="my-2">
                Step 1. Select user(s) or group(s)
            </h5>
            <p:selectOneButton value="#{cbean.selectedType}">
                <p:ajax event="change" update="usersSelectorPanel usersCountPanel"/>
                <f:selectItem itemLabel="#{msg.users}" itemValue="1"/>
                <f:selectItem itemLabel="#{msg.groupsTitle}" itemValue="2"/>
            </p:selectOneButton>

            <p:outputPanel id="usersSelectorPanel" styleClass="my-2">
                <p:selectCheckboxMenu id="selectedUsersIds" value="#{cbean.selectedUsersIds}" var="user" label="#{msg.users}"
                                      filter="true" filterMatchMode="startsWith" rendered="#{cbean.selectedType == 1}">
                    <p:ajax event="change" update="usersCountPanel submitBtnPanel message"/>
                    <p:ajax event="toggleSelect" update="usersCountPanel submitBtnPanel message"/>

                    <f:selectItems value="#{cbean.allUsers}" var="user" itemValue="#{user.id}" itemLabel="#{user.username}"/>
                </p:selectCheckboxMenu>

                <p:selectCheckboxMenu id="selectedGroupsIds" value="#{cbean.selectedGroupsIds}" var="group" label="#{msg.groupsTitle}"
                                      filter="true" filterMatchMode="startsWith" rendered="#{cbean.selectedType == 2}">
                    <p:ajax event="change" update="usersCountPanel submitBtnPanel message"/>
                    <p:ajax event="toggleSelect" update="usersCountPanel submitBtnPanel message"/>

                    <f:selectItems value="#{cbean.allGroups}" var="group" itemValue="#{group.id}" itemLabel="#{group.title}"/>
                </p:selectCheckboxMenu>
            </p:outputPanel>

            <p:outputPanel id="usersCountPanel">
                <p><h:outputText value="#{msg.users_selected} #{cbean.selectedUsersIds.size()}" rendered="#{not empty cbean.selectedUsersIds}"/></p>
            </p:outputPanel>
        </p:outputPanel>

        <p:outputPanel styleClass="col-md-4 align-items-center my-2 border-right">
            <h5>
                Step 2. Choose a daterange for data to be shown
            </h5>
            <div class="row my-2">
                <div class="col-md-4">
                    <p:outputLabel for="dateStart" value="#{msg.start_date}" styleClass="mr-2"/>
                </div>
                <div class="col-md-8">
                    <p:calendar id="dateStart" var="date" value="#{cbean.startDate}" showOn="button"/>
                </div>
            </div>
            <div class="row">
                <div class="col-md-4">
                    <p:outputLabel for="dateEnd" value="#{msg.end_date}" styleClass="mr-2"/>
                </div>
                <div class="col-md-8">
                    <p:calendar id="dateEnd" var="date" value="#{cbean.endDate}" showOn="button"/>
                </div>
            </div>
        </p:outputPanel>
        <p:outputPanel id="submitBtnPanel" styleClass="col-md-4 d-flex">
            <h5 class="my-2">
                Step 3. Select the data
            </h5>
            <div class="row align-items-center">
            <p:commandButton value="#{msg.select}" icon="ui-icon-check" update=":content" action="#{cbean.cleanAndUpdateStoredData}"
                                     disabled="#{empty cbean.selectedUsersIds or cbean.usersLimitReached}">
            </p:commandButton>
            </div>
        </p:outputPanel>
    </div>
</h:form>
</ui:composition>
